<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[认识MBA]]></title>
      <url>/2019/03/03/%E8%AE%A4%E8%AF%86MBA/</url>
      <content type="html"><![CDATA[<p>MBA全称Master of Business Administration,中文是工商管理硕士，听到这个词是从一位工作人多年的长辈那里，那个时候我还在上大学，对MBA的理解很少，自己学的是工科，平常做的事情多数是技术相关，因此也较少接触到。后来随着工作时间的延长和个人阅历的改变，我开始出现申请读MBA的想法。</p>
<h2 id="一、认识"><a href="#一、认识" class="headerlink" title="一、认识"></a>一、认识</h2><p>相比传统意义上的大学，工作后报考的MBA其实属于半商半学，和普通的大学毕业时候报考的硕士研究生，在起源和培养上都是有区别的，商业活动占一半，大学教育占一半，依托于学院的商业机构进行项目合作培养。这样的培养也同时存在一些商业项目，比如EMBA，全称高层管理人员工商管理硕士，主要培养商业领袖，是很多企业老板的就读选择，国外高管多数是这样，毕业后回馈母校，比如北大光华学院的椅子背后都写了捐赠人。</p>
<p>不过，对于MBA认可度不必担心，工商管理硕士和普通报考的硕士一样属于专业硕士，是由教育部认可并下放名额，然后颁发学历学位证书。如果你拥有出色的工作成绩和管理经验，那么完全可以报考MBA,不仅可以提升学历，扩展眼界知识，也能结识同学资源，甚至找到终身伴侣，有的人还能圆了高考失利的名校梦。</p>
<p>报考需要参加国家同意的研究生考试，科目包括英语和综合，综合包括：数学、逻辑、写。同时也需要面试，商学院的目标是帮助那些最有可能成功的或者是即使没有mba也能成功的人，这些人成为面试筛选的目标人群，近几年越来越多的人报考，你该思考的是你能给商学院带来什么？ </p>
<h5 id="1、我的背景于MBA的距离？"><a href="#1、我的背景于MBA的距离？" class="headerlink" title="1、我的背景于MBA的距离？"></a>1、我的背景于MBA的距离？</h5><ul>
<li>帮助已经成功的人更成功和可能成功的人。</li>
<li>厦门大学：4年、大中型管理、表彰的先进工作者、资深或高级员工、本人创业并且实际参与经营、持有cfa\cpa、雅思6.0或者gmat600</li>
<li>发展很好的公司，顺势而为，比如05年的腾讯毕业4年就搞定</li>
<li>工作本身要具有竞争力，比如空姐、健身教练这些就没有竞争力</li>
<li>没管理也可以参加，但是要有管理潜力，评估自己的优缺点</li>
<li>收入需要满足条件</li>
</ul>
<h4 id="2、家里没旷是否读得起？"><a href="#2、家里没旷是否读得起？" class="headerlink" title="2、家里没旷是否读得起？"></a>2、家里没旷是否读得起？</h4><ul>
<li>在职：60万 - 30万</li>
<li>供需不平衡，资源是有限的，把愿意支付高昂学费的人筛选出来</li>
<li>管理层晋升的最佳途径，中高层</li>
<li>商学院的品牌效应</li>
<li>资历最好最受欢迎的教授，有可能学生怼死教授</li>
<li>有低利率的贷款，毕业后再还，花未来的钱投资现在的自己</li>
<li>读mba大多是中产阶级，才必须努力支持</li>
</ul>
<h4 id="3、读完mba能成大牛吗？"><a href="#3、读完mba能成大牛吗？" class="headerlink" title="3、读完mba能成大牛吗？"></a>3、读完mba能成大牛吗？</h4><ul>
<li>读完之后是什么状态，学历提升，整个行业的公司随便挑，进入门槛后，才能发挥价值</li>
<li>强大的校友资源，同窗友谊，一起撸串、出国、做作业</li>
<li>培养自己成为工商管理的人才，系统学习管理知识</li>
<li>心态上的改变，在身边的人更自信</li>
<li>视野上的提升，光华海外交流课程：短期游学1周、交流3个月、第二学年再国外</li>
<li>拥有更多的可能性，当然也遵循二八法则，差距越来大</li>
</ul>
<h4 id="4、mba课程是万金油吗？"><a href="#4、mba课程是万金油吗？" class="headerlink" title="4、mba课程是万金油吗？"></a>4、mba课程是万金油吗？</h4><ul>
<li>北大光华和清华经管是状元的聚集地，企业高管多数是工商管理</li>
<li>每个学校课程结构设置相似，管理学、经济学、财务、营销、商业实战等等，专业性比较高的课程里先进者带动后学者</li>
<li>个别学校有特色课程</li>
<li>学分制，出勤率、考试、小组作业、毕业论文，严进宽出</li>
<li>本质是学习管理，核心是决策，商界的黄埔军校</li>
<li>不会教你赚大钱，教授们没有创业过</li>
<li>方便转行，每个行业都需要管理者，跳槽50%，可以帮助你完成职业转变</li>
<li>课程会忘记，同学是资源，更多是同学的互相学习</li>
<li>读不读看自己的需求，读什么水平看自己能力，读完变成谁看自己的野心</li>
<li>思维方式肯定改变</li>
</ul>
<h2 id="二、报考"><a href="#二、报考" class="headerlink" title="二、报考"></a>二、报考</h2><h4 id="1、什么样的人时刻报考mba"><a href="#1、什么样的人时刻报考mba" class="headerlink" title="1、什么样的人时刻报考mba?"></a>1、什么样的人时刻报考mba?</h4><ul>
<li>一定工作经验急需开阔视野</li>
<li>丰富实战经验想要回头补充理论知识</li>
<li>想要提升学历背景的</li>
<li>工作寻求更大突破，不上不下，进一步上升困难，全面提升后作为新起点</li>
<li>想学习管理知识的，已经出色但是凭借经验无法处理的问题，学识加成</li>
<li>人际圈子狭小，渴望高品质社交</li>
<li>想要找到优质人生伴侣，也有被拆散家庭的风险</li>
<li>25-31岁，具备一定经济基础，知道自己缺乏和需要什么</li>
<li>一定具有学习能力和工作能力</li>
</ul>
<h4 id="2、报考条件是否可以商量？"><a href="#2、报考条件是否可以商量？" class="headerlink" title="2、报考条件是否可以商量？"></a>2、报考条件是否可以商量？</h4><ul>
<li>学历必须符合，大专5本科3</li>
<li>英语，提前面试有的学校包含英语口语，学期包含海外交流板块，联考必须考英语2</li>
<li>工作背景，最好具有一定的管理经验，对企业的实际情况有深入认识，具备较好的领导才能，工作具有竞争力和潜力</li>
<li>年龄，平均工资年限是8年，虽然工作年限是那样，但是普遍要长一点</li>
</ul>
<h4 id="3、我的大学专业影响我报考mba"><a href="#3、我的大学专业影响我报考mba" class="headerlink" title="3、我的大学专业影响我报考mba?"></a>3、我的大学专业影响我报考mba?</h4><ul>
<li>并没有跨专业一说，任何专业都可以报考，无论医学、设计、表演</li>
<li>提前面试对管理能力和领导能力的考核</li>
<li>非全日制本科在个别学校是有区别的，但是工作学习能力、综合素质高是特例</li>
<li>告诉老师们不光写日记还会背单词，展示了自己的坚持能力</li>
<li>很多工程师是为了改变自己的现状，需要让老师看到转行为商业是没有问题的</li>
</ul>
<h4 id="4、报考流程，我到北大mba需要几步？"><a href="#4、报考流程，我到北大mba需要几步？" class="headerlink" title="4、报考流程，我到北大mba需要几步？"></a>4、报考流程，我到北大mba需要几步？</h4><ul>
<li>提前面试、考试、复考，最少2年，有的学校需要3年，比如厦门和武汉大学</li>
<li>提前面试：5月-11月，官网查询，允许考2年，第3年重新面试</li>
<li>全国联考：综合：数学是高中数学、逻辑公务员判断、写作论说文、论证分析，英语科2时六级水平</li>
<li>国家线都达到，英语单科线，总分线，综合线</li>
<li>政治，学校自己出题，会出大纲，每年都会淘汰一小部分人，马列、毛思、社会主义现代化</li>
<li>英语听力考试</li>
<li>政审复试</li>
<li>7月份收到录取通知书</li>
</ul>
<h4 id="5、提前面试到底面什么？"><a href="#5、提前面试到底面什么？" class="headerlink" title="5、提前面试到底面什么？"></a>5、提前面试到底面什么？</h4><ul>
<li>每个学校不同，组面与个面考核综合素质</li>
<li>组面：七八个人探讨，老师旁观，比如华科</li>
<li>个面：多个老师对你，比如清北</li>
<li>教育背景、学校成绩、学习能力</li>
<li>职业经历：工作性质、工作成绩、担任职务、企业规模、该行业的了解程度</li>
<li>仅仅是搞研发或者会计，工作内容比较单一</li>
<li>你的个人成绩大于的企业，必须在组织里取得很好的成绩，最忌讳谈公司多厉害而不是自己</li>
<li>任职的企业，快速发展的公司又于缓慢的人走到</li>
<li>思维逻辑和反应能力，判断问题的思考和回答，抓住问题的重点</li>
<li>某些院校还有压力面试，形象和谈吐也重要，看一部分颜值</li>
<li>表现出上进、求知</li>
</ul>
<h4 id="6、选顶尖mba还是适合自己的mba？"><a href="#6、选顶尖mba还是适合自己的mba？" class="headerlink" title="6、选顶尖mba还是适合自己的mba？"></a>6、选顶尖mba还是适合自己的mba？</h4><ul>
<li>地点，哪个城市工作可以考虑当地附近的，在职每个周末都上课，异地成本开销大，全日制不受影响</li>
<li>学费：北大光华2019年，32万，复旦在职接近40万</li>
<li>专业偏好：比如上交和清华也有分开的，金融班、创业班、国际班</li>
<li>结合学校：理工还是人文，是否有特色课程</li>
<li>时间，是否忙得难以上课做作业</li>
<li>录取率，如何在一群优秀的人里面脱颖而出</li>
</ul>
<h4 id="7、清华与北大的区别？"><a href="#7、清华与北大的区别？" class="headerlink" title="7、清华与北大的区别？"></a>7、清华与北大的区别？</h4><ul>
<li>学校风格：清华走的是精英风格，比如2016年大专生不允许报考，在教育部基础上提高了很多，70%名校本科生，联考分数比北大高。北大是兼容并包的风格，按照教育部条件招生。</li>
<li>学员的区别：清华精英意识和凝聚力更强，比较注重外面的舆论。北大不在乎，不拘一格降人才，我就是国内第一学府。</li>
<li>商学院：清华经管，公布学生数据，背景都很强，招到的是职业经理人，北大光华不公布数据，找的是未来的企业家，更加看重潜力。</li>
</ul>
<h4 id="8、普通硕士、MBA、EMBA总裁班的区别？"><a href="#8、普通硕士、MBA、EMBA总裁班的区别？" class="headerlink" title="8、普通硕士、MBA、EMBA总裁班的区别？"></a>8、普通硕士、MBA、EMBA总裁班的区别？</h4><ul>
<li>培养目标：mba是具有职业背景的硕士学位，特定职业高层次人才，普硕，教育和科研人才。</li>
<li>招生条件：普硕不需要具有工作年限，mba一定需要工作经验。</li>
<li>招生考试：考试内容和难度不同，普硕要难很多，也是含金量不高的原因的来由，但是mba的淘汰率是远高于普硕的。所以归根到底是定位的不同。</li>
<li>学习方式不同：普硕都是全日制，mba是可以非全日制的，而且非全日制是远多于全日制的，大多数人不愿意脱产。</li>
<li>学费不同：学校设的门槛，筛选出优秀的人。</li>
<li>MBA与E总裁班的区别：中小企业的老板，混圈子、学习管理知识同时不用耽误时间，颁发培训证书，不是学历证也不是学位证。人数不设限制，照得越多赚钱越多，mba是教育部设定的人数，招生是全国统一的，有毕业证与学位证。</li>
<li>EMBA：高级管理人员，过去只有学位证，2017年起需要统一参加年考，毕业后开始学历证。清华北大特权，可以自主命题和划线，给老板们一条不一样的通道。入学流程与mba一样，emba面试成绩占90%，过去很多明星喜欢，年纪偏大，39，职位很高决策者，老板读的项目。学费昂贵，50-70万，也是盈利项目，家里有矿就能读的就是这种。mba不盈利，教学为目的。</li>
</ul>
<h4 id="9、在职与全日制怎么选？"><a href="#9、在职与全日制怎么选？" class="headerlink" title="9、在职与全日制怎么选？"></a>9、在职与全日制怎么选？</h4><ul>
<li>在职：在职人员，一个月2-3个周末，2017后年起毕业证开始非全日制的盖章区别，但是跳槽是没有大区别，由学位决定，企业不做区别。年纪偏大，人数远多于全日制。学习背景稍微低，但是职位和薪资要求高。在职的通过人数要低一些，因为报考人数更多。在职比全日制学费更贵。中文班。</li>
<li>全日制：上课时间和普硕差不多，全日制毕业证，应届身份。年纪偏小，清北希望报考低于30周岁。学历背景考核的比例更高，国外没有非全日制，中国是特色的社会主义道路。招生的人数不多，背景基本都是本科名校。含金量是同等的，为什么对在职有偏见，有的不需要参加统考，以前存在在职研究生。很多不招收中文班，基本都是英文班，全英文授课。</li>
</ul>
<h2 id="三、备考"><a href="#三、备考" class="headerlink" title="三、备考"></a>三、备考</h2><h5 id="1、如何备考？"><a href="#1、如何备考？" class="headerlink" title="1、如何备考？"></a>1、如何备考？</h5><ul>
<li>了解院校的招生流程，弥补工作背景和学习能力</li>
<li>笔试复习，用心复习3-4月，全力复习4科，每天复习2门</li>
<li>英语解决单词问题，大声读出来，用黑板写出来放在视线可见处，考前一个月作文模版</li>
<li>数学参考机工版教材，淘宝、网课</li>
<li>逻辑不拉分，作文要听辅导班的课程，很拉分，多练笔</li>
<li>4个月，除去工作，每天4个小时</li>
<li>看到热点新闻可以说说自己的看法？</li>
</ul>
<h5 id="2、mba辅导班的作用？"><a href="#2、mba辅导班的作用？" class="headerlink" title="2、mba辅导班的作用？"></a>2、mba辅导班的作用？</h5><ul>
<li>相对于个人盲目复习，辅导班对考点把握好，知识结构方式可以，增加考试把我和信息。</li>
<li>面试辅导和笔试辅导，不能保证进入或者拿到名额，面试辅导如果找得到校友资源，直接找师哥师姐，校友帮忙最有效。口碑比较好的辅导班，遇到一个好的老师。</li>
<li>笔试辅导，直接买网课就行，自己私下里用过复习就行。</li>
<li>提防：数字游戏，比如清北通过率软文博眼球，有的小型辅导班老师是兼职。宣扬状元，事实是人家状元的能力强。签约保过，如果考不上就全额退款。</li>
</ul>
<h5 id="3、学习和工作背景不好如何逆袭？"><a href="#3、学习和工作背景不好如何逆袭？" class="headerlink" title="3、学习和工作背景不好如何逆袭？"></a>3、学习和工作背景不好如何逆袭？</h5><ul>
<li>工作时间短没问题，必须在工作上有突出的成绩，获得过一些荣誉、因为我的存在而不同，要有切实的成绩</li>
<li>职位低，比较难处理，是个缺陷，要有优秀管理者的潜力，自律提高自己的决心，必须要有升职的潜力，要比同龄人更优秀，对未来的计划是明确的，非常清楚并一直在努力。</li>
<li>大专生，多次脱颖而出获得奖励，打败起点高跑得快的人，很难也是少数。</li>
<li>和同龄人对比，比人家要优秀</li>
<li>工作背景优秀，拿过优秀员工，非常强的自律能力，背了600多天的单词和日记，我也很大的野心，我的理想就是做个成功的企业家，直接告诉老师。</li>
</ul>
<h4 id="4、mab的数据"><a href="#4、mab的数据" class="headerlink" title="4、mab的数据"></a>4、mab的数据</h4><ul>
<li>报考人数：2018年，243所招收，2016年10.9万、14.2万、17万人，20万人。</li>
<li>录取率：%22-%24</li>
<li>学费上涨：北大26.8万 - 29.8万 - 32.8万，厦门大学：16.8万-17.8万，学校自己定教育部审批，交给学校学费和运作。越早报考越有利。</li>
<li>年龄：北大在职 32，清华33，中国在职录取33岁，年收入63万，30-100万。全日制：28岁，10-40万之间。</li>
<li>职位：总经理、副总经理，业务经理、一般职员，创业者</li>
<li>工作年限：5-8年，在职8-9年，全日制5-6年。</li>
<li>学历分布：18.3大专，73.2本科 硕士6.7 博士1.9</li>
<li>行业分布：金融24，科技通信23，制造业10</li>
<li>薪资涨幅：100万 6.6 50-100万23.1 30-50万35.5</li>
</ul>
<h4 id="5、mba的内幕你知道多少？"><a href="#5、mba的内幕你知道多少？" class="headerlink" title="5、mba的内幕你知道多少？"></a>5、mba的内幕你知道多少？</h4><ul>
<li>分院：学校是商业盈利性质的，并且需要方便每个学员，需求决定供给，风险就是生源质量不对等，不同地区也可能出现精英，与本部的对待教学和毕业没有区别，本部的录取率要比分院低。</li>
<li>北大mba直接：光华和汇丰都是发双证，毕业证的学院名不同，汇丰12年才开始，行业相对单一。</li>
<li>mba黑幕：提前面试全程录像，杜绝利益输送，黑幕基本很少，教育部严格监管。</li>
</ul>
<h4 id="6、你与成功差一份备考攻略？"><a href="#6、你与成功差一份备考攻略？" class="headerlink" title="6、你与成功差一份备考攻略？"></a>6、你与成功差一份备考攻略？</h4><ul>
<li>打算未来报考在校的大学生：先认真学习，多参加社团的活动，制定职业规划</li>
<li>职场新人：培养视野和管理能力，一定要作出出色的成绩，先改变自己才有资格报考，明确定位，提高笔试能力，读书英语</li>
<li>马上报考的人：整理自己的</li>
</ul>
<blockquote>
<p>参考资料：</p>
<ul>
<li>千聊《北大学长教你逆袭MBA》 <a href="https://www.qlchat.com/official/student" target="_blank" rel="noopener">https://www.qlchat.com/official/student</a></li>
<li>中国研究生招生网: <a href="https://yz.chsi.com.cn/z/yzmba/" target="_blank" rel="noopener">https://yz.chsi.com.cn/z/yzmba/</a></li>
<li>MBA智库： <a href="https://wiki.mbalib.com/wiki/MBA" target="_blank" rel="noopener">https://wiki.mbalib.com/wiki/MBA</a></li>
<li>MBA中国网：<a href="http://video.mbachina.com/mba" target="_blank" rel="noopener">http://video.mbachina.com/mba</a></li>
<li>知乎：<a href="https://www.zhihu.com/topic/20169588/hot" target="_blank" rel="noopener">https://www.zhihu.com/topic/20169588/hot</a></li>
</ul>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[19年的展望]]></title>
      <url>/2019/01/14/19%E5%B9%B4%E7%9A%84%E5%B1%95%E6%9C%9B/</url>
      <content type="html"><![CDATA[<p>时间过得很快，快到还没反应过来新的19年就已经过去半个月，硬生生的把18年的回顾写成了19年的展望，不过这半个月确实是忙得飞起，事情一件一件，还都不是小事，也就可以理解一些。想想这一年都干了啥，人真的健忘，除了一些关键节点的记忆，剩下的时日着实想不起在做啥，是因为工作和生活的重复而忙碌让可圈可点的世界显得平凡了些？让我开始慢慢总结2018年。</p>
<h3 id="一、回顾："><a href="#一、回顾：" class="headerlink" title="一、回顾："></a>一、回顾：</h3><h5 id="1、工作：Biu项目"><a href="#1、工作：Biu项目" class="headerlink" title="1、工作：Biu项目"></a>1、工作：Biu项目</h5><p>记得年初的时候我在封闭项目，年底的时候我也在封闭项目，公司这样高速发展到处都在开新项目也属正常。biu项目的定位是校园社交，最开始让去支持这个项目的时候，我认为块领域是可以做的，非常乐意的就去往，毕竟人人网落幕之后这块再没出现有影响力的产品，如果能够做出一款有新社交产品，影响甚至改变人们的生活 将是非常有价值和意义的事情。</p>
<p>项目前期花较长的时间在一个评价的玩法上，类似国内的tataUFO,不过这个玩法有些单一，兴许是国内外环境不同，这样的功能用户看来最多图个新鲜却留不住，几个产品却在这上面花了很多心思，讲到我们需要添加更多玩法，我因此针对性的接入了小程序的sdk,建立了两个小游戏在上面。做了一段时间后，产品决定不往外推，内测的反馈和定位都不太好。随后我们开始做朋友圈功能，并要在IM的及时聊天中继续玩上述的评价游戏，与此同时运营同学开始去拉在校学生进行使用和会谈，找一找学生们的想法。随着一波内测的外部用户推广，有些学生进来，他们也坚持发朋友圈，收到了一些有效的反馈，但是到这里的时候下一步的发展依旧不太清晰有些迷茫。整个过程中我们感觉到产品同学其实没有太多的社交想法，比如IM对话框内复杂的交互设计还是我提出的优化，或许是因为之前没有做过社交产品吧。作为研发的立场提出的一些想法，是一些产品设计上的想法，在产品方向上并没有机会参与到更多，方向不能确立，整个团队就开始变得有些摸不着头脑，后来几个负责人出现分歧，导致项目有些停滞，就逐渐的解散了。</p>
<p>当然尽管项目没做起来，还是学到了很多，不仅仅是技术上的问题，更多的是团队和产品的理解，一款好的产品需要优秀的团队合作来支持，一个优秀的团队也需要好的产品来引领，创意的产品方案和良好的团队合作才有机会做出战略市场的产品。项目结束后就到了年终评定，这个时候是4月份了，认真做事勇于参与合作让我获得了好的评价，获得了提升。</p>
<h5 id="2、求学：获得英国高级计算机硕士offer"><a href="#2、求学：获得英国高级计算机硕士offer" class="headerlink" title="2、求学：获得英国高级计算机硕士offer"></a>2、求学：获得英国高级计算机硕士offer</h5><p>我不仅有做出一款互联网产品的愿景，内心深处蕴藏着一个求学的理想。本科毕业没有再坚持继续读研究生的路线，一方面是视野不够宽，考虑不清楚读什么研究生方向，想自己进入社会建立认识后再选择，另一方面是父母已经培养我辛苦了很久，自己也想先回报下父母。17年的时候有意识的开始申请，想看下自己能够申请到什么样的学校，学习了一段时间雅思，考试完开始提交申请材料，让还在学校的老同学帮忙办理各种证明，也是心生感谢。因为各种原因我申请的时间比较晚，错了很多学校的投递，到18年3月的时候才开始出结果，令我欣慰的还是申请到2所学校的offer,一所是曼切斯特大学，一所是布里斯托大学，在全球算是排名靠前的学校，我看到了自己大学成绩和背景能对标英国学校水平。拿到offer后，我思考了良久，决定放弃offer，因为随着在公司发展的成长和认识变化，自己如果出去读书，不仅错过了字节跳动高度发展的难得机遇，也给自己增加了很多经济压力，像字节跳动这样的企业发展在互联网的历史算其中一个奇迹了。</p>
<h5 id="3、工作：从头条到抖音"><a href="#3、工作：从头条到抖音" class="headerlink" title="3、工作：从头条到抖音"></a>3、工作：从头条到抖音</h5><p>社交项目结束后，回到今日头条主业务组。做了一段时间，公司开始针对主业务进行人员变更，老部门的划分到新部门的成立，业务也分拆出去。在头条业务组呆了2年多，恰逢业务和人员变更，决定在公司内部进行岗位调整，于是联系了抖音这边，新环境新开始。交接完毕后来到抖音主业务组工作，认识了很多新同事，团队氛围很好，感觉自己做了一个正确的决定。我开始接触更新的产品，与更大的团队进行开发合作，有机会去上海出差，参与到国际化的项目中，也参与到春节封闭的项目中，又与之前的保密项目进行对接。到目前为止已经大半年了，工作上还是蛮开心的，收获了很多，但也发现了自己的不足地方，还需要再提升。</p>
<p><img src="/assets/myPhoto/22.jpg" alt=""></p>
<h5 id="4、出行："><a href="#4、出行：" class="headerlink" title="4、出行："></a>4、出行：</h5><ul>
<li>北京周边爬过野长城，滑雪成功拿下张家口万龙的高级雪道，从山顶下来的酸爽正是滑雪的乐趣，蛮有成就感的，感觉离阿尔卑斯又近了一步。</li>
<li>去了泰国一次，算是第一回出国了，东南亚的风情确实不一样，711好便宜。</li>
<li>去了宁夏一次，怀念和感受了当年大话西游的情怀，蹦极的刺激</li>
<li>去香港一次，第一回带着爸妈出去旅游，正好是妈妈50岁生日，以后要做更多对父母尽孝的事情。</li>
<li>去重庆一次，新房交接，自己工作3年的成果之一，很开心。</li>
</ul>
<h5 id="5、业余学习："><a href="#5、业余学习：" class="headerlink" title="5、业余学习："></a>5、业余学习：</h5><ul>
<li>看了几本业外书籍，对企业和团队的认识有明显提升。</li>
<li>报了个钢琴班，坚持培养一个习惯，练习得不够多。</li>
</ul>
<h3 id="二、展望："><a href="#二、展望：" class="headerlink" title="二、展望："></a>二、展望：</h3><p>虽然写了不少，其实还发生了很多事情，不仅是工作学习，在对亲人朋友在感情上的认识有了一些变化。新的19年已经开始，我也马上就要回家过年，希望在新年里能够做得更好，找准自己要走的路线，去大胆尝试。又到了立目标的时候了，不断的修正和检验自己的目标，年底进行验收，还是那句话年轻就要多奋斗，在北京这样的地方目标需要十分清晰。</p>
<ul>
<li>继续在抖音团队效力，主动承担更多，业务上有明显产出，技术上有明显提升。</li>
<li>扩展边界，学习产品经理的能力</li>
<li>探索方向，放弃英国留学后寻找下一个突破</li>
<li>阅读管理和经济方面的书籍，眼界和思维的提升</li>
<li>继续坚持钢琴的学习，虽然慢，但在进步</li>
<li>坚持锻炼，跑步或者去健身房，年轻人应当有充沛的精力和体力</li>
</ul>
<p>最后，加油吧，当你渐渐的不再少年……</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[遇见上海]]></title>
      <url>/2018/08/21/%E9%81%87%E8%A7%81%E4%B8%8A%E6%B5%B7/</url>
      <content type="html"><![CDATA[<p>转岗到抖音一个多月，逐渐融入团队，也适应了业务的变化。老大是个非常奈斯的人，常常想着给组员谋福利，不是出去聚餐就是发放活动的票务，这次得到机会出差去上海和国际团队交流，第一次感受大上海的魅力,暗自激动着。</p>
<p>周三早早的就出门去机场，同行的小伙伴也是开心得很，一路有说有笑，真是一趟不一样的出差，我们作为客户端的研发，业务在哪人就在哪，很少说有机会去出差的，加上现在公司的远程沟通工具已经愈加方便，所以这次出差可以用喜出望外来形容，在机场吃了一顿真功夫的套餐，然后就径直的开始登机。</p>
<p><img src="/assets/myPhoto/23.jpg" alt=""></p>
<p>落地到达虹桥机场，下了飞机大家都开始激动起来，中关村的码农来到了金融大上海见世面的样子哈哈。我们开始乘坐地铁去住宿的酒店，看了下上海的地铁线路，还是北京的比较齐整，地形差异大。大概一个小时地铁，我们到达了徐家汇全季酒店，虽然环境很棒，但是大家都很饿了，来不及欣赏就收拾好出门，去到了上海著名的日月光中心广场，在大众点评上搜索了传说中的本帮菜，味道还是很不错的，饭饱之余来一张合照：</p>
<p><img src="/assets/myPhoto/24.jpg" alt=""></p>
<p>第二天我们前往Musical.ly的办公区，被字节跳动收购后就与抖音和在一起了，目前国内是抖音，国外就是Musical.ly和Tiktok。正在办公的同事给我们安排了座位接待我们，带着我们参观8号桥创意园区。</p>
<p><img src="/assets/myPhoto/25.jpg" alt=""></p>
<p>参观结束之后，我们开始了紧锣密鼓的业务对接，针对各个业务需求线的开发工作开了蛮久的会议。晚上由当地的同事带着一起去吃了晚饭，相互认识认识。</p>
<p>第三天是周五正常的上班，认真做完手上的工作后，就约同学出去吃饭了。</p>
<p> 上海的同学蛮多的，大学高中都有不少，是各行各业的精英啊，当然还在正在上学的朱博士。本来约的周六，突然说家里有事就改到周四了，查询地图才发现八号桥距离上海交通大学的校区很远，还想说去学校逛逛，来个夜游上交的什么的，无奈是真远，往返得三小时，于是订了个中间的位置。有一年没见吧，一起吃了顿火锅，聊了很多，内容广，故事长。</p>
<p> 第二天周五，大家都下班得早，我联系了高中同学阿曾，也是博士，复旦的曾博士，刚好就在日月光附近上班，有点巧，说到打车来我附近带我去吃东西，我说好的。哈哈，不知道前方高能有多高。下车之后给我打电话，说自己站在哪哪个地方，我真的是望穿秋水都没看到人，八年没见了，高中毕业之后就再没见过，而且曾博士完全变了个样，以前高中那会儿是肥肥的，现在已经是代表月亮消灭你的美少女了，我一脸震惊然后一顿狂笑，花了大概半个小时适应她现在的样子，嗯，女大真是十八变呢，不过她说我完全没有变样，还是老样子。打了个车就去了一个看起来很高级很有格调的地方吃饭，嗯，在楼顶，周围可见的高楼灯光，嗯，云南菜。随后两个重庆娃儿夹扎着不飘准的普通发，在上海的夜里谈笑风生。</p>
<p> 随后，我打车前往资深自动驾驶项目经理老夏的家里，嗯，老夏不是博士。在我之前老冯已经比我先到，正和老夏两口子一起撸火锅，是的，又是火锅。我到达后就一起交谈，在相互吹牛的时候隐约感觉有点不对劲，吃完火锅就去老夏家留宿了，果然第二天老夏自己去了公司，把我和老冯放在了家里。本来老夏之前说喊我来上海，要带我去游玩，带我去去看海，我还是满怀期待的到处走走的，结果还是一如即往的坑，不注重朋友相互来往的用户体验。我和老冯在他家里呆到了下午，老冯似乎没啥所谓的，毕竟上海呆了这么久啥没见过，可是我出差只有这点时间第二天就要回北京的啊。到晚饭时间，约了同期的高中同学一起聚聚，他们也很久没聚会了，趁着我来上海刚好组织一波。我和老冯先出发过去，老夏从公司打车过去，吃饭的地点是一家火锅店，没错，还是火锅，我来上海一连三顿，幸好第一天品尝了本帮菜。</p>
<p> 见到老同学们大家都挺开心的，刚开始有些腼腆，相互问候了下情况，结果说着说着就起飞了，一下子龙门阵就扯了起来，哈哈，都是在上海生活的精英们，不少同学表示将来要留在上海，也有一些同学正在为下一步工作做打算，怀念啊，高中毕业已经过去多年。</p>
<p> <img src="/assets/myPhoto/26.jpg" alt=""></p>
<p> 饭后，大家说带着我逛逛，看看江滩的风景，看看以前上海的老建筑，我终于来到了传说中的上海滩。</p>
<p>  <img src="/assets/myPhoto/28.jpg" alt=""></p>
<p>  <img src="/assets/myPhoto/27.jpg" alt=""></p>
<p>  第二天起飞回北京的飞机在浦东机场，特意选在那边的，想去感受下到机场的磁悬浮列车，老冯就是住在那边，晚上就和他一起过去留宿，聊着聊着就困睡了。第二天早上与老冯道别后，我在地铁站约了另外两个朋友笑娃和老冉见面吃饭，因为他们刚好都在浦东这边，之前几天的地方离他们都很远，前两天吃火锅真是吃够够的，选了一家贵州菜。三个不同行业的人坐在一起，讲述着各自的工作认识和生活见解，真别有一番体验，看到了社会不同的世界，我在北京中关村敲键盘，笑娃在上海通用拧螺丝，老冉在中科院药学所写方子，我们都有光明的前途。</p>
<p>  <img src="/assets/myPhoto/29.jpg" alt=""></p>
<p>  饭后，我就要起程返航北京了，送走了两位朋友离开，钢嫂在最后的时候赶了过来，我们在地铁站聊了一会，打了两把刺激战场，我就坐上磁悬浮列车去往了机场，磁悬浮是真快，快到感觉列车转弯就要飞出去。</p>
<p>  回顾整个上海之行，还是很匆忙的，除了正常工作之外，其他地方也没有太多去逛逛，主要时间是会见朋友，虽然都短暂，但大家都太忙，有机会都见不到下次再见不知何时。我走的时候上海正在下雨，内心很平静喜欢，来北京已经4年了，很久没有见到上海这般刷刷大雨，大概还是以前大学的时候吧。</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[26岁]]></title>
      <url>/2018/06/15/26%E5%B2%81/</url>
      <content type="html"><![CDATA[<p>18年过了一半，感觉这半年过得好快，不知道为什么觉得比之前的时间都快，埋头一想来北京的第4年马上就结束了。这一路摸索走来，做了好些思考和尝试，4年的工作路线的规划和实现，对自己是满意的。</p>
<p>4年相当于我在北京又念了一个大学，才来的时候周围读研的人很多，觉得在北京高中和大学同学都蛮多的，多到很多都来不及约，这样的氛围也让我不觉得孤单。慢慢的，他们毕业找了工作，一些人离开了这里，或去了别的城市，或回去了重庆，看朋友圈的一些动态，大部分高中同学还是都选择了回去，回去那个他们曾经想要离开的城市。重庆，在外地人眼里是个好吃好玩的旅游城市，这半年随着抖音的兴起，又让重庆火了一把，洪崖洞的夜景总是人山人海，而我在重庆的时候就白天去逛过一次，这就好比，就九寨沟因为地震毁了的时候我才想起，自己好像从来没有闲下心来去欣赏那些本来离我很近的风景。故事大多如此，多数人都这样，你眼里的普通在他人眼里却是一道独立的风景。我想我可以改变一下了，做点什么。</p>
<p>我开始变得不像从前那样匆忙，发现一些更为有趣的生活；在图书馆看书，去学校跑步，去音乐会，去酒吧嗨一嗨，去北京的周边走一走，或者更远的地方，一个人。</p>
<p>我开始不再因为领导的话语而坐在办公室更久，工作这个事情还是讲效率和成果，投入时间多了没什么产出反而影响效率，并且我也意识到他不是一个优秀的老大，我的人生里不想再受他的想法影响太多。</p>
<p>我开始享受一个正常的人生速度，不想再急切的实现去实现一个个目标，梦想也是可以慢慢实现的。我爸说的对，人这一生这么长，你们这个行业变化很多，你们从业人员一直出于不断学习的过程，总会在一个时候能做出成绩的。是的，我也热爱互联网，因为这里常常诞生奇迹。</p>
<p>组里来了一些小鲜肉，我开始不再是年龄的末尾了，不能再有小兄弟的心态，反而我会称呼他们为小兄弟或者小伙子，然后开启商业互吹模式。</p>
<p>我感受到了自己的认识和心态的变化，节奏稍微慢一点会有条理一些，真的很喜欢《从前慢》这首歌，在歌声描述的环境里会觉得时间是自己的，自己再享受时间的流逝。不过我依旧得保持一颗积极向上的心，不能因为节奏的慢而放松懒散，因为我希望在北京的日子里，是无悔的奋斗青春史，就和之前一样，让我在北京这时间里做一些有意义的事情。</p>
<p>整理下这半年的情况 ：</p>
<blockquote>
<p>1、头条内部创业创新项目完结，工作上升</p>
<p>2、英国学校Offer，曼切斯特大学和华威大学的高级计算机</p>
<p>3、看了几本书</p>
</blockquote>
<p>下半年想做的一些事情，年底再来check ：</p>
<blockquote>
<p>1、加强技术知识，刷刷Leetcode</p>
</blockquote>
<blockquote>
<p>2、出去旅行一次</p>
</blockquote>
<blockquote>
<p> 3、入门一门乐器，周六日上培训班</p>
</blockquote>
<blockquote>
<p>4、头条的日常工作有所产出，加强与同事沟通</p>
</blockquote>
<blockquote>
<p>5、搬家、办理工作居住证、日本护照签证、香港签证、</p>
</blockquote>
<p>整理了下感觉还行，一下子路线又有了纹路，就按照这几个方面去完成吧。</p>
<p>今天是6月15日，我坐在去往天津的火车上，26岁，祝自己生日快乐。</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[New一个golang爬虫]]></title>
      <url>/2017/09/01/New%E4%B8%80%E4%B8%AAgolang%E7%88%AC%E8%99%AB/</url>
      <content type="html"><![CDATA[<blockquote>
<p>刚好七八双月结束，工作整理完毕，下个双月OKR还没开始。做久了IOS开发也来扩展下领域，抽空几天学了下Golang，实现一个爬虫。</p>
</blockquote>
<h2 id="一、知识要点"><a href="#一、知识要点" class="headerlink" title="一、知识要点"></a>一、知识要点</h2><h3 id="1、爬虫"><a href="#1、爬虫" class="headerlink" title="1、爬虫"></a>1、爬虫</h3><h4 id="1-1-工作方式"><a href="#1-1-工作方式" class="headerlink" title="1.1 工作方式"></a>1.1 工作方式</h4><p>传统爬虫从一个或若干初始网页的URL开始，获得初始网页上的URL，在抓取网页的过程中，不断从当前页面上抽取新的URL放入队列,直到满足系统的一定停止条件。聚焦爬虫的工作流程较为复杂，需要根据一定的网页分析算法过滤与主题无关的链接，保留有用的链接并将其放入等待抓取的URL队列。然后，它将根据一定的搜索策略从队列中选择下一步要抓取的网页URL，并重复上述过程，直到达到系统的某一条件时停止。另外，所有被爬虫抓取的网页将会被系统存贮，进行一定的分析、过滤，并建立索引，以便之后的查询和检索；对于聚焦爬虫来说，这一过程所得到的分析结果还可能对以后的抓取过程给出反馈和指导。</p>
<h4 id="1-2-分类"><a href="#1-2-分类" class="headerlink" title="1.2 分类"></a>1.2 分类</h4><ul>
<li>全网爬虫，爬行对象从一些种子 URL 扩充到整个 Web，主要为门户站点搜索引擎和大型 Web 服务提供商采集数据。</li>
<li>聚焦网络爬虫，是指选择性地爬行那些与预先定义好的主题相关页面的网络爬虫。</li>
<li>增量式网络爬虫，是指对已下载网页采取增量式更新和只爬行新产生的或者已经发生变化网页的爬虫，它能够在一定程度上保证所爬行的页面是尽可能新的页面。</li>
<li>Deep Web 爬虫，表层网页是指传统搜索引擎可以索引的页面，以超链接可以到达的静态网页为主构成的Web页面。Deep Web 是那些大部分内容不能通过静态链接获取的、隐藏在搜索表单后的，只有用户提交一些关键词才能获得的 Web 页面。</li>
</ul>
<h4 id="1-3爬虫算法"><a href="#1-3爬虫算法" class="headerlink" title="1.3爬虫算法"></a>1.3爬虫算法</h4><ul>
<li><p>深度优先策略</p>
<p>  其基本方法是按照深度由低到高的顺序，依次访问下一级网页链接，直到不能再深入为止。 爬虫在完成一个爬行分支后返回到上一链接节点进一步搜索其它链接。 当所有链接遍历完后，爬行任务结束。 这种策略比较适合垂直搜索或站内搜索， 但爬行页面内容层次较深的站点时会造成资源的巨大浪费。</p>
</li>
<li><p>广度优先策略</p>
<p>  此策略按照网页内容目录层次深浅来爬行页面，处于较浅目录层次的页面首先被爬行。 当同一层次中的页面爬行完毕后，爬虫再深入下一层继续爬行。 这种策略能够有效控制页面的爬行深度，避免遇到一个无穷深层分支时无法结束爬行的问题，实现方便，无需存储大量中间节点，不足之处在于需较长时间才能爬行到目录层次较深的页面</p>
</li>
</ul>
<h3 id="2、golang"><a href="#2、golang" class="headerlink" title="2、golang"></a>2、golang</h3><h4 id="2-1-语法学习"><a href="#2-1-语法学习" class="headerlink" title="2.1 语法学习"></a>2.1 语法学习</h4><ul>
<li><p>为了让学习更加快速，想要优先上手，而不是沉浸在大量语法里面，找了一遍基础的语法文档，直接全读整体语法，先有个基础但是全面的认识。<br><a href="http://www.runoob.com/go/go-tutorial.html" target="_blank" rel="noopener">语法教程链接</a></p>
</li>
<li><p>然后直接手一本web教程书籍，此本书籍是开源的，在github上有1.78万star，5年前就开始书写，一直被追捧和使用。<a href="https://github.com/astaxie/build-web-application-with-golang" target="_blank" rel="noopener">书籍链接</a></p>
</li>
</ul>
<h3 id="2-2-环境安装"><a href="#2-2-环境安装" class="headerlink" title="2.2 环境安装"></a>2.2 环境安装</h3><h4 id="1-1-在MacOSX上安装"><a href="#1-1-在MacOSX上安装" class="headerlink" title="1.1 在MacOSX上安装"></a>1.1 在MacOSX上安装</h4><ul>
<li><a href="https://golang.org/dl/" target="_blank" rel="noopener">下载地址</a></li>
<li>源码包：go1.4.linux-amd64.tar.gz。</li>
<li>将下载的源码包解压至 /usr/local目录。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -C /usr/local -xzf go1.4.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<ul>
<li>将 /usr/local/go/bin 目录添加至PATH环境变量：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/usr/local/go/bin</span><br></pre></td></tr></table></figure>
<ul>
<li>注意：MAC 系统下你可以使用 .pkg 结尾的安装包直接双击来完成安装，安装目录在 /usr/local/go/ 下。</li>
</ul>
<h4 id="1-2-其他方式"><a href="#1-2-其他方式" class="headerlink" title="1.2 其他方式"></a>1.2 其他方式</h4><p><a href="https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/01.1.md" target="_blank" rel="noopener">参考链接</a></p>
<h2 id="二、代码实现"><a href="#二、代码实现" class="headerlink" title="二、代码实现"></a>二、代码实现</h2><p>先确立一个小目标，就是我们要爬取的网页的数据源是什么。一直觉得国内的大学排名争议比较有趣，TOP2的两所，但是TOP5的有8所，TOP10的有20所，哈哈，所以来爬个大学排行榜玩玩吧。</p>
<h3 id="1、网页抓取"><a href="#1、网页抓取" class="headerlink" title="1、网页抓取"></a>1、网页抓取</h3><h3 id="1-1-定义一个学校"><a href="#1-1-定义一个学校" class="headerlink" title="1.1 定义一个学校"></a>1.1 定义一个学校</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">type SchoolObj struct &#123;</span><br><span class="line">	rankTypeName string</span><br><span class="line">	RankIndex int</span><br><span class="line">	SchoolName string</span><br><span class="line">	EnrollOrder string</span><br><span class="line">	StarLevel string</span><br><span class="line">	LocationName string</span><br><span class="line">	SchoolType  string</span><br><span class="line">	UrlAddress string</span><br><span class="line">	SchoolTags []string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-单页面html解析"><a href="#1-2-单页面html解析" class="headerlink" title="1.2 单页面html解析"></a>1.2 单页面html解析</h3><ul>
<li><p>引入go语言的http函数包和上面定义的学校结构题</p>
</li>
<li><p>发起一个网页请求返回，go语言会返回网页的<html>以下全部的html格式字符串</html></p>
</li>
<li><p>如何从这些字符串中遍历查找和解析出我们需要的学校排名字段？</p>
</li>
</ul>
<p>因为有过前端开发的经验，我自然而然想到，使用CSS选择器会比直接使用遍历算法来得高效，有CSS的选择规则，我可以批量规律的获取和处理HTML的DOM结构数据。端开发中的jQuery提供了方便的操作 DOM 的 API。使用 Go 语言做服务器端开发，有时候需要解析 HTML 文件，比如抓取网站内容、写一个爬虫等。这时候如果有一个类似 jQuery 的库可以使用，操作 DOM 会很方便，而且，上手也会很快。果然，还真有这样的工具，此处推荐一个GitHub的开源框架 — Goquery 。</p>
<p>A、使用介绍：</p>
<p>goquery定义了一个Document结构，直接对应网页Javascript的Document节点，通过一个NewDocument方法，传入参数地址为网页的url地址，直接生产一个虚拟的go语言上的dom。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">type Document struct &#123;</span><br><span class="line">	*Selection</span><br><span class="line">	Url      *url.URL</span><br><span class="line">	rootNode *html.Node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewDocument(url string) (*Document, error) &#123;</span><br><span class="line">	// Load the URL</span><br><span class="line">	res, e := http.Get(url)</span><br><span class="line">	if e != nil &#123;</span><br><span class="line">		return nil, e</span><br><span class="line">	&#125;</span><br><span class="line">	return NewDocumentFromResponse(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Document有定义find方法，方法的使用和JQuery里面一直，传入目标字符串的css选择器即可。通过对Document执行find查找方法，获得全部学校目标的字符串数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">doc.Find(&quot;.bangTable table tr&quot;)</span><br></pre></td></tr></table></figure>
<p>这里的选择器怎么来的呢，我们在chrome里面打开url地址，找到我们想要收集的数据排名，右键打开审查元素，可以看到HTML的选择器名称。这里需要有一点CSS基础，因为有的选择器不是直接唯一的，需要自己去判断，怎样的选择器组合才能准确的拿到想要的目标字符串。</p>
<p><img src="/assets/images/schoolDom.jpg" alt=""></p>
<p>Document有定义each方法，用于遍历数组，也就是各个大学所对应的dom节点。在each方法中继续使用查找方法，并最后获得想要的字符串。</p>
<p>每一个dom对应一个SchoolStruct，新建并赋值，放入数组中返回。</p>
<p>B、代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;github.com/PuerkitoBio/goquery&quot;</span><br><span class="line">	&quot;SchoolReptile/struct&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func GaokaoquanRank(urlAddress string) []SchoolStruct.SchoolObj &#123;</span><br><span class="line"></span><br><span class="line">	var array [] SchoolStruct.SchoolObj</span><br><span class="line"></span><br><span class="line">	doc, err := goquery.NewDocument(urlAddress)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Find the review items</span><br><span class="line">	doc.Find(&quot;.bangTable table tr&quot;).Each(func(i int, s *goquery.Selection) &#123;</span><br><span class="line">		// For each item found, get the band and title</span><br><span class="line">		var obj SchoolStruct.SchoolObj</span><br><span class="line">		obj.RankIndex = s.Find(&quot;.t1 span&quot;).Text()</span><br><span class="line">		obj.SchoolName = s.Find(&quot;.t2 a&quot;).Text()</span><br><span class="line">		obj.UrlAddress ,_ = s.Find(&quot;.t2 a&quot;).Attr(&quot;href&quot;)</span><br><span class="line">		obj.LocationName = s.Find(&quot;.t3&quot;).Text()</span><br><span class="line">		obj.SchoolType = s.Find(&quot;.t4&quot;).Text()</span><br><span class="line">		obj.StarLevel = s.Find(&quot;.t5&quot;).Text()</span><br><span class="line">		obj.EnrollOrder = &quot;本科第一批&quot;</span><br><span class="line">		array = append(array, obj)</span><br><span class="line"></span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	return array</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2、接口请求"><a href="#2、接口请求" class="headerlink" title="2、接口请求"></a>2、接口请求</h3><p>我们再爬去数据的时候，一般都能直接抓取网页数据，但是有的数据在第一页炳辉展示出来，需要有点击操作，比如加载更多。此处的大学排行有200位，第一页请求只有20位，这时候就会发现，接口请求的方便。<br>有的网页在接口上做了cookie校验，摸清别人的请求规则，才能正确模拟出请求获得返回数据。</p>
<p>我们此处拿乐学高考作文例子，获取各个类型的大学排行榜。通过charles代理，我们获得请求的各类参数。</p>
<ul>
<li>拼接请求url</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url := LexueHost+&quot;/college/ranking?page=&quot;+pageStr+&quot;&amp;rank_type=&quot;+rankObj.RankType+&quot;&amp;page_size=15&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>发送HTTP请求，获取返回</p>
<p>网络请求返回的是一个字符串结构的数据，我们需要把它映射成map结构好获取key对应的value值。</p>
<p>这里推荐一个go语言在json解析上的一个开源库Simplejson，将返回的数据进行JSON结构化，然后通过get方法可以直接获得对应的参数值。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">defer resp.Body.Close()</span><br><span class="line"></span><br><span class="line">data, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">jsonBody,err := simplejson.NewJson(data)</span><br><span class="line"></span><br><span class="line">schoolJsonArray,err := jsonBody.Get(&quot;schools&quot;).Array()</span><br></pre></td></tr></table></figure>
<ul>
<li>多页请求使用递归的方式，不断改变get请求的pageStr参数，pageindex ++ ，当判断请求返回的json为空的时候，则说明接口请求已经到到了最后一页，跳出递归</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var nextArray [] SchoolStruct.SchoolObj</span><br><span class="line">nextArray = LexueRankEachList(rankObj,pageIndex)</span><br></pre></td></tr></table></figure>
<p>B、代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">import (</span><br><span class="line">	&quot;SchoolReptile/struct&quot;</span><br><span class="line">	&quot;net/http&quot;</span><br><span class="line">	&quot;io/ioutil&quot;</span><br><span class="line">	&quot;fmt&quot;</span><br><span class="line">	&quot;bytes&quot;</span><br><span class="line">	&quot;encoding/json&quot;</span><br><span class="line">	&quot;strings&quot;</span><br><span class="line">	&quot;github.com/bitly/go-simplejson&quot;</span><br><span class="line">	&quot;strconv&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func LexueRankEachList(rankObj SchoolStruct.RankTypeObj,pageIndex int ) []SchoolStruct.SchoolObj &#123;</span><br><span class="line"></span><br><span class="line">	pageStr := strconv.Itoa(pageIndex)</span><br><span class="line"></span><br><span class="line">	url := LexueHost+&quot;/college/ranking?page=&quot;+pageStr+&quot;&amp;rank_type=&quot;+rankObj.RankType+&quot;&amp;page_size=15&quot;</span><br><span class="line"></span><br><span class="line">	resp, err := http.Get(url)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		// handle error</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	defer resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	data, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"></span><br><span class="line">	jsonBody,err := simplejson.NewJson(data)</span><br><span class="line"></span><br><span class="line">	schoolJsonArray,err := jsonBody.Get(&quot;schools&quot;).Array()</span><br><span class="line"></span><br><span class="line">	var array [] SchoolStruct.SchoolObj</span><br><span class="line"></span><br><span class="line">	if len(schoolJsonArray) &lt;= 0 &#123;</span><br><span class="line">		println(&quot;请求到头了&quot;)</span><br><span class="line">		return array</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	for i,_ := range schoolJsonArray &#123;</span><br><span class="line">		schoolJson := jsonBody.Get(&quot;schools&quot;).GetIndex(i)</span><br><span class="line">		var obj SchoolStruct.SchoolObj</span><br><span class="line">		obj.RankIndex = strconv.Itoa(schoolJson.Get(&quot;school_rank&quot;).MustInt())</span><br><span class="line">		obj.SchoolName = schoolJson.Get(&quot;school_name&quot;).MustString()</span><br><span class="line">		obj.SchoolTags = schoolJson.Get(&quot;school_tags&quot;).MustStringArray()</span><br><span class="line">		array = append(array, obj)</span><br><span class="line">		println(obj.RankIndex,obj.SchoolName,obj.SchoolTags)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	pageIndex++</span><br><span class="line">	var nextArray [] SchoolStruct.SchoolObj</span><br><span class="line">	nextArray = LexueRankEachList(rankObj,pageIndex)</span><br><span class="line">	if len(nextArray) &gt; 0 &#123;</span><br><span class="line">		for _,obj := range nextArray &#123;</span><br><span class="line">			array = append(array,obj)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return array</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3、保存到Excel"><a href="#3、保存到Excel" class="headerlink" title="3、保存到Excel"></a>3、保存到Excel</h3><p>前两部获得了网络数据，并解析生成了对应的SchoolStruct数组，这个时候我们只需要创建excel边。遍历数组，把数组里面的数据字段都存入表格即可,git开源库xlsx能够让我们轻松的创建、查找、赋值Excel表。</p>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">func SaveSchoolRank(schoolArray [] SchoolStruct.SchoolObj,excelName string,sheetName string)  &#123;</span><br><span class="line"></span><br><span class="line">	var file *xlsx.File</span><br><span class="line">	var sheet *xlsx.Sheet</span><br><span class="line">	var row *xlsx.Row</span><br><span class="line">	var cell *xlsx.Cell</span><br><span class="line">	var err error</span><br><span class="line"></span><br><span class="line">	file,err = xlsx.OpenFile(excelName + &quot;.xlsx&quot;)</span><br><span class="line"></span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		file = xlsx.NewFile()</span><br><span class="line">		sheet,err = file.AddSheet(sheetName)</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">	   sheet = file.Sheet[sheetName]</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if err == nil &#123;</span><br><span class="line"></span><br><span class="line">		for i := 0; i &lt; len(schoolArray); i++ &#123;</span><br><span class="line">			obj := schoolArray[i]</span><br><span class="line"></span><br><span class="line">			row = sheet.AddRow()</span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.RankIndex</span><br><span class="line"></span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.SchoolName</span><br><span class="line"></span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.StarLevel</span><br><span class="line"></span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.LocationName</span><br><span class="line"></span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.EnrollOrder</span><br><span class="line"></span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.SchoolType</span><br><span class="line"></span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = obj.UrlAddress</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			var tagStr string</span><br><span class="line">			for _,value := range obj.SchoolTags &#123;</span><br><span class="line">				tagStr += &quot;+&quot; + value</span><br><span class="line">			&#125;</span><br><span class="line">			cell = row.AddCell()</span><br><span class="line">			cell.Value = tagStr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			if err != nil &#123;</span><br><span class="line">				fmt.Printf(err.Error())</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = file.Save(excelName + &quot;.xlsx&quot;)</span><br><span class="line">	if err != nil &#123;</span><br><span class="line">		fmt.Printf(err.Error())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[如何成功的交付产品]]></title>
      <url>/2017/08/03/%E5%A6%82%E4%BD%95%E6%88%90%E5%8A%9F%E7%9A%84%E4%BA%A4%E4%BB%98%E4%BA%A7%E5%93%81/</url>
      <content type="html"><![CDATA[<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p> 所有的流程和规范最终都是为了解决实际问题 的，不要贸然引入流程，除非已经碰到问题，否则尽量简化流程，提高效率。要交付 一个产品，其中最重要的只有 3 点:1)确定用户需求和预期指标;2)以最小成本实 现最主要的需求;3)发布并获得数据反馈，确定下一个迭代目标。</p>
<p> 用用户能理解的语言 去描述你要交付的产品带给他们的价值和好处十分重要，如果写不出来，或者写出来 用户看了一点兴趣都没有，请尽快停止这个产品，因为即使整个产品开发和交付过程 极其完美，这也注定会是一个失败的产品。</p>
<p> 在软件行业中，我们把设计、打造、发布一款符合市场需求的软件称为交付 (shipping)。</p>
<p>尽管时日尚短，交付却已展现出非凡的价值。它简直是一剂灵丹妙药。它能解决 钱的问题，因为投资人给你追加投资的前提是你取得了好结果;它能解决客户的问题， 因为交付能力的强弱决定了你是否能推出客户需要的功能和补丁;它能解决团队的问 题，因为没有什么比取得进展更能让团队士气大振!所以，如果你想追逐名望、财 富、幸福感，那么，交付出卓越的软件，你将赢得一切。</p>
<p>我只身前往达特茅斯学院的塞耶工程学院和 塔克商学院学习了一段时间，并取得了工程管理硕士学位。我花了 5 年多的时间研究可扩容性、商 业决策以及软件团队内部的人际动力学。</p>
<p>快速迭代、部 署、互联网服务托管已经变成了主流。</p>
<p>因为软件交付不只是如何管理项目，也不只是如何提升开发效率，你必须具备更 全面的技能。你既要加深对技术的理解，又要贡献更好的产品创意，更重要的是，整 个过程中，你需要展现出你强有力的商业洞察力。你也许要做所有工作，包括要求工 程师编写测试用例，或者用 Photoshop 绘制产品原型。这个工作要求你追求极致，只 要你不惧挑战，它终将成为你的舞台!</p>
<p>让观点更犀利点儿！</p>
<h2 id="交付卓越产品，步步为赢"><a href="#交付卓越产品，步步为赢" class="headerlink" title="交付卓越产品，步步为赢"></a>交付卓越产品，步步为赢</h2><h3 id="一、确定正确的产品方向"><a href="#一、确定正确的产品方向" class="headerlink" title="一、确定正确的产品方向"></a>一、确定正确的产品方向</h3><p>好的产品一定要满足众多客户所共有的某个真实的需求。你的使命就是 找到一种独特而有意义的方法去满足这一需求。</p>
<h4 id="1-1-如何找到正确需求"><a href="#1-1-如何找到正确需求" class="headerlink" title="1.1 如何找到正确需求"></a>1.1 如何找到正确需求</h4><ul>
<li>以客户为导向，而不是以竞争为导向</li>
<li>在于它解决的问题比我们最初意识到的那个问题要难得多</li>
</ul>
<h4 id="1-2-如何构建卓越的使命"><a href="#1-2-如何构建卓越的使命" class="headerlink" title="1.2 如何构建卓越的使命"></a>1.2 如何构建卓越的使命</h4><p>团队一定要有自己的使命。如果你没有清晰地阐述使命则会导致失败，因为你的 团队、组织和投资人会根据自己对使命的不同理解而各自为战。你需要的是一个能够反映代表性产品或服务的使命，而不是一个 面面俱到的使命。举个例子。我在 Google Talk 时肩负的使命是“使人与人之间在任何地点均能通 过任何终端沟通”。</p>
<ul>
<li><p>能够唤起人们的兴趣</p>
<p>  长期吸引利益相关者的注意，你才有时间去挖掘产品细节。</p>
</li>
<li><p>提供言之有物且能指明方向的原则</p>
</li>
<li><p>适合印在T桖上</p>
<p>  不要以为有一个高智商天才组成 的团队就不必这样做，他们的天才能力可不一定表现在对这类事情的记忆上。</p>
</li>
</ul>
<h4 id="1-3-如何制定正确的策略"><a href="#1-3-如何制定正确的策略" class="headerlink" title="1.3 如何制定正确的策略"></a>1.3 如何制定正确的策略</h4><p>策略是指在竞争对手的压力下，利用公司独特的优 势来争取目标用户的粗略计划。它只是一段用于说明对目标客户来说你的产品将如何长期保持比 竞争对手更强的吸引力的话。简而言之，你需要阐明三件事:客户、公司和竞争。</p>
<blockquote>
<p>策略举例:<br>随着越来越多内容的产生，用户每天消费的内容也越来越多，但对于 20 ~ 40 岁的工薪一族来说，他们在海量的内容面前却不知道如何选择。我们需要 给这些用户以启发，帮助他们找到想看的视频，并让他们在看的过程中对内容有更 深的理解。<br>我们之所以首先选择工薪一族是因为，与有大把的时间耗在 Facebook 和 YouTube上的青年不同，工薪一族时间有限，但他们人际网络丰富、个人主见强烈， 还有可自由支配的收入，愿意在内容上消费。<br>我们有独特的方法来解决用户挑选视频的问题。通过整合 IMDb 独有的电影数 据集、亚马逊对数码内容分门别类的能力以及可靠的个性化推荐技术，我们可以构 建出有效的视频推荐算法。虽然其他竞争对手(如 Netflix)也有一套推荐引擎，但 我们覆盖的平台多，拥有的数据也更丰富，能够提供比竞争对手更有趣的观看体验 和更精准的推荐。<br>我们将把这种观看体验通过各种载体来传递给观看者，这些载体展现了与内容 相关的背景数据(如 YouTube 视频的演员阵容)，包括 YouTube 等网站的浏览器插件、 手机应用程序等。我们还会提供丰富的与内容相关的信息以启发观看者，并提示观 看者进行反馈——这就创建了一个良性循环并惠及所有用户。</p>
</blockquote>
<p>这个策略满足了所有要求:阐述了 IMDb 应该提供什么产品以及为什么这家公司适 合提供这类产品，分析了竞争对手的情况以及 IMDb 应如何与之差异化竞争，还论证了 IMDb 为什么要针对这样一个特别的消费者群体。该策略不但简明扼要、详略得当，还 直接指明了我们的具体目标。</p>
<h3 id="二、尽可能清晰详细地定义产品"><a href="#二、尽可能清晰详细地定义产品" class="headerlink" title="二、尽可能清晰详细地定义产品"></a>二、尽可能清晰详细地定义产品</h3><p>交付的下一阶段是让你的产品方案具体且可理解。通过制订使命和策略，你知道 了你的客户是谁，他们的需求是什么。你也知道如何做才能比对手更出色、更具备差 异性。有了这些知识再加上一些头脑风暴，便可以得出一个大致的产品方案。</p>
<p>当设法细化产品方案时，你会发现产品要解决的一些客户问题都是你主观臆断 的，，而证明的最好方法就是把产品提 供给客户使用，然后听听他们的意见。在《精益创业》一书 中充分论证了为什么该构建一个最小化可行产品。</p>
<p>当迭代越小越快时，你甚至不需要花大力气去猜测客户的需求，而是 更多按照客户告诉你的去做，这样成功的可能性更大。</p>
<p>产品定义过程主要分为 10 步，完成这些步骤后，工程团 队就会对项目形成统一的认识，管理层或投资者也会了解并认可产品的设计，包括：</p>
<h3 id="2-1-撰写-新闻稿"><a href="#2-1-撰写-新闻稿" class="headerlink" title="2.1 撰写 新闻稿"></a>2.1 撰写 新闻稿</h3><p>所谓新闻稿是指一篇向市场宣布将要推出新产品的通告。不管是新 闻稿还是博客文章，都应该简单明了地传达关于产品的关键信息。</p>
<ul>
<li>产品命名</li>
<li>发布时间</li>
<li>目标客户</li>
<li>解决了什么问题</li>
<li>如何解决(务必简明扼要)</li>
<li>CEO 的公开赞辞</li>
<li>邀请设计团队和工程团队主管参与产品评审</li>
<li>找客户测试产品概念</li>
<li>命名、定价以及预测收益</li>
<li>向管理层汇报</li>
</ul>
<h3 id="2-2-创建并不断更新-FAQ-文档"><a href="#2-2-创建并不断更新-FAQ-文档" class="headerlink" title="2.2 创建并不断更新 FAQ 文档"></a>2.2 创建并不断更新 FAQ 文档</h3><p>我喜欢那些愚蠢的问题，因为它们让我感觉好像没花多少精力就消灭了一个问 题，这真是一种少有的乐趣啊。</p>
<p>遇到回答不上的问题时，我也会把它放入 FAQ 并期望有人能够回答它。最坏<br>情况下你也可以把这个 FAQ 当做个人的 Bug 列表或者团队讨论主题库.</p>
<ul>
<li>它能节省你大量回复邮件的时间，还能抵御一些内部责难。</li>
<li>当你的客户支持团队和科技写作团队开始整理所有面向公众的内容时， FAQ 将是一个很有价值的资源。</li>
</ul>
<h3 id="2-3-绘制线框流程图"><a href="#2-3-绘制线框流程图" class="headerlink" title="2.3 绘制线框流程图"></a>2.3 绘制线框流程图</h3><p>流程图可以帮助你准确地解释用户工作流和系统交互相关问题，简要线框图则可以帮助你 具象化产品各环节的用户体验。</p>
<h3 id="2-4-撰写产品单页或者演示文稿"><a href="#2-4-撰写产品单页或者演示文稿" class="headerlink" title="2.4 撰写产品单页或者演示文稿"></a>2.4 撰写产品单页或者演示文稿</h3><p>产品单页是一篇写给高管或多数风险投 资人看的产品介绍文章，你需要把控好介绍的详略程度。</p>
<p>你需要去争取工程团队、管理层、VC(风险投资人)或其他利益相关方的初步支持。你需要弄清楚他们对产品的认可程度，否则等到第 7 步功能规格 文档都快完成了，而他们还对产品的价值存有疑义，你将面临不断的返工<br>。<br>你会发现产品单页和演示文稿实际上是新闻稿的延伸，它们增加了市场机会(用户量)、收益机会(解决方案的价值)和长期竞争优势(对手长时间内无法模仿)这 三方面内容。</p>
<p>面对 VC 时，两样都需要准备，因为你既需要发邮件介绍你的产品，又需要面对面做产品演示。不过无论你在哪里工作，这两份文档的内容都是一样的，它们都是新 闻稿的延伸。</p>
<p>下面介绍这两份文档所需包含的五个要素:</p>
<ul>
<li>产品名称</li>
<li>目标客户 + 数量有多少</li>
<li>解决了什么问题 + 这个问题对于目标客户来说有多大价值</li>
<li>解决方案 + 这个解决方案类似线上哪个产品，为什么你的方案能让竞争对手在</li>
<li>长时间内都无法模仿</li>
<li>何时交付 + 主要的里程碑有哪些?</li>
<li>团队背景(仅针对 VC)</li>
</ul>
<h3 id="2-5-FAQ中添加API文档"><a href="#2-5-FAQ中添加API文档" class="headerlink" title="2.5 FAQ中添加API文档"></a>2.5 FAQ中添加API文档</h3><p>API 文档可以说明你的团队如何与其他团队协作、外部开发者如何使用这套系统 以及你需要存储什么数据。预先定义清楚 API 还有个好处，它可以帮助你搭建由这些 API 构成的面向服务的体系架构。</p>
<h3 id="2-6-撰写功能呢规格文档"><a href="#2-6-撰写功能呢规格文档" class="headerlink" title="2.6 撰写功能呢规格文档"></a>2.6 撰写功能呢规格文档</h3><p>产品的规模以及成熟度决定了你需要几天还是几周才能写完功能规格文档。如果 产品尚不成熟，你应当尽可能缩小产品规模以快速验证客户需求的真实性。</p>
<ul>
<li><p>简介：<br>说明了为什么要做这个产品以及做些什么，每个新进入项目的成员 都可以从中了解到必要的背景信息。同时它还说明了文档中一些术语的含义，你可能 因为使用习惯了这些术语而忘记别人其实并不理解</p>
</li>
<li><p>目标与非目标：<br>需要将其细化成不同目标，每个目 标都应保持清晰简洁并将它们按优先级排列，这样工程团队就可以合理地进行设计 与开发。目标是告诉别人你要做什么，那么非目标则是告诉别人你不要做什么</p>
</li>
<li><p>用例和用户场景：<br>用例是指用简要的语句来描述那些用户必须 执行的操作，用户场景则是指用叙述故事的方式来描述用户是如何体验产品的</p>
</li>
<li><p>原型图或线框图</p>
</li>
<li>API</li>
<li>负载规划：<br>负载规划是指对未来一段时间内用户的使用量进行粗略估计并制订应对计划，这 对工程团队来说非常重要。</li>
<li>依赖：<br>你需要将全部依赖方及其负责人列出来，如果有应急方案也一并列出来。</li>
<li>FAQ和开放问题</li>
<li>关键事件：<br>最好能列出主要事件的达成时 间，如特性完成时间、可信测试者版发布时间，如果具体的工程量尚未评估出来，那 预计的时间应该保守一些。</li>
</ul>
<h3 id="2-7-边界情况"><a href="#2-7-边界情况" class="headerlink" title="2.7 边界情况"></a>2.7 边界情况</h3><p>你需要时间 来仔细地、创造性地思考用户会如何弄坏你的软件或者在某种意义上没有按照你的预 期来使用软件。当你“漫步”时，请将想到的所有可能的边界情况以及应对策略写在 FAQ 或者产品需求文档中。</p>
<h3 id="2-8-客户测试"><a href="#2-8-客户测试" class="headerlink" title="2.8 客户测试"></a>2.8 客户测试</h3><p>团队会轻易陷入一场为莫须有的客户问题构建完美解 决方案的狂欢中，主张的是去找一 批现存的或潜在的客户，向他们介绍你的产品设想和原型，并听听他们的反馈 。</p>
<h3 id="2-9-基本商业要素——命名、定价和收益"><a href="#2-9-基本商业要素——命名、定价和收益" class="headerlink" title="2.9 基本商业要素——命名、定价和收益"></a>2.9 基本商业要素——命名、定价和收益</h3><p>命名：可以交给别人想想</p>
<p>定价：看起来很科学，但最终大部分定价都是拍脑袋出来的。按成本定价、按价值定价以及对比定价。分析竞争对手、调研客户愿意支付、简化初始定价以降低用户理解成本、等产品正式推出后再想涨价就难了</p>
<p>收益：制定收益模型。</p>
<p>1、估算买家总体市场规模<br>2、预估市场规模的增速<br>3、估算你的目标市场占总体市场的比率<br>4、估算通过市场推广你能触碰到的用户规模<br>5、预估触碰产品的人中会有多少转化成产品用户<br>6、找到其他新用户增长渠道并加入到模型中<br>7、产品定价乘以每个时期增长的用户数便是收益</p>
<h3 id="2-10-取得上层认可"><a href="#2-10-取得上层认可" class="headerlink" title="2.10 取得上层认可"></a>2.10 取得上层认可</h3><p>议你先花点时间预售 产品。在谷歌，最优秀的主管都知道怎么做这件事情，因为预售可以让管理层在公开 回应你的产品方案之前先了解一些背景。</p>
<p>种预售方式是“路过式”预售。趁着负责决策的高管站在走廊或者倒咖啡 的时候走到他身边和他聊一两分钟你想做的产品，这时候你追求的不是一个决策，而 仅仅是让他知道有这么一个事。</p>
<h3 id="2-11-产品准备就绪开始构建"><a href="#2-11-产品准备就绪开始构建" class="headerlink" title="2.11 产品准备就绪开始构建"></a>2.11 产品准备就绪开始构建</h3><p>阶段三，设计用户体验<br>你需要从用户的角度出发，和设计团队不断沟通、反复 迭代，最终构建出良好、直观、简洁的用户体验。</p>
<p>阶段四，做一些基础的项目管理工作<br> 括跟踪交付物的进展、指出问题以及控制项目范围。</p>
<p>阶段五，开始测试<br>作为团队主管，你需要主导 Bug 的处理并慎重决定哪些可以容忍出现在版本 1 而哪些又必须在发布之前修复掉。</p>
<p>阶段六，你差不多可以准备发布了<br>要求你建立一套衡量产品成败的指标</p>
<p>最后，正式发布产品<br>你需要制订市场营销和公关方案，并在发布前仔细核查清单中的每一项内 容。基本上每次发布都会有一些糟糕的事情发生，不过只要处理得好，大部分用户都 不会察觉到。</p>
<h3 id="三、赢在用户体验"><a href="#三、赢在用户体验" class="headerlink" title="三、赢在用户体验"></a>三、赢在用户体验</h3><p>用户体验不仅是产品的外观样式，它还是产品的使用方式,为了让设计团队发挥出最佳水平，你需要先理解设计，再让设计团队理解你,需要了解的东西便是如何和每种 设计角色有效地沟通，其中包括了解如何评论视觉稿以及如何向设计师提供反馈。最后一个了解设计的要点是学会使用线框图或原型图来辅助沟通，你可以通 过 Photoshop 或其他画图程序来绘制这些图形。</p>
<h3 id="3-1-各类角色"><a href="#3-1-各类角色" class="headerlink" title="3.1 各类角色"></a>3.1 各类角色</h3><ul>
<li>用户体验(UX，User Experience)</li>
</ul>
<p>关注的是用户如何完成任务以及该如何优化向 用户展现信息的方式。通常用户体验设计师会通过制作流程图或原型图来说明用户体 验，其中原型图是用来描述用户界面某一部分外观的图形，对信息架构(IA，Information Architecture)尤为关注。</p>
<ul>
<li>用户界面</li>
</ul>
<p>它更关注单个页面或屏幕的 设计，是用户体验的组成部分。</p>
<ul>
<li>视觉设计</li>
</ul>
<p>如何通过一种既赏心悦目、夺人眼球又清 晰明了的方式来展示内容的一门学问</p>
<ul>
<li>用户体验研究</li>
</ul>
<p>是用户体验的一个特殊组成 部分，它专注于研究用户是如何看待你的产品的。</p>
<ul>
<li>角色模型</li>
</ul>
<p>你的设计和业务团队将创 建一组虚拟角色来代表目标客户，这些角色模型拥有姓名、薪水和目标，你还可以赋 予他们任何你知道的目标客户的特征，然后利用这些角色模型来评估设计的效果。</p>
<h3 id="3-2-如何评估设计"><a href="#3-2-如何评估设计" class="headerlink" title="3.2 如何评估设计"></a>3.2 如何评估设计</h3><p>■该用户界面要求用户完成的最重要的任务是什么?<br>■这是最简单的解决方案吗?<br>■信息是否组织得当?<br>■设计是否易用且一目了然?<br>■标准是否一致?<br>■能否减少用户点击次数?</p>
<h3 id="3-3-如何与设计师沟通"><a href="#3-3-如何与设计师沟通" class="headerlink" title="3.3 如何与设计师沟通"></a>3.3 如何与设计师沟通</h3><ul>
<li>以用户的口吻说话</li>
<li>以提问的方式建立共识</li>
<li>讲述业务目标的相对优先级</li>
<li>用数据说话</li>
<li>提供竞争对手的运作良好的案例</li>
</ul>
<h3 id="3-4-借助图画进行沟通"><a href="#3-4-借助图画进行沟通" class="headerlink" title="3.4 借助图画进行沟通"></a>3.4 借助图画进行沟通</h3><p>■只制作用户界面中相关部分的原型。<br>■总是使用完整的、经过适当编辑的文本。<br>■控制花在视觉设计上的时间。<br>■使用灰度色，不要使用其他颜色。<br>■预期你的线框图会发生很大改动。<br>■当心视觉花招。</p>
<h3 id="四、赢在项目管理"><a href="#四、赢在项目管理" class="headerlink" title="四、赢在项目管理"></a>四、赢在项目管理</h3><h3 id="4-1-创建一张简单的计划表并持续维护。"><a href="#4-1-创建一张简单的计划表并持续维护。" class="headerlink" title="4.1 创建一张简单的计划表并持续维护。"></a>4.1 创建一张简单的计划表并持续维护。</h3><p>■它是我制作的。永远不要低估这种自豪感……<br>■它便于你的团队更新剩余时间以及查看项目进展。<br>■它便于发现长杆工程师。<br>■它便于配置或自定义。<br>■它便于跟踪假期，因为假期在这里也是一个任务。<br>■它便于挪动任务至后续版本。如果发现版本发布时间不满足要求，你可以将该<br>版本中一些任务的“目标版本值”改成后续的版本号。你也能使用这个模型来<br>跟踪里程碑。<br>■它还适用于管理项目最后 30 天的冲刺。<br>■它便于平衡团队内的任务分配。如果不想让克里斯在 V1 版本的关键路径上，<br>可以将他的任务重新分配给维奇。<br>■它便于预测项目各时间节点，包括编码完成时间、测试完成时间以及发布完成<br>时间。现在你的测试团队知道什么时候可以开始新一轮的测试，你的市场部门<br>也知道这款产品什么时候可以面世。<br>■它预先将你的假设传达给了你的团队。<br>■“天”是一个很好的用于跟踪任务的度量单位。你也许常用“0.2 天”来描述那些<br>非常小的任务，但我发现跟踪这些任务的最佳办法是放到 Bug 列表中。</p>
<h3 id="4-2-如何评估工作量"><a href="#4-2-如何评估工作量" class="headerlink" title="4.2 如何评估工作量"></a>4.2 如何评估工作量</h3><ol>
<li>如果你不是工程经理，那么让你的工程经理去要评估量。</li>
<li>表面上接受评估结果</li>
<li>认识到你的权力</li>
<li>只跟踪剩余时间</li>
<li>要求不考虑余量的评估</li>
<li>每周一次在团队会议上评估各任务的剩余时间</li>
</ol>
<h3 id="4-3-跟踪Bug并创建Bug燃尽图"><a href="#4-3-跟踪Bug并创建Bug燃尽图" class="headerlink" title="4.3 跟踪Bug并创建Bug燃尽图"></a>4.3 跟踪Bug并创建Bug燃尽图</h3><h3 id="4-4-管理依赖"><a href="#4-4-管理依赖" class="headerlink" title="4.4 管理依赖"></a>4.4 管理依赖</h3><ol>
<li>如果去除它也可以运转，那就去除它。</li>
<li>如果内部能构建，那就内部构建。</li>
<li>如果必须添加一个依赖，那就趁早添加。</li>
<li>如果必须添加一些依赖，那就依靠它上一个已构建的版本。</li>
<li>如果交付得早，被依赖伤害的可能性就小。</li>
</ol>
<h3 id="五、赢在测试"><a href="#五、赢在测试" class="headerlink" title="五、赢在测试"></a>五、赢在测试</h3><ol>
<li>坚持测试驱动开发。</li>
<li><p>围绕优秀的测试主管组建测试团队。</p>
<p>选择一:降低标准雇佣测试人员并聘请管理者去管理他们</p>
<p>选择二:按高标准雇佣外包团队</p>
<p>选择三:按高标准雇佣测试人员，不使用外包团队</p>
</li>
<li><p>亲自评审测试计划和测试用例。</p>
</li>
<li>自动化测试。</li>
<li>虔诚地推行内部试用(Dogfood)。</li>
<li>开展找虫总动员。</li>
<li>勤勉且有条理地处理 Bug。</li>
<li>任命可信测试者以构建最后一道防线。</li>
</ol>
<p>可信测试者是指在保密协议的约束下，在产品发布前使用产品内部试用版的用户。</p>
<ol start="9">
<li>思想火花:以新用户的方式来使用整个产品</li>
</ol>
<h3 id="六、赢在量化"><a href="#六、赢在量化" class="headerlink" title="六、赢在量化"></a>六、赢在量化</h3><p>量化数据是团 队主管的命根子，作为团队主管你全部的工作都是说服别人或被别人说服，各种量化 数据为这样的讨论提供了理性基础。</p>
<h3 id="6-1-如何采集正确的量化数据且只采集正确的量化数据"><a href="#6-1-如何采集正确的量化数据且只采集正确的量化数据" class="headerlink" title="6.1 如何采集正确的量化数据且只采集正确的量化数据"></a>6.1 如何采集正确的量化数据且只采集正确的量化数据</h3><ol>
<li>测量成本低廉</li>
<li>测量可靠且可重复检验</li>
<li>最好能实时测量</li>
<li>团队能够根据它做出明智的改变</li>
<li>专注于客户</li>
</ol>
<h3 id="6-2-你需要采集的三类量化数据"><a href="#6-2-你需要采集的三类量化数据" class="headerlink" title="6.2 你需要采集的三类量化数据"></a>6.2 你需要采集的三类量化数据</h3><h4 id="1-目标进度"><a href="#1-目标进度" class="headerlink" title="1.  目标进度"></a>1.  目标进度</h4><p>目标指标会告诉你目标的完成进度。在谷歌一个重要的目标指标是“7 天活跃用 户数”。没有人会看不懂使用精确增量表达法来描述的目标，而且这样的描述基本符合 SMART 的定义.</p>
<h4 id="2-经营绩效"><a href="#2-经营绩效" class="headerlink" title="2.  经营绩效"></a>2.  经营绩效</h4><p>经营绩效指标会告诉你产品的问题在哪里以及如何提升用户体验。这些指标通常 是用比率表示，比如从点击购买按钮到付款成功的转化率。和目标指标一样，选择合 适的经营绩效指标至关重要。比如说你想做一个优秀的社交产品，监控好友数量是没 有用的，不同类型的用户有不同的好友数。你应该去监控用户参与度，这样你才能回 答“用户会花费时间在网站上吗”、“用户会发信息吗”这类问题。反映这些行为的相 关指标可能包括 7 天活跃用户平均 7 天发帖量、7 天活跃用户平均停留时间等。</p>
<h4 id="3-系统性能"><a href="#3-系统性能" class="headerlink" title="3. 系统性能"></a>3. 系统性能</h4><p>系统性能指标能说明你产品的实时健康度。这类指标包括 99.9% 平均延迟、每 秒请求数、并发用户数、每秒下单数以及其他基于时间的指标。</p>
<h3 id="6-3-专注于目标本身，忽略细枝末节"><a href="#6-3-专注于目标本身，忽略细枝末节" class="headerlink" title="6.3 专注于目标本身，忽略细枝末节"></a>6.3 专注于目标本身，忽略细枝末节</h3><p>但是核心指标是不可能被糊弄过去的。</p>
<h3 id="七、赢在发布"><a href="#七、赢在发布" class="headerlink" title="七、赢在发布"></a>七、赢在发布</h3><h4 id="7-1-对改动说不。"><a href="#7-1-对改动说不。" class="headerlink" title="7.1. 对改动说不。"></a>7.1. 对改动说不。</h4><h4 id="7-2-开启作战室。"><a href="#7-2-开启作战室。" class="headerlink" title="7.2. 开启作战室。"></a>7.2. 开启作战室。</h4><h4 id="7-3-营造紧迫的气氛。"><a href="#7-3-营造紧迫的气氛。" class="headerlink" title="7.3. 营造紧迫的气氛。"></a>7.3. 营造紧迫的气氛。</h4><h4 id="7-4-核查发布清单。"><a href="#7-4-核查发布清单。" class="headerlink" title="7.4. 核查发布清单。"></a>7.4. 核查发布清单。</h4><h4 id="7-5-撰写博文。"><a href="#7-5-撰写博文。" class="headerlink" title="7.5. 撰写博文。"></a>7.5. 撰写博文。</h4><p>如果你是完全按照产品开发过程行事的，那么你应该已经写过一篇博文了，或者 至少写过相同主题的产品预告。那篇博文的目的在于阐述你的使命、你的目标客户以及你能解决的问题。从传统新闻的角度来看它就是你的“导语”。</p>
<h4 id="7-6-发布软件。"><a href="#7-6-发布软件。" class="headerlink" title="7.6. 发布软件。"></a>7.6. 发布软件。</h4><h4 id="7-7-亲自验证软件。"><a href="#7-7-亲自验证软件。" class="headerlink" title="7.7. 亲自验证软件。"></a>7.7. 亲自验证软件。</h4><h4 id="7-8-应对发布带来的各种影响。【重点查看】"><a href="#7-8-应对发布带来的各种影响。【重点查看】" class="headerlink" title="7.8. 应对发布带来的各种影响。【重点查看】"></a>7.8. 应对发布带来的各种影响。【重点查看】</h4><ul>
<li>应对回滚。</li>
<li>处理产品危机。 </li>
<li>演示产品。</li>
<li>应对媒体。</li>
<li>庆祝发布。</li>
</ul>
<h3 id="八、赢在团队"><a href="#八、赢在团队" class="headerlink" title="八、赢在团队"></a>八、赢在团队</h3><h3 id="8-1-如何组建一支团队"><a href="#8-1-如何组建一支团队" class="headerlink" title="8.1 如何组建一支团队"></a>8.1 如何组建一支团队</h3><p>为了组建一支高效的团队，你必须找到能默契配合的工程主管、产品主管和设计 主管。当发现这些人时，你要巴结好他们，哪怕给他们写赞美诗、买糖果甚至洗车都 行。纵观整个行业，你会发现不管 是在业务中还是在项目中，优秀的人总是聚在一起工作。</p>
<ul>
<li><p>项目集经理</p>
<p>PM负责交付软件，项目集经理的职责重点在于整合不同团队和不同工作职能。一种看待项目集经理的方式是把它看做是一个比产品经理更少关注业务、比项 目经理更少关注项目的技术角色。</p>
<ul>
<li>产品经理</li>
</ul>
<p>通常产品经理的职责更偏重软件的业务方面。甚至有些产品经理不负责软件，他 们是典型的 MBA 出身，专注于品牌管理、定价、市场进入策略等。</p>
<ul>
<li>项目经理</li>
</ul>
<p>项目经理的主要职责在于排定项目计划和协调团队工作，在谷歌这个职位也被 称作技术项目经理。他们负责向工程师要评估值，辨识从属关系以及弄清楚如何在 更短的时间内做更多事</p>
<ul>
<li>工程经理</li>
</ul>
</li>
</ul>
<p>工程经理常常是由老牌的程序员担任的。最佳的工程经理是那些由于热爱团队、 善解人意、精通交付并乐于构建卓越产品而晋升到该职位的人。产品经理、项目集经理或者项目经理，甚至是技术项目经理都可以是工程经理的 属下，但也可以是合作伙伴。</p>
<h3 id="8-2-雇佣原则"><a href="#8-2-雇佣原则" class="headerlink" title="8.2 雇佣原则"></a>8.2 雇佣原则</h3><p>■雇佣比你聪明的人。<br>■雇佣懂得自己不是来当老板的人。<br>■雇佣表达清晰、言之有物的人。<br>■雇佣用数据说话的人。<br>■雇佣充满活力的人。</p>
<h3 id="8-3-如何收购一家公司"><a href="#8-3-如何收购一家公司" class="headerlink" title="8.3 如何收购一家公司"></a>8.3 如何收购一家公司</h3><h4 id="8-3-1-知识产权"><a href="#8-3-1-知识产权" class="headerlink" title="8.3.1 知识产权"></a>8.3.1 知识产权</h4><p>你能使用这家公司构建的技术、内容和专利。</p>
<h4 id="8-3-2-人才"><a href="#8-3-2-人才" class="headerlink" title="8.3.2 人才"></a>8.3.2 人才</h4><p>你能使用这家公司雇佣的人才。关键人物、好的雇员、多余人才</p>
<h4 id="8-3-3-客户"><a href="#8-3-3-客户" class="headerlink" title="8.3.3 客户"></a>8.3.3 客户</h4><p>你能凭借这家公司的客户来加快业务增长。</p>
<h4 id="8-3-4-防御"><a href="#8-3-4-防御" class="headerlink" title="8.3.4 防御"></a>8.3.4 防御</h4><p>你买这家公司是为了让别人没法买它。</p>
<h4 id="8-3-5-收购的陷阱和最佳实践"><a href="#8-3-5-收购的陷阱和最佳实践" class="headerlink" title="8.3.5 收购的陷阱和最佳实践"></a>8.3.5 收购的陷阱和最佳实践</h4><ol>
<li>计划将你团队的部分人员调入他们团队</li>
<li>计划整合产品</li>
<li>了解之前所有的交易和负债</li>
</ol>
<h3 id="8-4-如何远程团队合作"><a href="#8-4-如何远程团队合作" class="headerlink" title="8.4 如何远程团队合作"></a>8.4 如何远程团队合作</h3><p>■组建一支工程师团队<br>■充分沟通<br>■不要外包设计或 PM 角色<br>■适应文化差异<br>■构建清晰的需求<br> ■忍受时差，通过任何方式会面<br> ■委任得力的主管。<br> ■大量出差，或者完全不出差<br> ■与远程团队共饮</p>
<h3 id="8-5-如何加入一个新团队"><a href="#8-5-如何加入一个新团队" class="headerlink" title="8.5 如何加入一个新团队"></a>8.5 如何加入一个新团队</h3><p>弄清楚在这个特殊团队中你的理想角色应该是什么很关键。</p>
<p>你必须敏感地意识到团队需要什么。</p>
<p>第一件事，不要和团队说你们的产品一团糟这种话。后来我才认识到在大多数情况下你 都应该尽量先将事情本身搞清楚，而不是张口就说产品一团糟这种话。</p>
<p>必须做的第二件事情是做一个选择:你是打算延期交付以解决这种 混乱状况，还是承认它的存在然后正常交付。做出延期决定的最佳时间点是你刚加入 团队的时候。</p>
<h3 id="九、胜在技术"><a href="#九、胜在技术" class="headerlink" title="九、胜在技术"></a>九、胜在技术</h3><p>如果想快速交付一款卓越的产品，你必须会询问富有洞见的问题，会正确地引 导方向，并明智地决定哪些事必须现在做，哪些事可以之后再做。你还要会评估和雇 佣工程经理。因此，你对技术的了解程度最不济也要与对你车里的汽油的了解程度相 当。。如果你想顺利地通过面试或者从容地 掌控产品开发过程，你需要了解四个S:服务器(server)、服务(service)、速度<br>(speed)和扩容(scaling)。一旦理解了这四个基本元素，你就能够向团队询问恰当 的问题了。</p>
<h3 id="9-1-服务器"><a href="#9-1-服务器" class="headerlink" title="9.1 服务器"></a>9.1 服务器</h3><p>尽量不要买服务器自己搭建。优秀的工程师会尝试学习如何避免去做运维的琐事。<br>展现层、业务逻辑层、数据库</p>
<h3 id="9-2-服务"><a href="#9-2-服务" class="headerlink" title="9.2 服务"></a>9.2 服务</h3><p>SOA面向服务的架构(SOA，Service-Oriented Architecture），SOA 将包含业务逻辑的中间层分解成一系列独立的服务。这些服务 可能运行在相同的服务器上，但它们的构建、版本管理和运行都是独立的。他们相互调用和返回，从而形成了服务链，产生耗时。</p>
<h3 id="9-3-速度"><a href="#9-3-速度" class="headerlink" title="9.3 速度"></a>9.3 速度</h3><p>缓存策略</p>
<h3 id="9-4-扩容"><a href="#9-4-扩容" class="headerlink" title="9.4 扩容"></a>9.4 扩容</h3><p>你能通过增加服务器来增加容量，且增加的每个服务器都能带来接 近完整服务器的容量。不过在许多系统中你依然会遇到瓶颈，如在 VIP 这块，一个 VIP 只支持那么多连接。这时面向服务的架构的一个好处是你可以独立为每个服务扩 容，当决策服务需要更多马力，回应服务需要更多空间时，你可以通过合理分配相应 类型的硬件给他们扩容。</p>
<h3 id="9-5-如何询问正确的技术问题"><a href="#9-5-如何询问正确的技术问题" class="headerlink" title="9.5 如何询问正确的技术问题"></a>9.5 如何询问正确的技术问题</h3><p>你现在的知识已经足够 向工程团队询问一些重要的问题并听懂他们大部分的回答了。你必须询问一些这类问题，它们会揭示出一些潜藏的问题 并帮助你的团队想清楚他们的设计。</p>
<h3 id="十、胜在沟通"><a href="#十、胜在沟通" class="headerlink" title="十、胜在沟通"></a>十、胜在沟通</h3><h3 id="10-1-如何写好邮件"><a href="#10-1-如何写好邮件" class="headerlink" title="10.1 如何写好邮件"></a>10.1 如何写好邮件</h3><p>你要向比你更忙的、有更多邮件需要处理的人们传达与决策或进展相 关的大小事项。因此写好邮件对你能否成功至关重要。写邮件最主要的目标应该是清 晰、简要地传递单个信息。</p>
<ul>
<li>像记者写新闻一样写邮件</li>
</ul>
<p>使用了精确增量表达法、用了 20 秒时间来为邮件加上称呼、敬 语和署名，这样可以帮助信息传递给正确的受众</p>
<ul>
<li>使用精确增量表达法</li>
</ul>
<p>见差值、见开始值、见结束值</p>
<ul>
<li>分点阐释原因</li>
<li>立即停笔，你已经写完了这封邮件</li>
<li>设法用建议取代质疑</li>
<li>考虑受众的感受</li>
</ul>
<h3 id="10-2-如何应对五种类型的会议"><a href="#10-2-如何应对五种类型的会议" class="headerlink" title="10.2 如何应对五种类型的会议"></a>10.2 如何应对五种类型的会议</h3><ul>
<li>团队会议</li>
</ul>
<p>了解近况以及利用团队合力来深入讨论和解决特定问题</p>
<ul>
<li>站会</li>
</ul>
<p>一种超级简短的会议，它只用来交流近况</p>
<ul>
<li><p>1对1</p>
</li>
<li><p>产品 / 工程 / 用户体验评审</p>
</li>
<li><p>头脑风暴会</p>
</li>
</ul>
<h3 id="10-3-如何组织好会议"><a href="#10-3-如何组织好会议" class="headerlink" title="10.3 如何组织好会议"></a>10.3 如何组织好会议</h3><p>■会后立即发出主题纪要<br>■允许改变开会的目的<br>■拒绝在团队会议中发泄负面情绪，但允许在 1 对 1 会议中发泄<br>■使用鱼骨图等辅助工具解决问题</p>
<h3 id="10-4-如何做好演示"><a href="#10-4-如何做好演示" class="headerlink" title="10.4 如何做好演示"></a>10.4 如何做好演示</h3><p>■将演示时间控制在 15 分钟内<br>■永远传达且只传达一个信息<br>■讲故事<br>■制作“综述单页”<br>■重点演示用户体验<br>■极度专注倾听</p>
<h3 id="十一、胜在决策"><a href="#十一、胜在决策" class="headerlink" title="十一、胜在决策"></a>十一、胜在决策</h3><h3 id="11-1-推后-我们明天再完成。"><a href="#11-1-推后-我们明天再完成。" class="headerlink" title="11.1 推后:我们明天再完成。"></a>11.1 推后:我们明天再完成。</h3><h3 id="11-2-谈判-“行，再给你10分钟。”"><a href="#11-2-谈判-“行，再给你10分钟。”" class="headerlink" title="11.2 谈判:“行，再给你10分钟。”"></a>11.2 谈判:“行，再给你10分钟。”</h3><p>■聚焦于促进。<br>■“先寻求理解，再寻求被理解。”<br>■如果你已经有了倾向性的判断，不妨先说出来，然后让其他人继续发表观点</p>
<ul>
<li>阶段1:这不是你的错</li>
<li>阶段2:公平谈判并使用数据支持</li>
<li>阶段3:那个数据没谈成……我们编个新数据吧!</li>
<li>阶段4:寻找可免费提供的东西</li>
<li>阶段5:转身离开并安静思考 </li>
<li>阶段6:协议、文书工作、以及互相指责</li>
</ul>
<h3 id="11-3-处理冲突"><a href="#11-3-处理冲突" class="headerlink" title="11.3 处理冲突"></a>11.3 处理冲突</h3><ul>
<li>不说“你”或“我”</li>
<li>聚焦在角色模型上，而不是人上</li>
<li>使用客观指标</li>
</ul>
<h3 id="十二、胜在从容"><a href="#十二、胜在从容" class="headerlink" title="十二、胜在从容"></a>十二、胜在从容</h3><p>■如何平衡交付、质量和影响、团队这三者的关系，你才能交付一款卓越的软件。<br>■如何应对随机情况，你才能继续按原定节奏交付一款卓越的软件。随机情况是 指当你的管理层掷给你一个弧线球或者你的团队脱离正轨时出现的情况。随机 情况是每个在谷歌或亚马逊工作的人都理解的词之一，因为它是与帮助团队专 注于交付相对立的。<br>■如何妥善地管好你的精力，你才能 1 个顶 3 个。 ■如何找人以及在什么时候找人，你才能让合适的人做合适的事。 ■如何咽下狗屎三明治，因为有时候你的确得咽下去。</p>
<h3 id="十三、再度起航"><a href="#十三、再度起航" class="headerlink" title="十三、再度起航"></a>十三、再度起航</h3><p>先回过头来审视一下周边的环境。软件从来没有做完一说。 你需要问问自己是应该开始做软件的第二版，还是开始做些新的东西。某些情况下你 会发现对产品的投入所带来的回报正在递减。我所说的投入是指你的时间。时间构成 的风险资本是最具利用价值的资产之一。</p>
<p>如果你各方面都表现不凡——按照本书的指导来做事你就能变成这样，就永远可 以选择下一个项目。考虑每种选择对你的业务或个人意味着什么。或许是时候换一个 团队或换一个产品了，或许你因为理解错了客户的需求而需要重构刚刚交付的产品， 或许你只是简单地喜欢和那个工程经理小伙伴一起工作。评估维度有很多，你需要花 些时间来考虑。</p>
<p>项目过渡之所以具有挑战性，是因为它就像铁人三项赛一样，你必须中断之前的</p>
<p>192  第二部分 掌握卓越技能，更胜一筹<br>做事方式(如专注于细节、预发布)然后开始新的做事方式(如参与头脑风暴和策略 游戏)。它的另一个挑战性还在于你需要设法做好两份工作。第一份工作是维护已经 在生产环境中的软件，它几乎肯定会遇到一些早期发展过程中的困难。第二份工作是 启动新项目。大部分新项目在启动时都需要巨大的精力去推动，并在推动不利时需要 以坚韧的精神去承受不可避免的迎头痛击。</p>
<h2 id="十大交付原则"><a href="#十大交付原则" class="headerlink" title="十大交付原则"></a>十大交付原则</h2><ol>
<li>你不是来当老板的——团队主管是仆人，他们存在的目的就是为了伺候工程团队。 2. 从用户角度出发。</li>
<li>用独特的方法解决很多人都有的大问题。</li>
<li>坏的消息就是好的消息。——杰克·韦尔奇</li>
<li>先寻求理解，再寻求被理解。——史蒂芬·柯维</li>
<li>构建最简洁的可用的产品。</li>
<li>交付手中有的，而非脑中想的。</li>
<li>无法测量的东西也就无法提升。——开尔文勋爵</li>
<li>你不可能做完所有工作，所以你应首先做那些只有你能做的工作。 10. 永远走在交付的康庄大道上。</li>
</ol>
<h2 id="团队不可或缺的工件"><a href="#团队不可或缺的工件" class="headerlink" title="团队不可或缺的工件"></a>团队不可或缺的工件</h2><p>在管理产品开发的过程中，你会创建很多文档、指南、核查清单以及其他工件。 下面这张列表是贯穿产品生命周期中你可能期望创建的工件的略述。你很可能需要创 建以下所有工件，所以它们没有按照特别的顺序排列。你能从 <a href="http://www.shippinggreatness" target="_blank" rel="noopener">www.shippinggreatness</a>. com 上下载到其中一些工件的模板。<br>■轮值表——将寻呼器号码和手机号码的清单复制到一张钱包大小的纸上。 </p>
<p>■使用 Wiki 搭建的“联络簿”，用于遇到故障、突发事件或问题时寻找相关负责 人。这个列表应该包括法务、公关、市场、产品团队、工程团队和网络运维(或者任何负责生产基础设施的部门)的负责人和联系信息。<br>■描述使命的语句。</p>
<p>■关于未来两年的清晰策略。</p>
<p>■一页简要说明产品的人物 / 事件 / 原因 / 时间 / 方法的文档。 ■产品需求文档，或者叫功能规格说明。</p>
<p>■新闻稿。</p>
<p>■线框原型图或者餐巾纸草图。</p>
<p>■内部 FAQ 文档，其中部分问答打上外部 FAQ 标签以作为客户支持内容的原始<br>素材。 ■沟通文档，包括关键信息、有潜在危险的问题和对这些问题的回应。 ■发布时穿的 T 恤衫。</p>
<p>■包含测试时间的开发计划表。<br>■未来两年的路线图。</p>
<p>■内部用户列表和迁移时间表(适用于基础设施项目)。</p>
<p>■可信测试者列表(适用于面向外部的产品)。</p>
<p> ■特性需求列表，并将内部和外部客户中呼声最高的三个特性需求高亮。 </p>
<p> ■开放问题列表，并清晰标记这些问题的状态。 </p>
<p> ■进行中的会议纪要。最好建一个文档保存项目所有的历史会议纪要。 </p>
<p> ■发布计划或发布规程。 </p>
<p> ■记录什么特性在什么时间发布的生成变更列表。在排查客户问题时特别有用。 </p>
<p> ■对增长预测和硬件配置需求提前进行计划的生产设计文档。</p>
<p>  ■专利注册文件、商标注册文件和版权申明文件。</p>
<p>■隐私说明。 </p>
<p>■出色的数据指标——包含内部的状态面板和一些供外部消费的清洗过的数据指标。 </p>
<p>■为幻灯片、演示、评审、发布准备的产品截图。</p>
<p> ■团队本季度目标以及上季度目标完成情况。</p>
<p>■Bug 状态面板和阻碍每个发布的 Bug 列表。<br>■错误原因报告或事后调查报告。</p>
<p> ■会议纪要和团队周会、用户界面评审、产品评审、工程评审、Bug 处理、法务<br>评审、业务拓展周会以及客户支持碰头会的时间计划表。</p>
]]></content>
      
        
        <tags>
            
            <tag> 产品 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[关于产品经理]]></title>
      <url>/2017/07/02/%E5%85%B3%E4%BA%8E%E4%BA%A7%E5%93%81%E7%BB%8F%E7%90%86/</url>
      <content type="html"><![CDATA[<h2 id="一、产品和产品经理"><a href="#一、产品和产品经理" class="headerlink" title="一、产品和产品经理"></a>一、产品和产品经理</h2><h4 id="1-1-产品"><a href="#1-1-产品" class="headerlink" title="1.1 产品"></a>1.1 产品</h4><ul>
<li>帮助人们解决问题与麻烦的、可被使用和消费的、有形或者无形的服务、组织和观念</li>
</ul>
<h4 id="1-2-产品经理"><a href="#1-2-产品经理" class="headerlink" title="1.2 产品经理"></a>1.2 产品经理</h4><ul>
<li>负责设计出或者改进某产品的人</li>
<li>目前主要指代计算机设备的应用程序的产品经理。</li>
</ul>
<h2 id="二、如何设计应用程序"><a href="#二、如何设计应用程序" class="headerlink" title="二、如何设计应用程序"></a>二、如何设计应用程序</h2><h4 id="2-1-问题："><a href="#2-1-问题：" class="headerlink" title="2.1 问题："></a>2.1 问题：</h4><ul>
<li>帮助我们解决一个或多个问题。</li>
</ul>
<h4 id="2-2-流程与页面："><a href="#2-2-流程与页面：" class="headerlink" title="2.2 流程与页面："></a>2.2 流程与页面：</h4><ul>
<li>各种各样的页面存在一定的流程关系。</li>
</ul>
<h4 id="2-3-内容与功能："><a href="#2-3-内容与功能：" class="headerlink" title="2.3 内容与功能："></a>2.3 内容与功能：</h4><ul>
<li>不同页面内容和功能不同。</li>
</ul>
<h4 id="2-4-布局："><a href="#2-4-布局：" class="headerlink" title="2.4 布局："></a>2.4 布局：</h4><ul>
<li>内容和功能有不同的位置。</li>
</ul>
<h4 id="2-5-样式："><a href="#2-5-样式：" class="headerlink" title="2.5 样式："></a>2.5 样式：</h4><ul>
<li>优雅美观的设计风格。</li>
</ul>
<h2 id="三、应用程序的工作分工"><a href="#三、应用程序的工作分工" class="headerlink" title="三、应用程序的工作分工"></a>三、应用程序的工作分工</h2><h4 id="3-1-分工"><a href="#3-1-分工" class="headerlink" title="3.1 分工"></a>3.1 分工</h4><ul>
<li>产品经理：2.1 \ 2.2 </li>
<li>交互设计：2.3 \ 2.4</li>
<li>UI设计师：2.5 </li>
<li>开发：研发工程师</li>
<li>测试：测试工程师</li>
<li>上线</li>
<li>推广：市场推广，让更多人接触和使用</li>
<li>运营：产品运行，让用户更长的使用和产生收益</li>
<li>运维：运维工程师，数据和服务器的高速稳定。</li>
</ul>
<h4 id="3-2-调整"><a href="#3-2-调整" class="headerlink" title="3.2 调整"></a>3.2 调整</h4><p>小型公司部分岗位进行融合，比如无交互设计和运维。</p>
<h2 id="四、产品经理的具体工作"><a href="#四、产品经理的具体工作" class="headerlink" title="四、产品经理的具体工作"></a>四、产品经理的具体工作</h2><h4 id="4-1-解决什么问题与麻烦"><a href="#4-1-解决什么问题与麻烦" class="headerlink" title="4.1 解决什么问题与麻烦"></a>4.1 解决什么问题与麻烦</h4><ul>
<li>洞察机会：可以帮助人们解决什么问题，也就是点子</li>
<li>市场分析：解决这个问题，有没有市场前景，能不能得到好处</li>
<li>用户研究：什么样的人会碰到这样的问题？什么情况下？</li>
<li>需求分析：用户达到什么目的？用户有什么要求?</li>
<li>竞品分析:有没有产品已经解决这个问题，怎么做的，优缺点。</li>
<li>产品策划：为什么要做？应该怎么做？需要什么方法和资源？<h4 id="4-2-功能与内容"><a href="#4-2-功能与内容" class="headerlink" title="4.2 功能与内容"></a>4.2 功能与内容</h4></li>
<li>需求管理：问题优先、稍后、暂不解决</li>
<li>功能设计: 什么功能来解决问题</li>
<li>内容设计：什么内容来解决问题</li>
<li>功能模块设计:模块与系统，如何组合</li>
<li>信息结构设计：信息流的逻辑梳理</li>
<li>需求文档撰写：需求文档把上述内容都说清楚</li>
</ul>
<h4 id="4-3-流程页面"><a href="#4-3-流程页面" class="headerlink" title="4.3 流程页面"></a>4.3 流程页面</h4><ul>
<li>流程设计：按照什么流程来查看和使用</li>
<li>页面设置：哪些内容放在一个页面上，都有哪些页面</li>
<li>信息架构设计：如何让用户明白产品有哪些功能，并能快速定位到自己的需求</li>
<li>原型设计：具体的页面视图</li>
<li>交互文档撰写：把原型的展示细节说清楚</li>
</ul>
<h4 id="4-4-其他工作"><a href="#4-4-其他工作" class="headerlink" title="4.4 其他工作"></a>4.4 其他工作</h4><ul>
<li>配合UI设计师：一同选择设计风格并验收</li>
<li>配合开发工程师：不理解和不好实现的问题</li>
<li>管理项目进度：项目排期和按时发布</li>
<li>配合产品测试：发现可能存在的问题和不足</li>
<li>配合市场推广：帮助获取更多用户来使用产品</li>
<li>配合运营：协助设计运营方案。</li>
</ul>
<h2 id="五、产品经理能力"><a href="#五、产品经理能力" class="headerlink" title="五、产品经理能力"></a>五、产品经理能力</h2><h4 id="5-1-素质能力"><a href="#5-1-素质能力" class="headerlink" title="5.1 素质能力"></a>5.1 素质能力</h4><ul>
<li>逻辑分析能力：对产品和用户思考</li>
<li>设计规划能力： 功能和内容的迭代</li>
<li>文字表达能力： 问题和方案描述清楚</li>
<li>良好沟通能力：与各方沟通</li>
<li>管理能力： 需求和项目进度管理</li>
</ul>
<h4 id="5-2-工具能力"><a href="#5-2-工具能力" class="headerlink" title="5.2 工具能力"></a>5.2 工具能力</h4><ul>
<li>思维导图：Xmind</li>
<li>流程图：processon</li>
<li>原型工具：墨刀、Axure</li>
<li>文档撰写：word</li>
<li>数据整理分析：excel</li>
<li>展示和回报：PPT</li>
</ul>
<h2 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h2><ul>
<li>产品经理确实是更符合我的性格，如果最开始入行就选择，到如今肯定已经做到较高的水平。从前选择了从程序员方向切入，不过我始终保持发散思维，对程序开发的认识更进一步，相信待到合适的现实时机下，有机会直接做事，拥有懂程序的优势。</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 产品 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[机器学习在IOS中的应用 Core ML]]></title>
      <url>/2017/06/22/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9C%A8IOS%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%20Core%20ML/</url>
      <content type="html"><![CDATA[<blockquote>
<p>2017年的WWDC大会苹果赋予了开发者们新能力，能够将机器学习应用在移动端上，着实是一次让人感到兴奋的事情，一颗赛艇！！积极开展的Session学习活动，在第一节和第二节引用了一些概念和背景来帮助理解，熟练工请忽略，跳至第三节直接开始操作,第五节开始有图片学习的demo可查看。 </p>
</blockquote>
<h3 id="本篇相关文档和Session有："><a href="#本篇相关文档和Session有：" class="headerlink" title="本篇相关文档和Session有："></a>本篇相关文档和Session有：</h3><ul>
<li><p>document: <a href="https://developer.apple.com/documentation/coreml" target="_blank" rel="noopener">Core Ml FrameWork</a></p>
</li>
<li><p>Session: <a href="https://developer.apple.com/videos/play/wwdc2017/703/" target="_blank" rel="noopener">WWDC 2017 Session 703 Introducing Core ML</a></p>
</li>
<li><p>Session: <a href="https://developer.apple.com/videos/play/wwdc2017/710/" target="_blank" rel="noopener">WWDC 2017 Session 710 Core ML in depth</a></p>
</li>
</ul>
<h2 id="一、AI-ML-DL"><a href="#一、AI-ML-DL" class="headerlink" title="一、AI.ML.DL"></a>一、AI.ML.DL</h2><h3 id="1、-人工智能"><a href="#1、-人工智能" class="headerlink" title="1、 人工智能"></a>1、 人工智能</h3><h4 id="1-1-定义："><a href="#1-1-定义：" class="headerlink" title="1.1 定义："></a>1.1 定义：</h4><p>让人工制造出来的系统或者机器，其运作行为看起来就像是人所表现出的智能行为一样，即机器“像人一样思考”、“像人一样行动”、“理性地思考”和“理性地行动”。人工智能的研究是高度技术性和专业的，比如机器学习就是属于学习方向的课题，让机器具有人一样的学习行为。</p>
<h4 id="1-2-研究课题："><a href="#1-2-研究课题：" class="headerlink" title="1.2 研究课题："></a>1.2 研究课题：</h4><p>演绎推理和解决问题、知识表示法、规划、学习、自然语言处理、运动和控制、知觉、社交、创造力、多元智能、伦理管理、经济冲击</p>
<h3 id="2、机器学习"><a href="#2、机器学习" class="headerlink" title="2、机器学习"></a>2、机器学习</h3><h4 id="2-1-定义："><a href="#2-1-定义：" class="headerlink" title="2.1 定义："></a>2.1 定义：</h4><p>通过在大量数据中寻找模式,从数据中自动分析获得规律，并利用规律对未知数据进行预测的算法.因为学习算法中涉及了大量的统计学理论，机器学习与推断统计学联系尤为密切，也被称为统计学习理论，涵盖一切有关数据训练的学习算法。</p>
<h4 id="2-2-方式分类："><a href="#2-2-方式分类：" class="headerlink" title="2.2 方式分类："></a>2.2 方式分类：</h4><ul>
<li>监督学习：</li>
</ul>
<p>从给定的训练数据集中学习出一个函数，当新的数据到来时，可以根据这个函数预测结果。监督学习的训练集要求是包括输入和输出，也可以说是特征和目标。训练集中的目标是由人标注的。类似概念还有半监督学习和无监督学习。</p>
<ul>
<li>增强学习：</li>
</ul>
<p>通过观察来学习做成如何的动作。每个动作都会对环境有所影响，学习对象根据观察到的周围环境的反馈来做出判断。</p>
<h4 id="2-3-使用算法："><a href="#2-3-使用算法：" class="headerlink" title="2.3 使用算法："></a>2.3 使用算法：</h4><ul>
<li>构造间隔理论分布，聚类分析和模式识别：</li>
</ul>
<p>人工神经网络、决策树、感知器、支持向量机、集成学习AdaBoost、降维与度量学习、聚类贝叶斯分类器</p>
<ul>
<li><p>构造条件概率，回归分析和统计分类：    </p>
<p>高斯过程回归、线性判别分析、最近邻居法、径向基函数核</p>
</li>
<li><p>通过再生模型构造概率密度函数，最大期望算法概率图模型：</p>
<p>  贝叶斯网、Markov随机场、Generative Topographic Mapping</p>
</li>
<li><p>近似推断技术：<br>  马尔可夫链、蒙特卡罗方法、变分法</p>
</li>
</ul>
<h3 id="3、深度学习"><a href="#3、深度学习" class="headerlink" title="3、深度学习"></a>3、深度学习</h3><h4 id="3-1-定义："><a href="#3-1-定义：" class="headerlink" title="3.1 定义："></a>3.1 定义：</h4><p>深度学习是机器学习中一种基于对数据进行表征学习的方法，起源于人工神经网络，在前期机器学习并没有深度学习这样的学习模型。所以我们现在也认为它是属于深度学习属于机器学习范畴内。它试图使用包含复杂结构或由多重非线性变换构成的多个处理层对数据进行高层抽象的算法。</p>
<h4 id="3-2-关系图："><a href="#3-2-关系图：" class="headerlink" title="3.2 关系图："></a>3.2 关系图：</h4><p><img src="/assets/images/AIMLDL.jpg" alt=""></p>
<h2 id="二、机器学习的应用发展："><a href="#二、机器学习的应用发展：" class="headerlink" title="二、机器学习的应用发展："></a>二、机器学习的应用发展：</h2><h3 id="2-1-发展："><a href="#2-1-发展：" class="headerlink" title="2.1 发展："></a>2.1 发展：</h3><p>1956年，达特茅斯会议提出了“人工智能”的概念。其后，人工智能就一直萦绕于人们的脑海之中，并在科研实验室中慢慢孵化。之后的几十年，人工智能一直在两极反转，或被称作人类文明耀眼未来的预言；或者被当成技术疯子的狂想扔到垃圾堆里，直到2012年之前，这两种声音还在同时存在。主要问题来自于运算需求难以得到满足，即使是最基本的神经网络，也需要大量的运算。过去几年，尤其是2015年以来，人工智能开始大爆发，很大一部分是由于GPU的广泛应用，使得并行计算变得更快、更便宜、更有效。当然，无限拓展的存储能力和骤然爆发的数据洪流（大数据）的组合拳，也使得图像数据、文本数据、交易数据、映射数据全面海量爆发。</p>
<h3 id="2-2-应用："><a href="#2-2-应用：" class="headerlink" title="2.2 应用："></a>2.2 应用：</h3><ul>
<li>领域列举<br>机器学习已广泛应用于数据挖掘、计算机视觉、自然语言处理、生物特征识别、搜索引擎、医学诊断、检测信用卡欺诈、证券市场分析、DNA序列测序、语音和手写识别、战略游戏和机器人等等</li>
<li>场景举例<br>句子翻译、动态手势识别、个人化推荐、美化的图像处理、云歌曲推荐、无人机航拍的视频实时分类路况信息等等</li>
</ul>
<h3 id="2-3-大公司"><a href="#2-3-大公司" class="headerlink" title="2.3 大公司"></a>2.3 大公司</h3><ul>
<li>FaceBook<br>Facebook AI研究项目（FAIR）专注于基础科学以及长期研究,另外一个叫应用机器学习部门（AML）,将技术用于现有Facebook产品。</li>
<li>Microsoft<br>微软1991年就已经开始涉足机器学习，有数百名科学家和工程师。</li>
<li>Google<br>Google Assistant是谷歌深度学习研究的集大成者。</li>
<li>Amazon<br>其CEO贝索斯称，已经悄悄研究了AI四年，目前在其语音识别生态系统上投入的人力有1000人。</li>
<li>Baidu<br>2014年，百度重金挖来谷歌深度学习项目负责人Andrew Ng，发力AI研究。</li>
<li>Apple<br>WWDC2017，苹果宣布面向开发者的机器学习框架Core ML ，加速在 iPhone、iPad、Apple Watch 上的人工智能任务。</li>
</ul>
<h2 id="三、在IOS中使用机器学习"><a href="#三、在IOS中使用机器学习" class="headerlink" title="三、在IOS中使用机器学习"></a>三、在IOS中使用机器学习</h2><blockquote>
<p>使用Core ML，你可以将训练好的机器学习模型整合到你的应用中。</p>
</blockquote>
<h3 id="3-1-Core-ML简介"><a href="#3-1-Core-ML简介" class="headerlink" title="3.1 Core ML简介"></a>3.1 Core ML简介</h3><p>Core ML是一个训练好的模型Model，一个机器学习算法应用到一个训练数据集之后所得到的结果。利用该模型可以基于新的输入数据而进行预测，也就是利用了机器学习的结果。比如，如果一个模型在一个地区的历史房价数据上进行了训练，那么它就可能能够根据房子的卧室和浴室数量来预测房价。<br>Core ML 为设备性能进行了优化，从而减少了内存占用和功耗。严格在设备上运行能够确保用户数据的隐私，并且能保证你的应用在没有网络连接时也能够工作和响应。<br>Core ML 框架本身构建于低层面的原语（primitives）之上，比如 Accelerate、BNNS 和 Metal Performance Shaders；<br>构建完成的Core Ml又作为其他更高级框架的基础，比如支持用于图像分析的 Vision 框架，用于自然语言处理的 Foundation类，以及用于评估已经学习到的决策树的 GameplayKit。结构图如下:</p>
<p><img src="/assets/images/CoreMl.png" alt=""></p>
<h3 id="3-2-支持的系统"><a href="#3-2-支持的系统" class="headerlink" title="3.2 支持的系统"></a>3.2 支持的系统</h3><ul>
<li>iOS 11.0+Beta</li>
<li>macOS 10.13+Beta</li>
<li>tvOS 11.0+Beta</li>
<li>watchOS 4.0+Beta</li>
</ul>
<h3 id="3-3-如何获得CoreMl-Model"><a href="#3-3-如何获得CoreMl-Model" class="headerlink" title="3.3 如何获得CoreMl Model"></a>3.3 如何获得CoreMl Model</h3><p>从如上定义看出，CoreMl框架只是将机器学习后的成果拿来应用，本身并不涉及机器学习的运行环境和过程。获得这些结果的方式有两种。</p>
<ul>
<li><p>苹果爸爸为你提供的现在model<br>根据自己的需要下载：<a href="https://developer.apple.com/machine-learning" target="_blank" rel="noopener">https://developer.apple.com/machine-learning</a></p>
</li>
<li><p>自己创建model<br>苹果爸爸为开发者提供了生成方法，不满意官方或者使用不足的时候，可以自己去机器学习完成，在创建应用，即第四节的内容。</p>
</li>
</ul>
<h3 id="3-4-将CoreML模型用在你的应用中"><a href="#3-4-将CoreML模型用在你的应用中" class="headerlink" title="3.4 将CoreML模型用在你的应用中"></a>3.4 将CoreML模型用在你的应用中</h3><ul>
<li>新建demo工程，在工程target中在Build Phase的Link Binary With Libraries里，加上CoreML.framework系统框架。</li>
<li>将获得的 CoreMl Model 添加至工程中，我们以GoogLeNetPlaces.mlmodel为例:</li>
</ul>
<p><img src="/assets/images/CoreMLXcode.jpg" alt=""></p>
<ul>
<li>注意中间有个Model Class ，点击查看api调用，有两点注意，输入参数为 CVPixelBufferRef 格式,图片需要是224X224像素的大小，所以需要自己写方法去转化为合适的参数。</li>
</ul>
<p><img src="/assets/images/GoogleAPI.jpg" alt=""></p>
<ul>
<li><p>调用示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GoogLeNetPlaces *model = [[GoogLeNetPlaces alloc] init];</span><br><span class="line">UIImage *scaledImage = [self imageScaleToSize224:CGSizeMake(224, 224)];</span><br><span class="line">CVPixelBufferRef buffer = [self pixelBufferFromImage:scaledImage];</span><br><span class="line">GoogLeNetPlacesInput *input = [[GoogLeNetPlacesInput alloc] initWithSceneImage:buffer];</span><br><span class="line">GoogLeNetPlacesOutput *output = [model predictionFromFeatures:input error:nil];</span><br><span class="line">NSLog(@&quot;Scene label is: %@&quot;, output.sceneLabel);</span><br></pre></td></tr></table></figure>
</li>
<li><p>结论<br>百度搜索图片，下载常规的桌子、卧室图片，利用google此个model进行判断输出，正确。输入健身房的图片，判断输出为博物馆。由此可以看出，训练样本过少，当输入数据变复杂的时候就不能判断正确，侧面激励开发者们自己开展训练模型。</p>
</li>
</ul>
<h2 id="四、创建自己的Core-Ml-Model"><a href="#四、创建自己的Core-Ml-Model" class="headerlink" title="四、创建自己的Core Ml Model"></a>四、创建自己的Core Ml Model</h2><h3 id="4-1-Apple支持的模型"><a href="#4-1-Apple支持的模型" class="headerlink" title="4.1 Apple支持的模型"></a>4.1 Apple支持的模型</h3><p>苹果支持由第三方工具和框架训练出来的机器学习模型转化，我们可以只用苹果提供的转化工具,将个人已经训练好的数据模型转化为CoreML进行支持。工具为 Core ML Tools ，是基于Python开发的工具，需要自己安装配置，到这里，上面一二节的概念理解就有作用了，前面提到了机器学习所使用到的思想算法，这里工具有对应的类型支持转化。我从官网对照理解过来如下图：</p>
<table>
<thead>
<tr>
<th>学习模型</th>
<th>子算法类型</th>
<th>工具框架</th>
</tr>
</thead>
<tbody>
<tr>
<td>人工神经网络</td>
<td>多层向前反馈网络（Multilayer Feedforward Network）、CNN卷积神经网络（Convolution Neural Network、RNN递归神经网络（Recurrent Neural Networks）</td>
<td>Caffe、Keras 1.2.2</td>
</tr>
<tr>
<td>集成算法</td>
<td>随机森林（Random forests）、迭代树（boosted trees）、决策树（decision trees）</td>
<td>scikit-learn 0.18、XGBoost 0.6</td>
</tr>
<tr>
<td>支持向量机</td>
<td>线性回归（Scalar regression）、多分类器（multiclass classification）</td>
<td>scikit-learn 0.18、LIBSVM 3.22</td>
</tr>
<tr>
<td>广义线性模型</td>
<td>线性回归（Linear regression）、多分类器（multiclass classification）、标量回归（Scalar regression）</td>
<td>scikit-learn 0.18</td>
</tr>
<tr>
<td>特征工程</td>
<td>稀疏向量化（Sparse vectorization）、密集向量化（ dense vectorization）、分类处理（categorical processing）</td>
<td>scikit-learn 0.18</td>
</tr>
<tr>
<td>机器学习流</td>
<td>马尔可夫链（Sequentially chained models）</td>
<td>scikit-learn 0.18</td>
</tr>
</tbody>
</table>
<h3 id="4-2-转换你的学习模型"><a href="#4-2-转换你的学习模型" class="headerlink" title="4.2 转换你的学习模型"></a>4.2 转换你的学习模型</h3><p>微信朋友圈常常被一些风格奇异的图片刷屏，app里上传自己的照片就能变成特定风格的画像，有油画、漫画等等，这些都是机器学习的结果，Neural Transfer Style。一般有两种实现：第一种是快速渲染，输入一张原图+一个某种固定画风的模型 = 输出结果，这个你只需要模型就OK；第二种方法是，输入一张原图+一张风格图 + 在线渲染 = 输出结果，需要一个原始模型就行。搜索查询都是基于python的训练实现，有基于tensorflow,也有基于torch的，没到已生成的model，因而这里还是拿一个已有的图像识别的例子来讲。</p>
<ul>
<li><p>已下载材料<br>   <a href="http://dl.caffe.berkeleyvision.org/bvlc_alexnet.caffemodel" target="_blank" rel="noopener">bvlc_alexnet.caffemodel</a>、<br>   <a href="https://raw.githubusercontent.com/BVLC/caffe/master/models/bvlc_alexnet/deploy.prototxt" target="_blank" rel="noopener">deploy.prototxt</a>、<br>   <a href="https://raw.githubusercontent.com/torch/tutorials/master/7_imagenet_classification/synset_words.txt" target="_blank" rel="noopener">class_labels.txt</a></p>
</li>
<li><p>其他参考Caffe Model：</p>
<p>  <a href="https://github.com/BVLC/caffe/wiki/Model-Zoo#models-for-age-and-gender-classification" target="_blank" rel="noopener">Caffe model</a></p>
</li>
</ul>
<h4 id="4-2-1-pip安装Coremltools"><a href="#4-2-1-pip安装Coremltools" class="headerlink" title="4.2.1 pip安装Coremltools"></a>4.2.1 pip安装Coremltools</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; sudo easy_install pip</span><br><span class="line">&gt;&gt; pip install -U coremltools</span><br></pre></td></tr></table></figure>
<h4 id="4-2-2-打开mac终端"><a href="#4-2-2-打开mac终端" class="headerlink" title="4.2.2 打开mac终端"></a>4.2.2 打开mac终端</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; python</span><br><span class="line">&gt;&gt; import coremltools</span><br><span class="line">&gt;&gt; coreml_model = coremltools.converters.caffe.convert((&apos;bvlc_alexnet.caffemodel&apos;, &apos;deploy.prototxt&apos;),predicted_feature_name=&apos;class_labels.txt&apos;)</span><br><span class="line">&gt;&gt; coreml_model.author = &apos;徐子超&apos;</span><br><span class="line">&gt;&gt; coreml_model.license = &apos;字节跳动&apos;</span><br><span class="line">&gt;&gt; coreml_model.short_description = &apos;Predicts the price of a house in the Seattle area.&apos; </span><br><span class="line">&gt;&gt; coreml_model.save(&apos;BVLCObjectClassifier.mlmodel&apos;)</span><br></pre></td></tr></table></figure>
<h4 id="4-2-3-得到model结果"><a href="#4-2-3-得到model结果" class="headerlink" title="4.2.3 得到model结果"></a>4.2.3 得到model结果</h4><p>我下载的bvlc_alexnet.caffemodel大小有244M左右，在终端中转化为CoreMl却基本没有转化耗时，可见苹果在开发工具的创造上下了功夫。我们得到了CoreML的模型如下图：</p>
<p><img src="/assets/images/CoreMLFile.jpg" alt=""></p>
<p>直接在工程文件中，加入model,添加到对应的target</p>
<p><img src="/assets/images/CoreMLXcode.jpg" alt=""></p>
<p>点击中间Model Class即可查看对应的定义，Model依旧244M大小，我在打开定义的过程中感受到了Xcode的明显延迟卡顿。</p>
<p>到这里，我们的model转化就完成了，在WWDC上也介绍了别的python工具，我这里没有使用，直接在终端里面完成即可。接下来，做个实测demo跑一下效果，本次转化的model过大，此处我们还是继续拿第三节的model来做。</p>
<h2 id="五、相机即时画面的图像解析Demo"><a href="#五、相机即时画面的图像解析Demo" class="headerlink" title="五、相机即时画面的图像解析Demo"></a>五、相机即时画面的图像解析Demo</h2><h4 id="4-1-新建一个相机demo"><a href="#4-1-新建一个相机demo" class="headerlink" title="4.1 新建一个相机demo"></a>4.1 新建一个相机demo</h4><p>即时的图像识别，需要在摄像头打开后，实时的获取手机屏幕上展示的每一帧图像，所以通常的UIimageViewPicker是无法做到的，我们需要自己搭建UI并手写捕捉相机视图的代码来构建一个自己的相机，通过AVFoundationKit,我们可以拿到相机里面图像流动的每一帧，从而可以将图像传递给GoogleNet进行识别。来，继续改造第三节的demo工程，将viewController变成一个简化版本的相机。</p>
<p>相机启动在三个时机，viewDidLoad的时候直接建立好组件，主要涉及AVFoundationKit的类有：</p>
<ul>
<li>AVCaptureDevice：获取手机功能里的相机设备</li>
<li>AVCaptureSession：连接相机device到输出数据流的会话层</li>
<li>AVCaptureVideoPreviewLayer：用于展示图片的画布，也是我们常见的相机窗口</li>
<li>AVCaptureVideoDataOutput：数据流</li>
<li>AVCaptureConnection ：数据连接</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">- (void)initAVCapturWritterConfig</span><br><span class="line">&#123;</span><br><span class="line">    self.session = [[AVCaptureSession alloc] init];</span><br><span class="line">    </span><br><span class="line">    //视频</span><br><span class="line">    AVCaptureDevice *videoDevice = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];</span><br><span class="line">    if (videoDevice.isFocusPointOfInterestSupported &amp;&amp; [videoDevice isFocusModeSupported:AVCaptureFocusModeContinuousAutoFocus]) &#123;</span><br><span class="line">        [videoDevice lockForConfiguration:nil];</span><br><span class="line">        [videoDevice setFocusMode:AVCaptureFocusModeContinuousAutoFocus];</span><br><span class="line">        [videoDevice unlockForConfiguration];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    AVCaptureDeviceInput *cameraDeviceInput = [[AVCaptureDeviceInput alloc] initWithDevice:videoDevice error:nil];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    if ([self.session canAddInput:cameraDeviceInput]) &#123;</span><br><span class="line">        [self.session addInput:cameraDeviceInput];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //视频</span><br><span class="line">    self.videoOutPut = [[AVCaptureVideoDataOutput alloc] init];</span><br><span class="line">    NSDictionary * outputSettings = [[NSDictionary alloc] initWithObjectsAndKeys:[NSNumber numberWithInt:kCVPixelFormatType_32BGRA],(id)kCVPixelBufferPixelFormatTypeKey, nil];</span><br><span class="line">    [self.videoOutPut setVideoSettings:outputSettings];</span><br><span class="line">    if ([self.session canAddOutput:self.videoOutPut]) &#123;</span><br><span class="line">        [self.session addOutput:self.videoOutPut];</span><br><span class="line">    &#125;</span><br><span class="line">    self.videoConnection = [self.videoOutPut connectionWithMediaType:AVMediaTypeVideo];</span><br><span class="line">    self.videoConnection.enabled = NO;</span><br><span class="line">    [self.videoConnection setVideoOrientation:AVCaptureVideoOrientationPortrait];</span><br><span class="line">    </span><br><span class="line">    //初始化预览图层</span><br><span class="line">    self.previewLayer = [[AVCaptureVideoPreviewLayer alloc] initWithSession:self.session];</span><br><span class="line">    [self.previewLayer setVideoGravity:AVLayerVideoGravityResizeAspectFill];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，在viewDidAppear的开始捕捉画面，viewWillDisappear停止相机捕捉。在viewDidAppear的时候我们开始相机的录制，代码会在videooutput的协议里回调给我们相机设备录制到的每一帧图像，这个时候我们就可以开始处理了。关键代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (void)startVideoCapture</span><br><span class="line">&#123;</span><br><span class="line">    [self.session startRunning];</span><br><span class="line">    self.videoConnection.enabled = YES;</span><br><span class="line">    self.videoQueue = dispatch_queue_create(&quot;videoQueue&quot;, NULL);</span><br><span class="line">    [self.videoOutPut setSampleBufferDelegate:self queue:self.videoQueue];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark --AVCaptureVideoDataOutputSampleBufferDelegate</span><br><span class="line">- (void)captureOutput:(AVCaptureOutput *)captureOutput didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection *)connection</span><br><span class="line">&#123;</span><br><span class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;CMSampleBufferRef&quot;, NULL);</span><br><span class="line">    dispatch_sync(queue, ^&#123;</span><br><span class="line">        CGImageRef cgImage = [UIImage imageFromSampleBuffer:sampleBuffer];</span><br><span class="line">        NSString *text = [self predictImageScene:[UIImage imageWithCGImage:cgImage]];</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            self.googleLabel.text = text;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意此处，相机给我们回传的是CMSampleBufferRef格式的数据，而我们在第三节需要传入的是CVPixelBufferRef，所以会有一步在UIImage+Utils里的转化,最后附上代码地址。</p>
<h4 id="4-2-实时显示效果"><a href="#4-2-实时显示效果" class="headerlink" title="4.2 实时显示效果"></a>4.2 实时显示效果</h4><p>到官网下载安装配置，把手机升级到IOS11的beta版本后，将相机demo连上手机真机调试得到实时显示,当我移动手机对准不同画面时，相机底部会对应解析出识别结果:</p>
<p><img src="/assets/images/coremlgif.gif" alt=""></p>
<h2 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h2><p>从本次实践上，还是可以看出一些问题：</p>
<p>1、Core ML 框架只在IOS11以上才开始支持，现状是很多APP还在支持低版本。比如目前微信支持IOS8以上。</p>
<p>2、每一个机器学习模型引入的model都是很大，我们的demo使用偏小的model，但是数据却又不准确，model的引入会给IOS安装包带来包体积很大的增加。</p>
<p>3、机器学习的结果分析大量的运算，虽然目前iphone在不断的升级硬件GPUCPU，但是我测试过程中还是发现计算的延迟，就异步计算返回的。</p>
<p>4、对于非专业的机器学习人士来讲，IOS开发能拿到现在的model来使用，很多酷炫的效果都没有现成的model,这里也是一个门槛。</p>
<p>随着Core ML技术的引入，移动端上实现机器学习开始变得可能，这也让IOS开发者为之兴奋，然而在IOS上实践机器学习还是有较长的路要走，当然apple本身的布局正在推动这一发展，保持期待。本文不仅仅是对WWDC新技术的探索和分享，也是对机器学习的兴趣认识。</p>
<h4 id="github代码-IOS-Core-ML，有兴趣的同学可以下载在IOS11的设备上跑起来。"><a href="#github代码-IOS-Core-ML，有兴趣的同学可以下载在IOS11的设备上跑起来。" class="headerlink" title="github代码:IOS-Core ML，有兴趣的同学可以下载在IOS11的设备上跑起来。"></a>github代码:<a href="https://github.com/xuzichao/IOS-Core-ML" target="_blank" rel="noopener">IOS-Core ML</a>，有兴趣的同学可以下载在IOS11的设备上跑起来。</h4>]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[写在2016年末]]></title>
      <url>/2016/12/25/%E5%86%99%E5%9C%A82016%E5%B9%B4%E5%BA%95/</url>
      <content type="html"><![CDATA[<p>现在已经是16年的年尾了，想起去年元旦节那天和几个老基友在一棵年树下合影留念，恰好是自己入职今日头条第一天，那时候自己在工作上又上了一个台阶，特别开心。入职的一月给自己定了16年的目标，16年是本命年啊，要好好的过好这一年。</p>
<p>针对个人的各方面规划，看起来真是个美好的愿景，一天天按部就班的做着事情，希望能再年底的时候给自己惊喜。如今回头去看，有的目标还没有进展！贼哈哈哈哈哈！想起来我也是快乐的！是啊，这大半年有些浪。总结回顾，大概去年创业大半年给整累了，来了头条后，各种更好的生活，各种轻松的姿态，逐渐的也就有些懒散，当然头条也是创业驱动型公司，氛围是很强烈的，不过对于我这样从创业公司过来的，还是觉得条件会好些，少了点之前那股劲头。</p>
<p>目标这个东西确实容易让人清醒，想起当时的积极澎湃都去哪了，看着一个个目标的进度，上哪说理去？客观原因分析后，主要是一年自己没有想好怎么过，年初定的目标有偏颇，总是一个探索的心，自己尝试了好多方向去认识自己，在知道想干什么的前提下，尝试去判断自己能不能做到。而这些尝试呢，和原本设定的目标是有出入的。既定的目标的实现时机由于一个客观原因也发生了变化，在今年是完成不了的。就这样，在一个个夜里深睡去，直到每日早上九十点，几个老基友基本每周都聚，自己的生活节奏也是存在影响的。工作期间，找我的头聊了聊，他也看出了我的一些困惑，觉得我可能是有些茫然，大概对应了工作两年的人都会有的现象，给我讲述了他的一些故事。这又让我想起了自己大学的时候，好像大二是有点茫然，未来那么长，我该做点什么。对，是的，我该做点什么了。中间我也修正过一些计划，在中秋节的时候总结了一下，但是没有从根本上做出变动。</p>
<p>经过不断的自我认识，不断的尝试，我觉得现在比较清楚自己之后的安排了，可以拟定一些方向性质上的目标，以前定目标都是相对较短期目标，接下来要完成这些目标的时间是相对较长的，是到17年年底的时候才会来check的。因为是从自己目前的情况来看，这样相对来说合适一点，这段时间内，我也做不了比这些更大的事情了。总感觉这次和以往定目标时不太一样，也许这就是成长。</p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>时间：16-12-25</p>
<blockquote>
<p>目标 1： IOS技术扩展挖深</p>
</blockquote>
<ul>
<li>头条的业务需求、管理一块业务</li>
</ul>
<blockquote>
<p>目标 2： 产品经理继续学习</p>
</blockquote>
<ul>
<li>头条数据分析；网站上学习理论知识，应用在独立App上</li>
</ul>
<blockquote>
<p>目标 3： 维护一个头条号</p>
</blockquote>
<ul>
<li>每周发两篇</li>
</ul>
<blockquote>
<p>目标 4： 争取能够自己发一款独立APP</p>
</blockquote>
<ul>
<li>IOS端至少能够达到演示的目的</li>
</ul>
<blockquote>
<p>目标 5： 托福考试过，申请香港或新加坡的硕士</p>
</blockquote>
<blockquote>
<p>目标 6： 成都或者重庆买下自己的第一套住房</p>
</blockquote>
<ul>
<li>去闯，闯不了就滚回去</li>
</ul>
<blockquote>
<p>目标 7： 学会摄影或者学会一门乐器</p>
</blockquote>
<ul>
<li>一个人拥有一个爱好是很重要的</li>
</ul>
<blockquote>
<p>目标 8： 锻炼</p>
</blockquote>
<ul>
<li>健康是最重要的，年轻人就得有肌肉</li>
</ul>
<h2 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h2><p>时间：17-12-28</p>
<blockquote>
<p>目标 1：</p>
</blockquote>
<ul>
<li><p>问答业务进展顺利，开发独立app</p>
</li>
<li><p>主导应用工程平台化。</p>
</li>
<li><p>主导内部创业新项目</p>
</li>
</ul>
<blockquote>
<p>目标 2：</p>
</blockquote>
<ul>
<li>零零散散的看了一些产品的博客和大咖的文章，看了两本书</li>
</ul>
<blockquote>
<p>目标 3：</p>
</blockquote>
<ul>
<li>建立了头条号，只发了几篇文章</li>
</ul>
<blockquote>
<p>目标 4： </p>
</blockquote>
<ul>
<li>画过原型和设计，做了部分APP的代码组件和雏形，在做解耦拆分，工作量大。</li>
</ul>
<blockquote>
<p>目标 5：</p>
</blockquote>
<ul>
<li>前后加起来背了有两千单词，然后被杂事打乱。</li>
<li>做完一本托福阅读的书籍。</li>
<li>由于一些原因改为考了一次雅思，发出了英国学校申请</li>
</ul>
<blockquote>
<p>目标 6： </p>
</blockquote>
<ul>
<li><p>从11月份和12月份的观察，到1月份回去查看了各处的楼盘，对这事情的认识有所改观，房子这个事情先不着急，但是也可以做，牵扯到的东西多，春节回来办公积金卡，5月份的时候可以再去看看。</p>
</li>
<li><p>4月份的时候回了重庆，买在了照母山旁边，目前房价已经涨起来</p>
</li>
</ul>
<blockquote>
<p>目标 7：</p>
</blockquote>
<ul>
<li>单反出去拍过，有进步</li>
<li>自己买了个无人机，飞行了几次，在北京由于禁飞限制，每次都要开车跑很远，飞行成本很高</li>
<li>买了个小提琴，没怎么动过，以后可以考虑参加培训班</li>
</ul>
<blockquote>
<p>目标 8：</p>
</blockquote>
<ul>
<li>打过打乒乓球和羽毛球，偶尔跑步</li>
<li>力量训练少，整体频次低</li>
<li>身在IT行业再难做到学校的作息</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[使用CocoaPods创建私有仓库]]></title>
      <url>/2016/11/22/%E4%BD%BF%E7%94%A8CocoaPods%E5%88%9B%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93/</url>
      <content type="html"><![CDATA[<h2 id="一、两个概念："><a href="#一、两个概念：" class="headerlink" title="一、两个概念："></a>一、两个概念：</h2><h3 id="1、XXX-podspec-配置文件"><a href="#1、XXX-podspec-配置文件" class="headerlink" title="1、XXX.podspec   配置文件"></a>1、XXX.podspec   配置文件</h3><p>spec 配置文件是cocoapods的每一个代码仓库所对应的信息管理文件，主要是对仓库的行为进行配置，每一个版本的代码仓库都对应有一个配置文件。</p>
<p>包括仓库的名称、版本号、描述、主页地址、证书说明、作者、版本指定方式、工程的目标版本号、文件和资源的路径、依赖的库关系等。举例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># Be sure to run `pod lib lint ios-category.podspec&apos; to ensure this is a</span><br><span class="line"># valid spec before submitting.</span><br><span class="line">#</span><br><span class="line"># Any lines starting with a # are optional, but their use is encouraged</span><br><span class="line"># To learn more about a Podspec see http://guides.cocoapods.org/syntax/podspec.html</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">Pod::Spec.new do |s|</span><br><span class="line">  s.name             = &apos;ios-category&apos;</span><br><span class="line">  s.version          = &apos;0.0.2&apos;</span><br><span class="line">  s.summary          = &apos;ios-category is used for ios-network&apos;</span><br><span class="line"></span><br><span class="line"># This description is used to generate tags and improve search results.</span><br><span class="line">#   * Think: What does it do? Why did you write it? What is the focus?</span><br><span class="line">#   * Try to keep it short, snappy and to the point.</span><br><span class="line">#   * Write the description between the DESC delimiters below.</span><br><span class="line">#   * Finally, don&apos;t worry about the indent, CocoaPods strips it!</span><br><span class="line"></span><br><span class="line">  s.description      = &lt;&lt;-DESC</span><br><span class="line"></span><br><span class="line">  s.homepage         = &apos;http://www.example.com&apos;</span><br><span class="line">  # s.screenshots     = &apos;www.example.com/screenshots_1&apos;, &apos;www.example.com/screenshots_2&apos;</span><br><span class="line">  s.license          = &#123; :type =&gt; &apos;MIT&apos;, :file =&gt; &apos;LICENSE&apos; &#125;</span><br><span class="line">  s.author           = &#123; &apos;xuzichao&apos; =&gt; &apos;xuzichao03@gmail.com&apos; &#125;</span><br><span class="line">  s.source           = &#123; :git =&gt; &apos;git@code.xuzichao.org:tt_pods_ios-category.git&apos;, :tag =&gt; s.version.to_s  &#125;</span><br><span class="line">  # s.social_media_url = &apos;https://twitter.com/&lt;TWITTER_USERNAME&gt;&apos;</span><br><span class="line"></span><br><span class="line">  s.ios.deployment_target = &apos;6.0&apos;</span><br><span class="line"></span><br><span class="line">  s.source_files = &apos;ios-category/Classes/**/*&apos;</span><br><span class="line">  </span><br><span class="line">  s.resource_bundles = &#123;</span><br><span class="line">    &apos;ios-category&apos; =&gt; [&apos;ios-category/Resources/*&apos;]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  # s.public_header_files = &apos;Pod/Classes/**/*.h&apos;</span><br><span class="line">  # s.frameworks = &apos;UIKit&apos;, &apos;MapKit&apos;</span><br><span class="line">  # s.dependency &apos;ios-categorying&apos;, &apos;~&gt; 2.3&apos;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="2、Spec-repo"><a href="#2、Spec-repo" class="headerlink" title="2、Spec repo"></a>2、Spec repo</h3><p>组合词，表示仓库的概念，主要是用于存储pod代码库对应的podspec文件，管理各个仓库的各个版本的代码，它其实就是一个容器。Cocoapods会默认在本地建立一个容器，包含了你各个工程对应的代码仓库，当你使用了Cocoapods后，它们就会被clone到本地的~/.cocoapods/repos目录下。这里指代的是Cocoapods默认创建的仓库，其实我们不需要关心。</p>
<p>当我们创建私有库的时候，我们需要有自己的容器，用于存放自己的各个代码库，和上面的Cocoapods创建的是区别开的。我们自己创建的容器，其实就是一个远端的git仓库，我们把代码库对应的各个版本配置文件提交上去。</p>
<h2 id="二、创建的操作："><a href="#二、创建的操作：" class="headerlink" title="二、创建的操作："></a>二、创建的操作：</h2><h3 id="1、使用cocoapods："><a href="#1、使用cocoapods：" class="headerlink" title="1、使用cocoapods："></a>1、使用cocoapods：</h3><p>1.1 命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install cocoapods</span><br><span class="line">touch podfile</span><br><span class="line">pod install</span><br><span class="line">pod update</span><br></pre></td></tr></table></figure>
<p>1.2 pod install 、 pod update</p>
<p>pod install 将pod的版本写入Podfile.lock文件中.对于已经在Podfile.lock中有记录的Pod下载对应的版本，即便有新的版本，也不会去更新.对于没有记录的，根据Podfile中的约定，下载版本，并把版本信息写入Podfile.lock中.</p>
<p>只有当需要更新pod版本时，才用pod update,其余时间都用pod install</p>
<h3 id="2、私有库"><a href="#2、私有库" class="headerlink" title="2、私有库"></a>2、私有库</h3><p>2.1 创建并设置一个私有的Spec Repo。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod repo add TestSpecs https://coding.net/test.git</span><br></pre></td></tr></table></figure>
<p>2.2 创建Pod的所需要的项目工程文件，并且有可访问的项目版本控制地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">$ git commit -s -m &quot;我的工程代码文件&quot;</span><br><span class="line">$ git remote add origin git@coding.net:ios-category.git     </span><br><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>
<p>2.3 创建Pod所对应的podspec文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pod spec create ios-category.podspec</span><br></pre></td></tr></table></figure>
<p>2.4 本地测试配置好的podspec文件是否可用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pod lib lint</span><br><span class="line">	</span><br><span class="line">$ pod &apos;ios-category&apos;, :podspec =&gt; &apos;~/Users/ios-category.podspec&apos;  #指定podspec文件</span><br></pre></td></tr></table></figure>
<p>2.5 向私有的Spec Repo中提交podspec。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod repo push TestSpecs ios-category.podspec</span><br></pre></td></tr></table></figure>
<p>2.6 在个人项目中的Podfile中增加刚刚制作的好的Pod并使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># private</span><br><span class="line">source &apos;https://coding.net/test.git&apos;</span><br><span class="line"># public</span><br><span class="line">source &apos;https://github.com/CocoaPods/Specs.git&apos;</span><br><span class="line"></span><br><span class="line">target &apos;ReactiveCocoaDemo&apos; do</span><br><span class="line">pod &quot;ios-category&quot;, &quot;0.1.0&quot;</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="三、其他说明"><a href="#三、其他说明" class="headerlink" title="三、其他说明"></a>三、其他说明</h2><p>按照阶段二进行操作，即可顺利完成pod工程的引用，其他介绍说明文档中可能出现的，testpod 工程，其实可以不用管。比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec create PodTestLibrary git@coding.net:test.gitt</span><br></pre></td></tr></table></figure>
<p>以及由于pod的各个版本变化，spec文件有可能本来是正确的，但是pod lib lint这一步始终不能通过，这样pod repo push这一步就无法完成。可以直接将spec文件通过git 提交的方式放进远端的Spec Repo中，依然可以正常运行。</p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[AOP面向切面编程]]></title>
      <url>/2016/10/04/AOP%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>AOP可以理解为面向切面编程，如果OOP编程可以将各个业务模块化，那么我们可以认为AOP是从模块的侧面一刀切入进行操作，提炼出各个业务模块中公共部分进行操作，侧面切入可以做到不影响原本的业务功能，实现相对独立的功能构建，与原业务无耦合。大的功能比如各个业务的日志统计、性能分析、异常处理等等，小的功能点可以一些运行时信息的读取。</p>
<p>在iOS中实现AOP的编程思想主要是基于Runtime机制，Objectve-c是动态的编程语言，在运行时也能够对外提供交互的方法，不仅仅是方法交换，所有你能想象的应用场景，这非常有利于我们进行AOP切面编程。</p>
<h3 id="一、Category构建安全校验"><a href="#一、Category构建安全校验" class="headerlink" title="一、Category构建安全校验"></a>一、Category构建安全校验</h3><p>开发过程中我们通常遇到一些安全检验判断，防止数据格式不对的时候引起异常或者崩溃。比如对字典和数组进行的操作，是否存在对应的数据类型，是否超出下标越界，添加的对象是否为空。通常我们再开发的时候每次都需要进行if条件的判断，这样的操作其实很繁琐。</p>
<h5 id="1、代码中频繁的判断操作"><a href="#1、代码中频繁的判断操作" class="headerlink" title="1、代码中频繁的判断操作"></a>1、代码中频繁的判断操作</h5><p>1.1 如果没有添加判断，obj为nil将出现异常崩溃</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//字典</span><br><span class="line">NSMutableDictionary *param = [NSMutableDictionary new];</span><br><span class="line">if (obj) &#123;</span><br><span class="line">    [params setObject:obj forKey:@&quot;obj&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//数组</span><br><span class="line">NSMutableArray *array = [NSMutableArray array];</span><br><span class="line">if (obj) &#123;</span><br><span class="line">    [array addObject:obj]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.2 获取字典或者数组中对应的数据类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//字典</span><br><span class="line">NSDictionary *dic = fromNetDic;</span><br><span class="line">    NSString *str = @&quot;&quot;;</span><br><span class="line">    id value = [dic objectForKey:key];</span><br><span class="line">    if (value &amp;&amp; [value isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">        str = value;</span><br><span class="line">    &#125;else if(value &amp;&amp; [value isKindOfClass:[NSNumber class]])&#123;</span><br><span class="line">        str =  [value stringValue];</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        str = @&quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//数组</span><br><span class="line">同理</span><br></pre></td></tr></table></figure>
<h5 id="2、通过切面编程改进"><a href="#2、通过切面编程改进" class="headerlink" title="2、通过切面编程改进"></a>2、通过切面编程改进</h5><p>上面的都是日常频繁操作，每次都写编程就会变得低效，我们通过新建分类进行改善，不需要再频繁判断，且保证代码原本操作的不变。</p>
<p>2.1 新建替换操作方法基于NSObject的分类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;NSObject+MethodReplace.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation NSObject(MethodReplace)</span><br><span class="line">- (void)swizzleMethod:(SEL)origSelector withMethod:(SEL)newSelector</span><br><span class="line">&#123;</span><br><span class="line">    Class class = [self class];</span><br><span class="line">    </span><br><span class="line">    Method originalMethod = class_getInstanceMethod(class, origSelector);</span><br><span class="line">    Method swizzledMethod = class_getInstanceMethod(class, newSelector);</span><br><span class="line">    </span><br><span class="line">    BOOL didAddMethod = class_addMethod(class,</span><br><span class="line">                                        origSelector,</span><br><span class="line">                                        method_getImplementation(swizzledMethod),</span><br><span class="line">                                        method_getTypeEncoding(swizzledMethod));</span><br><span class="line">    if (didAddMethod) &#123;</span><br><span class="line">        class_replaceMethod(class,</span><br><span class="line">                            newSelector,</span><br><span class="line">                            method_getImplementation(originalMethod),</span><br><span class="line">                            method_getTypeEncoding(originalMethod));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>2.2 字典的安全写法替换，不需要再判断类型， 数组也是同理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;NSDictionary+Safe.h&quot;</span><br><span class="line">#import &quot;NSObject+MethodReplace.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation NSDictionary (Safe)</span><br><span class="line"></span><br><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        id obj = [[self alloc] init];</span><br><span class="line">        [obj swizzleMethod:@selector(valueForKey:) withMethod:@selector(safeValueForkey:)];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)safeValueForkey:(NSString *)key</span><br><span class="line">&#123;</span><br><span class="line">    id value = nil;</span><br><span class="line">    if (key &amp;&amp; ![key isEqualToString:@&quot;&quot;]) &#123;</span><br><span class="line">        if ([self.allKeys containsObject:key]) &#123;</span><br><span class="line">            value = [self valueForKey:@&quot;key&quot;];</span><br><span class="line">            if ([value isKindOfClass:[NSNumber class]]) &#123;</span><br><span class="line">                value = ((NSNumber *)value).stringValue;</span><br><span class="line">            &#125;</span><br><span class="line">            else if ([value isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">                value = (NSString *)[self valueForKey:@&quot;key&quot;];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation NSMutableDictionary (Safe)</span><br><span class="line"></span><br><span class="line">+ (void)load</span><br><span class="line">&#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        id obj = [[self alloc] init];</span><br><span class="line">        [obj swizzleMethod:@selector(setObject:forKey:) withMethod:@selector(safeSetObject:forKey:)];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)safeSetObject:(id)anObject forKey:(id&lt;NSCopying&gt;)aKey</span><br><span class="line">&#123;</span><br><span class="line">    if (aKey) &#123;</span><br><span class="line">        if (anObject) &#123;</span><br><span class="line">            [self setObject:anObject forKey:aKey];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="二、AOP编程库Aspects"><a href="#二、AOP编程库Aspects" class="headerlink" title="二、AOP编程库Aspects"></a>二、AOP编程库Aspects</h3><p>Aspects是iOS面向切面编程的一个代表，本质上也是对runtime在方法替换上的一个封装，包含了强大也简单易用的方法，可以再原方法的前后执行或者替换删除执行，并且提供了AspectInfo作为所有方法的参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_OPTIONS(NSUInteger, AspectOptions) &#123;</span><br><span class="line">    AspectPositionAfter   = 0,            /// Called after the original implementation (default)</span><br><span class="line">    AspectPositionInstead = 1,            /// Will replace the original implementation.</span><br><span class="line">    AspectPositionBefore  = 2,            /// Called before the original implementation.</span><br><span class="line">    </span><br><span class="line">    AspectOptionAutomaticRemoval = 1 &lt;&lt; 3 /// Will remove the hook after the first execution.</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@protocol AspectInfo &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">/// The instance that is currently hooked.</span><br><span class="line">- (id)instance;</span><br><span class="line"></span><br><span class="line">/// The original invocation of the hooked method.</span><br><span class="line">- (NSInvocation *)originalInvocation;</span><br><span class="line"></span><br><span class="line">/// All method arguments, boxed. This is lazily evaluated.</span><br><span class="line">- (NSArray *)arguments;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface NSObject (Aspects)</span><br><span class="line"></span><br><span class="line">+ (id&lt;AspectToken&gt;)aspect_hookSelector:(SEL)selector</span><br><span class="line">                      withOptions:(AspectOptions)options</span><br><span class="line">                       usingBlock:(id)block</span><br><span class="line">                            error:(NSError **)error;</span><br><span class="line"></span><br><span class="line">/// Adds a block of code before/instead/after the current `selector` for a specific instance.</span><br><span class="line">- (id&lt;AspectToken&gt;)aspect_hookSelector:(SEL)selector</span><br><span class="line">                      withOptions:(AspectOptions)options</span><br><span class="line">                       usingBlock:(id)block</span><br><span class="line">                            error:(NSError **)error;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>我们从他的具体实现上可以看到，本质的也是利用了runtime的methodReplace</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">static void aspect_prepareClassAndHookSelector(NSObject *self, SEL selector, NSError **error) &#123;</span><br><span class="line">    NSCParameterAssert(selector);</span><br><span class="line">    Class klass = aspect_hookClass(self, error);</span><br><span class="line">    Method targetMethod = class_getInstanceMethod(klass, selector);</span><br><span class="line">    IMP targetMethodIMP = method_getImplementation(targetMethod);</span><br><span class="line">    if (!aspect_isMsgForwardIMP(targetMethodIMP)) &#123;</span><br><span class="line">        // Make a method alias for the existing method implementation, it not already copied.</span><br><span class="line">        const char *typeEncoding = method_getTypeEncoding(targetMethod);</span><br><span class="line">        SEL aliasSelector = aspect_aliasForSelector(selector);</span><br><span class="line">        if (![klass instancesRespondToSelector:aliasSelector]) &#123;</span><br><span class="line">            __unused BOOL addedAlias = class_addMethod(klass, aliasSelector, method_getImplementation(targetMethod), typeEncoding);</span><br><span class="line">            NSCAssert(addedAlias, @&quot;Original implementation for %@ is already copied to %@ on %@&quot;, NSStringFromSelector(selector), NSStringFromSelector(aliasSelector), klass);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // We use forwardInvocation to hook in.</span><br><span class="line">        class_replaceMethod(klass, selector, aspect_getMsgForwardIMP(self, selector), typeEncoding);</span><br><span class="line">        AspectLog(@&quot;Aspects: Installed hook for -[%@ %@].&quot;, klass, NSStringFromSelector(selector));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在AspectOptions执行方式上的实现，是通过数组进行保存，并放在替换方法的前后invoke执行的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// Before hooks.</span><br><span class="line">aspect_invoke(classContainer.beforeAspects, info);</span><br><span class="line">aspect_invoke(objectContainer.beforeAspects, info);</span><br><span class="line"></span><br><span class="line">// Instead hooks.</span><br><span class="line">BOOL respondsToAlias = YES;</span><br><span class="line">if (objectContainer.insteadAspects.count || classContainer.insteadAspects.count) &#123;</span><br><span class="line">    aspect_invoke(classContainer.insteadAspects, info);</span><br><span class="line">    aspect_invoke(objectContainer.insteadAspects, info);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    Class klass = object_getClass(invocation.target);</span><br><span class="line">    do &#123;</span><br><span class="line">        if ((respondsToAlias = [klass instancesRespondToSelector:aliasSelector])) &#123;</span><br><span class="line">            [invocation invoke];</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;while (!respondsToAlias &amp;&amp; (klass = class_getSuperclass(klass)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// After hooks.</span><br><span class="line">aspect_invoke(classContainer.afterAspects, info);</span><br><span class="line">aspect_invoke(objectContainer.afterAspects, info);</span><br></pre></td></tr></table></figure>
<h3 id="三、小结"><a href="#三、小结" class="headerlink" title="三、小结"></a>三、小结</h3><p>AOP编程给开发者在一些公共方法的解耦和实现带来一些新的思路，提高的编程效率和优化了工程结构，除了Aspects，类似的库还有JRSwizzle和RSSwizzle。</p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS热补丁方案]]></title>
      <url>/2016/09/11/iOS%E7%83%AD%E8%A1%A5%E4%B8%81%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h1 id="TTSparkRescue"><a href="#TTSparkRescue" class="headerlink" title="TTSparkRescue"></a>TTSparkRescue</h1><blockquote>
<p>备注：2017年4月开始出现使用热修复审核不通过的情况，经过混淆的方式后，绕过了苹果的检测，但是到5月初的时候，苹果全方面严打IOS热修复策略，各方APP包括头条在内的方案被迫下架。</p>
</blockquote>
<h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h1><p>TTSparkRescue是头条公司层面的通用的热修复库，同时提供给其他产品线使用。设计包括如下：</p>
<ul>
<li>启动崩溃计数修改为3秒后清除</li>
<li>启动初始化的预清理</li>
<li>启动崩溃本地有缓存预先执行</li>
<li>启动崩溃第二次，启动上报逻辑和预处理</li>
<li>启动崩溃第三次，开始启动修复逻辑</li>
<li>启动后修复</li>
<li>补丁下发更新机制</li>
<li>客户端本地处理下发的patch错误</li>
<li>下发JS空白</li>
<li>下发前，本地预先运行，验证JS脚本</li>
<li>本地模拟crash</li>
<li>管理的系统版本号粒度更精细</li>
<li>增加端监控，传出参数，由TTMonitor在外部配合调到 </li>
</ul>
<h1 id="2-快速集成"><a href="#2-快速集成" class="headerlink" title="2. 快速集成"></a>2. 快速集成</h1><h2 id="2-1-Podfile引用"><a href="#2-1-Podfile引用" class="headerlink" title="2.1 Podfile引用"></a>2.1 Podfile引用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source &apos;头条内部的git地址&apos;</span><br><span class="line"></span><br><span class="line">pod &apos;TTSparkRescue&apos;, &apos;2.3&apos;</span><br></pre></td></tr></table></figure>
<h2 id="2-2-代码块替换"><a href="#2-2-代码块替换" class="headerlink" title="2.2 代码块替换"></a>2.2 代码块替换</h2><blockquote>
<p>方法A: </p>
</blockquote>
<p>APP原本的didFinishLaunchingWithOptions的全部逻辑didFinishLaunchingWithOptions</p>
<blockquote>
<p>方法B :</p>
</blockquote>
<p>新建并复制，参数和函数体与方法A保持一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application</span><br><span class="line"> normalLaunchProcessWithOptions:(NSDictionary *)launchOptions</span><br></pre></td></tr></table></figure>
<p>使用TTJSPatch结构替换方法A，下面部分可以直接复制即可用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    __weak typeof(self) wself = self;</span><br><span class="line">    </span><br><span class="line">#if DEBUG</span><br><span class="line">    //默认注释关闭</span><br><span class="line">    //    [[TTSparkRescue shareInstance] setTestPatch:YES simulationCrash:YES];</span><br><span class="line">#endif</span><br><span class="line">    </span><br><span class="line">    //内部监控上报</span><br><span class="line">    [[TTSparkRescue shareInstance] setReportBlock:^(NSString *key, NSDictionary *info) &#123;</span><br><span class="line">        </span><br><span class="line">        //crash的预处理逻辑</span><br><span class="line">        if ([key isEqualToString:TTJSPatchLaunchCrash]) &#123;</span><br><span class="line">            //优先清理coredata缓存</span><br><span class="line">            //解决可能造成的crash</span><br><span class="line">            //连续崩溃第四次才启用安全模式</span><br><span class="line">        &#125;</span><br><span class="line">        [[TTMonitor shareManager] trackService:key status:1 extra:info];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    //运行错误处理，内部已加监控, type == 1 for JS, type == 2 for OC</span><br><span class="line">    [[TTSparkRescue shareInstance] setJSCrashHanlder:^(NSInteger type, NSString *msg) &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    //CompletionBlock:头条正常启动逻辑</span><br><span class="line">    [[TTSparkRescue shareInstance] setBoolCompletionBlock:^BOOL&#123;</span><br><span class="line">        </span><br><span class="line">#if DEBUG</span><br><span class="line">        //本地测试的时候模拟crash，不必注释，由前面的开关控制即可</span><br><span class="line">        [[TTSparkRescue shareInstance] simulationLauchCrash];</span><br><span class="line">        [[TTSparkRescue shareInstance] simulationLauchDelayCrash];</span><br><span class="line">        [[TTSparkRescue shareInstance] simulationActiveCrash];</span><br><span class="line">        </span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">        return [wself application:application normalLaunchProcessWithOptions:launchOptions];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    //启动执行逻辑，完成后调用CompletionBlock</span><br><span class="line">    return [[TTSparkRescue shareInstance] launchContinuousCrashProcess];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-功能设计"><a href="#3-功能设计" class="headerlink" title="3. 功能设计"></a>3. 功能设计</h1><h2 id="3-1、说明："><a href="#3-1、说明：" class="headerlink" title="3.1、说明："></a>3.1、说明：</h2><h4 id="1、启动崩溃计数修改为12秒后清除"><a href="#1、启动崩溃计数修改为12秒后清除" class="headerlink" title="1、启动崩溃计数修改为12秒后清除"></a>1、启动崩溃计数修改为12秒后清除</h4><blockquote>
<p>如果启动过程中，出现延迟操作，操作时间在原先的5秒之外，那么这次操作如果出现崩溃将无法被记录下。也就无法再启动中修复。<br>     将清除时间调大，设置为一个网络请求的返回时间，覆盖了延迟造作造成的crash。</p>
</blockquote>
<h4 id="2、启动初始化的预清理"><a href="#2、启动初始化的预清理" class="headerlink" title="2、启动初始化的预清理"></a>2、启动初始化的预清理</h4><blockquote>
<p>当我们判断当前版本号发生变化时，直接清除本地的patch文件，避免升级覆盖安装后，还持有原先逻辑或者错误。</p>
</blockquote>
<h4 id="3、启动崩溃本地有缓存预先执行"><a href="#3、启动崩溃本地有缓存预先执行" class="headerlink" title="3、启动崩溃本地有缓存预先执行"></a>3、启动崩溃本地有缓存预先执行</h4><blockquote>
<p>因为是修复崩溃的逻辑，之前需要达到崩溃条件后才开始请求下发，原本就体验差了，如果再遇上网络缓慢的时候，启动会很慢，<br>  体验更差。并且每次都会崩溃后重新启动。此次修改后，出现一次之后同步请求返回patch,正常启动，下次进入，判断有缓存就直接执行，<br>  执行异步的请求更新。</p>
</blockquote>
<h4 id="4、启动崩溃第二次，启动上报逻辑和预处理"><a href="#4、启动崩溃第二次，启动上报逻辑和预处理" class="headerlink" title="4、启动崩溃第二次，启动上报逻辑和预处理"></a>4、启动崩溃第二次，启动上报逻辑和预处理</h4><blockquote>
<p>APPDelegate 上报和预处理逻辑 ReportBlock，当出现第二次崩溃的时候，可以删除本地的一些可能会导致crash的东西，<br>比如本地的数据库可以先清理掉，等等。然后统计上报。</p>
</blockquote>
<h4 id="5、启动崩溃第三次，开始启动修复逻辑"><a href="#5、启动崩溃第三次，开始启动修复逻辑" class="headerlink" title="5、启动崩溃第三次，开始启动修复逻辑"></a>5、启动崩溃第三次，开始启动修复逻辑</h4><blockquote>
<p>如果本地有缓存，则网络异步更新，因为后面的逻辑保证本地已有的缓存patchJS执行没错，所以可以先执行。<br>如果本地无缓存，则网络同步请求，返回补丁，运行成功后再启动APP正常流程。<br>不会再出现再次崩溃3此的情况。<br>只要出现3次崩溃，忽略本地缓存，直接请求更新。</p>
</blockquote>
<h4 id="6、启动后修复"><a href="#6、启动后修复" class="headerlink" title="6、启动后修复"></a>6、启动后修复</h4><blockquote>
<p>启动中的时候，判断本地有缓存文件，预先执行，之后，每次active就会请求更新文件</p>
</blockquote>
<h4 id="7、补丁下发更新机制"><a href="#7、补丁下发更新机制" class="headerlink" title="7、补丁下发更新机制"></a>7、补丁下发更新机制</h4><blockquote>
<p>本地无缓存，直接存储，有缓存，判断版本号。<br> 我们在后台下发补丁的时候，目前依旧保持，升级版本号，全量覆盖。也就是说，app每个版本，在客户端里依旧保持唯一一个补丁，启动前和启动后各自有对应的唯一一个。<br>此处，服务端也有策略，我们上传的参数包含当前，版本，如果服务端有更高版本，就会升级。</p>
</blockquote>
<h4 id="8、客户端本地处理下发的patch错误"><a href="#8、客户端本地处理下发的patch错误" class="headerlink" title="8、客户端本地处理下发的patch错误"></a>8、客户端本地处理下发的patch错误</h4><blockquote>
<ul>
<li>(void)handleException:(void (^)(NSInteger crashType,NSString *msg))exceptionBlock;<br>crashType == 1 的时候是 JS环境 运行的Crash<br>crashType == 2 的时候是  OC环境 运行的Crash<br>当我们下发的脚本有问题的时候，客户端本地直接删除全部补丁文件，包括启动前和启动后。<br>APPDelegate 中 JSCrashHanlder 被调用，可以填写上报逻辑和反馈运行的错误原因。<br>在此条件下，当用户退到后台之后，自动崩溃，重新打开客户端没有patch，这个留出来及时下发修正后Patch的时机。</li>
</ul>
</blockquote>
<h4 id="9、下发JS空白"><a href="#9、下发JS空白" class="headerlink" title="9、下发JS空白"></a>9、下发JS空白</h4><blockquote>
<p>直接删除本地补丁文件</p>
</blockquote>
<h4 id="10、下发前，本地预先运行，验证JS脚本"><a href="#10、下发前，本地预先运行，验证JS脚本" class="headerlink" title="10、下发前，本地预先运行，验证JS脚本"></a>10、下发前，本地预先运行，验证JS脚本</h4><blockquote>
<p>直接将要在后台要下发的JS代码，非BASE64编码，贴到工程里的test.js 文件里，此处文件名固定。<br>并在APPDelegate 打开测试运行的开关，然后直接运行即可，测试完毕，防止错误，必须关闭。</p>
</blockquote>
<h4 id="11、本地模拟crash"><a href="#11、本地模拟crash" class="headerlink" title="11、本地模拟crash"></a>11、本地模拟crash</h4><blockquote>
<p>增加错误的OC代码导致crash，用于模拟各种情况，包括启动中，启动中延时，启动后。<br>并设置了开关，默认都是关闭的，随测试方法的开关一起，正式提交时，必须关闭。</p>
</blockquote>
<h4 id="2、管理的系统版本号粒度更精细"><a href="#2、管理的系统版本号粒度更精细" class="headerlink" title="2、管理的系统版本号粒度更精细"></a>2、管理的系统版本号粒度更精细</h4><blockquote>
<p>整数示例：8，9，10   —-   后台命中：8.x,9.x,10.x   IOS系统版本<br>精确示例：9.1.2 — 后台命中：9.1.2 IOS系统版本</p>
</blockquote>
<h4 id="13、下发补丁一并写注释"><a href="#13、下发补丁一并写注释" class="headerlink" title="13、下发补丁一并写注释"></a>13、下发补丁一并写注释</h4><blockquote>
<p>每次下发补丁，需要填写说明，包括：【事故原因】【下发人】【下发日期】</p>
</blockquote>
<h4 id="14、启动后的下发调用改为通知"><a href="#14、启动后的下发调用改为通知" class="headerlink" title="14、启动后的下发调用改为通知"></a>14、启动后的下发调用改为通知</h4><blockquote>
<p>不需要在applicationDidBecomeActive中再显示调用原来的makePatchRequestAfterLaunch，manager内部监听通知即可。</p>
</blockquote>
<h4 id="15、增加端监控，传出参数，由TTMonitor在外部配合调到"><a href="#15、增加端监控，传出参数，由TTMonitor在外部配合调到" class="headerlink" title="15、增加端监控，传出参数，由TTMonitor在外部配合调到"></a>15、增加端监控，传出参数，由TTMonitor在外部配合调到</h4><blockquote>
<p>监控请求成功和失败、下发更新、版本升级删除的等等用于统计patch的使用情况，后期有利于生成分布和图形。<br>TTSparkRescueLaunchCrash<br>APPDelegate 上报和预处理逻辑 ReportBlock，当出现第二次崩溃的时候，可以删除本地的一些可能会导致crash的东西，<br>比如本地的数据库可以先清理掉，等等。然后统计上报。<br>TTSparkRescueServerCloseCrash<br>服务器端下发关闭运行JSPatch的统计<br>TTSparkRescueDeleteFile<br>删除清空本地文件的统计，下发空白、错误、运行错误、升级都会删除之前的缓存文件，用action字段区分。<br>TTSparkRescueError<br>内部运行的错误报告，文件请求失败和运行失败等。<br>TTSparkRescueUpdateFile<br>统计更新成功的事件</p>
</blockquote>
<h2 id="3-2、测试Case"><a href="#3-2、测试Case" class="headerlink" title="3.2、测试Case"></a>3.2、测试Case</h2><p>1、启动中，有崩溃，包括延时崩溃，无缓存文件。正常同步请求返回，APP启动完成。</p>
<p>2、启动中，有崩溃，包括延时崩溃，有缓存文件。<br>直接读取本地文件，APP启动完成。</p>
<p>3、启动中，有崩溃，包括延时崩溃，下发JS语法的patch文件。<br>无法正常启动，连续crash3次后走同步请求。</p>
<p>4、启动后，有崩溃，无缓存文件。正常异步请求返回，APP正常运行。</p>
<p>5、启动后，有崩溃，有缓存文件。直接读取本地文件，正常同步请求返回更新文件，APP正常运行。</p>
<p>6、启动后，下发错误JS语法的patch文件。客户端判断文件出错，删除全部补丁缓存文件，清零，开始重新请求更新。</p>
<p>7、以上case通过线上下发运行一次，再本地测试开关运行一次。testPatch.js 在主工程被正确添加后，都可以正确执行。</p>
<p>8、升级版本号，覆盖安装。删除本地原有的补丁文件，清零。</p>
<p>9、监控点事件上报。正常对外输出事件和外带信息到APPDelegate中</p>
<h1 id="4-使用说明"><a href="#4-使用说明" class="headerlink" title="4. 使用说明"></a>4. 使用说明</h1><h2 id="4-1-补丁后台管理"><a href="#4-1-补丁后台管理" class="headerlink" title="4.1 补丁后台管理"></a>4.1 补丁后台管理</h2><p>客户端的修复需要后端的支持，提供接口和后端管理平台，用于托管修复文件，控制版本和保证传输安全。客户端根据反馈的崩溃信息(版本、名称、设备、用户)，针对某一批用户或者某一个版本号，在后台进行选择对应的版本JS文件，进行下发即可。</p>
<h3 id="4-1-1-热修复接口定义"><a href="#4-1-1-热修复接口定义" class="headerlink" title="4.1.1 热修复接口定义"></a>4.1.1 热修复接口定义</h3><p>应用名称和应用ID作用一致，为了兼容老的已经发出去的版本，我们保留app_name，之后的都是用app_id，两者等效力，<br>参数命中其中一个，至少有一个就行，就可以返回值。  </p>
<table>
<thead>
<tr>
<th>参数</th>
<th>参数ID</th>
<th>举例说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>应用版本号</td>
<td>app_version</td>
<td>5.6.0</td>
</tr>
<tr>
<td>应用名称</td>
<td>app_name</td>
<td>今日头条</td>
</tr>
<tr>
<td>应用ID</td>
<td>app_id</td>
<td>com.iphone.text</td>
</tr>
<tr>
<td>启动前后</td>
<td>app_launch</td>
<td>0前1后</td>
</tr>
<tr>
<td>设备ID</td>
<td>device_id</td>
<td>用户的手机设备ID</td>
</tr>
<tr>
<td>编号</td>
<td>无，客户端不作请求参数</td>
<td>服务端后台的文件号，随意定，不重复即可</td>
</tr>
<tr>
<td>百分比</td>
<td>无，客户端不作请求参数</td>
<td>服务端后台按量下发补丁</td>
</tr>
<tr>
<td>ON/OFF</td>
<td>无，客户端不作请求参数</td>
<td>服务端后台控制补丁开关</td>
</tr>
<tr>
<td>逗号分隔</td>
<td>无，客户端不作请求参数</td>
<td>服务端后台下发补丁，支持不同的版本，逗号分隔</td>
</tr>
<tr>
<td>应用版本号扩展</td>
<td>无，客户端不作请求参数</td>
<td>服务端后台下发的补丁，补丁本身的版本号，格式约定：应用版本号整数数字.补丁版本号整数数字，比如：570.1，591.21</td>
</tr>
</tbody>
</table>
<h3 id="4-1-2-数据格式"><a href="#4-1-2-数据格式" class="headerlink" title="4.1.2 数据格式"></a>4.1.2 数据格式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">status:0, </span><br><span class="line">message:&quot;&quot;,</span><br><span class="line">data:&#123;</span><br><span class="line">     js_crash:0,  //修复代码本身出错的时候打开</span><br><span class="line">     js_version:560.4,         //5.6.0版本的第四个JS版本</span><br><span class="line">     js_value: &quot; sfkdsfnldjgdfnkgndkfngdsfgmdfngfjshdbfkhrwnf&quot;   //js的BASE64编码值，客户端直接解码运行</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-2-客户端运行："><a href="#4-2-客户端运行：" class="headerlink" title="4.2 客户端运行："></a>4.2 客户端运行：</h2><p>补丁分为启动前和启动后，和前面快速集成代码块一样，只需要这里，就已经是全部，启动前后的划分在内部执行，通知监听，不需要手动再调用。</p>
<h2 id="4-3、具体案例："><a href="#4-3、具体案例：" class="headerlink" title="4.3、具体案例："></a>4.3、具体案例：</h2><p>案例：5.7.0版本上bug修复</p>
<p>当我们需要完全替换方法的时候，我们需要注意替换原则，就是尽量使用原生的Native方法，这样JSpatch在转化的过程中可以遵循原生方法规则，生成对应代码，在解析的时候可以还原。<br>比如：</p>
<h3 id="4-3-1-使用注意"><a href="#4-3-1-使用注意" class="headerlink" title="4.3.1 使用注意"></a>4.3.1 使用注意</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static inline void setAutoresizingMaskFlexibleWidthAndHeight(UIView *view)&#123;</span><br><span class="line">    view.autoresizingMask = UIViewAutoresizingFlexibleWidth|UIViewAutoresizingFlexibleHeight;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>setAutoresizingMaskFlexibleWidthAndHeight(self.footerView);<br>我们在写的时候得写成：<br>self.footerView.autoresizingMask = 2|16;<br>系统自定义的常量，比如：UIViewAutoresizingFlexibleWidth,在JSPtatch中将被转化为同名的变量，然而这个变量，却在JS环境中没有定义，从而会报错。<br>所以我们直接使用对应的常量数字 2.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[self.footerView footerScrollView] tt_addDelegate:self asMainDelegate:NO];</span><br></pre></td></tr></table></figure>
<p>用于JSPatch自定义的语法为使用下划线区分方法名称，所以当转化为的JS再次被转回来OC方法的时候，会出现[[self.footerView footerScrollView] tt:addDelegate:self asMainDelegate:NO];<br>这样就崩溃了。</p>
<h3 id="4-3-2-示例"><a href="#4-3-2-示例" class="headerlink" title="4.3.2  示例"></a>4.3.2  示例</h3><p>Native源代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@implementation TTDetailWebviewContainer</span><br><span class="line">- (void)addFooterView:(UIView&lt;TTDetailFooterViewProtocol&gt; *)footerView</span><br><span class="line">  detailFooterAddType:(TTDetailNatantStyle)natantStyle</span><br><span class="line">&#123;</span><br><span class="line">    self.natantStyle = natantStyle;</span><br><span class="line">    self.footerView = footerView;</span><br><span class="line">    [self.footerView addObserver:self forKeyPath:@&quot;footerScrollView&quot; options:NSKeyValueObservingOptionOld | NSKeyValueObservingOptionNew context:nil];</span><br><span class="line">    [[self.footerView footerScrollView] tt_addDelegate:self asMainDelegate:NO];</span><br><span class="line">    self.footScrollView = self.footerView.footerScrollView;</span><br><span class="line">    self.footerView.frame = self.bounds;</span><br><span class="line">    //footerScrollView被赋值后，刷新scrollEnable和scrollToTop的状态；</span><br><span class="line">    self.footerStatus = self.footerStatus;</span><br><span class="line">    setAutoresizingMaskFlexibleWidthAndHeight(self.footerView);</span><br><span class="line">    if ([self shouldOpenInsertionOptimization]) &#123;</span><br><span class="line">        [self addFooterView];</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">      [self addFooterView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>目标JS代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">defineClass(&apos;TTDetailWebviewContainer&apos;, &#123;</span><br><span class="line">addFooterView_detailFooterAddType: function(footerView, natantStyle) &#123;</span><br><span class="line">self.setNatantStyle(natantStyle);</span><br><span class="line">self.setFooterView(footerView);</span><br><span class="line">self.footerView().addObserver_forKeyPath_options_context(self, &quot;footerScrollView&quot;, 1|2, null);</span><br><span class="line">self.footerView().footerScrollView().tt__addDelegate_asMainDelegate(self, false);</span><br><span class="line">self.setFootScrollView(self.footerView().footerScrollView());</span><br><span class="line">self.footerView().setFrame(self.bounds());</span><br><span class="line">self.setFooterStatus(self.footerStatus());</span><br><span class="line">self.footerView().setAutoresizingMask(2 | 16);</span><br><span class="line">if (self.shouldOpenInsertionOptimization()) &#123;</span><br><span class="line">self.addFooterView();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">self.addFooterView();</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="5-原理介绍"><a href="#5-原理介绍" class="headerlink" title="5. 原理介绍"></a>5. 原理介绍</h1><h2 id="5-1-三方库"><a href="#5-1-三方库" class="headerlink" title="5.1 三方库"></a>5.1 三方库</h2><p>JSPatch(Github链接)诞生于2015年5月，最初是腾讯广研高级iOS开发@bang的个人项目。在Github.com上开源后获得了几千个star和几百个fork，广受关注，目前已被应用在大量腾讯/阿里/百度的App中。只需要在项目里引入极小的引擎文件，就可以使用 JavaScript 调用任何 Objective-C 的原生接口，替换任意 Objective-C 原生方法。所以我们通过下发 JS 脚本替换原生 Objective-C 代码，就可以实时修复线上 bug。针对头条客户端用于解决客户端发布后的崩溃修复问题，尤其是解决客户端的启动崩溃问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line">#import &lt;objc/message.h&gt;</span><br></pre></td></tr></table></figure>
<h2 id="5-2-TTSparkRescue"><a href="#5-2-TTSparkRescue" class="headerlink" title="5.2 TTSparkRescue"></a>5.2 TTSparkRescue</h2><h3 id="5-2-1-修复类型"><a href="#5-2-1-修复类型" class="headerlink" title="5.2.1 修复类型"></a>5.2.1 修复类型</h3><h4 id="5-2-1-1-启动进行中"><a href="#5-2-1-1-启动进行中" class="headerlink" title="5.2.1.1 启动进行中"></a>5.2.1.1 启动进行中</h4><p>当发生启动崩溃的时候，通过同步的网络请求，下发JS脚本执行修复。下发的条件由本地的崩溃计数决定，应用每次启动都会在本地增加一次崩溃计数，并在3秒之后将计数清理，如果3秒内崩溃，则判定为一次真实的崩溃。当崩溃次数达到设置的条件的时候，比如连续崩溃3次，客户端就开始执行修复的逻辑过程，向后端发起对此接口的同步请求，由接口信息告知是否需要使用JS修复，是否需要更新JS文件，文件版本号以及JS文件内容的加密值。请求返回后，由客户端本地判断更新文件，下载，并执行。如果本地之前没有修复的JS 文件，默认需要请求更新。更新文件成功后，对应更新本地的文件版本号和MD5值。</p>
<p>同步请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_t semaphore = dispatch_semaphore_create(0);</span><br><span class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;queue&quot;, NULL);</span><br><span class="line">dispatch_async(queue, ^(void) &#123;</span><br><span class="line">    </span><br><span class="line">    HandlerBlock semaphoreBlock = ^(TTSparkRescueCrashType type,NSString *msg)&#123;</span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    [self getLaunchRequestBlock:semaphoreBlock];</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br></pre></td></tr></table></figure>
<p>请求返回保存本地</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)updateLaunchLocalJS:(NSString *)launchJS</span><br><span class="line">                versionCode:(NSNumber *)versionCode</span><br></pre></td></tr></table></figure>
<p>执行本地JS代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (void)exvalueBase64Script:(NSString *)base64Script;</span><br><span class="line">- (void)exvalueRescueScript:(NSString *)jsScript;</span><br></pre></td></tr></table></figure>
<p>监听是否有执行错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setJSCrashHanlder:(HandlerBlock)handlerBlock;</span><br></pre></td></tr></table></figure>
<h4 id="5-2-1-2-启动完成后，使用中"><a href="#5-2-1-2-启动完成后，使用中" class="headerlink" title="5.2.1.2 启动完成后，使用中"></a>5.2.1.2 启动完成后，使用中</h4><p>当到达启动崩溃条件的时候，我们直接执行启动热修复逻辑。启动的时间稍微加长，遇见网络慢的情况用户需要等待的时间就会更久，当然为了避免崩溃这都是必要的。还有，另外的情况是，当用户使用我们的应用的时候，在一个层级比较深的地方操作并出现崩溃，当用户用到这里之前才会崩溃都不会有，这种情况我们依然需要进行热修复。流程类似，为异步。</p>
<h3 id="5-2-2-补丁模拟自测"><a href="#5-2-2-补丁模拟自测" class="headerlink" title="5.2.2 补丁模拟自测"></a>5.2.2 补丁模拟自测</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  测试环节，用一个方法控制开关</span><br><span class="line"> *  执行测试的testPatch.js,固定命名，测试完毕提交的时候必须关闭</span><br><span class="line"> *  模拟启动中崩溃,立刻</span><br><span class="line"> *  模拟启动中延迟崩溃，延迟启动中网络请求返回的默认时间10s</span><br><span class="line"> *  模拟激活后崩溃,60s</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">- (void)setTestPatch:(BOOL)testJsOn simulationCrash:(BOOL)crashOn;</span><br><span class="line">- (void)simulationLauchCrash;</span><br><span class="line">- (void)simulationLauchDelayCrash;</span><br><span class="line">- (void)simulationActiveCrash;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-2-混淆方式，绕过审核"><a href="#5-2-2-混淆方式，绕过审核" class="headerlink" title="5.2.2 混淆方式，绕过审核"></a>5.2.2 混淆方式，绕过审核</h3><h4 id="5-2-2-1-原理："><a href="#5-2-2-1-原理：" class="headerlink" title="5.2.2.1 原理："></a>5.2.2.1 原理：</h4><p>我们大致判断，苹果审核部检测应用是否使用JSPatch是通过运行时方法名检测。所以通过宏定义替换的方式，我们将与”JSPatch“有关的字段都用混淆的字符串进行宏定义替换，运行时检测到的都是混淆的不可读名称。</p>
<h4 id="5-2-2-2-脚本替换"><a href="#5-2-2-2-脚本替换" class="headerlink" title="5.2.2.2 脚本替换"></a>5.2.2.2 脚本替换</h4><p>shell脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/usr/bin/env bash  </span><br><span class="line"> </span><br><span class="line">STRING_SYMBOL_FILE=&quot;func.list&quot;  </span><br><span class="line">HEAD_FILE=&quot;./confuseMacro.h&quot;  </span><br><span class="line">export LC_CTYPE=C  </span><br><span class="line"></span><br><span class="line">ramdomString()  </span><br><span class="line">&#123;  </span><br><span class="line">    openssl rand -base64 64 | tr -cd &apos;a-zA-Z&apos; |head -c 16  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">rm -f $HEAD_FILE  </span><br><span class="line"></span><br><span class="line">touch $HEAD_FILE</span><br><span class="line">echo &apos;#ifndef Demo_codeObfuscation_h  </span><br><span class="line">#define Demo_codeObfuscation_h&apos; &gt;&gt; $HEAD_FILE  </span><br><span class="line">echo &quot;//confuse string at `date`&quot; &gt;&gt; $HEAD_FILE  </span><br><span class="line">cat &quot;$STRING_SYMBOL_FILE&quot; | while read -ra line; do  </span><br><span class="line">    if [[ ! -z &quot;$line&quot; ]]; then  </span><br><span class="line">        ramdom=`ramdomString`  </span><br><span class="line">        echo $line $ramdom  </span><br><span class="line">        echo &quot;#define $line $ramdom&quot; &gt;&gt; $HEAD_FILE  </span><br><span class="line">    fi  </span><br><span class="line">done  </span><br><span class="line">echo &quot;#endif&quot; &gt;&gt; $HEAD_FILE</span><br></pre></td></tr></table></figure>
<p>宏定义替换结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#ifndef Demo_codeObfuscation_h  </span><br><span class="line">#define Demo_codeObfuscation_h</span><br><span class="line">//confuse string at 2017年 5月 9日 星期二 15时09分20秒 CST</span><br><span class="line">#define JPEngine zLuEDxRvmBuomcFI</span><br><span class="line">#define JPExtension IoAZxAmFBjgEOaIg</span><br><span class="line">#define JPBoxing wzZsoLGKuQUTRFsi</span><br><span class="line">#define startEngine PRqvWWtwFlXUqdBe</span><br><span class="line">#define evaluateScriptWithPath cNHrlJKiZyWXkfKo</span><br><span class="line">#define _evaluateScriptWithPath oDyiimPOHiIWBOEI</span><br><span class="line">#define addExtensions MbpkqoMunCfIBgxY</span><br><span class="line">#define defineStruct jIfCtJkMsIshJCvx</span><br><span class="line">#define formatPointerJSToOC IcHiIjXLjFucrQHR</span><br><span class="line">#define formatRetainedCFTypeOCToJS lyCjsaHwzQaYUiBE</span><br><span class="line">#define formatPointerOCToJS DdwjOGMUveuHjYQq</span><br><span class="line">#define formatJSToOC BBFoPIaVlHRWBNQx</span><br><span class="line">#define formatOCToJS PHwNpfqmydeeFhMY</span><br><span class="line">#define TTSparkRescue euibpyTZoKOvrKyO</span><br><span class="line">#define exvalueBase64Script fcXBLgUPqmsRqIWx</span><br><span class="line">#define _JSOverideMethods FBOBELKtnClIUhEa</span><br><span class="line">#define _TMPMemoryPool ysvnOHCwoCVvFwfY</span><br><span class="line">#define _propKeys cnyhVgwVNuEVAvEp</span><br><span class="line">#define _JSMethodSignatureCache inrkXDymTFAbwLRo</span><br><span class="line">#define _JSMethodSignatureLock LmXaTYYBizrQBKzn</span><br><span class="line">#define _JSMethodForwardCallLock YdmfSXxrtNuKsJkp</span><br><span class="line">#define _protocolTypeEncodeDict NxHWlKlDFjjgpzYV</span><br><span class="line">#define _pointersToRelease pybucmDygKyxFMvj</span><br><span class="line">#define jp_methodSignatureForSelector cyzfrUQNsmWrwIgU</span><br><span class="line">#define jp_fixMethodSignature vlSNUMpVTTXwTWJl</span><br><span class="line">#define JPForwardInvocation gflqBWbUOmJHNfcL</span><br><span class="line">#define JPExecuteORIGForwardInvocation itGMsXKksYYFyCPL</span><br><span class="line">#define _initJPOverideMethods hpoUXLPSkKsFbHRk</span><br><span class="line">#define overrideMethod KCgQjNlpCNXOixZS</span><br><span class="line">#define invokeVariableParameterMethod YITOuEIcAICefCkG</span><br><span class="line">#define convertJPSelectorString wwttXxSrZoFlmKML</span><br><span class="line">#define getJSFunctionInObjectHierachy JjRtFUqUREPdZAgY</span><br><span class="line">#define unboxOCObjectToJS MeVMxsEAmgCokbXc</span><br><span class="line">#define makePatchRequestAfterLaunch icreqUfezHNyjLdw</span><br><span class="line">#define setJSCrashHanlder hwsfKTIzZPvTEMmc</span><br><span class="line">#define getLaunchPatchVersionCode jqRICpprUZpVeKVy</span><br><span class="line">#define getActivePatchVersionCode zZIvunQsewkyABXu</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[移动端持久化存储方案]]></title>
      <url>/2016/08/03/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<h2 id="一、持久化方案："><a href="#一、持久化方案：" class="headerlink" title="一、持久化方案："></a>一、持久化方案：</h2><h3 id="1-1-NSUserDefault"><a href="#1-1-NSUserDefault" class="headerlink" title="1.1 NSUserDefault"></a>1.1 NSUserDefault</h3><p>通常用来存储用户偏好设置和应用配置信息，偶尔也会存放一些服务端版本标识数据，比如AB方案的判断开关。它适合小规模的数据，并且这些数据是不具备私密性的。常见的应用启动的时候是否需要展示引导页，就可以在这里设置一个是否已显示过的标志。它的背后实际上是一个特殊的 .plist 文件。</p>
<h3 id="1-2-Keychain"><a href="#1-2-Keychain" class="headerlink" title="1.2 Keychain"></a>1.2 Keychain</h3><p>Keychain 用来存储一些敏感的数据，比如密码，token 等。由于相关的 API 比较底层，我们可以使用对其做了封装的更友好的第三方库，比如 FXKeychain。</p>
<h3 id="1-3-文件"><a href="#1-3-文件" class="headerlink" title="1.3 文件"></a>1.3 文件</h3><p>文件存储一般用于存取媒体文件，包括视频音频图片等。比如iOS端上由于本地资源库没法直接读取视频数据本身，通常会转化到文件里面再进行上传处理。</p>
<h3 id="1-4-Plist"><a href="#1-4-Plist" class="headerlink" title="1.4 Plist"></a>1.4 Plist</h3><p>.plist 文件用来存储小规模的结构化的数据，用到的时候可以很方便的读取。常见的比如“省-城市”数据。但存储对象类型只能是这些：NSData，NSString，NSNumber，NSDate，NSArray，NSDictionary。<br>NSKeyedArchiver：由于 Plist 对存储对象类型的限制，如果想存更大量的，结构更复杂的对象，就可以用归档。只需要自定义的数据类型遵守 NSCoding 协议。</p>
<h3 id="1-5-数据库"><a href="#1-5-数据库" class="headerlink" title="1.5 数据库"></a>1.5 数据库</h3><p>上面提到的几种方案都是很轻量级的，一旦数据量更大，数据结构及关联关系更复杂，需要更频繁和方便的增删改查，我们就需要用上数据库来满足这些需求。本篇涉及的数据包括：GYDataCenter、Core Data、Realm。</p>
<h2 id="二-数据库对比"><a href="#二-数据库对比" class="headerlink" title="二. 数据库对比"></a>二. 数据库对比</h2><h3 id="2-1-CoreData"><a href="#2-1-CoreData" class="headerlink" title="2.1 CoreData"></a>2.1 CoreData</h3><p>Core Data 是 Apple的对象图管理和数据持久化框架。它的底层是通过 SQLite，XML 或二进制文件存储数据的。在数据存储之上，又提供了数据模型的解决方案。可以说它搭起了下层数据和上层对象之间的桥梁，将关系型数据转成对象，并通过对象图组织起来，进行自动管理。同时使得开发者可以面向对象编程。</p>
<p>虽然是苹果自带的数据库方案，但是它常常为人所诟病。不展开对它的使用，因为我们要采用的方案从来都不是它。说说那些列举不完的原因：</p>
<ul>
<li>学习成本高，要很久才能得心应手</li>
<li>对象Schema改变后，数据迁移比较棘手</li>
<li>对于一次大量更新删除等操作效率较低</li>
<li>对主键的支持要自己去维护 </li>
<li>占用内存会高</li>
<li>Context之间的关系和线程之间的处理感到很头痛</li>
<li>多个持久化文件很麻烦</li>
</ul>
<h3 id="2-2-RealM"><a href="#2-2-RealM" class="headerlink" title="2.2 RealM"></a>2.2 RealM</h3><p>在选择替换数据库方案的时候，网上看了很多对realm的赞扬，尤其是在和coredata的对比之下，没有哪里是不完爆的，各种好使各种快速。不过我们还是好好的来理一下他的优缺点。</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li>使用方便</li>
</ul>
<p>Realm并不是基于SQLite的对象关系映射数据库。它是使用自己的持久化引擎，为简单和速度而生。</p>
<ul>
<li>快</li>
</ul>
<p>零拷贝的设计使得它比其他数据库都更快。</p>
<ul>
<li>跨平台 </li>
<li>优秀的特性</li>
</ul>
<p>如加密，图形查询，轻松的迁移。Realm的API是一个非常适合打造高响应的应用程​​序，并且Realm为我们提供方便的组件。</p>
<p>###</p>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>关联关系弱</li>
</ul>
<p>对象跟对象之间的一对多关系和多对多关系，并不能映射，需要在双方里面都写上属性，此外还需要在设置的时候两边同时设置。查询时候也是 NSPredicate 也仅仅只支持一些一层的查询，没法做出带SUBQUERY的复杂查询出来。</p>
<ul>
<li>强制内省容错机制导致存储文件不断变大</li>
</ul>
<p>Realm本身感觉有一个数据容错机制。但是这个机制在数据库文件有错误的情况自己修复的时候，会无限增大。官方文档里面有说到会造成这种情形的原因，我在尽我所能的避免问题以后，存储文件还是会有可能不那么夸张的变大一些。</p>
<ul>
<li>没有细粒化通知</li>
</ul>
<p>在某个地方做出修改。 其他地方只知道Realm有修改，但是没法知道我是增加、修改还是删除了数据。不知道我更新的是那一条数据。</p>
<ul>
<li>增加包体积</li>
</ul>
<p>官方说会增加1MB左右的包大小，如果你是一个小体积应用，或者是一个几千万用户的主流应用。</p>
<ul>
<li>核心代码目前闭源</li>
</ul>
<h2 id="2-3-GYDataCenter"><a href="#2-3-GYDataCenter" class="headerlink" title="2.3 GYDataCenter"></a>2.3 GYDataCenter</h2><p>GYDataCenter 是一个 SQLite 数据库框架，提供了一套简单易用的面向对象的数据操作接口，同时保留了 SQL 查询的灵活性。GYDataCenter 简单易上手，相对于 CoreData，GYDataCenter 的学习成本更低。同时，根据自己的需求，开发者可以更方便地划分数据库，设计数据库表，数据库索引等。</p>
<p>GYDataCenter 具有以下特性：</p>
<ul>
<li>面向对象的数据操作接口</li>
<li>使用 SQLite 的 where 语句做为查询条件</li>
<li>自动创建及更新数据库表</li>
<li>高性能 cache 层</li>
<li>faulting 机制（类似 Core Data）</li>
<li>自动批量写入磁盘</li>
<li>使用 ANALYZE 优化查询</li>
</ul>
<h2 id="三、封装GYModelObject"><a href="#三、封装GYModelObject" class="headerlink" title="三、封装GYModelObject"></a>三、封装GYModelObject</h2><p>对比了上述三种数据库之后，决定放弃当前使用的coredata存储方式。另外两种在使用上各有优势，考虑到realm比较重，我们对数据库的要求不高，觉得采用比较轻量级的GYmodel尝试实现存储需求。</p>
<p>GYDataCenter的上手使用非常快，核心点在于继承GYModle然后与对应的数据库建立映射，并且不需要自己手动建立数据库的过程。GY基于FMDB做的封装。具体的使用这里就不展开叙述了，在具体的使用中为了更方便易用，我们讲一下对它的升级。首页我们自定一个Model,它继承自GYModelObject，叫做BaseEntity,以后其他业务使用需要存入数据库的数据，直接继承BaseEntity。</p>
<h3 id="3-1-字典模型转化"><a href="#3-1-字典模型转化" class="headerlink" title="3.1 字典模型转化"></a>3.1 字典模型转化</h3><p>GYModelObject继承自NSObject，拥有基础的读取、查询和保存到数据的接口。但是通常的应用中，原始的Json数据需要转化到模型上使用，参照JSModle的使用，<br>我们给BaseEntity新增两个方法。</p>
<ul>
<li><ul>
<li>(void)updateWithDictionary:(NSDictionary *)dictionary</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)updateWithDictionary:(NSDictionary *)dictionary &#123;</span><br><span class="line">    NSArray *persistentProperties = [[self class] persistentProperties];</span><br><span class="line">    NSDictionary *propertyTypes = [[self class] propertyTypes];</span><br><span class="line">    NSDictionary *keyMapping = [[self class] keyMapping];</span><br><span class="line"></span><br><span class="line">    for (NSString *modelKey in persistentProperties) &#123;</span><br><span class="line">        NSString *jsonKey = [keyMapping objectForKey:modelKey];</span><br><span class="line">        if (!jsonKey) &#123;</span><br><span class="line">            jsonKey = modelKey;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        id value = [dictionary objectForKey:jsonKey];</span><br><span class="line">        if (value &amp;&amp; value != [NSNull null]) &#123;</span><br><span class="line">            GYPropertyType propertyType = [[propertyTypes objectForKey:modelKey] unsignedIntegerValue];</span><br><span class="line">            if (propertyType == GYPropertyTypeRelationship) &#123;</span><br><span class="line">                NSAssert([value isKindOfClass:[NSDictionary class]], @&quot;&quot;);</span><br><span class="line">                Class propertyClass = [[[self class] propertyClasses] objectForKey:modelKey];</span><br><span class="line">                value = [dictionary ttentity_dictionaryValueForKey:jsonKey defalutValue:nil];</span><br><span class="line">                if (value) &#123;</span><br><span class="line">                    value = [propertyClass objectWithDictionary:value];</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    //value不合法，忽略</span><br><span class="line">                    NSAssert(NO, @&quot;wrong relation type&quot;);</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeInteger) &#123;</span><br><span class="line">                value = @([dictionary ttentity_longlongValueForKey:jsonKey defaultValue:0]);</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeFloat) &#123;</span><br><span class="line">                value = @([dictionary ttentity_doubleValueForKey:jsonKey defaultValue:0]);</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeString) &#123;</span><br><span class="line">                value = [dictionary ttentity_stringValueForKey:jsonKey defaultValue:nil];</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeBoolean) &#123;</span><br><span class="line">                value = @([dictionary ttentity_boolValueForKey:jsonKey defaultValue:NO]);</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeDate) &#123;</span><br><span class="line">                if (![value isKindOfClass:[NSDate class]]) &#123;</span><br><span class="line">                    NSAssert(NO, @&quot;wrong date type&quot;);</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeData) &#123;</span><br><span class="line">                if (![value isKindOfClass:[NSData class]]) &#123;</span><br><span class="line">                    NSAssert(NO, @&quot;wrong data type&quot;);</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (propertyType == GYPropertyTypeUndefined || propertyType == GYPropertyTypeTransformable) &#123;</span><br><span class="line">                //NSNumber, NSDictionary, NSArray会走这个分支</span><br><span class="line">                NSString *className = [GYReflection propertyTypeOfClass:[self class] propertyName:modelKey];</span><br><span class="line">                Class propertyClass = NSClassFromString(className);</span><br><span class="line">                if (propertyClass == nil || //取不到时也认为value合法，WenDaInviteData会出现这种情况</span><br><span class="line">                    [value isKindOfClass:propertyClass] ||</span><br><span class="line">                    [value isKindOfClass:[NSData class]]) &#123;</span><br><span class="line">                    // value合法</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                else if ([propertyClass isSubclassOfClass:[NSNumber class]] &amp;&amp; [value isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">                    value = @([(NSString *)value longLongValue]);</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    //类型不匹配，认为value不合法，忽略赋值</span><br><span class="line">                    LOGD(@&quot;setWrongTypeValueForKey %@ value %@&quot;, modelKey, value);</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @try &#123;</span><br><span class="line">                [self setValue:value forKey:modelKey];</span><br><span class="line">            &#125;</span><br><span class="line">            @catch (NSException *exception) &#123;</span><br><span class="line">                NSAssert(NO, @&quot;exception %@&quot;, exception);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><ul>
<li>(NSDictionary *)toDictionary</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (NSDictionary *)toDictionary &#123;</span><br><span class="line">    NSArray *persistentProperties = [[self class] persistentProperties];</span><br><span class="line">    NSDictionary *keyMapping = [[self class] keyMapping];</span><br><span class="line">    </span><br><span class="line">    NSMutableDictionary *dictionary = [NSMutableDictionary dictionaryWithCapacity:persistentProperties.count];</span><br><span class="line">    </span><br><span class="line">    for (NSString *modelKey in persistentProperties) &#123;</span><br><span class="line">        NSString *jsonKey = [keyMapping objectForKey:modelKey];</span><br><span class="line">        if (!jsonKey) &#123;</span><br><span class="line">            jsonKey = modelKey;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        id value = [self valueForKey:modelKey];</span><br><span class="line">        if (value) &#123;</span><br><span class="line">            if ([value isKindOfClass:[TTEntityBase class]]) &#123;</span><br><span class="line">                [dictionary setValue:[value toDictionary] forKey:jsonKey];</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                [dictionary setValue:value forKey:jsonKey];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return dictionary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-查询"><a href="#3-2-查询" class="headerlink" title="3.2 查询"></a>3.2 查询</h3><ul>
<li>(NSArray <em>)objectsWithQuery:(NSDictionary </em>)query<pre><code>orderBy:(NSString *)orderKey
 offset:(NSInteger)offset
  limit:(NSInteger)limit
</code></pre></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">+ (NSArray *)objectsWithQuery:(NSDictionary *)query orderBy:(NSString *)orderKey offset:(NSInteger)offset limit:(NSInteger)limit &#123;</span><br><span class="line">    NSMutableString *sql = [[NSMutableString alloc] init];</span><br><span class="line">    NSMutableArray *arguments = [[NSMutableArray alloc] init];</span><br><span class="line">    </span><br><span class="line">    NSArray *allKeys = query.allKeys;</span><br><span class="line">    NSUInteger count = [allKeys count];</span><br><span class="line">    </span><br><span class="line">    for (NSUInteger i = 0; i &lt; count; ++i) &#123;</span><br><span class="line">        NSString *key = [allKeys objectAtIndex:i];</span><br><span class="line">        if (i == 0) &#123;</span><br><span class="line">            [sql appendFormat:@&quot;WHERE %@ = ?&quot;, key];</span><br><span class="line">        &#125;</span><br><span class="line">        else &#123;</span><br><span class="line">            [sql appendFormat:@&quot; AND %@ = ?&quot;, key];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [arguments addObject:query[key]];</span><br><span class="line">        //NSLog(@&quot;%@=%@&quot;, key, query[key]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (orderKey.length &gt; 0) &#123;</span><br><span class="line">        [sql appendFormat:@&quot; ORDER BY %@&quot;, orderKey];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (limit &gt; 0 &amp;&amp; limit &lt; NSIntegerMax) &#123;</span><br><span class="line">        [sql appendFormat:@&quot; LIMIT %ld OFFSET %ld&quot;, (long)limit, (long)offset];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSArray *results = [self objectsWhere:sql arguments:arguments];</span><br><span class="line">    return results;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-size大小"><a href="#3-3-size大小" class="headerlink" title="3.3 size大小"></a>3.3 size大小</h3><ul>
<li>(float)dbSize</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+ (float)dbSize &#123;</span><br><span class="line">    NSError *error = nil;</span><br><span class="line">    NSDictionary *fileDictionary = [[NSFileManager defaultManager] attributesOfItemAtPath:[self pathForDbName:[self dbName]] error:&amp;error];</span><br><span class="line">    if (!error) &#123;</span><br><span class="line">        float result = [[fileDictionary objectForKey:NSFileSize] floatValue];</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0.f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-删除"><a href="#3-4-删除" class="headerlink" title="3.4 删除"></a>3.4 删除</h3><ul>
<li>(void)deleteDBFileIfNeeded</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ (void)deleteDBFileIfNeeded &#123;</span><br><span class="line">    NSString *key = [NSString stringWithFormat:@&quot;k%@DBVersion&quot;, NSStringFromClass(self)];</span><br><span class="line">    NSInteger oldNewsDBVersion = [[NSUserDefaults standardUserDefaults] integerForKey:key];</span><br><span class="line">    NSInteger newsDBVersion = [self dbVersion];</span><br><span class="line">    </span><br><span class="line">    // 升级或降级都要删数据库</span><br><span class="line">    if (newsDBVersion != oldNewsDBVersion) &#123;</span><br><span class="line">        if (oldNewsDBVersion &gt; 0) &#123;</span><br><span class="line">            [self deleteDBFile];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            [[NSUserDefaults standardUserDefaults] setInteger:newsDBVersion forKey:key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>(BOOL)deleteDBFile</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ (BOOL)deleteDBFile &#123;</span><br><span class="line">    NSString *path = [self pathForDbName:[self dbName]];</span><br><span class="line">    BOOL ret = YES;</span><br><span class="line">    </span><br><span class="line">    if ([[NSFileManager defaultManager] fileExistsAtPath:path]) &#123;</span><br><span class="line">        ret = [[NSFileManager defaultManager] removeItemAtPath:path error:nil];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (ret) &#123;</span><br><span class="line">        //dbVersion更新为当前版本</span><br><span class="line">        NSString *key = [NSString stringWithFormat:@&quot;k%@DBVersion&quot;, NSStringFromClass(self)];</span><br><span class="line">        [[NSUserDefaults standardUserDefaults] setInteger:[self dbVersion] forKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-使用小结"><a href="#3-5-使用小结" class="headerlink" title="3.5 使用小结"></a>3.5 使用小结</h3><p>使用下来还是比Coredata,更快捷、更方便。原本我们的数据库有点积重难返，每次升级不好管理容易冲突，整个迁移过程中，比较正常顺利，<br>没有因为数据库出现严重的显示问题，bug还很少，且容易追查，对于我们以后数据持久化是一次重大的更新。说一下还有哪些地方不太满足需求的：</p>
<ul>
<li>关联很弱，不同model之间基本没有什么关系</li>
<li>同一model更新保存，其他地方的引用得不到刷新</li>
<li>每次修改数据库存储的字段，需要整体删除原有数据库重新生成新的，带来版本号问题</li>
<li>当数字很大时候，使用NSNumber属性作为存储属性，保存值会出现不正确情况</li>
<li>BaseEntity里面出现子model，需要变为BaseEntity且重写读取方法，包括删除和保存都需要单独调用</li>
</ul>
<p>虽然如此，我们从迁移到目前一直使用着，可见开发中还是没有出现严重问题，对比realm,给我们带来的收益应该会好一点，看到有新的数据库我们还是会尝试。</p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[参加iWeb峰会]]></title>
      <url>/2016/05/12/%E5%8F%82%E5%8A%A0iWeb%E5%B3%B0%E4%BC%9A/</url>
      <content type="html"><![CDATA[<p>16年的时候，赶上周末去参加了一趟北京的iweb峰会，会上来自各个公司的人分享和宣传自己的产品和技术，我作为一名普通开发者的角度去听大会，并了解和记录当前的一些技术发展。 </p>
<h2 id="一、主题峰会-9-00-–-12-00"><a href="#一、主题峰会-9-00-–-12-00" class="headerlink" title="一、主题峰会 9:00 – 12:00"></a>一、主题峰会 9:00 – 12:00</h2><h4 id="1、主持人开场-–-田爱娜-HTML5梦工场-创始人"><a href="#1、主持人开场-–-田爱娜-HTML5梦工场-创始人" class="headerlink" title="1、主持人开场    – 田爱娜 HTML5梦工场  创始人"></a>1、主持人开场    – 田爱娜 HTML5梦工场  创始人</h4><p>HTML5梦工场是中国最有影响力的技术社区团队，由国内最早一批HTML5探索者和狂热拥护者发起，为广大开发者搭建一个开放、自由的互动交流平台，旨在推动HTML5在中国的应用与普及。“梦工场”也被誉为最接地气的草根公益组织。</p>
<h4 id="2、HTML5发行的力量-–-凌海-蝴蝶互动-CEO"><a href="#2、HTML5发行的力量-–-凌海-蝴蝶互动-CEO" class="headerlink" title="2、HTML5发行的力量    – 凌海  蝴蝶互动  CEO"></a>2、HTML5发行的力量    – 凌海  蝴蝶互动  CEO</h4><p>公司的创始人凌海、王峰都来自于中国互联网上市公司核心高管，有业界极为丰富的互联网产品经验和创新精神。凌海曾任盛大集团高级副总裁，盛大游戏总 裁，韩国上市公司ACTOZ董事长。王峰曾任盛大游戏技术副总裁。<br>《传世H5》工作室组建于2015年初，由策划团队、美术团队、技术研发团队、运营团队、测试团队等组成。<br>除了《传世H5》蝴蝶互动又相继推出了《鬼吹灯》、《天天赚钱》、《蛮荒创世》等优秀的HTML5游戏，收到用户和业界的不断好评，之后蝴蝶互动即将推出《武 神》、《鹿鼎记》等。</p>
<h4 id="3、天下武功，唯快不破-–-陈书艺-白鹭时代-CEO"><a href="#3、天下武功，唯快不破-–-陈书艺-白鹭时代-CEO" class="headerlink" title="3、天下武功，唯快不破 – 陈书艺 白鹭时代  CEO"></a>3、天下武功，唯快不破 – 陈书艺 白鹭时代  CEO</h4><p>白鹭移动游戏解决方案包含白鹭引擎、工具和白鹭开放平台，提供从游戏开发、上线到商业化运营的一站式免费服务。白鹭引擎（Egret Engine）、HTML5加速器(Egret Runtime)、骨骼动画工具(Dragon Bones)、可视化编辑器(Egret Wing)等共计14款核心产品，可以帮助开发者高效地开发出HTML5游戏。白鹭开放平台联动开发者、发行商、渠道商、第三方服务商，让HTML5游戏实现了从开发、上线到商业化运营生态连线，并且让所有技术服务和商业化服务，得以落地。案例：围住神经猫、访问量三天过亿</p>
<h4 id="4、-社交生态下的HTML5游戏新契-–-王哲-触控科技副总裁"><a href="#4、-社交生态下的HTML5游戏新契-–-王哲-触控科技副总裁" class="headerlink" title="4、    社交生态下的HTML5游戏新契 – 王哲 触控科技副总裁"></a>4、    社交生态下的HTML5游戏新契 – 王哲 触控科技副总裁</h4><p>公司起步于2008年初创建的CocoaChina社区，专注于苹果产品和iOS系统开发。2010年11月12日触控科技正式组建团队，并在之后2年间获得北极光、迪士尼思伟创投、红杉创投以及纪源资本（GGV）的风险投资，融资总规模3200万美金。2011年凭借一款《捕鱼达人》游戏一战成名。</p>
<h4 id="5、-HTML5和Docker容器如何重构和颠覆应用产业-–-李明-很快-创始人兼CEO"><a href="#5、-HTML5和Docker容器如何重构和颠覆应用产业-–-李明-很快-创始人兼CEO" class="headerlink" title="5、 HTML5和Docker容器如何重构和颠覆应用产业 – 李明 很快  创始人兼CEO"></a>5、 HTML5和Docker容器如何重构和颠覆应用产业 – 李明 很快  创始人兼CEO</h4><h4 id="6、WeX5移动开发云-马科-CEO"><a href="#6、WeX5移动开发云-马科-CEO" class="headerlink" title="6、WeX5移动开发云 马科 CEO"></a>6、WeX5移动开发云 马科 CEO</h4><p>WeX5开发H5 app，遵循Apache开源协议，完全开源免费，上百个组件框架，全部开放，可视化的组件框架，开发者可自定义组件，集成第三方组件，采用MVC设计模式，数据和视图分离，页面描述和代码逻辑分离，支持浏览器调试、真机调试、原生调试，等多种调试模式，开发者可掌握每一行代码。WeX5一直坚持采用H5+CSS3+JS标准技术，一次开发，多端任意部署.</p>
<h4 id="7、-Web-前端的实时化-–-江小丹-英特尔-Web技术研发总监"><a href="#7、-Web-前端的实时化-–-江小丹-英特尔-Web技术研发总监" class="headerlink" title="7、 Web 前端的实时化 – 江小丹 英特尔  Web技术研发总监"></a>7、 Web 前端的实时化 – 江小丹 英特尔  Web技术研发总监</h4><h4 id="8、移动互联网下半场，不用好HTML5将无法生存-–-肖光宇-野狗实时后端云-联合创始人"><a href="#8、移动互联网下半场，不用好HTML5将无法生存-–-肖光宇-野狗实时后端云-联合创始人" class="headerlink" title="8、移动互联网下半场，不用好HTML5将无法生存 – 肖光宇 野狗实时后端云  联合创始人"></a>8、移动互联网下半场，不用好HTML5将无法生存 – 肖光宇 野狗实时后端云  联合创始人</h4><p>实时通信—包括消息订阅，推送，双向通信等功能。网络延迟小，服务响应速度快，API简单易用。<br>数据存储—提供了一个Key-Value的云端数据存储，直接通过API就可以对数据进行存取操作。操作简单，按需扩展。</p>
<h4 id="9、-H5游戏进入精品新时代-—-王安-Dcloud-CEO"><a href="#9、-H5游戏进入精品新时代-—-王安-Dcloud-CEO" class="headerlink" title="9、 H5游戏进入精品新时代 — 王安 Dcloud CEO"></a>9、 H5游戏进入精品新时代 — 王安 Dcloud CEO</h4><p>DCloud面向HTML5行业分别推出了开发工具HBuilder、手机强化引擎5+ Runtime、跨平台前端框架mui、应用发行产品流应用，通过系列产品对HTML5的强化支持，使得HTML5能达到原生的功能和体验，同时在发行上更优于原生应用。</p>
<p>类似 : APICloud</p>
<h4 id="10-、谢成鸿-LayaBox-CEO"><a href="#10-、谢成鸿-LayaBox-CEO" class="headerlink" title="10 、谢成鸿 LayaBox  CEO"></a>10 、谢成鸿 LayaBox  CEO</h4><p>Layabox是HTML5引擎之一，引擎以HTML5技术为核心，定位于全平台的高性能引擎，让游戏开发者一次开发，可同时发布APP、HTML5、VR、Flash版本。开发语言支持Flash AS3、JavaScript、TypeScript三种，让开发者人才选择范围更广泛。引擎核心库仅100K左右，除了大型游戏和小型游戏、还可以用于HTML5应用、APP、广告、营销、教育、3D、VR等众多领域。另外，LayaPlayer运行器移动设备安装量覆盖超5亿，帮助Layabox引擎的开发者进行产品发行。<br>  Layabox是Laya中国实验室历经4年倾力打造的全球顶级HTML5技术框架，核心产品包括：Flash开发H5的框架（LayaFlash）、多语言H5开发引擎（LayaAir）、H5运行器（LayaPlayer）、嵌入式H5应用商店（LayaStore）。</p>
<h2 id="二、应用工具专场1-13：30-–-17：00"><a href="#二、应用工具专场1-13：30-–-17：00" class="headerlink" title="二、应用工具专场1 13：30 – 17：00"></a>二、应用工具专场1 13：30 – 17：00</h2><h4 id="1、HTML5-App开发云实践-基于完全开源的WeX5开发框架"><a href="#1、HTML5-App开发云实践-基于完全开源的WeX5开发框架" class="headerlink" title="1、HTML5 App开发云实践-基于完全开源的WeX5开发框架"></a>1、HTML5 App开发云实践-基于完全开源的WeX5开发框架</h4><p>王洁 WeX5  首席技术运营</p>
<h4 id="2、-Web技术推进多样化人机交互方式"><a href="#2、-Web技术推进多样化人机交互方式" class="headerlink" title="2、 Web技术推进多样化人机交互方式"></a>2、 Web技术推进多样化人机交互方式</h4><p>吴栋霞 英特尔  软件工程师</p>
<h4 id="3、-Yo-去哪儿移动UI框架"><a href="#3、-Yo-去哪儿移动UI框架" class="headerlink" title="3、 Yo-去哪儿移动UI框架"></a>3、 Yo-去哪儿移动UI框架</h4><p>杜瑶 去哪儿网  前端开发总监</p>
<h4 id="4、-手机QQ-React-Web极致优化"><a href="#4、-手机QQ-React-Web极致优化" class="headerlink" title="4、 手机QQ React Web极致优化"></a>4、 手机QQ React Web极致优化</h4><p>李成熙 腾讯AlloyTeam  前端工程师</p>
<h4 id="5、-手机淘宝营销互动页面最佳实践"><a href="#5、-手机淘宝营销互动页面最佳实践" class="headerlink" title="5、 手机淘宝营销互动页面最佳实践"></a>5、 手机淘宝营销互动页面最佳实践</h4><p>黄华健  阿里巴巴  前端工程师</p>
<h4 id="6、大型SPA的复杂工程如何化简"><a href="#6、大型SPA的复杂工程如何化简" class="headerlink" title="6、大型SPA的复杂工程如何化简"></a>6、大型SPA的复杂工程如何化简</h4><p>陈恺睿 小米  高级前端工程师</p>
<h4 id="7、-UC前端业务套件体系"><a href="#7、-UC前端业务套件体系" class="headerlink" title="7、 UC前端业务套件体系"></a>7、 UC前端业务套件体系</h4><p>三桥 阿里巴巴UC移动事业群  高级前端工程师</p>
<h2 id="三、应用工具专场2-13：30-–-17：00"><a href="#三、应用工具专场2-13：30-–-17：00" class="headerlink" title="三、应用工具专场2 13：30 – 17：00"></a>三、应用工具专场2 13：30 – 17：00</h2><h4 id="1、Web-Components-—-Web-前端开发的未来趋势"><a href="#1、Web-Components-—-Web-前端开发的未来趋势" class="headerlink" title="1、Web Components — Web 前端开发的未来趋势"></a>1、Web Components — Web 前端开发的未来趋势</h4><p>1、陈本峰 云适配  创始人兼CEO</p>
<p>云适配由前微软美国总部专家、美通云动（北京）科技公司CEO陈本峰在美国西雅图研发，只需在原网站中插入一行代码，即能创建移动化网站，并实现网址不变、内容实时更新，它颠覆了传统手工移动网站建设模式，可快速打开移动营销六大入口。</p>
<p>2、 web  Components : </p>
<p>组件化给前端开发带来了极大的效率提升，组件化的UI框架也因此层出不穷，从EXTJs、YUI到 jQuery UI ，再到 Bootstrap、React、Ratchet、Ionic等等等等等等，几乎每年都有很多新的UI框架冒出来，它们或者借鉴或者颠覆其他已存在的框架。简单对比一下就会发现这些框架的很大一部分模块在功能上是重合的，但也仅仅在功能层面重合，代码层面确完全不兼容。</p>
<p>Web Components 的出现给组件标准化带来了很好的契机：</p>
<p>WEB组件目前仍然依靠各种类似”Hack”的方式来模拟，模拟方式也各有不同，很难统一和标准化，而 Web Components 则直接提供了标准化的组件定义方式，这是组件标准化的基石，使得未来的组件能够统一创建、方法调用、事件监听、属性访问等。<br>基于标准化的组件定义方式，我们便可以像W3C等标准组织一样来定义组件标准，无需再依赖、等待“内置”组件，这也使得我们获得了“渔”的能力</p>
<h4 id="2、语音智能与H5的结合"><a href="#2、语音智能与H5的结合" class="headerlink" title="2、语音智能与H5的结合"></a>2、语音智能与H5的结合</h4><p>陈家军 科大讯飞  云平台事业部研发主管</p>
<h4 id="3、-浅析HTML5中的无障碍标签及用处"><a href="#3、-浅析HTML5中的无障碍标签及用处" class="headerlink" title="3、 浅析HTML5中的无障碍标签及用处"></a>3、 浅析HTML5中的无障碍标签及用处</h4><p>张昆 中国信息无障碍产品联盟  首席专家</p>
<h4 id="4、HTML5多屏互动平台实践"><a href="#4、HTML5多屏互动平台实践" class="headerlink" title="4、HTML5多屏互动平台实践"></a>4、HTML5多屏互动平台实践</h4><p>苏震巍 苏州盛派网络  CEO</p>
<h4 id="5、iWeb-议题：Weex-开发者工具探究"><a href="#5、iWeb-议题：Weex-开发者工具探究" class="headerlink" title="5、iWeb 议题：Weex 开发者工具探究"></a>5、iWeb 议题：Weex 开发者工具探究</h4><p>勾三股四（阿里巴巴 前端工程师）、梧叶（阿里巴巴 高级技术专家）</p>
<p>手淘和天猫曾经尝试过React Native，然后放弃了。但是把它的思想吸收过来，结合Web Component和Vue.js，然后就成了Weex.</p>
<h4 id="6、小米应用商店Hybrid性能优化实践"><a href="#6、小米应用商店Hybrid性能优化实践" class="headerlink" title="6、小米应用商店Hybrid性能优化实践"></a>6、小米应用商店Hybrid性能优化实践</h4><p>杨伟贤 小米  高级前端工程师</p>
<h4 id="7、Vue-js从入门到上线"><a href="#7、Vue-js从入门到上线" class="headerlink" title="7、Vue.js从入门到上线"></a>7、Vue.js从入门到上线</h4><p>陈陆扬 精雕细课  前端负责人</p>
<h2 id="四、游戏专场1-13：30-–-17：00"><a href="#四、游戏专场1-13：30-–-17：00" class="headerlink" title="四、游戏专场1 13：30 – 17：00"></a>四、游戏专场1 13：30 – 17：00</h2><h4 id="1、文学连接游戏-阅文集团“泛娱乐2-0”迎接H5领域新时代"><a href="#1、文学连接游戏-阅文集团“泛娱乐2-0”迎接H5领域新时代" class="headerlink" title="1、文学连接游戏 阅文集团“泛娱乐2.0”迎接H5领域新时代"></a>1、文学连接游戏 阅文集团“泛娱乐2.0”迎接H5领域新时代</h4><p>朱靖 阅文集团  副总裁</p>
<p>腾讯COO任宇昕与副总裁程武宣布正式成立阅文集团，统一管理和运营原本属于盛大文学和腾讯文学旗下的起点中文网、创世中文网、小说阅读网、潇湘书院、红袖添香、云起书院、榕树下、QQ阅读、中智博文、华文天下等网文品牌。</p>
<h4 id="2、Cocos-Creator：全面提升-H5-游戏的开发和运行速度"><a href="#2、Cocos-Creator：全面提升-H5-游戏的开发和运行速度" class="headerlink" title="2、Cocos Creator：全面提升 H5 游戏的开发和运行速度"></a>2、Cocos Creator：全面提升 H5 游戏的开发和运行速度</h4><p>王楠 触控科技  产品总监</p>
<p>Cocos Creator 是以内容创作为核心的游戏开发工具，在 Cocos2d-x 基础上实现了彻底脚本化、组件化和数据驱动等特点</p>
<h4 id="3、快创互娱，人人都是HTML5游戏创想家"><a href="#3、快创互娱，人人都是HTML5游戏创想家" class="headerlink" title="3、快创互娱，人人都是HTML5游戏创想家"></a>3、快创互娱，人人都是HTML5游戏创想家</h4><p>段会锋 快创互娱  合伙人兼技术副总</p>
<p>快创互娱是由大连文森软件特科技有限公司设计开发的一款HTML5在线开发平台。快创互娱是一款可视化、零代码、拖拽式编程的在线开发平台，基于HTML5及MIT开源协议，具有跨平台的强大性能。使用者可通过鼠标拖拽的简单方法，创造属于自己的故事、动画、游戏、课件，同时一键分享，轻松将作品上传至网络。</p>
<h4 id="4、Yahoo-Y5平台飛躍出海、強勢出航！"><a href="#4、Yahoo-Y5平台飛躍出海、強勢出航！" class="headerlink" title="4、Yahoo Y5平台飛躍出海、強勢出航！"></a>4、Yahoo Y5平台飛躍出海、強勢出航！</h4><p>赖俊光 Yahoo台湾与香港游戏频道   负责人</p>
<h4 id="5、发行和渠道为什么推那个产品"><a href="#5、发行和渠道为什么推那个产品" class="headerlink" title="5、发行和渠道为什么推那个产品"></a>5、发行和渠道为什么推那个产品</h4><p>李力维 独角兽游戏  CEO</p>
<h4 id="6、腾讯浏览服务，鼎力服务H5游戏生态"><a href="#6、腾讯浏览服务，鼎力服务H5游戏生态" class="headerlink" title="6、腾讯浏览服务，鼎力服务H5游戏生态"></a>6、腾讯浏览服务，鼎力服务H5游戏生态</h4><p>魏晓海 腾讯浏览器  内核开发总监技术专家</p>
<h4 id="7、H5游戏2-0时代到来"><a href="#7、H5游戏2-0时代到来" class="headerlink" title="7、H5游戏2.0时代到来"></a>7、H5游戏2.0时代到来</h4><p>姬海江 交叉点  CEO   一个外包公司</p>
<h2 id="五、游戏专场2-13：30-–-17：00"><a href="#五、游戏专场2-13：30-–-17：00" class="headerlink" title="五、游戏专场2 13：30 – 17：00"></a>五、游戏专场2 13：30 – 17：00</h2><h4 id="1、约三端，战未来"><a href="#1、约三端，战未来" class="headerlink" title="1、约三端，战未来"></a>1、约三端，战未来</h4><p>汪阔 Layabox  技术副总裁</p>
<h4 id="2、《小小战争》的设计经验分享"><a href="#2、《小小战争》的设计经验分享" class="headerlink" title="2、《小小战争》的设计经验分享"></a>2、《小小战争》的设计经验分享</h4><p>李瑞峰 圣堂科技  CEO     H5策略游戏</p>
<h4 id="3、H5游戏的未来发展"><a href="#3、H5游戏的未来发展" class="headerlink" title="3、H5游戏的未来发展"></a>3、H5游戏的未来发展</h4><p>赵鹏 横石科技  副总裁 在线网页游戏《弑沙》</p>
<h4 id="4、Lie-to-Me—聊聊HTML5多人实时在线游戏的优化"><a href="#4、Lie-to-Me—聊聊HTML5多人实时在线游戏的优化" class="headerlink" title="4、Lie to Me—聊聊HTML5多人实时在线游戏的优化"></a>4、Lie to Me—聊聊HTML5多人实时在线游戏的优化</h4><p>大城小胖  自由程序员 </p>
<p><a href="http://weibo.com/finscn?is_hot=1" target="_blank" rel="noopener">http://weibo.com/finscn?is_hot=1</a></p>
<p><a href="https://github.com/finscn" target="_blank" rel="noopener">https://github.com/finscn</a></p>
<h4 id="5、强化渠道产品联动，升级用户游戏体验"><a href="#5、强化渠道产品联动，升级用户游戏体验" class="headerlink" title="5、强化渠道产品联动，升级用户游戏体验"></a>5、强化渠道产品联动，升级用户游戏体验</h4><p>林玮 北京游琥科技  副总经理</p>
<h4 id="6、从市场角度分析H5游戏该如何立项"><a href="#6、从市场角度分析H5游戏该如何立项" class="headerlink" title="6、从市场角度分析H5游戏该如何立项"></a>6、从市场角度分析H5游戏该如何立项</h4><p>谭德文 上海越山科技  CEO</p>
<h4 id="7、H5游戏的困境和破局"><a href="#7、H5游戏的困境和破局" class="headerlink" title="7、H5游戏的困境和破局"></a>7、H5游戏的困境和破局</h4><p>黄加阳 9G游戏  CEO</p>
<h2 id="六、数字营销专场-13：30-–-17：00"><a href="#六、数字营销专场-13：30-–-17：00" class="headerlink" title="六、数字营销专场 13：30 – 17：00"></a>六、数字营销专场 13：30 – 17：00</h2><h4 id="1、后营销时代：借H5实现“移动互联网"><a href="#1、后营销时代：借H5实现“移动互联网" class="headerlink" title="1、后营销时代：借H5实现“移动互联网+"></a>1、后营销时代：借H5实现“移动互联网+</h4><p>张翔 白鹭时代、青雀移动  联合创始人、总经理</p>
<h4 id="2、-共享创赢移动网页大平台"><a href="#2、-共享创赢移动网页大平台" class="headerlink" title="2、    共享创赢移动网页大平台"></a>2、    共享创赢移动网页大平台</h4><p>马岳 Google  商业合作部行业总监</p>
<h4 id="3、-裂变·营销闭环·H5生态"><a href="#3、-裂变·营销闭环·H5生态" class="headerlink" title="3、    裂变·营销闭环·H5生态"></a>3、    裂变·营销闭环·H5生态</h4><p>刘旭 易企秀  联合创始人兼副总裁</p>
<p>易企秀是一款针对移动互联网营销的手机幻灯片、H5场景应用制作工具，将原来只能在PC端制作和展示的各类复杂营销方案转移到更为便携和展示的手机上，用户随时随地根据自己的需要在PC端、手机端进行制作和展示，随时随地营销。</p>
<h4 id="4、-喵葩：天猫电商互动技术新思路"><a href="#4、-喵葩：天猫电商互动技术新思路" class="headerlink" title="4、    喵葩：天猫电商互动技术新思路"></a>4、    喵葩：天猫电商互动技术新思路</h4><p>续彬 天猫  高级技术专家</p>
<h4 id="5、-网络营销未来的五大发展趋势"><a href="#5、-网络营销未来的五大发展趋势" class="headerlink" title="5、    网络营销未来的五大发展趋势"></a>5、    网络营销未来的五大发展趋势</h4><p>葛甲 北京蓝时代  互联网分析师，自媒体人</p>
<h4 id="6、-H5数字营销的技术痛点"><a href="#6、-H5数字营销的技术痛点" class="headerlink" title="6、    H5数字营销的技术痛点"></a>6、    H5数字营销的技术痛点</h4><p>余悠 跳跳糖创意  CEO</p>
<h4 id="7、-纽约广告节最佳数字营销作品赏析"><a href="#7、-纽约广告节最佳数字营销作品赏析" class="headerlink" title="7、    纽约广告节最佳数字营销作品赏析"></a>7、    纽约广告节最佳数字营销作品赏析</h4><p>吴金君<br>纽约广告节  中国首席代表</p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MVC、MVP与MVVM]]></title>
      <url>/2016/04/22/MVC%E3%80%81MVP%E4%B8%8EMVVM/</url>
      <content type="html"><![CDATA[<p>看了不少关于工程结构的文章，不限于在iOS编程的工程和语言，设计主要有几种，分别是MVC、MVP、MVVM以及Redux，每一篇都有自己细微独到的认知，在一些职责分配理解上有稍微的区别，不过都围绕着一个真理：工程层级分工清楚，通信同步，减少结构的臃肿与耦合，提高开发效率。要理解各个结构，其实主要就是理解他们之间的交通规则，也就是他们分别代表谁，而谁能和谁说话。</p>
<h3 id="一、MVC"><a href="#一、MVC" class="headerlink" title="一、MVC"></a>一、MVC</h3><p>MVC历史比较悠久也有着很多衍生体，本来一直以为MVC结构是一种固定标准的工程设计结构，后来了解到它在不同的语言和领域中体现出的职能机制可以说是大不相同的。</p>
<h5 id="1-1-标准的MVC"><a href="#1-1-标准的MVC" class="headerlink" title="1.1 标准的MVC"></a>1.1 标准的MVC</h5><p>我表示不知道哪里有标准的完整的MVC，只是它们之间都有一些共同的定义，引用至百科：</p>
<ul>
<li>Model：表示程序的数据模型对象，是应用程序中用于保存数据和处理数据逻辑的部分。</li>
<li>View：表示程序的视图界面，代表显示部分。</li>
<li>Controller：表示程序的控制器，处理用户交互输入，包括视图数据读取并向模型发送数据等。</li>
<li>Model与View之间是相互可知道的</li>
</ul>
<h5 id="1-2-各种不同的MVC规则"><a href="#1-2-各种不同的MVC规则" class="headerlink" title="1.2 各种不同的MVC规则"></a>1.2 各种不同的MVC规则</h5><ul>
<li>Spring</li>
</ul>
<p><img src="/assets/images/MVC/SPRINGMVC.jpg" alt=""></p>
<ul>
<li>ASP</li>
</ul>
<p><img src="/assets/images/MVC/ASPMVC.jpg" alt=""></p>
<ul>
<li>Rails</li>
</ul>
<p><img src="/assets/images/MVC/RAILSMVC.jpg" alt=""></p>
<ul>
<li>WIKI</li>
</ul>
<p><img src="/assets/images/MVC/WIKIMVC.jpg" alt=""></p>
<h5 id="1-3-iOS中的MVC"><a href="#1-3-iOS中的MVC" class="headerlink" title="1.3 iOS中的MVC"></a>1.3 iOS中的MVC</h5><p>1.3.1 交通规则</p>
<p><img src="/assets/images/MVC/iOSMVC.jpg" alt=""></p>
<p>我们可以看到iOS中的MVC和其他是很接近的，苹果的整个开发框架设计都遵循着MVC结构。其中：</p>
<p>Model和View永远不能相互通信，只能通过Controller传递。</p>
<p>Controller可以直接与Model对话，Model可以通过Notification和KVO机制与Controller间接通信。</p>
<p>Controller可以直接与View对话，View通过action向Controller报告事件的发生与状态，Controller去数据交互回来再更新View.</p>
<p>但是实际开发中，由于框架的限制，我们还是会发现iOS在MVC的开发遵循了上述的标准模式，model和View之间会存在耦合。</p>
<p>1.3.2 缺点</p>
<ul>
<li><p>model与View的职责过于简单</p>
</li>
<li><p>臃肿的ViewController</p>
<ul>
<li>View的加载显示逻辑</li>
<li>网络请求数据逻辑</li>
<li>工具类逻辑</li>
<li>交互操作逻辑</li>
<li>dataSource和代理逻辑</li>
<li>页面的生命周期</li>
<li>状态记录</li>
<li>界面跳转</li>
</ul>
</li>
<li><p>维护成本高、测试性差</p>
</li>
</ul>
<p>1.3.3 优化</p>
<ul>
<li>model </li>
</ul>
<p>不做为单纯的数据结构体，应当包含数据流动的全部处理逻辑，包括网络请求，数据库存取，数据格式处理转化。</p>
<ul>
<li>ViewController</li>
</ul>
<p>单独的工具类处理方法，新建View的容器用于组织和管理view加载显示，传递生命周期给View自我管理，界面跳转使用scheme路由分发给View自身事件，网络请求可以单独新建一个category或者service，状态和事件的响应拆分出一个事件派发中心的管理器。</p>
<ul>
<li>view</li>
</ul>
<p>容器概念处理布局，接受生命周期，更多的承担VC中的显示逻辑与代理协议，监听数据变化与同步</p>
<h3 id="二、MVP"><a href="#二、MVP" class="headerlink" title="二、MVP"></a>二、MVP</h3><p>MVP其实一个MVC的变种，不存在明显的区别，看实际的应用场景是Android币iOS多，如果按照上述标准的MVC结构来讲，MVP主要的特点为：</p>
<ul>
<li>V变种为被动视图，不在主动更新数据，所有的交互都通过presenter来进行处理并更新，保罗View的协议代理</li>
<li>视图层对于模型层没有任何依赖，两者被presenter进行了解耦，他俩是无感知的</li>
</ul>
<h3 id="三、MVVM"><a href="#三、MVVM" class="headerlink" title="三、MVVM"></a>三、MVVM</h3><p>记得从前MVVM刚出来的时候被炒的出神入化，但是发现很多人在理解和使用上并没有用出MVC的区别来，存在误区，我们来看一下职责。</p>
<p><img src="/assets/images/MVC/MVVM.png" alt=""></p>
<h5 id="3-1-职责"><a href="#3-1-职责" class="headerlink" title="3.1 职责"></a>3.1 职责</h5><p>Model：提供业务逻辑实现方法(本地存储数据的交互、服务端数据的交互)，数据结构</p>
<p>View: 负责View的初始化释放与布局,响应用户交互事件</p>
<p>ViewModel：从Model层 获取数据，同步数据到Model中，向View层提供接口，其中包括 数据接口(格式化的数据) 以及事件处理接口，通知View层数据改变，业务逻辑，页面跳转</p>
<p>看到这里是不是发现似曾相识，VM不就是从前的C吗，只不过是臃肿的C变成了臃肿的VM而已。但是如果你仔细的理解正确，会发现MVVM与MVC的区别。</p>
<h5 id="3-2-关键区别"><a href="#3-2-关键区别" class="headerlink" title="3.2 关键区别"></a>3.2 关键区别</h5><ul>
<li>VM 是 对View层视图的逻辑抽象，包括直接的数据显示格式和状态保存</li>
<li>VM 与View之间进行了绑定关系，VM的更新会自动同步给View</li>
<li>VM 里面不包含Controller所具有的独特功能</li>
</ul>
<h5 id="3-3-小结"><a href="#3-3-小结" class="headerlink" title="3.3 小结"></a>3.3 小结</h5><p>MVVM是MVC的进化,依旧是已解耦分工为目标，这个时候View和Model之间不再有联系，彻底分隔开，有VM进行统一管理。在实际的应用中，Controller一层是存在的，所以MVVM结构本质上的结构多了隐式绑定和C这么一层，并且绑定用于绑定关系的出现，iOS在MVVM的应用上结合reactiveCocoa进行响应式编程更为开阔的思路。结构如下：</p>
<p><img src="/assets/images/MVC/MVMCV.jpg" alt=""></p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[AVFoundation视频开发总结]]></title>
      <url>/2016/03/28/%E8%A7%86%E9%A2%91%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>AVFoundation是为数不多的几个框架,您可以使用和创建基于时间的视听媒体。它提供了一个objective - c接口用于工作与基于时间的视听数据详细的级别。例如,您可以使用它来检查,创建、编辑或reencode媒体文件。你也可以输入流从设备和操作视频实时捕捉和回放。</p>
<h2 id="一、概念引导："><a href="#一、概念引导：" class="headerlink" title="一、概念引导："></a>一、概念引导：</h2><h3 id="1、ASSets媒体文件"><a href="#1、ASSets媒体文件" class="headerlink" title="1、ASSets媒体文件:"></a>1、ASSets媒体文件:</h3><p>1）AVAsset</p>
<p>一个抽象类来表示时间等视听媒体视频和声音。每个资产包含一组跟踪旨在呈现或加工在一起,一个统一的媒体类型,包括但不限于音频、视频、文本、关闭字幕,字幕。</p>
<p>AVURLAsset *anAsset = [[AVURLAsset alloc] initWithURL:url options:nil];属性有<br>tracks、duration、preferredVolume、preferredTransform等等。</p>
<p>2) 一个AVAssetTrack</p>
<p>对象提供了所有资产提供track-level检查接口,方便对ASSets进行更具体的属性获取以及对应的操作。</p>
<p>3）AVAssetImageGenerator</p>
<p>对象提供缩略图或预览图像的资产独立于回放，可以生成单独的图片，也可以生成图片队列，这是获取视频缩略图的方式之一，还有另外两种ALAsset的thumbnail 和 - (UIImage *)imageFromSampleBuffer:(CMSampleBufferRef)sampleBuffer。</p>
<p>4）AVAssetExportSession</p>
<p>针对AVAsset源对象的内容进行转码，创建一个被指定输出形式的资源。</p>
<p><img src="/assets/images/AVAssetExportSession.jpg" alt=""></p>
<h3 id="2、Playback播放控制"><a href="#2、Playback播放控制" class="headerlink" title="2、Playback播放控制:"></a>2、Playback播放控制:</h3><p>1) AVPlayer</p>
<p>你使用一个AVPlayer对象来实现控制器和用户接口单一或多种条目回放。</p>
<ul>
<li><p>-  (instancetype)initWithPlayerItem:(AVPlayerItem *)item</p>
</li>
<li><p>play 、 parse 、 end</p>
</li>
<li><p>- (void)seekToTime:(CMTime)time</p>
</li>
</ul>
<p>2) AVPlayerLayer</p>
<p>用于显示视频内容，相当于大屏幕。里面有videoGravity，默认值 AVLayerVideoGravityResizeAspect.</p>
<p>3) AVPlayerItem</p>
<p>一个AVPlayerItem代表资产的表现状态,由一个AVPlayer对象和可以观察到的状态。对视频播放状态修改一起监听的过程多数发生在正对这个对象的操作操作上，比如：</p>
<ul>
<li>seekToTime，从哪里开始播放</li>
<li>各种资源播放状态的通知AVPlayerItemFailedToPlayToEndTimeNotification<br>等</li>
</ul>
<p>4) AVPlayerItemTrack </p>
<p>你用一个AVPlayerItemTrack对象修改资产的表现状态跟踪(AVAssetTrack)一个AVPlayer对象。通常视频的加载播放有各种状态，我们需要KVO监听或者添加通知去知道播放器的准备、进行、暂停、停止等状态。</p>
<p>5) AVQueuePlayer</p>
<p>按照队列播放视频</p>
<ul>
<li><p>queuePlayerWithItems，</p>
</li>
<li><p>insertItem:(AVPlayerItem *)item</p>
<pre><code>afterItem:(AVPlayerItem *)afterItem
</code></pre></li>
</ul>
<h3 id="3、Editing资源编辑"><a href="#3、Editing资源编辑" class="headerlink" title="3、Editing资源编辑:"></a>3、Editing资源编辑:</h3><p>AVFoundation框架提供了一个功能丰富的组类促进视听资产的编辑。AVFoundation的编辑API的核心成分，就是一组追踪从一个或多个不同的媒体资产。AVMutableComposition类提供了一个接口,用于插入和删除操作的痕迹,以及管理自己时间排序。</p>
<p><img src="/assets/images/AVMutableComposition.jpg" alt=""></p>
<p>1）AVMutableComposition</p>
<p>是一个可变的AVComposition子类，当您想要从现有资产创建一个新的资源。你可以添加和删除跟踪,可以添加、删除和时间范围。<br>比如：</p>
<ul>
<li>– insertEmptyTimeRange：可以增加一段空白时间</li>
</ul>
<ul>
<li>– insertTimeRange:ofAsset:atTime:error:<br>插入的所有跟踪给定的时间范围内指定的资产到接收机。</li>
</ul>
<!-- -->
<pre><code>AVAsset *videoAsset = &lt;#AVAsset with at least one video track#&gt;;
AVAsset *anotherVideoAsset = &lt;#another AVAsset with at least one video track#&gt;;
// Get the first video track from each asset.
AVAssetTrack *videoAssetTrack = [[videoAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0];
AVAssetTrack *anotherVideoAssetTrack = [[anotherVideoAsset tracksWithMediaType:AVMediaTypeVideo] objectAtIndex:0];
// Add them both to the composition.
[mutableCompositionVideoTrack insertTimeRange:CMTimeRangeMake(kCMTimeZero,videoAssetTrack.timeRange.duration) ofTrack:videoAssetTrack atTime:kCMTimeZero error:nil];
[mutableCompositionVideoTrack insertTimeRange:CMTimeRangeMake(kCMTimeZero,anotherVideoAssetTrack.timeRange.duration) ofTrack:anotherVideoAssetTrack atTime:videoAssetTrack.timeRange.duration error:nil];&apos;
</code></pre><p>2) AVMutableAudioMix </p>
<p>一个AVMutableAudioMix对象管理混合音轨的输入参数。它允许自定义音频处理在回放期间音轨或执行其他操作。</p>
<!--0-->
<pre><code>AVMutableAudioMix *mutableAudioMix = [AVMutableAudioMix audioMix];
// Create the audio mix input parameters object.
AVMutableAudioMixInputParameters *mixParameters = [AVMutableAudioMixInputParameters audioMixInputParametersWithTrack:mutableCompositionAudioTrack];
// Set the volume ramp to slowly fade the audio out over the duration of the composition.
[mixParameters setVolumeRampFromStartVolume:1.f toEndVolume:0.f timeRange:CMTimeRangeMake(kCMTimeZero, mutableComposition.duration)];
// Attach the input parameters to the audio mix.
mutableAudioMix.inputParameters = @[mixParameters];
</code></pre><h3 id="4、Media-Capture媒体捕捉"><a href="#4、Media-Capture媒体捕捉" class="headerlink" title="4、Media Capture媒体捕捉:"></a>4、Media Capture媒体捕捉:</h3><p>1) AVCaptureDevice </p>
<p>代表输入设备,如摄像头或麦克风</p>
<p>2) AVCaptureInput </p>
<p>输入设备的配置端口，我们可以理解为输入</p>
<p>3）AVCaptureSession</p>
<p>协调数据流从输入到输出,用startRunning开始从输入到输出的数据流,并调用stopRunning停止流动。采取关闭代理，保证取景器一直流动。</p>
<p>4) AVCaptureOutput </p>
<ul>
<li><p>AVCaptureMovieFileOutput，输入到视频文件，代理AVCaptureFileOutputRecordingDelegate</p>
</li>
<li><p>AVCaptureVideoDataOutput，如果想要实时的处理每一帧数据，或想要有自己的图形动画，代理AVCaptureVideoDataOutputSampleBufferDelegate</p>
</li>
</ul>
<ul>
<li><p>AVCaptureAudioDataOutput ，音频数据，代理AVCaptureVideoDataOutputSampleBufferDelegate</p>
</li>
<li><p>AVCaptureStillImageOutput ，图片数据</p>
</li>
</ul>
<p>5）AVCaptureVideoPreviewLayer </p>
<p>实时展示被session传出出来的视频流数据，也就是我们的取景器</p>
<p>6）AVCaptureConnection </p>
<p>代表捕获之间的连接输入和输出对象关联到一个捕获会话。</p>
<p><img src="/assets/images/AVCaptureConnection.jpg" alt=""></p>
<h3 id="5、Export媒体输出"><a href="#5、Export媒体输出" class="headerlink" title="5、Export媒体输出:"></a>5、Export媒体输出:</h3><p>1) AVAssetExportSession</p>
<p>针对AVAsset对象转码，创建一个输出的形式被指定出口预设内容。包括对输出媒体资源的属性设定，可以设置presetName进行视频品质压缩，AVAssetExportPresetLowQuality等。也可以设置属性包括：outputFileType<br>、fileLengthLimit、timeRange<br>等。</p>
<p>2）AVAssetReader </p>
<p>直接从媒体读取存储样本,获得样本解码成可渲染的形式。组合资产多个音轨和组合多个视频跟踪(通过使用AVAssetReaderAudioMixOutput和AVAssetReaderVideoCompositionOutput)。</p>
<ul>
<li>addOutPut</li>
<li>startReading</li>
<li>cancelReading</li>
</ul>
<p>读取一个音频：</p>
<!--0-->
<pre><code>AVAudioMix *audioMix = &lt;#An AVAudioMix that specifies how the audio tracks from the AVAsset are mixed#&gt;;
// Assumes that assetReader was initialized with an AVComposition object.
AVComposition *composition = (AVComposition *)assetReader.asset;
// Get the audio tracks to read.
NSArray *audioTracks = [composition tracksWithMediaType:AVMediaTypeAudio];
// Get the decompression settings for Linear PCM.
NSDictionary *decompressionAudioSettings = @{ AVFormatIDKey : [NSNumber numberWithUnsignedInt:kAudioFormatLinearPCM] };
// Create the audio mix output with the audio tracks and decompression setttings.
AVAssetReaderOutput *audioMixOutput = [AVAssetReaderAudioMixOutput assetReaderAudioMixOutputWithAudioTracks:audioTracks audioSettings:decompressionAudioSettings];
// Associate the audio mix used to mix the audio tracks being read with the output.
audioMixOutput.audioMix = audioMix;
// Add the output to the reader if possible.
if ([assetReader canAddOutput:audioMixOutput])
[assetReader addOutput:audioMixOutput];
</code></pre><p>3) AVAssetWriter</p>
<p>使用一个AVAssetWriter对象媒体数据写入新文件指定视听的容器类型,如QuickTime电影文件或一个mp4文件,支持自动交叉媒体数据的多个并发的痕迹。</p>
<ul>
<li>initWithURL:fileType:error:</li>
<li>startWriting</li>
<li>startSessionAtSourceTime</li>
<li>addInput</li>
<li>endSessionAtSourceTime</li>
<li>finishWritingWithCompletionHandler</li>
</ul>
<h2 id="二、代码实践："><a href="#二、代码实践：" class="headerlink" title="二、代码实践："></a>二、代码实践：</h2><blockquote>
<h3 id="import-“TTCameraViewController-h”"><a href="#import-“TTCameraViewController-h”" class="headerlink" title="#import “TTCameraViewController.h”"></a>#import “TTCameraViewController.h”</h3></blockquote>
<h2 id="三、问题回顾："><a href="#三、问题回顾：" class="headerlink" title="三、问题回顾："></a>三、问题回顾：</h2><h3 id="1、视频文件写入崩溃："><a href="#1、视频文件写入崩溃：" class="headerlink" title="1、视频文件写入崩溃："></a>1、视频文件写入崩溃：</h3><h4 id="现象："><a href="#现象：" class="headerlink" title="现象："></a>现象：</h4><p>相机开始拍摄就会出现崩溃，时而出现，有时难以复现。</p>
<h4 id="原因与解决："><a href="#原因与解决：" class="headerlink" title="原因与解决："></a>原因与解决：</h4><p>1）startSessionAtSourceTime只能在 AVAssetWriterStatusWriting的之后调用，但是startWriting调用之后writer并没有立即变为writing状态，而已有一个极短的开始时间，参照苹果规范使用文档，只需要前面调用之后后面就可以跟着执行startSessionAtSourceTime，然而，我遇见了这问题，说明它并不是。随后我到stackoverflow上查了问题，发现有人早就提过，并没有答案，说是升级IOS8以后就没有了，可我这里是IOS9…随后我只能判断writer状态如果是writing就开始执行，如果不是就调用startWriting。</p>
<p>2）[videoWriterInput appendSampleBuffer：xxx]这只能在startSessionAtSourceTime开始之后调用，和1是同样的情况，明明第一行调用了startSessionAtSourceTime，第二调用appendSampleBuffer就会崩溃，并且依旧是偶尔发生。但是这里的问题是没有一个状态可以判断是否已经开始startSessionAtSourceTime，这里就有点血崩了，不能像问题1一样判断解决，后来只好try catch了,稳住局面防止崩溃，丢失极少的毫秒级帧数。</p>
<h3 id="2、相机拍摄闪烁抖动："><a href="#2、相机拍摄闪烁抖动：" class="headerlink" title="2、相机拍摄闪烁抖动："></a>2、相机拍摄闪烁抖动：</h3><h4 id="现象：-1"><a href="#现象：-1" class="headerlink" title="现象："></a>现象：</h4><p>开始拍摄时候，取景器闪烁抖动，引起一小部分可见范围内的视频内容发送抖动，并被存入文件中，体验差。</p>
<h4 id="原因与解决：-1"><a href="#原因与解决：-1" class="headerlink" title="原因与解决："></a>原因与解决：</h4><p>在开始拍摄的时候，再去创建connection并传递设备和拍摄方向，有利于视频获取oritation，自然而然的横着拍摄也会竖着播放，但是问题在于connection的建立产生较大的链接，引起视频抖动，此抖动将被录制进入视频文件中。于是我采取在初始化input的时候就把connection就增加进去，当开始拍摄的时候不会发生抖动，但是牺牲的是视频的oritation需要自己根据用户拍摄的方向去手动修改视频方向。</p>
<h3 id="3、视频方向混乱："><a href="#3、视频方向混乱：" class="headerlink" title="3、视频方向混乱："></a>3、视频方向混乱：</h3><h4 id="现象：-2"><a href="#现象：-2" class="headerlink" title="现象："></a>现象：</h4><p>背面摄像头拍摄，home键在下，拍摄出来的视频文件，在播放的时候，底部在手机右边，而不是底边，一次类推，home键在底部与视频的底部角度成90垂直关系。</p>
<h4 id="原因与解决：-2"><a href="#原因与解决：-2" class="headerlink" title="原因与解决："></a>原因与解决：</h4><!--0-->
<pre><code>self.videoOutPut = [[AVCaptureVideoDataOutput alloc] init];
NSDictionary * outputSettings = [[NSDictionary alloc] initWithObjectsAndKeys:[NSNumber numberWithInt:kCVPixelFormatType_32BGRA],(id)kCVPixelBufferPixelFormatTypeKey, nil];
[self.videoOutPut setVideoSettings:outputSettings];

//必须
if ([self.session canAddOutput:self.videoOutPut]) {
    [self.session addOutput:self.videoOutPut];
}

//先于
self.videoConnection = [self.videoOutPut connectionWithMediaType:AVMediaTypeVideo];
self.videoConnection.enabled = NO;
[self.videoConnection setVideoOrientation:AVCaptureVideoOrientationPortrait];
</code></pre><h3 id="4、横着拍摄的视频横着播放："><a href="#4、横着拍摄的视频横着播放：" class="headerlink" title="4、横着拍摄的视频横着播放："></a>4、横着拍摄的视频横着播放：</h3><h4 id="现象：-3"><a href="#现象：-3" class="headerlink" title="现象："></a>现象：</h4><p>横着拍摄的视频，放的时候是竖着的。</p>
<h4 id="原因与解决：-3"><a href="#原因与解决：-3" class="headerlink" title="原因与解决："></a>原因与解决：</h4><p>因为上面解决视频抖动，导致不能直接设定拍摄时候的视频方向，从而需要根据手动的拍摄方向去修改视频的视图的方向。<br>考虑到用户可能锁住屏幕旋转，于是就CMMotionManager获取重力方向来判断，在VC出现或者开始拍摄的时候开启，在VC退出或者拍摄完成的的时候关闭。获得方向后，在视频的写入里直接修改方向即可。</p>
<!--0-->
<pre><code>[videoWriterInput setTransform:CGAffineTransformScale(CGAffineTransformMakeRotation(-M_PI_2), 1.0, 1.0)];
</code></pre><h3 id="5、录制视频有右边和底边绿色线条："><a href="#5、录制视频有右边和底边绿色线条：" class="headerlink" title="5、录制视频有右边和底边绿色线条："></a>5、录制视频有右边和底边绿色线条：</h3><h4 id="现象：-4"><a href="#现象：-4" class="headerlink" title="现象："></a>现象：</h4><p>手机全屏录制的时候，设置视频输出宽度为手机的宽高，当宽高为基数的时候视频录制里面会出现绿色线条。</p>
<h4 id="原因与解决：-4"><a href="#原因与解决：-4" class="headerlink" title="原因与解决："></a>原因与解决：</h4><p>不知道原因，神奇的bug，参照着段子的视频方法解决的，直接修改视频输出宽高为偶数。</p>
<!--0-->
<pre><code>NSInteger videoWidth = [[NSNumber numberWithFloat:self.view.frame.size.width] integerValue];
NSInteger videoHeight = [[NSNumber numberWithFloat:self.view.frame.size.height] integerValue];
if (videoWidth % 2 == 1) {
    videoWidth = videoWidth - 1;
}
if (videoHeight % 2 == 1) {
    videoHeight = videoHeight - 1;
}
</code></pre>]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[IOS 音频一览]]></title>
      <url>/2016/03/15/IOS%20%E9%9F%B3%E9%A2%91%E4%B8%80%E8%A7%88/</url>
      <content type="html"><![CDATA[<blockquote>
<p>做嘉宾聊天室这个需求的时候接触了音频和视频上的开发，嘉宾可以发布视频和语音以及文字信息出来，观众则可以文字回复，这样主持人嘉宾和观众就形成一个良性的互动过程。在这里把相关整理一下，望给大家带来一些认识。</p>
</blockquote>
<h1 id="一、了解音频"><a href="#一、了解音频" class="headerlink" title="一、了解音频"></a>一、了解音频</h1><p>声音作为信息的一种媒介载体必不可少，在移动端体现为各类语音交流以及音乐等，开发中使用的音频文件通过声音采样、量化、编码几步从而成为人耳可听的声音，频率为20HZ到20KHZ，奈奎斯特的理论表明采样率高于最高频2倍时候，是可以将数字信号还原为原来的模拟信号的，所以通常我们在网上看到的音频文件的采样率为44.1KHZ。</p>
<p>采样后通过量化的脉冲编码调制，我们得到了PCM类型的数据，比如在使用AVAudioRecorder采样的时候可以看到采样类型kAudioFormatLinearPCM。但是这样拿到的数据是很大的，不便于使用和传输，通过对人类不敏感的声音区域进行过滤压缩，就有了MP3、AAC、OGG、WMA等数据格式类型，这些都是有损压缩。</p>
<p>码率代码了压缩质量，比如MP3常用码率有128kbit/s、160kbit/s、320kbit/s等等，越高代表着声音音质越好。MP3中的数据有ID3和音频数据组成，ID3用于存储歌名、演唱者、专辑、音轨等我们可以常见的信息。</p>
<h1 id="二、IOS对音频的操作"><a href="#二、IOS对音频的操作" class="headerlink" title="二、IOS对音频的操作"></a>二、IOS对音频的操作</h1><p>开发实际上是为了解决需求，需求对应的是使用场景，开发的方式很多，不同的使用场景可以使用的方法不同。IOS开发提供了以下几种常用方式供我们解决对应的音频需求。</p>
<ul>
<li>System Sound Services </li>
<li>AVFoundation 框架</li>
<li>Media Player 框架</li>
</ul>
<h2 id="2-1-System-Sound-Services"><a href="#2-1-System-Sound-Services" class="headerlink" title="2.1  System Sound Services"></a>2.1  System Sound Services</h2><h4 id="2-1-1-场景特点"><a href="#2-1-1-场景特点" class="headerlink" title="2.1.1 场景特点"></a>2.1.1 场景特点</h4><p>最底层也是简单的声音播放服务，此方法是适合播放提示警告类型的短小的声音</p>
<h4 id="2-1-2-存在限制"><a href="#2-1-2-存在限制" class="headerlink" title="2.1.2 存在限制"></a>2.1.2 存在限制</h4><ul>
<li>声音长度要小于 30 秒</li>
<li>In linear PCM 或者 IMA4 (IMA/ADPCM) 格式的</li>
<li>打包成 .caf, .aif, 或者 .wav 的文件</li>
<li>不能控制播放的进度</li>
<li>调用方法后立即播放声音</li>
<li>没有循环播放和立体声控制：</li>
</ul>
<h4 id="2-1-3-使用方式"><a href="#2-1-3-使用方式" class="headerlink" title="2.1.3 使用方式"></a>2.1.3 使用方式</h4><p>调用 AudioServicesCreateSystemSoundID(CFURLRef inFileURL,SystemSoundID *outSystemSoundID) 该函数的第一个参数代表音频文件的URL（可通过NSURL转换成CFURLRef），第二个参数代表注册音频文件的SystemSoundID。</p>
<p>调用AudioServicesAddSystemSoundCompletion()函数为制定SystemSoundID注册Callback函数。有了 CallBack 函数我们可以解决不少问题，比如可以克服 System Sound Services 本身不支持循环播放的问题。</p>
<p>调用AudioServicePlaySystemSound函数或者AudioServicePlayAlertSound（调用系统振动功能）。</p>
<pre><code>- (void)viewDidLoad
{
[super viewDidLoad];

// 1. 定义要播放的音频文件的URL
NSURL *voiceURL = [[NSBundle mainBundle]URLForResource:@&quot;CleanDidFinish&quot; withExtension:@&quot;aiff&quot;];

// 2. 注册音频文件（第一个参数是音频文件的URL 第二个参数是音频文件的SystemSoundID）
AudioServicesCreateSystemSoundID((__bridge CFURLRef)(voiceURL),&amp;ditaVoice);

// 3. 为crash播放完成绑定回调函数AudioServicesAddSystemSoundCompletion(ditaVoice,NULL,NULL,(void*)completionCallback,NULL);

// 4. 播放 ditaVoice 注册的音频 并控制手机震动
AudioServicesPlayAlertSound(ditaVoice);

//    AudioServicesPlaySystemSound(ditaVoice);
//    AudioServicesPlaySystemSound(kSystemSoundID_Vibrate); // 控制手机振动

}
</code></pre><h2 id="2-2-AVFoundation-框架"><a href="#2-2-AVFoundation-框架" class="headerlink" title="2.2  AVFoundation 框架"></a>2.2  AVFoundation 框架</h2><h4 id="2-2-1-场景特点"><a href="#2-2-1-场景特点" class="headerlink" title="2.2.1 场景特点"></a>2.2.1 场景特点</h4><p>如果播放较大的音频或者要对音频有精确的控制，则System Sound Service可能就很难满足实际需求了，通常这种情况会选择使用AVFoundation，它可以满足我们通常意义上的绝大部分的场景需求，包括音乐的交互、声音的制作等等，根据自己的业务需求实现自定义的定制化。如果你只是想实现音频的播放或者录制，没有其他需求，AVFoundation会很好的满足你，它的接口使用简单、不用关心其中的细节。</p>
<h4 id="2-2-2-关键点和API浏览"><a href="#2-2-2-关键点和API浏览" class="headerlink" title="2.2.2 关键点和API浏览"></a>2.2.2 关键点和API浏览</h4><blockquote>
<p>Background Modes</p>
</blockquote>
<p>打开后台模式的音乐播放，或者在info.plist文件中添加Required Background Modes键，其值是App plays audio or streams audio/video using AirPlay</p>
<blockquote>
<p>AVAudioSession</p>
</blockquote>
<p>用于 iOS 系统中协调应用程序之间的音频播放的 API 的。例如，当有电话打进来时，音频的播放就会被暂停；在用户启动电影时，音乐的播放就会停止。我们需要使用这些 API 来确保一个应用程序能够正确响应并处理这类事件。</p>
<blockquote>
<p>AVAudioPlayer</p>
</blockquote>
<p>这个高层级的 API 为你提供一个简单的接口，用来播放本地或者内存中的音频。这是一个无界面的音频播放器 (也就是说没有提供 UI 元素)，使用起来也很直接简单。它不适用于网络音频流或者低延迟的实时音频播放。如果这些问题都不需要担心，那么 AVAudioPlayer 可能就是正确的选择。音频播放器的 API 也为我们带来了一些额外的功能，比如循环播放、获取音频的音量强度等等。</p>
<blockquote>
<p>AVAudioRecorder</p>
</blockquote>
<p>作为与 AVAudioPlayer 相对应的 API，AVAudioRecorder 是将音频录制为文件的最简单的方法。除了用一个音量计接受音量的峰值和平均值以外，这个 API 简单粗暴，但要是你的使用场景很简单的话，这可能恰恰就是你想要的方法。</p>
<blockquote>
<p>AVPlayer</p>
</blockquote>
<p>AVPlayer 与上面提到的 API 相比，提供了更多的灵活性和可控性。它基于 AVPlayerItem 和 AVAsset，为你提供了颗粒度更细的权限来获取资源，比如选择指定的音轨。它还通过 AVQueuePlayer 子类支持播放列表，而且你可以控制这些资源是否能够通过 AirPlay 发送。</p>
<h4 id="与-AVAudioPlayer-最主要的区别是，AVPlayer-对来自网络的流媒体资源的-“开箱即用”-支持。这增加了处理播放状态的复杂性，但是你可以使用-KVO-来观测所有的状态参数来解决这个问题。"><a href="#与-AVAudioPlayer-最主要的区别是，AVPlayer-对来自网络的流媒体资源的-“开箱即用”-支持。这增加了处理播放状态的复杂性，但是你可以使用-KVO-来观测所有的状态参数来解决这个问题。" class="headerlink" title="与 AVAudioPlayer 最主要的区别是，AVPlayer 对来自网络的流媒体资源的 “开箱即用” 支持。这增加了处理播放状态的复杂性，但是你可以使用 KVO 来观测所有的状态参数来解决这个问题。"></a>与 AVAudioPlayer 最主要的区别是，AVPlayer 对来自网络的流媒体资源的 “开箱即用” 支持。这增加了处理播放状态的复杂性，但是你可以使用 KVO 来观测所有的状态参数来解决这个问题。</h4><blockquote>
<p> AVAudioEngine</p>
</blockquote>
<p>AVAudioEngine 是播放和录制的 Objective-C 接口。它提供了以前需要深入到 Audio Toolbox 框架的 C API 才能做的控制 (例如一些实时音频任务)。该音频引擎 API 对底层的 API 建立了优秀的接口。如果你不得不处理底层的问题，你仍然可以使用 Audio Toolbox 框架。</p>
<p>这个 API 的基本概念是建立一个音频的节点图，从源节点 (播放器和麦克风) 以及过处理 (overprocessing) 节点 (混音器和效果器) 到目标节点 (硬件输出)。每一个节点都具有一定数量的输入和输出总线，同时这些总线也有良好定义的数据格式。这种结构使得它非常的灵活和强大。而且它集成了音频单元 (audio unit)。</p>
<h2 id="2-3-Media-Player-框架"><a href="#2-3-Media-Player-框架" class="headerlink" title="2.3 Media Player 框架"></a>2.3 Media Player 框架</h2><h4 id="2-3-1-场景特点"><a href="#2-3-1-场景特点" class="headerlink" title="2.3.1 场景特点"></a>2.3.1 场景特点</h4><p>众所周知音乐是iOS的重要组成播放，无论是iPod、iTouch、iPhone还是iPad都可以在iTunes购买音乐或添加本地音乐到音乐库中同步到你的iOS设备。在MediaPlayer.frameowork中有一个MPMusicPlayerController用于播放音乐库中的音乐。Media Player 框架是 iOS 平台上一个用于音频和视频播放的高层级接口，它包含了一个你可以在应用中直接使用的默认的用户界面。你可以使用它来播放用户在 iPod 库中的项目，或者播放本地文件以及网络流。这个框架也包括了查找用户媒体库中内容的 API，同时还可以配置像是在锁屏界面或者控制中心里的音频控件。</p>
<h4 id="2-3-2-使用方式"><a href="#2-3-2-使用方式" class="headerlink" title="2.3.2 使用方式"></a>2.3.2 使用方式</h4><p>使用MPMusicPlayerController实例化对象来播放内置音乐库的媒体文件，有以下两种类方法来实例化对象：</p>
<p>MPMusicPlayerController *playController = [MPMusicPlayerController systemMusicPlayer]; </p>
<p>说明：播放内置媒体库项目取代用户目前播放状态（如果是用网易云音乐或QQQ音乐在播放歌曲）</p>
<p>MPMusicPlayerController *playController = [MPMusicPlayerController applicationMusicPlayer]; </p>
<p>说明：播放该应用内的歌曲，不影响本机自带音乐播放器的状态。</p>
<ul>
<li><p>判断有没有正在播放的媒体</p>
<pre><code>[MPMusicPlayerController indexOfNowPlayingItem] == NSNotFound
</code></pre></li>
<li><p>创建媒体队列</p>
<pre><code>[MPMediaQuery songsQuery];
[MPMusicPlayerController setQueueWithQuery:nil];
</code></pre></li>
<li><p>获取媒体曲目的信息</p>
</li>
</ul>
<pre><code>MPMediaItem *currentItem = ....
NSString *artist = [currentItem valueForProperty:MPMediaItemPropertyArtist];
NSString *songName = [currentItem valueForProperty:MPMediaItemPropertyTitle];
</code></pre><ul>
<li><p>监听媒体通知</p>
<pre><code>NSNotificationCenter *notificationCenter = [NSNotificationCenter defaultCenter];[notificationCenter addObserver:self
              selector:@selector()
                       name:MPMusicPlayerControllerNowPlayingItemDidChangeNotification
                     object:nil];
</code></pre></li>
</ul>
<h2 id="2-4-更多音频方案"><a href="#2-4-更多音频方案" class="headerlink" title="2.4 更多音频方案"></a>2.4 更多音频方案</h2><p>CoreAudio的接口层次：</p>
<p><img src="/assets/images/api.png" alt=""></p>
<h4 id="2-4-1-OpenAL"><a href="#2-4-1-OpenAL" class="headerlink" title="2.4.1 OpenAL"></a>2.4.1 OpenAL</h4><p>OpenAL 是一个跨平台的 API。它提供了位置 (3D) 和低延迟的音频服务。它主要用于跨平台游戏的开发。它有意地模仿了 OpenGL 中 API 的风格。</p>
<h4 id="2-4-2-Audio-Unit-框架"><a href="#2-4-2-Audio-Unit-框架" class="headerlink" title="2.4.2  Audio Unit 框架"></a>2.4.2  Audio Unit 框架</h4><p>Audio Unit 框架是一个底层的 API；所有 iOS 中的音频技术都构建在 Audio Unit 这个框架之上。音频单元是用来加工音频数据的插件。一个音频单元链叫做音频处理图。</p>
<p>如果你需要非常低的延迟 (如 VoIP 或合成乐器)、回声消除、混音或者音调均衡的话，你可能需要直接使用音频单元，或者自己写一个音频单元。但是其中的大部分工作可以使用 AVAudioEngine 的 API 来完成。如果你不得不写自己的音频单元的话，你可以将它们与 AVAudioUnit 节点一起集成在 AVAudioEngine 处理图中。</p>
<h4 id="2-4-2-AudioToolBox-框架"><a href="#2-4-2-AudioToolBox-框架" class="headerlink" title="2.4.2 AudioToolBox 框架"></a>2.4.2 AudioToolBox 框架</h4><p>通过AudioToolbox框架，可以将短声音注册到system sound服务上，被注册到system sound服务上的声音称之为 system sounds。<br>前面常用的System Sound Services 就来自这里的框架。</p>
<p>它必须满足下面几个条件：</p>
<p>(1).播放的时间不能超过30秒</p>
<p>(2).数据必须是 PCM或者IMA4流格式</p>
<p>(3).必须被打包成下面三个格式之一：Core Audio Format (.caf), Waveform audio (.wav), 或者 Audio Interchange File (.aiff)</p>
<p>(4）声音文件必须放到设备的本地文件夹下面。通过AudioServicesCreateSystemSoundID方法注册这个声音文件.</p>
<h4 id="2-4-3-CoreMIDI-和-CoreAudioKit-框架"><a href="#2-4-3-CoreMIDI-和-CoreAudioKit-框架" class="headerlink" title="2.4.3 CoreMIDI 和 CoreAudioKit 框架"></a>2.4.3 CoreMIDI 和 CoreAudioKit 框架</h4><p>在 iOS 上，Core MIDI 和 CoreAudioKit 可以被用来使应用程序表现为 MIDI 设备。在 OS X 上，Music Sequencing 服务提供了基于 MIDI 的控制和对音乐数据访问的权限。Core MIDI 服务为服务器和驱动程序提供了支持。</p>
<h4 id="2-4-4-QTKit-和-QuickTime-框架"><a href="#2-4-4-QTKit-和-QuickTime-框架" class="headerlink" title="2.4.4 QTKit 和 QuickTime 框架"></a>2.4.4 QTKit 和 QuickTime 框架</h4><p>现在已经过时了，它们不应该被用在以后的开发中。我们应该使用 AVFoundation (和 AVKit) 来代替它们</p>
<h1 id="三、今日头条嘉宾聊天室音频实践"><a href="#三、今日头条嘉宾聊天室音频实践" class="headerlink" title="三、今日头条嘉宾聊天室音频实践"></a>三、今日头条嘉宾聊天室音频实践</h1><h2 id="3-1-背景"><a href="#3-1-背景" class="headerlink" title="3.1 背景"></a>3.1 背景</h2><p>嘉宾聊天室是头条16年初新起的一个项目服务，目标是为了引进明星嘉宾访谈类型和体育赛事线上直播的节目，丰富头条在直播领域的内容，聊天室一期是属于图文、语音、短视频直播，后期发展可成为视频线上直播。表现形式与网易直播频道类似，但更丰富。</p>
<h2 id="3-2-IOS端实现"><a href="#3-2-IOS端实现" class="headerlink" title="3.2 IOS端实现"></a>3.2 IOS端实现</h2><p>根据聊天室在语音和视频的需求，使用系统自带实现的MPMoviePlayerController没法符合自定义的需求，包括功能与交互设计，并且MPMoviePlayerController已经不被苹果官方提倡，将要通过AVPlayer方案代替。需求本身的属于基本的语音和视频沟通，只对音频视频的录制与播放，符合音质画质要求和大小要求，因此采用AVFoundation框架即可，能够满足聊天室的需求。主要使用了AVPlayer、AVAudioRecorder、AVAudioSession等主要的类。</p>
<p>实现类有如下等：</p>
<pre><code>#import &quot;TTAudioRecorder.h&quot;
#import &quot;TTAudioPlayer.h&quot;
#import &quot;TTLiveCameraViewController.h&quot;
#import &quot;TTUploadVideoAudioManager.h&quot;
#import &quot;TTLiveAudioManager.h&quot;
</code></pre><h2 id="3-3-问题与解决"><a href="#3-3-问题与解决" class="headerlink" title="3.3 问题与解决"></a>3.3 问题与解决</h2><p>整个需求的实现过程还算顺利，按照API说明理解即可，提两三点说明下都会遇见哪一类的问题。</p>
<h4 id="3-1-音频格式为AMR"><a href="#3-1-音频格式为AMR" class="headerlink" title="3.1 音频格式为AMR"></a>3.1 音频格式为AMR</h4><p>AVPlayer来播放视频音频都相当强大，但是它也存在着一些不可回避的问题，那就是目前IOS已经不再支持AMR格式的播放。</p>
<pre><code>AMR format is no longer supported by Apple (since iOS 4.3)
</code></pre><p>与安卓同步开发的时候对接确立的通用的格式为AMR，因为AAC文件在网络传输下载播放的时候显得很大，AMR相对来说会好很多，同时我们也看了微博和微信的实现都是使用AMR，鉴于头条的用户量和使用体验，于是就采用了同样的方式。安卓可以很好支持AMR，在iOS平台上需要进行WAV和AMR之间的转换，好在libopencore可以解决这个事。网络上有好些所谓的相互转化的库，仔细看了下，都没有脱离这个core本身。</p>
<p>libopencore库：</p>
<pre><code>interf_dec.h 
interf_enc.h
dec_if.h
if_rom.h
libopencore-amrnb.a
libopencore-amrwb.a
</code></pre><p>主要方法：</p>
<pre><code>EncodeWAVEFileToAMRFile 、 DecodeAMRFileToWAVEFile
</code></pre><p>封装一个mannager：        </p>
<pre><code>#import &lt;Foundation/Foundation.h&gt;

@interface VoiceConverter : NSObject

+ (int)amrToWav:(NSString*)_amrPath wavSavePath:(NSString*)_savePath;

+ (int)wavToAmr:(NSString*)_wavPath amrSavePath:(NSString*)_savePath;

@end
</code></pre><h4 id="3-2-WAV转化AMR声音变形："><a href="#3-2-WAV转化AMR声音变形：" class="headerlink" title="3.2 WAV转化AMR声音变形："></a>3.2 WAV转化AMR声音变形：</h4><p>录制WAV格式本地正常播放，转化为AMR后，把AMR格式文件在电脑端播放，声音严重变形，无法识别，再转化会WAV,，手机还是无法识别。<br>原因与解决<br>声音格式转化采用的是”amrFileCodec.h”，它对转化的音频输入源是有格式要求的，要求转化的采样率为标准的8k，如果录制的音频频率采用高频率44.1K的话就会出现变形，我想这里的设定依据来自于amr格式的采样率通常为8K。通过AVAudioRecorder把采样率设置为8K后，可以正常互相转化。</p>
<blockquote>
<p>AMR维基百科：</p>
</blockquote>
<blockquote>
<p>采样率 8 kHz/13-bit (160 采样点每20ms)，滤波后只保留 200-3400 Hz 范围内的信号.</p>
</blockquote>
<blockquote>
<p>编码器使用8个位速：12.2、10.2、7.95、7.40、6.70、5.90、5.15和4.75 kbit/s.</p>
</blockquote>
<pre><code>NSMutableDictionary *settings=[NSMutableDictionary dictionary];
[settings setObject:@(kAudioFormatLinearPCM) forKey:AVFormatIDKey];
[settings setObject:@(8000) forKey:AVSampleRateKey]; //必须和amr文件解码参数保持一致
[settings setObject:@(1) forKey:AVNumberOfChannelsKey];
[settings setObject:@(16) forKey:AVLinearPCMBitDepthKey];
[settings setObject:@(NO) forKey:AVLinearPCMIsFloatKey];
[settings setValue:@(NO) forKey:AVLinearPCMIsNonInterleaved];
[settings setValue:@(NO) forKey:AVLinearPCMIsBigEndianKey];
[settings setValue:@(AVAudioQualityHigh) forKey:AVEncoderAudioQualityKey];
AVAudioRecorder *recorderTemp = [[AVAudioRecorder alloc] initWithURL:fileUrl settings:settings error:nil];
</code></pre><h4 id="3-3-AVPlayer的准备状态"><a href="#3-3-AVPlayer的准备状态" class="headerlink" title="3.3 AVPlayer的准备状态"></a>3.3 AVPlayer的准备状态</h4><p>当AVPlayer的status变为AVPlayerStatusReadyToPlay后，依旧可能无法开始播放？</p>
<p>AVPlayerStatusReadyToPlay属性只是表明了AVPlayer已经成功的载入了AVPlayerItem，并且准备好，但是实际的是否能播放时由AVPlayerItem的status到达AVPlayerItemStatusReadyToPlay的时候，才能开始正常播放的。<br>如果我们的App使用CPU过多，I/O读写过多时，有可能导致直接无法播放，我们再调用play或者seekToTime:方法都无法正常播放，尤其是视频。所以我们需要做一个真正播放状态准备好的判断，也可以通过KVO去监听AVPlayerItem的status。</p>
<pre><code>//播放器是否准备好
if (self.videoPrePlayer.status == AVPlayerStatusReadyToPlay) 
{
    //视频是否加载成功
    if(self.videoPrePlayer.currentItem.status == AVPlayerItemStatusFailed){   
        return;
    }
        [self.videoPrePlayer play];

}
</code></pre><h1 id="四、小结"><a href="#四、小结" class="headerlink" title="四、小结"></a>四、小结</h1><p>文章主要对音频的使用范畴做了概括，并列举了两三实践点，其他的并没有做详细的论述，因为本篇比较偏向音频知识的介绍，知道用什么工具框架后再具体解决就好。比如如何播放流畅的网络音频，如何实现音频的快放与慢放等具体问题，此次需求内容并不复杂没有涉及，他们都可以通过 AudioToolBox框架实现。</p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[换肤功能的实现]]></title>
      <url>/2016/01/21/%E6%8D%A2%E8%82%A4%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      <content type="html"><![CDATA[<h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>市面上的应用常见换肤功能，归纳下来可谓两类形式，一种是普通的切换皮肤颜色，比如今日头条的夜间阅读模式，另外一种是节假日喜庆皮肤，比如淘宝京东每逢双十一的炫酷界面，来头条后刚好接触到这方面的学习，写篇文章总结下。</p>
<h3 id="二、头条夜间阅读模式"><a href="#二、头条夜间阅读模式" class="headerlink" title="二、头条夜间阅读模式"></a>二、头条夜间阅读模式</h3><p>1、定制</p>
<p>一般的视图大多继承自UIView，但是也存在没有继承比如UIBarButtonItem，更换主题的时候，不同视图需要更换的属性比如textColor、backgroundColor和UIImageView的图片也不同，所以也难避免需要一种一种的找出来进行视图的定制。</p>
<p>新建一个SSThemed.h文件，里面定义的所有视图都需要绑定一个主题的key值，每一种key值对应了不同主题下的各个颜色。<br>设置一个视图为浅白色的，key值是backgrounColor4，在白天的时候对应的是#ffffff,在夜间的时候对应的是#252525。</p>
<p>比如SSThemedView这个类，其实就是继承自UIView，绑定了关于背景和边框线的主题键即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@interface SSThemedView : SSViewBase</span><br><span class="line"></span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *backgroundColorThemeKey;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *borderColorThemeKey;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>而像文本输入框这样的视图继承自UITextView，就要相对多2个属性，因为包含文字颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface SSThemedTextView : UITextView</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *borderColorThemeKey;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *textColorThemeKey;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *placeholderColorThemeKey;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *backgroundColorThemeKey;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>其他类似，比如UIImageView，但是图片会多一个图片name属性，这个是由开发者自己添加的，主题切换的时候需要自己处理，我们接下往下看。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface SSThemedImageView : UIImageView</span><br><span class="line"></span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *imageName;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *highlightedImageName;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *tintColorThemeKey;</span><br><span class="line">@property(nonatomic, copy) IBInspectable NSString *hightlightedTintColorThemeKey;</span><br><span class="line">@property(nonatomic, assign) IBInspectable BOOL enableNightCover;</span><br><span class="line">@property(nonatomic) CGSize preferredContentSize;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>2、管理主题的manager</p>
<p>创建一个全局单例的TTThemeManager，用于读取配置管理主题和记录用户选择主题操作。头条的做法是将尽可能使用到的主题放在一个默认的plist文件中，有与头条只有夜间模式和白天模式，所以通过plist存储颜色值基本可以满足配置要求，应用启动的时候管理器读取应用包里的配置。白天对应的plist是default_theme.plist，夜间对应的是night_theme.plist，里面存放的key值是相同的，如上所述，不同文件里相同key对应的颜色值不一样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (NSDictionary *)dictionaryForBundle:(NSString *)bundleName theme:(NSString*)themeName &#123;</span><br><span class="line">    if (!bundleName) bundleName = @&quot;TTThemed&quot;;</span><br><span class="line">    </span><br><span class="line">    NSString *bundlePath = [[NSBundle mainBundle] pathForResource:bundleName ofType:@&quot;bundle&quot;];</span><br><span class="line">    NSBundle *bundle = [NSBundle bundleWithPath:bundlePath];</span><br><span class="line">    </span><br><span class="line">    NSString *fileName = [NSString stringWithFormat:@&quot;%@_theme&quot;, themeName];</span><br><span class="line">    NSString *path = [bundle pathForResource:fileName ofType:@&quot;plist&quot;];</span><br><span class="line">    if (![[NSFileManager defaultManager] fileExistsAtPath:path]) &#123;</span><br><span class="line">        path = [[NSBundle mainBundle] pathForResource:@&quot;default_theme&quot; ofType:@&quot;plist&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return [NSDictionary dictionaryWithContentsOfFile:path];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、主题切换</p>
<p>头条内部夜间模式和白天模式切换，通过发出一个全局的通知NSNotification到各个组件，组件收到通知事件通过mananger读取当前的主题，也就是当前是白天还是夜间，然后获取当前绑定的颜色key值在该主题下所对应的颜色。</p>
<p>针对背景颜色和边框颜色的情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)_customThemeChanged:(NSNotification *)notification &#123;</span><br><span class="line">    if (!isEmptyString(_backgroundColorThemeKey)) &#123;</span><br><span class="line">        self.backgroundColor = [UIColor tt_themedColorForKey:_backgroundColorThemeKey];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIColor *)themedColorForKey:(NSString *)key &#123;</span><br><span class="line">    if (self.currentTheme &amp;&amp; [self.currentTheme[@&quot;colors&quot;] valueForKey:key]) &#123;</span><br><span class="line">        NSString *colorString = [self.currentTheme[@&quot;colors&quot;] valueForKey:key];</span><br><span class="line">        </span><br><span class="line">        UIColor *color = [self.colorCache objectForKey:colorString];</span><br><span class="line">        </span><br><span class="line">        if (!color) &#123;</span><br><span class="line">            color = [UIColor colorWithHexString:colorString];</span><br><span class="line">            </span><br><span class="line">            if (color) &#123;</span><br><span class="line">                [self.colorCache setObject:color forKey:colorString];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return color;</span><br><span class="line">    &#125;</span><br><span class="line">    return nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>针对图片替换情况，开发者在建议有主题变化的ImageView的时候需要提供两套图片，一个是白天的，一个是夜晚，并且需要遵循一定的规则，比如白天的名字叫XXX.png,那么夜晚的名字就是白天的名字加上后缀_night,也就是XX_night.png。当主题发生变化的时候，UIImageView自动寻找对应的后缀名的图片文件替换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"> if ([[TTThemeManager sharedInstance_tt] currentThemeMode] == TTThemeModeNight) &#123;</span><br><span class="line">        if (noNightModeFileNameSet == nil) &#123;</span><br><span class="line">            noNightModeFileNameSet = [[NSMutableSet alloc] initWithCapacity:100];</span><br><span class="line">        &#125;</span><br><span class="line">        if ([noNightModeFileNameSet containsObject:fixedName]) &#123;</span><br><span class="line">            return [UIImage imageNamed:fixedName];</span><br><span class="line">        &#125;</span><br><span class="line">        if ([TTDeviceHelper is667Screen] || [TTDeviceHelper is736Screen]) &#123;</span><br><span class="line">            NSString * name = hdImageNamed(fixedName, YES);</span><br><span class="line">            UIImage * image = [UIImage imageNamed:name];</span><br><span class="line">            if (image) &#123;</span><br><span class="line">                [noNightModeFileNameSet addObject:name];</span><br><span class="line">                return image;</span><br><span class="line">            &#125;</span><br><span class="line">            name = hdImageNamed(fixedName, NO);</span><br><span class="line">            image = [UIImage imageNamed:name];</span><br><span class="line">            if (image) &#123;</span><br><span class="line">                [noNightModeFileNameSet addObject:name];</span><br><span class="line">                return image;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        NSString * fileNameWithNightModelSuffix = [self fileNameAddNightModelSuffix:fixedName];</span><br><span class="line">        </span><br><span class="line">        UIImage * img = [UIImage imageNamed:fileNameWithNightModelSuffix];</span><br><span class="line">        if (img != nil) &#123;</span><br><span class="line">            return img;</span><br><span class="line">        &#125;</span><br><span class="line">        [noNightModeFileNameSet addObject:fixedName];</span><br><span class="line">        return [UIImage imageNamed:fixedName];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">+ (NSString * )fileNameAddNightModelSuffix:(NSString *)originName</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableString *resultName = [NSMutableString stringWithString:originName];</span><br><span class="line">    </span><br><span class="line">    NSRange lastPoint = [resultName rangeOfString:@&quot;.&quot; options:NSBackwardsSearch];</span><br><span class="line">    if(lastPoint.location != NSNotFound) &#123;</span><br><span class="line">        [resultName insertString:nightModelSuffixStr atIndex:lastPoint.location];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [resultName appendString:nightModelSuffixStr];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return resultName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="三、节假日的喜庆皮肤"><a href="#三、节假日的喜庆皮肤" class="headerlink" title="三、节假日的喜庆皮肤"></a>三、节假日的喜庆皮肤</h3><p>与阅读模式有些微区别，虽然本质上可以使用一套，但是节日假通常是根据节假日时间出现和消失，并且不是属于用户行为，而是应用开发方进行的控制，有了上述的方法的基础，不使用默认提供的theme组件，我们再节假日单独变更的页面可以采用入下实现方式。</p>
<p>1、首先需要定制符合需求的UI组件</p>
<p>2、下发数据使用接口</p>
<p>我们可以合server约定类型，在参数为1-10的时候表示为10中主题，当下发参数为0的时候客户端显示默认设计样式，不走本地主题的逻辑，下发的数据格式举例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;home_navi&quot;: &#123;</span><br><span class="line">        &quot;colors&quot;: &#123;</span><br><span class="line">            &quot;color_background&quot;: &quot;#ffffff&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;images&quot;: &#123;</span><br><span class="line">            &quot;image_logo&quot;: &quot;home_topLogo&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;home_tabbar&quot;: &#123;</span><br><span class="line">        &quot;colors&quot;: &#123;</span><br><span class="line">            &quot;color_background&quot;: &quot;#F9F9F9&quot;,</span><br><span class="line">            &quot;color_button_normal&quot;: &quot;#999999&quot;,</span><br><span class="line">            &quot;color_button_selected&quot;: &quot;#444444&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;images&quot;: &#123;</span><br><span class="line">            &quot;image_one_button_normal&quot;: &quot;tab按钮1图片&quot;,</span><br><span class="line">            &quot;image_one_button_selected&quot;: &quot;tab按钮1选中图片&quot;,</span><br><span class="line">            &quot;image_two_button_normal&quot;: &quot;tab按钮2图片&quot;,</span><br><span class="line">            &quot;image_two_button_selected&quot;: &quot;tab按钮2选中图片&quot;,</span><br><span class="line">            &quot;image_three_button_normal&quot;: &quot;tab按钮2图片&quot;,</span><br><span class="line">            &quot;image_three_button_selected&quot;: &quot;tab按钮2选中图片&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;values&quot;: &#123;</span><br><span class="line">            &quot;value_one_button&quot;: &quot;tab按钮1&quot;,</span><br><span class="line">            &quot;value_two_button&quot;: &quot;tab按钮2&quot;,</span><br><span class="line">            &quot;value_three_button&quot;: &quot;tab按钮3&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;loading&quot;: &#123;</span><br><span class="line">        &quot;resources&quot;: &#123;</span><br><span class="line">            &quot;resource_refreshImage&quot; : &quot;refresh.gif&quot;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、下发使用压缩包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@interface SSZipArchive : NSObject</span><br><span class="line"></span><br><span class="line">// Password check</span><br><span class="line">+ (BOOL)isFilePasswordProtectedAtPath:(NSString *)path;</span><br><span class="line"></span><br><span class="line">// Unzip</span><br><span class="line">+ (BOOL)unzipFileAtPath:(NSString *)path toDestination:(NSString *)destination;</span><br><span class="line">+ (BOOL)unzipFileAtPath:(NSString *)path toDestination:(NSString *)destination delegate:(nullable id&lt;SSZipArchiveDelegate&gt;)delegate;</span><br><span class="line"></span><br><span class="line">//...</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="4、优化"><a href="#4、优化" class="headerlink" title="4、优化"></a>4、优化</h3><p>头条在使用皮肤切换的存储上其实可以通过下发的处理，更加灵活和方便产品变动。主调颜色一致是红色，也没有节假日的活动皮肤，其实个人认为可以多增加点产品上的小体验，大红色好单调哦，主题可以多定制几个，而不是只有夜间模式。</p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[入职今日头条]]></title>
      <url>/2015/12/30/%E5%85%A5%E8%81%8C%E4%BB%8A%E6%97%A5%E5%A4%B4%E6%9D%A1/</url>
      <content type="html"><![CDATA[<p>2015年过去的很快，这一年算是自己工作的上升成长期，由毕业后最初的踏入到如今完全接受自己的工作领域和环境，并能正常的快速加入新的公司和团队，这是我这一年来最大的变化。人总是在不断的认知中成长，在去哪儿那会生活很安逸舒适，其他部门加班成狗的时候，我们无线部门依旧正常上下班，相信这也是移动发版周期化带来的好处，急了也急不了多少，慢也慢不起来，所以一切都再正常的时间里做着正常的事情里度过。</p>
<p>到15年7月，自己的水平已经进步了，恰逢学长开始创业，叫我一起干，原本就看着互联网大潮的我愉快的加入了。之后在里面独立承担开发APP 的任务，收货颇多。可毕竟不是个以产品支撑的企业，随着资本市场的低谷，我们的汽车业务数据起不来的结果就是最后度日艰难。到我离开的时候，互联网领域依旧低调，前面后试了许多知名企业，也拿到了一些Offer，还是对自己更加肯定，可是环境毕竟不是我想要得，想起自己从前的日子，年轻人暂时还不想过得太安逸。</p>
<p>12月底，经过多轮面试，我选择加入了今日头条，这是一个快速发展的公司，处于上升期，公司对员工很不错，尤其是食堂的饭菜很好吃，工作氛围也符合了我的预期，我相信在这里我会有更多的成长和获得更多的机会。目前，已经对公司的节奏基本把握和适应，对工作的需求已经开展中了。</p>
<p>恰逢2016年新年开始，我希望自己在新的一年里，整个安心稳定的工作，加大工作的力度，却不要追逐速度，要沉稳，要踏实，在自己的开发领域里有新的突破，对开发的认知更进一步，对技术的使用更深一层。针对头条的客户端能够熟悉并搭建工程结构，希望未来在某一方面或者某一块能够完全胜任管理，能够快速开发，能够应用和分享新的技术，并实践在客户端中。这一切都离不开同事们的交流，希望同事能够把一些坑和经验写入wiki文档，成为大家一起分享的资料，有说明才有更好的合作开发，也希望组长能够多多指点，让我能有力去做出一些付出，希望公司越来越好。</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[我短暂的创业经历]]></title>
      <url>/2015/12/21/%E6%88%91%E7%9F%AD%E6%9A%82%E7%9A%84%E5%88%9B%E4%B8%9A%E7%BB%8F%E5%8E%86/</url>
      <content type="html"><![CDATA[<p>互联网圈内，去哪儿旅行对外展示着的形象是加班多，偶尔还传出员工猝死的消息，然而任何一家公司也并不是每个部门都加班，并不是每个部门都有那么多亟不可待的业务需要去追赶，反而，在这里，我每天的工作自在舒适，按需完成，加班是很少的，如果你不想去外面的世界翻滚，这里就是你长久生养之地。那个时候我就是一枚螺丝开发，由于业务需求没有那么多，所以每日我只需要自己安排完成一定的工作量即可，有时候需求周期因为各端同事的配合时间也会被拉长，所以其实我大部分时间就是在自己浏览学习，没有实际的业务上手实践。而与此同时，互联网界正在迅猛发展，每天看着的都是各自CEO的诞生，各自融资拿钱拿到手软，这不禁也影响着我。<br>所以，尽管如此，尽管这里是整个互联网最安逸的体现，到了今年的7月份时候，我还是决心离开这温暖的被窝，离开我每日安享的梦境，全心投身创业。我却开始有些难过，因为那是我第一份工作，和去哪儿也是很有缘分的说，跟大家告别的时候特别伤心。一阵心塞之后，我的雄心开始燃烧，总是想着要闯出一片天地，对未来充满希望和无限遐想，想到我会享受着创业成就感与创业艰辛的交织幸福感，内心便激动起来。</p>
<p>加入的创业公司属于互联网汽车行业，与一般不同的是，做的是汽车B2B模式平台。加入前，我和公司的领头人聊得很好，不仅是因为旧相识，谈得更多的是对整个业务未来的展望，他侃侃而谈，把整个行业给我分析了一遍，我似乎找不到哪里一点他说的不对，只有当我问到如果事情没有按照你所推演的发展，这中间出现环节出错误的时候，他才有些避重就轻。当时我的理解，在此投资环境如此之好得情况下，任何一家创业公司的带头人应该都是这幅样子，要利用互联网优势把这个市场搅拌，要让传统行业为我们所用的架势,遇见的问题自然也会有办法。汽车市场如此之大，随便能咬到一口就是丰厚的回报，而早期的成员就自然不言而喻。同时已经拿到投资，数额可观，在此基础上开始讲解了如何去且足以推动整个业务的初期发展，到这里我确实接触到了不少我之前没能接触到的各种环境，且对他的信任，就基本已经奠定我后来加入的格局了。</p>
<p>加入团队后，秉承着我创业的心态一直很有干劲，除了自己分管的一些业务，其他大小事务也有一些参与感，看着产品的不断迭代和上线，我看到了自己努力的结果，心里满足，同时也收获了很多朋友，直到上周五离开，整整5个月了。</p>
<p>那么问题来了，我为何还是选择离开？</p>
<p>事情似乎看着一切进展顺利，产品上线，人员分工合理，但其中的原因并不缺乏，一切可以说只是看起来顺利，可以说常见的创业问题几乎在这个公司都体现出来了，尤其到后来资本市场的寒冬到来，互联网经济受影响，4个月之后出现融资困难，在这时候公司问题更加的突出了。</p>
<p>首先说说产品，因为我是过去做开发的。产品的存在是为了服务公司的业务，开发人员和产品人员每日工作干进度是为了早日将这些服务呈现出来，按照我们的业务形态，产品的主要使用对象是汽车经销商，包括二级和4S在内。当时，产品和技术说现在版本上线了，大家可以推广使用了，却没有啥回应，包括几个带头人，他们对产品的使用好像并不在意，原本该我们的销售人员向对应的经销商开始推广安装使用，却没有一个销售人员相应行动。在团队产品的推进过程中，他们不会关心现在有多少人在使用了，不会关心技术团队的人加班后又做到什么程度了，这只是产品，为什么我单独说产品，因为三个合伙人是有一个专门管产品的，我看到的是他时常悠闲的在购物。</p>
<p>再说说领导的意识和管理，到公司内部的管理也是混乱，涉及到大家过了实习期转正问题的时候，负责人基本不在意，一问就说有事之后再说，一拖就是近10天，我自己倒是干得还可以，也相信负责人，但其中不乏一些刚毕业的学生同事，他们感受到的更多是不幸福，严重降低大家创业积极性，不过这些算是也创业的小问题，在这个创业环境下，我们都可以接受，都可以认为没什么，因为大家在业务兴起的时候，必须各自忙着自己这一块，可能管不了很多。</p>
<p>所以我们来说说，销售业务，这个公司最关键的地方，产品再好，没有业绩没有数据，一切为空。互联网汽车行业，单纯靠互联网的产品哪能，这也许成为前面大家忽视的原因，更多的精力放在了销售业务上，所以从这个角度看过去前面的好像也可以理解。销售团队向各级经销商，通过公司平台进行车源交易，从最初开始，产品技术和销售一起去往同一个地方推广，做销售的事情，活动覆盖了一个省，到现在建立几个省的销售区，规模也是有了。但是到现在，销售的量，汽车的成交量，一直没有突破，一直处于很低的指数，而这同时，最初的投资已经消耗了不少了，直到我离开的时候，销售的业务还是没有起，销售队伍已经快瓦解。公司各个方面的不足导致公司现在人心涣散，那些留下同事的理由唯一就是还有那么些钱可以消耗，可以再观望一阵。后来，到带头人发现有些带不动大家的时候，开始找大家吃饭讲问题，每次一讲都是几个小时。可在又一次的会议上，我们大家一起探讨，说到我们这次离开北京去浙江做到什么程度其实我也不知道，做多久其实我也不知道，最后，他自己也说了一句，要是我们这个没做起来，就换个方向做。我问，什么是换个方向，他说，就是不做这业务了找其他事情做。听到这里的时候，我开始确定我之前的怀疑，看来并不是我自己创业心智不够成熟，是确实这件事情本身存在了我们没能解决的不足。随后，销售团队首先开始离职，技术团队先后离职了，我也就是其中一个。</p>
<p>今天是周一，写了些文字，为了记录一下我这次经历吧，我对整个公司没有什么负面情绪，相反，从领头人到和我工作的同事，大家都对我很照顾，平常也是一起其乐融融的生活，自己也成长进步。倒是这次的经历之后，让我开始反思自己究竟想要做什么，自己适合做什么，写这篇文章不仅是总结，也是分享给其他有兴趣的人看看吧。我给自己mark,让自己以后的路会做到走的更好。</p>
<p>我在咖啡屋里，周围好些人，或看书，或攀谈，抿一口，待会继续投简历。</p>
<blockquote>
<h3 id="后记："><a href="#后记：" class="headerlink" title="后记："></a>后记：</h3></blockquote>
<p>离我当时离开过了一年半了，我走的时候有一位坚持留下的开发同事走了，去了小米，随后也走了一名产品同事，去了高德地图，那位合伙的产品负责人也走了，去了一家互联网家具公司担任负责人。剩下的其他同事招了新人，改了发展路线，目前在慈溪开了三家汽车品牌服务维修店，大概是做汽车销售品牌的。比之前有些进展，但是要走的路还很长。祝他们能更快的取得更好的成果。</p>
<p>离我当时离开过了2年半了，凉了。</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RunLoop是如何跑起来的]]></title>
      <url>/2015/11/05/RunLoop%E6%98%AF%E5%A6%82%E4%BD%95%E8%B7%91%E8%B5%B7%E6%9D%A5%E7%9A%84/</url>
      <content type="html"><![CDATA[<h2 id="一、Run-Loop为何存在"><a href="#一、Run-Loop为何存在" class="headerlink" title="一、Run Loop为何存在?"></a>一、Run Loop为何存在?</h2><p>我们从编写命令式的语句开始理解，一般我们写一个运行函数，只要顺序执行，一遍就过了，比如简单的NSLog一个“hello word”，这样我们就算完成了一个问候世界的程序。好简单的程序，但是一个复杂的系统，一个能称之为系统的程序，比如我们的手机App，它是不可能按照执行顺序一下执行完成就结束的，它包含了我们各类需求，会接受我们不同的操作，所以这个程序需要有一个设计的模式能够符合这样的应用场景，能够响应操作。所以，有了Event驱动的模式。</p>
<p>特点：</p>
<ul>
<li>程序可以一直运行并且接受用户的输入</li>
<li>决定程序应该处理哪些Event</li>
<li>主调方不能被被调方卡主，所以需要调用解耦。主调方就发个消息就完事了，就不管了，就可以去做别的了，被调防根据消息去派发、操作等等。这个概念就是(Message Queue) </li>
<li>节省了CPU时间，比如时间片执行，这就是操作系统里的概念。</li>
<li>没事的时候闲着，有事的时候激活它</li>
</ul>
<h2 id="二、Run-Loop-都包含了什么相关内容？"><a href="#二、Run-Loop-都包含了什么相关内容？" class="headerlink" title="二、Run Loop 都包含了什么相关内容？"></a>二、Run Loop 都包含了什么相关内容？</h2><h3 id="1、CF层和F层"><a href="#1、CF层和F层" class="headerlink" title="1、CF层和F层"></a>1、CF层和F层</h3><p>CF层是C写的，跨平台，F层其实不干事的。GCD 有部分联系。</p>
<p><img src="/assets/images/RL_CF.jpg" alt=""></p>
<h3 id="2、常用"><a href="#2、常用" class="headerlink" title="2、常用"></a>2、常用</h3><p>NSTimer 完全依赖于RunLoop，UIEvent 都是RunLoop 跑的，AutoRelease 面试问题</p>
<p><img src="/assets/images/RL_normal.jpg" alt=""></p>
<h2 id="三、RunLoop调用堆栈"><a href="#三、RunLoop调用堆栈" class="headerlink" title="三、RunLoop调用堆栈"></a>三、RunLoop调用堆栈</h2><p><img src="/assets/images/RL_zhan.jpg" alt=""></p>
<h2 id="四、RunLoop构成元素"><a href="#四、RunLoop构成元素" class="headerlink" title="四、RunLoop构成元素"></a>四、RunLoop构成元素</h2><h3 id="1、构成元素"><a href="#1、构成元素" class="headerlink" title="1、构成元素"></a>1、构成元素</h3><p>thread里面不是只能起一个RL，是可以多个的，但是必须嵌套。<br>RunLoop机制存在的一对多的关系，比如Mode和Timer<br>CFRunLoopSurece、CFRunLoopTimer、CFRunLoopObserver，主要的核心就是这三个。</p>
<p><img src="/assets/images/RL_consist.jpg" alt=""></p>
<h3 id="2、对CFRunLoopTimer的封装"><a href="#2、对CFRunLoopTimer的封装" class="headerlink" title="2、对CFRunLoopTimer的封装"></a>2、对CFRunLoopTimer的封装</h3><p>NSTimer、 performSelector:after 、 displayLink</p>
<h3 id="3、对CFRunLoopSurece的理解"><a href="#3、对CFRunLoopSurece的理解" class="headerlink" title="3、对CFRunLoopSurece的理解"></a>3、对CFRunLoopSurece的理解</h3><p>source是RL的数据源的抽象类，类似proctol，定义了两个version的source：</p>
<ul>
<li>source0：处理APP内部的世界、APP自己管理触发，比如UIEvent、CFSocket</li>
<li>source1: 又RL和内核管理，Mach port 驱动 ，进程兼通讯的方式，往某个进程方法可以发到这个port上，对面的进程监听这个port 就是可以获得消息。比如：CFMachPort，CFMessagePort</li>
</ul>
<p><img src="/assets/images/RL_Source0.jpg" alt=""></p>
<h3 id="4、对CFRunLoopServer对外报告状态"><a href="#4、对CFRunLoopServer对外报告状态" class="headerlink" title="4、对CFRunLoopServer对外报告状态"></a>4、对CFRunLoopServer对外报告状态</h3><p>比如我们在CAAnimation数组，多个动画，RL会通过判断依次的状态，将全部收集到一起后再开始执行。</p>
<p><img src="/assets/images/RL_Observer.jpg" alt=""></p>
<h3 id="5、CFRunLoopMode"><a href="#5、CFRunLoopMode" class="headerlink" title="5、CFRunLoopMode"></a>5、CFRunLoopMode</h3><p>RunLoop在同一时间段内，只能在唯一的特点的mode下Run。<br>更换Mode时，需要停止当前的Loop，然后重启动新的Loop。<br>Mode是个保证IOS滑动顺畅的关键，在这个mode下只执行滑动计算相关<br>可以创建自己的mode</p>
<p>NSDefaultRunLoopMode: 默认的<br>UITrackingRunLoopMode:scrollView滑动<br>UIInitializationRunLoopMode: 启动的时候，私有的<br>NSRunLoopCommomModes: 1和2都能执行，作为一个数组，并无优先级</p>
<blockquote>
<p>相关Topic：</p>
</blockquote>
<ul>
<li><p>NSTimer 默认被加入NSDefaultRunLoopMode中，如果不希望被SCrollView影响，让滑动的时候timer也依然进行运行，就需要添加到NSRunLoopCommomModes中。</p>
</li>
<li><p>RunLoopMode切换<br>都是重新起，不是切换回原来的</p>
</li>
</ul>
<p><img src="/assets/images/RL_Mode_Change.jpg" alt=""></p>
<ul>
<li>GCD和Run Loop的联系</li>
</ul>
<p>GCD的计时器是它自己的计时器，只有main queue的时候有关系。Run Loop 会问一下 GCD 你这边在搞事情吗？有的话就抛出来。</p>
<p><img src="/assets/images/RL_GCD.jpg" alt=""></p>
<ul>
<li>Auto Release<br>UIKit 通过的RunLoopServer在RunLoop两次Sleep间对Autorelease进行Pop和Push将这次Loop中产生的AutoRelease对象释放。两圈之间自动释放UI上自动释放池的东西，比如UITouch。</li>
</ul>
<h3 id="六、RunLoop的挂起和唤醒"><a href="#六、RunLoop的挂起和唤醒" class="headerlink" title="六、RunLoop的挂起和唤醒"></a>六、RunLoop的挂起和唤醒</h3><p>CGRunLoopServiceMachPort 的作用就是发送消息，表示暂停还是激活，与内核进行交互。</p>
<p><img src="/assets/images/RL_Port.jpg" alt=""></p>
<h3 id="七、RunLoop的实践"><a href="#七、RunLoop的实践" class="headerlink" title="七、RunLoop的实践"></a>七、RunLoop的实践</h3><p>1、AFNetworking<br>常驻线程，NSURLConnetion需要一个RL常驻，不然跑一次就没了。<br>比如有个需求需要一直在线程里面呆着。</p>
<pre><code>+ (void)networkRequestThreadEntryPoint:(id)__unused object {
@autoreleasepool {
    [[NSThread currentThread] setName:@&quot;AFNetworking&quot;];

    NSRunLoop *runLoop = [NSRunLoop currentRunLoop];
    [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];
    [runLoop run];
}
}
+ (NSThread *)networkRequestThread {
static NSThread *_networkRequestThread = nil;
static dispatch_once_t oncePredicate;
dispatch_once(&amp;oncePredicate, ^{
    _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];
    [_networkRequestThread start];
});

return _networkRequestThread;
</code></pre><p>}</p>
<p>2、 延迟加载tableview的图片</p>
<pre><code>UIImage *downLoadImage = ...;  
[self.avatarImageView performSelector:@selector(setImage:)  
                    withObject:downloadImage  
                    afterDelay:0  
                    inModes:@[NSDefaultRunLoopMode]];
</code></pre><p>3、让Crash的APP回光返照</p>
<pre><code>// 创建RunLoop
CFRunLoopRef runLoop = CFRunLoopGetCurrent();
// 设置Mode
NSArray *allModes = CFBridgingRelease(CFRunLoopCopyAllModes(runLoop));
// 弹窗告知 程序挂了
UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:@&quot;程序崩溃了&quot; message:@&quot;崩溃信息&quot; delegate:nil cancelButtonTitle:@&quot;取消&quot; otherButtonTitles:nil];
[alertView show];
while (1) {
for (NSString *mode in allModes) {
// 快速的切换 Mode  就能处理滚动、点击等事件
CFRunLoopRunInMode((CFStringRef)mode, 0.001, false);
}
}
</code></pre>]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[FE前端的修炼之道]]></title>
      <url>/2015/10/15/%E5%89%8D%E7%AB%AF%E4%BF%AE%E7%82%BC%E4%B9%8B%E9%81%93/</url>
      <content type="html"><![CDATA[<blockquote>
<p>转移动端开发之前，曾是名呆萌的FE，在学校的时候还算勤劳，上线了大大小小的产品，冰岩作坊见证了我的成长，认识了很多朋友。如今回顾一下，整理一条前端之路。</p>
</blockquote>
<h2 id="知识谱图"><a href="#知识谱图" class="headerlink" title="知识谱图"></a>知识谱图</h2><p><img src="/assets/images/feTotal.png" alt=""></p>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="一、语言"><a href="#一、语言" class="headerlink" title="一、语言"></a>一、语言</h3><h3 id="1、HTML"><a href="#1、HTML" class="headerlink" title="1、HTML"></a>1、HTML</h3><h4 id="1-1-理解"><a href="#1-1-理解" class="headerlink" title="1.1 理解"></a>1.1 理解</h4><ul>
<li><p><code>HyperText Markup Language</code>超文本标记语言。语言自不必说，超文本意味着『将网页彼此连接链接，超越了传统意义上的书本文字』，标记则说明了语言的特点是描述性的。比如可以通过标签来描述内容：<code>&lt;h1&gt;</code>是一个标题(headline)；<code>&lt;p&gt;</code>是一个段落(paragraph)；<code>&lt;code&gt;</code>是一段代码等等。还可以通过声明属性进一步描述如<code>&lt;input class=&quot;form-inline&quot; id=&quot;gender-input-female&quot; type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;female&quot;&gt;</code>。HTML是一门应当注重语义化的语言，尤其在HTML5的规范中更是强调此，如增加了<code>&lt;article&gt;`</code><section>`等标签。</section></p>
</li>
<li><p>标签有自闭和和成对闭合两种，具体规则要参考规范，注意自闭合标签结尾的反斜杠不是必须的。常见的自闭合标签是<code>&lt;img&gt;</code>，<code>&lt;input&gt;</code>。</p>
</li>
<li><p>HTML在被浏览器渲染时，会有两种元素，非替换元素指的是其内容无需被浏览器替换，直接显示即可。而替换原素则需要浏览器进行转换才能正常工作，如<code>&lt;img&gt;&lt;textarea&gt;&lt;canvas&gt;</code></p>
</li>
<li><p>HTML中也可以嵌入如SVG等其他语言内容。</p>
</li>
</ul>
<h3 id="2、CSS"><a href="#2、CSS" class="headerlink" title="2、CSS"></a>2、CSS</h3><h4 id="2-1-理解"><a href="#2-1-理解" class="headerlink" title="2.1 理解"></a>2.1 理解</h4><ul>
<li><code>Cascading Style Sheets</code>层叠样式表。表自不必说，样式也是顾名思义，关键点在于层叠。CSS的层叠体现在选择器的关系上：通过选择器的优先级来决定样式的使用与否，能够灵活的控制HTML元素的样式。</li>
<li>一个普通的『规则』由如下部分组成：选择器+声明块（声明由属性：值组成），此外还有@语句，可用于媒体查询、引入文件等，在此略过。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.class &#123;</span><br><span class="line">    color: rgba(0,0,0,.6);</span><br><span class="line">    transition: height .3s ease-in-out .5s;</span><br><span class="line">    -webkit-tap-highlight-color: transparent;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">.night .class &#123;</span><br><span class="line">    color: black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>由于浏览器纷争以及标准的制定落后于市场，CSS存在着很严重的兼容性问题。具体问题暂且不表，但为了解决这些问题，业界目前普遍使用『预处理器』和『后处理器』来增强CSS。</li>
</ul>
<p>a、 预处理器主要是通过对CSS进行改编或扩展行成一种新的语言，然后通过『预处理器』编译为可被浏览器使用的CSS。常见的就是LESS和SCSS。<br>b、 后处理器是指在生成一个标准的CSS后，进行一些列的优化的工具。如用于自动补充各浏览器前缀的autoprefixer；用于去除冗余css的CSSClean等。大都依赖于PostCSS这个工具。</p>
<h3 id="3、JavaScript"><a href="#3、JavaScript" class="headerlink" title="3、JavaScript"></a>3、JavaScript</h3><h4 id="3-1-理解"><a href="#3-1-理解" class="headerlink" title="3.1 理解"></a>3.1 理解</h4><p>这个没有一个明确的翻译，名字里有Java纯粹是为了蹭热度。广义上的JS由其语言核心+DOM+BOM组成。</p>
<ul>
<li>JavaScript有一个比较简单的出生，但有个比较折腾的成长。目前其标准属于EcmaScript（Flash使用的ActionScript也是这个标准下的产物），现在的版本是第7版，正式名是ES2017，前几天刚定稿，老浏览器都不支持，需要通过bable工具转换为第5版才能让绝大多数浏览器正常执行。</li>
<li>JS是弱类型语言，其基本数据类型有number/boolean/string/undefined/symbol/(null)、引用类型object，包括function和array。基本类型按值访问，引用类型按地址访问。基本数据类型用typeof区分，引用类型需要使用instanceof或其特殊的判断方法区分。</li>
<li>在ES5时代变量作用域仅限于函数内，ES6后通过let能指定块级作用于。var存在变量提升，是个bug隐患点。</li>
<li>ES5时代没有定义class，可以通过function+prototype的方式模拟一个类。JS的继承主要是通过原型链实现的：<code>instance.__proto__.....__proto__ === Class.prototype</code>。</li>
<li>DOM（文档对象模型）描述了处理网页内容的方法和接口。如document.getElementById。</li>
<li>BOM（浏览器对象模型）描述了与浏览器进行交互的方法和接口。如location.href。</li>
<li>通过XMLHttpRequest发送HTTP请求，可以通过指定异步的方式实现AJAX。异步请求存在同源限制。</li>
<li>ES6规范中明确了异步操作的推荐做法即Promise。<br>主要理解两点：异步与事件驱动。两者相互结合构成了现在的JS的运行逻辑。</li>
<li>TypeScript<br>微软推出谷歌力捧的JS超集，实现了强类型、类等诸多C++、Java功能，目前也需要通过编译才能执行，未有浏览器原生支持。</li>
</ul>
<h3 id="二、代码执行环境"><a href="#二、代码执行环境" class="headerlink" title="二、代码执行环境"></a>二、代码执行环境</h3><h3 id="1、浏览器"><a href="#1、浏览器" class="headerlink" title="1、浏览器"></a>1、浏览器</h3><ul>
<li>浏览器的历史不过多介绍，当前PC主流有Chrome和IE/Edge两个，其余的Firefox、safari都很小众。这三类都是独自研制开发。移动端上的主流几乎只有Safari和Chrome两种。</li>
<li>单独谈渲染引擎主流的有Webkit(Blink)、Trident、Gecko。单独谈JS引擎主要有V8、charkra等。</li>
</ul>
<h3 id="2、Node-js"><a href="#2、Node-js" class="headerlink" title="2、Node.js"></a>2、Node.js</h3><p>Node.js®是一个基于Chrome V8 引擎的 JavaScript 运行时。 Node.js 使用高效、轻量级的事件驱动、非阻塞 I/O 模型。Node.js 之生态系统是目前最大的开源包管理系统。</p>
<h3 id="三、代码执行流程"><a href="#三、代码执行流程" class="headerlink" title="三、代码执行流程"></a>三、代码执行流程</h3><h3 id="1、编译"><a href="#1、编译" class="headerlink" title="1、编译"></a>1、编译</h3><p>以现阶段的通常情况来看，我们采用超前的ES6、ES7来写JS，用Less写CSS，用React等来实现View，这些代码通过import/export引用和发布。然后通过webpack、fis等工具『编译』成能被浏览器执行的HTML/JS/CSS。</p>
<h3 id="2、部署："><a href="#2、部署：" class="headerlink" title="2、部署："></a>2、部署：</h3><p>其中HTML如果涉及到与后端数据的直接耦合，则被认为是『模板』，部署到相应的接入层逻辑指定的线上地址，而其他内容如.js/.css/.png/.svg等，则与服务端分离，部署在CDN上以提供更快的访问速度。这个过程主要的问题在于如何控制浏览器缓存（HTTP缓存）。</p>
<h3 id="3、访问："><a href="#3、访问：" class="headerlink" title="3、访问："></a>3、访问：</h3><p>从URL被请求到HTML被返回的逻辑就暂且略去，主要谈HTML返回后的过程。<br>这一部分以真实请求的Performance为例讲解吧。不赘述？？？？后续找几篇文章填补空白。</p>
<h3 id="4、JSBridge-链接跳转"><a href="#4、JSBridge-链接跳转" class="headerlink" title="4、JSBridge(链接跳转)"></a>4、JSBridge(链接跳转)</h3><ul>
<li>JS → Native：发特定规则的url，被native拦下来就好了。</li>
<li>Native → JS：Native可以在JSContext中注入代码，或者通过javascript:xxxx这种方式调用。</li>
</ul>
<h3 id="四、常见的问题与debug"><a href="#四、常见的问题与debug" class="headerlink" title="四、常见的问题与debug"></a>四、常见的问题与debug</h3><h3 id="1、如何获取与定位问题"><a href="#1、如何获取与定位问题" class="headerlink" title="1、如何获取与定位问题"></a>1、如何获取与定位问题</h3><ul>
<li>最好用的工具就是chrome的开发者工具了。<h3 id="2、为什么会白页"><a href="#2、为什么会白页" class="headerlink" title="2、为什么会白页"></a>2、为什么会白页</h3></li>
<li>一种是JS的BUG导致的，一般来说在相同文件内的JS会由于错误阻塞运行。也就是上文有错，下文直接挂。当渲染在下文时就容易出现这种问题。</li>
<li>另一种情况比较少见就是在load事件后调用document.write导致。</li>
</ul>
<h3 id="3、XSS与CSRF"><a href="#3、XSS与CSRF" class="headerlink" title="3、XSS与CSRF"></a>3、XSS与CSRF</h3><ul>
<li>XSS是老生常谈的话题了，主要是由于HTML语言的『保留字』（&lt; &gt; ‘ “ ）被直接使用导致，大部分能够通过HTML转义避免。<br>CSRF现在大都不常见了，基本通过加密token校验来避免。<h3 id="4、性能"><a href="#4、性能" class="headerlink" title="4、性能"></a>4、性能</h3></li>
<li>为何觉得卡，是因为人眼的构造决定的，实际上没有连续的动画，动画都是一帧一帧组成的。如果普通大众能接受60帧，那就意味着对HTML的相应操作要在1000/60m=16ms内执行完毕，才不会掉帧。</li>
<li>还是可以通过chrome的preformance工具来进行定位。</li>
</ul>
<h3 id="五、「框架」新时代"><a href="#五、「框架」新时代" class="headerlink" title="五、「框架」新时代"></a>五、「框架」新时代</h3><ul>
<li>jQurey、Bootstrap：这个时代的特点就是乱，文件瞎引用，样式瞎写，但干起活来就是快，维护体验很差。</li>
<li>backbone：开始有了一些思想，主要是类比了MVC，在前端也搞了全套的M-V-C，强调数据-模板（样式）-逻辑分离。</li>
<li>MVVM：再后来开始分化，一些人觉得C不足以表意，因为其实干来干去都是在操作M和V，不如就叫VM，所以是MVVM。另一些人觉得前端这么简单的事儿不要搞复杂留着V就足够了，也就出现了MVVM的代表Angular，和纯View层的代表React。</li>
<li>Vue.js:渐进式框架,Vue 从根本上采用最小成本、渐进增量的设计。Vue 的核心库只专注于视图层，并且很容易与其他第三方库或现有项目集成。</li>
</ul>
<h3 id="六、新技术"><a href="#六、新技术" class="headerlink" title="六、新技术"></a>六、新技术</h3><ul>
<li>PWA：（ Progressive Web Apps，渐进式网页应用）是由谷歌提出的新一代 Web 应用概念，旨在提供可靠、快速、类似 Native 应用的服务方案。</li>
<li>AMP：谷歌提倡的一些列『最佳实践』，通过实现这些最佳实践，大概率能让你的网站速度飙升。</li>
<li>reactNative、Weex：以虚拟DOM技术为核心，尝试将其用非Web技术渲染执行。</li>
<li>webSocket：在HTTP2出现以前，提供的一个基于TCP的socket应用接口，全双工、可二进制传输是其特点。</li>
<li>WebGL：基于canvas和OpenGL，使得web也能进行大型游戏和渲染场景的制作。</li>
<li>WASM：厉害了，所有能被JS实现的最终都会被JS实现。类似安卓的so。</li>
<li>微信小程序：个人理解是：对现有限制浏览器体验的内容删减，纯数据驱动以限制web能力，缓存模板甚至缓存运行时以提升性能，提供了一个本质还是浏览器的东西。</li>
<li>Electron： 打包一个浏览器，钉钉。</li>
</ul>
<h3 id="七、讨论"><a href="#七、讨论" class="headerlink" title="七、讨论"></a>七、讨论</h3><ul>
<li>对残障人士更友好的网页：这个话题里中国比较远，下一题。</li>
<li>HybridApp：这个题好，其实非核心功能和弱交互功能，完全可以交给web实现。而web主要性能受限的网络则可以通过Hybrid的方式预先集成到App内部，需要时就能立刻提供服务。类似PWA。</li>
<li>参考书籍与站点 ：<br>《JavaScript高级程序设计》、《深入理解ES6》、Google Developer Docs、Mozilla Web Docs</li>
<li>常用工具 ：caniuse 查兼容性的神器、tinypng 压缩图片好工具</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Native与Web通信]]></title>
      <url>/2015/09/10/Native%E4%B8%8EWeb%E9%80%9A%E4%BF%A1/</url>
      <content type="html"><![CDATA[<h2 id="一、Webview方式："><a href="#一、Webview方式：" class="headerlink" title="一、Webview方式："></a>一、Webview方式：</h2><h3 id="1、JS调用Native"><a href="#1、JS调用Native" class="headerlink" title="1、JS调用Native"></a>1、JS调用Native</h3><h3 id="1-1-webview加载流程"><a href="#1-1-webview加载流程" class="headerlink" title="1.1 webview加载流程"></a>1.1 webview加载流程</h3><ul>
<li>发起一个网页请求</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)loadRequest:(NSURLRequest *)request</span><br></pre></td></tr></table></figure>
<ul>
<li>代理回调判断是否加载当前请求</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)webView:(UIWebView *)webView </span><br><span class="line">shouldStartLoadWithRequest:(NSURLRequest *)request </span><br><span class="line">navigationType:(UIWebViewNavigationType)navigationType;</span><br></pre></td></tr></table></figure>
<ul>
<li>开始请求的时机</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)webViewDidStartLoad:(UIWebView *)webView;</span><br></pre></td></tr></table></figure>
<ul>
<li>成功完成加载请求</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView;</span><br></pre></td></tr></table></figure>
<ul>
<li>请求失败</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)webView:(UIWebView *)webView didFailLoadWithError:(NSError *)error;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-URL拦截"><a href="#1-2-URL拦截" class="headerlink" title="1.2 URL拦截"></a>1.2 URL拦截</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)webView:(UIWebView *)webView </span><br><span class="line">shouldStartLoadWithRequest:(NSURLRequest *)request </span><br><span class="line">navigationType:(UIWebViewNavigationType)navigationType</span><br><span class="line">&#123;</span><br><span class="line">   //JS发起的nativePage调用</span><br><span class="line">	if ([request.URL.scheme isEqualToString:@&quot;SchemeName&quot;]) &#123;</span><br><span class="line">       </span><br><span class="line">       //这里是应用内部的schema跳转分发逻辑</span><br><span class="line">       [Router openNewPage:url];</span><br><span class="line">       //返回NO，不打开新网页</span><br><span class="line">       return NO; </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   //JS发起的事件Bridge调用</span><br><span class="line">   if([request.URL.scheme isEqualToString:@&quot;JSBridgeName&quot;])</span><br><span class="line">   &#123;</span><br><span class="line">        //这里是应用内部的JS事件处理逻辑分发</span><br><span class="line">       [JSBridgeManager dealWithAction:url webView:webView];</span><br><span class="line">       //返回NO，不打开新网页</span><br><span class="line">       return NO; </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   return YES;//默认打开请求</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-请求分发"><a href="#1-3-请求分发" class="headerlink" title="1.3 请求分发"></a>1.3 请求分发</h3><p>注意上面的Router，其实也可以用JSBridgeManager事件进行分发，跟进传入的参数来判定即可，这里单独提炼出去，可以更好使得业务功能拆分复用。</p>
<p>拦截下JS的请求后，我们开始构建自己的JSBridgeManager。</p>
<ul>
<li>定义我们执行JS事件的webview为JSWebView，包含对应执行JS的方法</li>
<li>和前端约定一个固定接口，当前webview执行JS事件的时候，暴露一个方法给Native，Native调用来获取执行事件的时候所需要的额外信息，此处定义为”JSBridgeManager._fetchInfo()”</li>
<li>获取完返回的信息后执行解析为一个数组，数组里面每一个对象都是一个可执行的命令体，通过转化我们定义命令体对象JSCommand</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//消息类型</span><br><span class="line">@property(nonatomic, copy) NSString *messageType;</span><br><span class="line">//事件ID</span><br><span class="line">@property(nonatomic, copy) NSString *eventID;</span><br><span class="line">//回调ID</span><br><span class="line">@property(nonatomic, copy) NSString *callbackID;</span><br><span class="line">//消息参数</span><br><span class="line">@property(nonatomic, copy) NSDictionary *params;</span><br><span class="line">//前端传过来的方法名</span><br><span class="line">@property(nonatomic, copy) NSString *fullName;</span><br><span class="line">//方法名</span><br><span class="line">@property(nonatomic, copy) NSString *methodName;</span><br></pre></td></tr></table></figure>
<ul>
<li>定义一个JSForwardManager对象,专门用于转发命令，根据native的本地协定好的方法名和格式，动态消息转发。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)dealWithAction:(NSURLRequest *)request withWebView:(JSWebView *)webView &#123;</span><br><span class="line">    NSURL *url = request.URL;</span><br><span class="line">    </span><br><span class="line">    if (![webView respondsToSelector:@selector(ttr_evaluateJavaScript:completionHandler:)]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    [webView evaluateJavaScript:@&quot;;window.JSBridgeManager &amp;&amp; JSBridgeManager._fetchInfo();&quot; completionHandler:^(id result, NSError *error) &#123;</span><br><span class="line">        NSArray *messagesData = [result JSONValue];</span><br><span class="line">        for(NSDictionary *messageData in messagesData) &#123;</span><br><span class="line">            JSCommand *command = [[JSCommand alloc] initWithDictonary:messageData];</span><br><span class="line">            [[JSForwardManager sharedInstance] forwardJSBWithCommand:command engine:webView completion:^(TTRJSBMsg msg, NSDictionary *response) &#123;</span><br><span class="line">                [self invokeJSBCallbackWithCommand:command msg:msg data:response webView:webView];</span><br><span class="line">            &#125;];;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>处理传入进来的命令，根据JSCommand查找本地规则对应的JSPlugin，JSPlugin则是各个JS事件对应调用的实际Native对象，该对象由业务方自己实习，继承自JSPlugin，最后通过NSInvocation直接调用对应的方法。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)forwardDynamicPluginWithCommand:(JSCommand *)command engine:(id&lt;JSEngine&gt;)engine completion:(JSResponse)completion &#123;</span><br><span class="line">    </span><br><span class="line">    NSString *selectorStr = [command.methodName stringByAppendingString:@&quot;WithParam:callback:webView:controller:&quot;];</span><br><span class="line">    SEL selector = NSSelectorFromString(selectorStr);</span><br><span class="line">    </span><br><span class="line">    JSPlugin *plugin = [self _generatePluginWithCommand:command engine:engine];</span><br><span class="line">    if (![plugin respondsToSelector:selector]) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSMethodSignature *signature = [plugin methodSignatureForSelector:selector];</span><br><span class="line">    NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:signature];</span><br><span class="line">    invocation.target = plugin;</span><br><span class="line">    invocation.selector = selector;</span><br><span class="line">    </span><br><span class="line">    NSDictionary *params = command.params;</span><br><span class="line">    [invocation setArgument:&amp;params atIndex:2];</span><br><span class="line">    [invocation setArgument:&amp;completion atIndex:3];</span><br><span class="line">    [invocation setArgument:&amp;engine atIndex:4];</span><br><span class="line">    UIViewController *source = engine.ttr_sourceController;</span><br><span class="line">    [invocation setArgument:&amp;source atIndex:5];</span><br><span class="line">    </span><br><span class="line">    [invocation invoke];</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注意此处的completion回调，会返回去执行原来传进来的block，这里的JSResponse类都由本地实现和定义，最后在原webview里面执行脚本JS方法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[self invokeJSBCallbackWithCommand:command msg:msg data:response webView:webView];</span><br><span class="line"></span><br><span class="line">[self evaluateJavaScriptFromString:javaScriptString completionBlock:completionHandler];</span><br></pre></td></tr></table></figure>
<h3 id="2、Native调用JS"><a href="#2、Native调用JS" class="headerlink" title="2、Native调用JS"></a>2、Native调用JS</h3><p>与上述最后一步回调一样，实际就是webview的一个执行JS的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nullable NSString *)stringByEvaluatingJavaScriptFromString:(NSString *)script;</span><br></pre></td></tr></table></figure>
<h2 id="二-基于JavaScriptCore"><a href="#二-基于JavaScriptCore" class="headerlink" title="二. 基于JavaScriptCore"></a>二. 基于JavaScriptCore</h2><h3 id="1、JS调用Native-1"><a href="#1、JS调用Native-1" class="headerlink" title="1、JS调用Native"></a>1、JS调用Native</h3><h3 id="1-1-获取当前JS环境"><a href="#1-1-获取当前JS环境" class="headerlink" title="1.1 获取当前JS环境"></a>1.1 获取当前JS环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.JSContext = [self.baseWebView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];</span><br></pre></td></tr></table></figure>
<h3 id="1-2-在Native定义JS环境对象"><a href="#1-2-在Native定义JS环境对象" class="headerlink" title="1.2 在Native定义JS环境对象"></a>1.2 在Native定义JS环境对象</h3><p>利用JSExport接口定义一套自己的业务接口协议，实现此协议的对象，可以放入JSContext环境中直接作为同名的JS方法调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;JavaScriptCore/JavaScriptCore.h&gt;</span><br><span class="line">@protocol BaseWebObjProctol &lt;JSExport&gt;</span><br><span class="line"></span><br><span class="line">//网页打开本地</span><br><span class="line">- (void)openNativePage:(id)param;</span><br><span class="line"></span><br><span class="line">//登录</span><br><span class="line">- (void)login;</span><br><span class="line"></span><br><span class="line">//调用分享接口</span><br><span class="line">- (void)shareToOthers;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface BaseWebObj : NSObject&lt;BaseWebObjProctol&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic,strong) BaseWebVC *webVC;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<h3 id="1-3-注入JS对象"><a href="#1-3-注入JS对象" class="headerlink" title="1.3 注入JS对象"></a>1.3 注入JS对象</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView</span><br><span class="line">&#123;</span><br><span class="line">    //初始化</span><br><span class="line">    BaseWebObj *webObj = [[BaseWebObj alloc] init];</span><br><span class="line">    webObj.webVC = self;</span><br><span class="line">    self.JSContext[@&quot;nativeApp&quot;] = webObj;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-JS调用示例"><a href="#1-4-JS调用示例" class="headerlink" title="1.4 JS调用示例"></a>1.4 JS调用示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.nativeApp.openUrlPage(dictionary)</span><br></pre></td></tr></table></figure>
<h3 id="2、Native调用JS-1"><a href="#2、Native调用JS-1" class="headerlink" title="2、Native调用JS"></a>2、Native调用JS</h3><p>与上述最后一步回调一样，实际就是webview的一个执行JS的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@interface JSContext : NSObject</span><br><span class="line">- (JSValue *)evaluateScript:(NSString *)script;</span><br></pre></td></tr></table></figure>
<h2 id="三、调试"><a href="#三、调试" class="headerlink" title="三、调试"></a>三、调试</h2><ul>
<li>手机: 设置-&gt;Safari-&gt;高级-&gt;打开web检查器</li>
<li>Safari: Safari-&gt;首选项-&gt;高级-&gt;打开 ‘在菜单中显示开发’ 选项</li>
<li>调试流程:Safari-&gt;开发-&gt;找到需要调试的设备-&gt;找到需要调试的页面</li>
<li>BTW: 可用于检测WebView实例的内存泄露</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iOS多线程]]></title>
      <url>/2015/06/27/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><h5 id="1、进程与线程"><a href="#1、进程与线程" class="headerlink" title="1、进程与线程"></a>1、进程与线程</h5><ul>
<li>进程</li>
</ul>
<p>进程是资源分配的基本单位，它是程序执行时的一个实例。程序运行时系统就会创建一个进程，并为它分配资源，然后把该进程放入进程就绪队列，进程调度器选中它的时候就会为它分配CPU时间，程序开始真正运行。多个进程之间不存在相互影响。</p>
<ul>
<li>线程</li>
</ul>
<p>线程是程序执行时的最小单位，它是进程的一个执行流，是CPU调度和分派的基本单位，一个进程可以由很多个线程组成，线程间共享进程的所有资源，所以相互通信更方便。每个线程有自己的堆栈和局部变量，但是没有自己的地址空间。一个线程低调则进程也死掉。线程由CPU独立调度执行，在多CPU环境下就允许多个线程同时运行。</p>
<h5 id="2、iOS中的几种线程"><a href="#2、iOS中的几种线程" class="headerlink" title="2、iOS中的几种线程"></a>2、iOS中的几种线程</h5><p><img src="/assets/images/thread.png" alt=""></p>
<h3 id="二、NSThread"><a href="#二、NSThread" class="headerlink" title="二、NSThread"></a>二、NSThread</h3><p>NSThread是苹果对线程的封装，完全是面向对象的，你可以直接操作线程本身，创建和获得一个线程非常方便，但是线程的生命周期需要手动管理，在实现多线程的时候不太方便，所以我们使用的场景偏向于基础调用和读取较多一些。场景如下：</p>
<h5 id="1、读取线程信息"><a href="#1、读取线程信息" class="headerlink" title="1、读取线程信息"></a>1、读取线程信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//主线程</span><br><span class="line">[NSThread mainThread]；</span><br><span class="line">[NSThread isMainThread];</span><br><span class="line"></span><br><span class="line">//当前线程</span><br><span class="line">[NSThread currentThread];</span><br><span class="line"></span><br><span class="line">//是否多线程</span><br><span class="line">[NSThread isMultiThreaded];</span><br><span class="line"></span><br><span class="line">//实例线程状态</span><br><span class="line">thread.isExecuting;</span><br><span class="line">thread.isCancelled;</span><br><span class="line">thread.isFinished;</span><br></pre></td></tr></table></figure>
<h5 id="2、阻塞一个线程"><a href="#2、阻塞一个线程" class="headerlink" title="2、阻塞一个线程"></a>2、阻塞一个线程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//休眠到指定时间</span><br><span class="line">[NSThread sleepUntilDate:[NSDate date]];</span><br><span class="line">//休眠指定时长</span><br><span class="line">[NSThread sleepForTimeInterval:4.5];</span><br></pre></td></tr></table></figure>
<h5 id="3、退出和取消线程"><a href="#3、退出和取消线程" class="headerlink" title="3、退出和取消线程"></a>3、退出和取消线程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[NSThread exit];</span><br><span class="line"></span><br><span class="line">//实例</span><br><span class="line">thread.cancel</span><br></pre></td></tr></table></figure>
<h5 id="4、在某个线程上执行方法，也属于线程通信"><a href="#4、在某个线程上执行方法，也属于线程通信" class="headerlink" title="4、在某个线程上执行方法，也属于线程通信"></a>4、在某个线程上执行方法，也属于线程通信</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//主线程执行</span><br><span class="line">- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;</span><br><span class="line"></span><br><span class="line">//后台线程执行</span><br><span class="line">- (void)performSelectorInBackground:(SEL)aSelector withObject:(nullable id)arg；</span><br><span class="line"></span><br><span class="line">//某一个子线程执行</span><br><span class="line">- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait；</span><br></pre></td></tr></table></figure>
<h3 id="三、GCD"><a href="#三、GCD" class="headerlink" title="三、GCD"></a>三、GCD</h3><p>GCD是苹果提出的多核运行方案伟大的中央调度系统，基于C语言用来替代NSThread。自动管理线程的生命周期，包括创建销毁和执行，以Block的形式接口，功能强大且方便灵活，现实开发中基本涵盖全部场景,包含几个基本概念。</p>
<p>block任务：你的操作，也即是Block中那段代码。</p>
<p>queue队列：用于存放任务并等待执行的栈容器。</p>
<p>sync同步：只在当前线程中执行。</p>
<p>async异步：可以开启新的线程。</p>
<p>concurrent并发：多个任务同时执行。</p>
<p>serial串行：一个任务执行完毕再执行下一个。</p>
<h5 id="1、创建队列"><a href="#1、创建队列" class="headerlink" title="1、创建队列"></a>1、创建队列</h5><ul>
<li>主队列是特殊的串行队列，UI相关的操作只能放主队列</li>
<li>自己创建的队列可以是串行的也可以是并行的队列</li>
<li>全局队列是系统提供的一个全局的并发队列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//主队列UI</span><br><span class="line">dispatch_queue_t queue = dispatch_get_main_queue();</span><br><span class="line"></span><br><span class="line">//自己创建队列</span><br><span class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;tk.bourne.testQueue&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">dispatch_queue_t queue = dispatch_queue_create(&quot;tk.bourne.testQueue&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">//全局并发队列</span><br><span class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br></pre></td></tr></table></figure>
<h5 id="2、创建任务"><a href="#2、创建任务" class="headerlink" title="2、创建任务"></a>2、创建任务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//异步任务，新起一个线程，等这个队列什么时候安排Block</span><br><span class="line">dispatch_async(dispatch_queue_t queue, DISPATCH_NOESCAPE dispatch_block_t block);</span><br><span class="line"></span><br><span class="line">//同步任务，等这个队列什么时候安排Block</span><br><span class="line">dispatch_sync(dispatch_queue_t queue, DISPATCH_NOESCAPE dispatch_block_t block);</span><br></pre></td></tr></table></figure>
<ul>
<li>两个阻塞案例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//只会打印1，因为sync阻塞了主线程</span><br><span class="line">NSLog(&quot;1 - %@&quot;, NSThread.currentThread())</span><br><span class="line">dispatch_sync(dispatch_get_main_queue(), &#123; () -&gt; Void in </span><br><span class="line">        NSLog(&quot;2 - %@&quot;, NSThread.currentThread())</span><br><span class="line">&#125;)</span><br><span class="line">NSLog(&quot;3 - %@&quot;, NSThread.currentThread())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//只会打印1，因为sync阻塞了自己创建的线程queue</span><br><span class="line">dispatch_async(queue, &#123; () -&gt; Void in</span><br><span class="line">    NSLog(&quot;1 - %@&quot;, NSThread.currentThread())</span><br><span class="line">    dispatch_sync(queue, &#123; () -&gt; Void in</span><br><span class="line">         NSLog(&quot;2 - %@&quot;, NSThread.currentThread())</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">NSLog(&quot;3 - %@&quot;, NSThread.currentThread())</span><br></pre></td></tr></table></figure>
<h5 id="3、其他用法"><a href="#3、其他用法" class="headerlink" title="3、其他用法"></a>3、其他用法</h5><ul>
<li>延时执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_after(dispatch_time_t when,dispatch_queue_t queue,dispatch_block_t block);</span><br></pre></td></tr></table></figure>
<ul>
<li>一次执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static dispatch_once_t onceToken;</span><br><span class="line">dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">    // 只执行1次的代码(这里面默认是线程安全的)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>组合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//其实是和队列进行绑定，最后都完成之后会发出一个notify</span><br><span class="line">dispatch_queue_t disqueue =  dispatch_queue_create(&quot;com.shidaiyinuo.NetWorkStudy&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">dispatch_group_t disgroup = dispatch_group_create();</span><br><span class="line">dispatch_group_async(disgroup, disqueue, ^&#123;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;任务一完成&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">dispatch_group_async(disgroup, disqueue, ^&#123;</span><br><span class="line">    </span><br><span class="line">    sleep(8);</span><br><span class="line">    NSLog(@&quot;任务二完成&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">    </span><br><span class="line">dispatch_group_notify(disgroup, disqueue, ^&#123;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;dispatch_group_notify 执行&quot;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>信号</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_t  signal = dispatch_semaphore_create(1);</span><br><span class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</span><br><span class="line">        sleep(1);</span><br><span class="line">        x = dispatch_semaphore_signal(signal);</span><br><span class="line">    &#125;);</span><br><span class="line">x = dispatch_semaphore_wait(signal, DISPATCH_TIME_FOREVER);</span><br></pre></td></tr></table></figure>
<h3 id="四、NSOperation"><a href="#四、NSOperation" class="headerlink" title="四、NSOperation"></a>四、NSOperation</h3><p>NSOperation是苹果对GCD的封装，也是面向对象的，实现了一些GCD不好实现的功能。NSOperation是基类不能添加任务，需要再子类NSInvocationOperation和NSBlockOperation中实现，可以配合NSOperationQueue使用，分别对应GCD里面的任务和队列。</p>
<h5 id="1、执行任务"><a href="#1、执行任务" class="headerlink" title="1、执行任务"></a>1、执行任务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//start方法，直接在当前线程执行</span><br><span class="line"></span><br><span class="line">//NSInvocationOperation</span><br><span class="line">NSOperation *op = [[NSInvocationOperation alloc]initWithTarget:self </span><br><span class="line">selector:@selector(downloadImage:) object:@&quot;Invocation&quot;];</span><br><span class="line">[op start];</span><br><span class="line"></span><br><span class="line">//NSBlockOperation同理</span><br></pre></td></tr></table></figure>
<h5 id="2、进入队列"><a href="#2、进入队列" class="headerlink" title="2、进入队列"></a>2、进入队列</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NSOperationQueue *q = [[NSOperationQueue alloc]init];</span><br><span class="line">[q addOperationWithBlock:^&#123;</span><br><span class="line">  NSLog(@&quot;%@------%d&quot;,[NSThread currentThread],i);</span><br><span class="line">&#125;];</span><br><span class="line">[q start];</span><br></pre></td></tr></table></figure>
<h5 id="3、其他用法-1"><a href="#3、其他用法-1" class="headerlink" title="3、其他用法"></a>3、其他用法</h5><ul>
<li>创建依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">NSBlockOperation *operation1 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">NSBlockOperation *operation2 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">NSBlockOperation *operation3 = [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line">[operation2 addDependency:operation1]; </span><br><span class="line">[operation3 addDependency:operation2]; </span><br><span class="line"></span><br><span class="line">NSOperationQueue *queue = [[NSOperationQueue alloc] init];</span><br><span class="line">[queue addOperations:@[operation3, operation2, operation1] waitUntilFinished:NO];</span><br></pre></td></tr></table></figure>
<ul>
<li>属性设置与操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//最大线程数量</span><br><span class="line">NSInteger maxConcurrentOperationCount</span><br><span class="line"></span><br><span class="line">//获取队列的任务数</span><br><span class="line">NSUInteger operationCount; </span><br><span class="line"></span><br><span class="line">//取消队列中所有的任务</span><br><span class="line">- (void)cancelAllOperations; </span><br><span class="line"></span><br><span class="line">//阻塞当前线程直到此队列中的所有任务执行完毕</span><br><span class="line">- (void)waitUntilAllOperationsAreFinished; </span><br><span class="line"></span><br><span class="line">// 暂停与继续</span><br><span class="line">[queue setSuspended:YES]; </span><br><span class="line">[queue setSuspended:NO];</span><br></pre></td></tr></table></figure>
<h3 id="五、pthread"><a href="#五、pthread" class="headerlink" title="五、pthread"></a>五、pthread</h3><p>pthread，是线程的POSIX标准。该标准定义了创建和操纵线程的一整套API。在类Unix操作系统（Unix、Linux、Mac OS X等）中，都使用Pthreads作为操作系统的线程。移植性很强，当然在 iOS 中也是可以的。使用C语言函数，所有线程的管理都需要手动处理，简单看下使用方式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//在线程上执行一个funcName函数方法</span><br><span class="line">pthread_t thread;</span><br><span class="line">//创建一个线程并自动执行</span><br><span class="line">pthread_create(&amp;thread, NULL, funcName, NULL);</span><br></pre></td></tr></table></figure>
<h3 id="六、小结"><a href="#六、小结" class="headerlink" title="六、小结"></a>六、小结</h3><ul>
<li>NSThread使用简单，自己管理生命周期。</li>
<li>GCD有任务和队列，做到了NSOperation不能的：一次性执行、延迟执行、调度组</li>
<li>NSOperation有任务和队列，做到了GCD不能的：最大并发数、暂停和继续、取消、依赖关系</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[锁机制]]></title>
      <url>/2015/04/10/%E9%94%81%E6%9C%BA%E5%88%B6/</url>
      <content type="html"></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[自动布局 Masonry]]></title>
      <url>/2015/03/22/%E8%87%AA%E5%8A%A8%E5%B8%83%E5%B1%80%20Masonry/</url>
      <content type="html"><![CDATA[<h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>苹果出了新机型后需要进行适配，同时也给开发者提供了一套自动布局方案NSLayoutConstraint,不仅可以代码中实现约束，还可以在Xib上实现直接的约束。不过说实在的，因为它那冗长而又丑爆的语法，写一个约束要写那么多行，几个视图下来的代码结构比较难看，因此我是拒绝使用的，好在Masonry对它进行了友好封装，所以我才没有放弃对它更上一层的使用。</p>
<h3 id="二、Masonry"><a href="#二、Masonry" class="headerlink" title="二、Masonry"></a>二、Masonry</h3><h3 id="1、常规用法"><a href="#1、常规用法" class="headerlink" title="1、常规用法"></a>1、常规用法</h3><p>比如我们要写一个视图，他距离父视图的上边77pt,距离左边4pt,超出右边10pt,距离下边20pt,使用如下写法比系统自带的语法简洁很多，由于masonry的链式语法使你能够连续调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UIView *view = [[UIView alloc]init];</span><br><span class="line">    </span><br><span class="line">[self.view addSubview:view];</span><br><span class="line">    </span><br><span class="line">[view1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.top.equalTo(self.view.mas_top).with.offset(77);</span><br><span class="line">        make.left.equalTo(self.view.mas_left).with.offset(4);</span><br><span class="line">        make.bottom.equalTo(self.view.mas_bottom).with.offset(-10);</span><br><span class="line">        make.right.equalTo(self.view.mas_right).with.offset(20);</span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>
<h3 id="2、链式语法"><a href="#2、链式语法" class="headerlink" title="2、链式语法"></a>2、链式语法</h3><p>接下来我们分析下，是如何在OC的语法中实现链式调用的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *))block &#123;</span><br><span class="line">    self.translatesAutoresizingMaskIntoConstraints = NO;</span><br><span class="line">    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];</span><br><span class="line">    block(constraintMaker);</span><br><span class="line">    return [constraintMaker install];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先第一个方法可以看到，我们将block实现，但是在方法内部就直接执行了block,其实就相当于调用了一次，进来先关闭了视图的系统默认约束，然后创建了一个MASConstraintMaker并将它传回，这样我们才能在block内部进行约束赋值。用于方法属于view的一个category分类，所以此处就将MASConstraintMaker与View进行了绑定。我看接着看.top方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (MASConstraint *)top &#123;</span><br><span class="line">    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeTop];</span><br><span class="line">&#125;</span><br><span class="line">- (MASConstraint *)addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</span><br><span class="line">    return [self constraint:nil addConstraintWithLayoutAttribute:layoutAttribute];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (MASConstraint *)constraint:(MASConstraint *)constraint addConstraintWithLayoutAttribute:(NSLayoutAttribute)layoutAttribute &#123;</span><br><span class="line">    MASViewAttribute *viewAttribute = [[MASViewAttribute alloc] initWithView:self.view layoutAttribute:layoutAttribute];</span><br><span class="line">    MASViewConstraint *newConstraint = [[MASViewConstraint alloc] initWithFirstViewAttribute:viewAttribute];</span><br><span class="line">    if ([constraint isKindOfClass:MASViewConstraint.class]) &#123;</span><br><span class="line">        //replace with composite constraint</span><br><span class="line">        NSArray *children = @[constraint, newConstraint];</span><br><span class="line">        MASCompositeConstraint *compositeConstraint = [[MASCompositeConstraint alloc] initWithChildren:children];</span><br><span class="line">        compositeConstraint.delegate = self;</span><br><span class="line">        [self constraint:constraint shouldBeReplacedWithConstraint:compositeConstraint];</span><br><span class="line">        return compositeConstraint;</span><br><span class="line">    &#125;</span><br><span class="line">    if (!constraint) &#123;</span><br><span class="line">        newConstraint.delegate = self;</span><br><span class="line">        [self.constraints addObject:newConstraint];</span><br><span class="line">    &#125;</span><br><span class="line">    return newConstraint;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到在赋值到最后的返回值是依旧是一个MASViewConstraint对象，所以top和left、right、bottom是一样的使用。我们再来看equal_To和with以及offset</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (MASConstraint * (^)(id))equalTo &#123;</span><br><span class="line">    return ^id(id attribute) &#123;</span><br><span class="line">        return self.equalToWithRelation(attribute, NSLayoutRelationEqual);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (MASConstraint *)with &#123;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (MASConstraint * (^)(CGFloat))offset &#123;</span><br><span class="line">    return ^id(CGFloat offset)&#123;</span><br><span class="line">        self.offset = offset;</span><br><span class="line">        return self;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到block的参数是需要赋的值，返回值则是可以进行下一轮赋值的MASConstraint，而这个block作为参数的时候,这个block是由外部来实现,内部调用的，当block作为返回值的时候,这个block是由内部来实现,外部调用的。通过将block作为参数和返回值，从而就实现了链式调用的语法。</p>
<p>3、使用注意</p>
<ul>
<li>约束视图对象只有在被addSubview之后，才能给视图添加约束</li>
<li>动画的使用是在更新约束之后调用</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[view.superview layoutIfNeeded];//强制绘制</span><br></pre></td></tr></table></figure>
<ul>
<li>masony由于是对系统api的封装，在视图数量较多和列表复用的使用会有性能问题</li>
<li>masonry和其他frame约束同时使用会有不可控问题发生</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[App的多语言国际化]]></title>
      <url>/2015/02/05/App%E7%9A%84%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%9B%BD%E9%99%85%E5%8C%96/</url>
      <content type="html"><![CDATA[<p>开发应用的时候遇到国际化业务，我们都会针对同一个App进行国际化适配，也就是语言本地化，不同地区的人打开应用会显示对应地区的语言和该有的图案。接下来从app名称、应用内字符串和图片三个方面来使用一下。</p>
<h3 id="一、选择多种语言进行配置"><a href="#一、选择多种语言进行配置" class="headerlink" title="一、选择多种语言进行配置"></a>一、选择多种语言进行配置</h3><ul>
<li>新建一个demo工程</li>
<li>选中project-&gt;Info-&gt;Localizations，然后点击”+”，添加需要国际化/本地化的语言，如下图（默认需要勾选Use Base Internationalization）</li>
<li>这里我们添加英语、汉语和简体中文，如下图:</li>
</ul>
<p><img src="/assets/images/localization/1.png" alt=""></p>
<h3 id="二、应用名称多语言化"><a href="#二、应用名称多语言化" class="headerlink" title="二、应用名称多语言化"></a>二、应用名称多语言化</h3><p>新建一个strings文件，名为infoPlist.strings，必须为infoPlist的名称，然后选中高亮这个文件，在xcode右边会出现Localization的选择，选中我们要进行国际化的三个语言，你会发现info.strings自动多出三个文件分别对应三个语言，如下图:</p>
<p><img src="/assets/images/localization/2.png" alt=""></p>
<p>我们分别在对应的文件里面，对应的设置应用名称如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CFBundleDisplayName = &quot;AppName&quot;;</span><br><span class="line">CFBundleDisplayName = &quot;앱 명칭&quot;;</span><br><span class="line">CFBundleDisplayName = &quot;应用名称&quot;;</span><br></pre></td></tr></table></figure>
<p>将模拟器切换成韩语的环境，我们可以看到应用名称已经更改，其他语言也是如此</p>
<p><img src="/assets/images/localization/3.png" alt=""></p>
<h3 id="三、页面内字符串多语言化"><a href="#三、页面内字符串多语言化" class="headerlink" title="三、页面内字符串多语言化"></a>三、页面内字符串多语言化</h3><p>对于页面内的任意字符而言，与上述较为接近。新建一个strings文件，名为Localizable.strings，必须为Localizable的名称，然后选中高亮这个文件，在xcode右边会出现Localization的选择，选中我们要进行国际化的三个语言，你会发现Localizable.strings自动多出三个文件分别对应三个语言。</p>
<p>Localizable的名字是为了和系统的方法进行关联，我们只需要使用Foundation框架自带的NSLocalizedString(key, comment)这个宏根据Key获取对应的字符串，然后赋值给代码中的字符串。</p>
<p>在对应的文件里面，对应的设置应用名称如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;home&quot; = &quot;home&quot;;</span><br><span class="line">&quot;home&quot; = &quot;명칭&quot;;</span><br><span class="line">&quot;home&quot; = &quot;首页&quot;;</span><br></pre></td></tr></table></figure>
<p>然后在ViewController里面进行设置，统一设置为home字符串，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">UILabel *a = [[UILabel alloc] init];</span><br><span class="line">a.text = NSLocalizedString(@&quot;home&quot;,nil);</span><br><span class="line">a.textColor = [UIColor blackColor];</span><br><span class="line">[a sizeToFit];</span><br><span class="line">[self.view addSubview:a];</span><br></pre></td></tr></table></figure>
<p>然后我们调整为韩文环境，在模拟器中可以看到显示如下：</p>
<p><img src="/assets/images/localization/4.png" alt=""></p>
<p>另外，如果的strings文件想要换个名字，比如多个人在协作开发的时候，要利用到别人的文件，这个时候，可以使用系统的NSLocalizedStringFromTable方法，调用是一样的，多一个参数用于传递别人的文件名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">UILabel *a = [[UILabel alloc] init];</span><br><span class="line">a.text = NSLocalizedStringFromTable(@&quot;home&quot;,&quot;别人的文件名称&quot;,nil);</span><br><span class="line">a.textColor = [UIColor blackColor];</span><br><span class="line">[a sizeToFit];</span><br><span class="line">[self.view addSubview:a];</span><br></pre></td></tr></table></figure>
<h3 id="四、图片的多语言化"><a href="#四、图片的多语言化" class="headerlink" title="四、图片的多语言化"></a>四、图片的多语言化</h3><ul>
<li>不同语言环境下不同名称</li>
</ul>
<p>上述我们已经实现字符串的多语言，因为有imageNamed方法的存在，所以我们可以单独新建一份strings文件用于保存图片名称，这样在不同环境下会自动根据图片名称替换即可。</p>
<ul>
<li>不同语言环境下相同名称</li>
</ul>
<p>我们拖入一个图片到工程里，然后选中图片，在右边进行localization，选中多个语言环境如下</p>
<p><img src="/assets/images/localization/5.png" alt=""></p>
<p>然后我们选中图片show in finder进入文件夹，会发现自动生成了对应语言的文件夹，里面有相同名称的图片，这个时候我们对应替换文件就行了，名称依旧保持一致</p>
<p><img src="/assets/images/localization/6.png" alt=""></p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[事件的传递与响应]]></title>
      <url>/2014/12/23/%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BC%A0%E9%80%92%E4%B8%8E%E5%93%8D%E5%BA%94/</url>
      <content type="html"><![CDATA[<p>零散的看了一些博客介绍关于事件的响应，大概意思都是父和子的传递和查找，有的把事件传递和响应混在了一块，这里我自己学习拿一个手对屏幕的触摸例子来写一下。</p>
<h3 id="一、应用的层级"><a href="#一、应用的层级" class="headerlink" title="一、应用的层级"></a>一、应用的层级</h3><p>我们新建一个demo工程，定义一个基础ViewConrtoller，里面包含一个wapperView，wapperview里面有本来blackView和blueView，然后blueView里面有一个UIButton。命名分别为对应的类名，结构如图：</p>
<p><img src="/assets/images/eventView.png" alt=""></p>
<p>我们重写一下UIbutton的touchBegin事件如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</span><br><span class="line">&#123;</span><br><span class="line">    UIResponder * next = self;</span><br><span class="line"> </span><br><span class="line">    while (next != nil) &#123;</span><br><span class="line">       NSLog(NSStringFromClass([next class]));</span><br><span class="line">       next = [next nextResponder];</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过打印我们得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UIButton</span><br><span class="line">blueView</span><br><span class="line">wrapperView</span><br><span class="line">ViewController</span><br><span class="line">UIWindow</span><br><span class="line">UIApplication</span><br><span class="line">AppDelegate</span><br></pre></td></tr></table></figure>
<p>所以我们基本可以理解到，一个应用的层级结构从外到内为<br>AppDelegate -&gt; UIApplication -&gt; UIWindow -&gt; UIViewController -&gt; UIView,通常我们操作的级别都是VC以及其内部子视图。</p>
<h3 id="二、事件传递"><a href="#二、事件传递" class="headerlink" title="二、事件传递"></a>二、事件传递</h3><p>1、 当一个屏幕上的触摸时间发生后，系统会自动将该时间加入一个UIApplication管理的事件队列中。</p>
<p>2、UIApplication会将最前的事件取出发送给应用的Keywindow,所以这就决定了事件的传递过程是从上到下，从外到内的。</p>
<p>3、如何从上到下寻找一个合适的View?</p>
<p>我们可以看到UIView类是存在两个方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;   // recursively calls -pointInside:withEvent:. point is in the receiver&apos;s coordinate system</span><br><span class="line"></span><br><span class="line">- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event;</span><br></pre></td></tr></table></figure>
<p>只要事件传递到当前的的控件就会调用hitTest:withEvent:的方法，返回一个合适的View。事件从父级向下传递，不管子控件是不是最合适的view，系统默认都要先把事件传递给子控件，经过子控件调用自己的hitTest:withEvent:方法验证后才知道有没有更合适的view。如果确定最终父控件是最合适的view，那么该父控件的子控件的hitTest:withEvent:方法也是会被调用的。而pointInside方法会同时返回该点是否在控件身上。</p>
<h3 id="三、事件响应"><a href="#三、事件响应" class="headerlink" title="三、事件响应"></a>三、事件响应</h3><p>找到合适的View之后，就需要开始响应操作。一般默认做法是控件将事件顺着响应者链条向上传递，将事件交给上一个响应者进行处理，也就是找到合适的视图后就从当前寻找touch方法，如果没有就继续往父视图传递。如果某一个控件重写了touch方法，那么调用就在这个控件这里结束，没有重写的都会继续向上传递。</p>
<p>在demo这个案例里，在UIbutton重写了Touch事件所以在这里调用，如果button里面没写就会在blueView里面寻找，如果没有则继续往上走。直到上面我们获得的层级最后一层AppDelegate，如果都没有作为废弃事件，也就是相当于随便画一下屏幕，没啥反应。</p>
<ul>
<li>如果我们只想要blueView响应的可以这么写</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event</span><br><span class="line">&#123;</span><br><span class="line">    return [self superview]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果我们同时想要blueView响应的可以这么写</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event</span><br><span class="line">&#123;</span><br><span class="line">    [super touchesBegan:touches withEvent:event];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[NSObject与UIView]]></title>
      <url>/2014/11/13/NSObject%E4%B8%8EUIView/</url>
      <content type="html"><![CDATA[<p>学习IOS里面常用的类有两个基础的类NSObject与UIView，是很多类的父类或者说根类，无处不在，很有必要来进行认识一下。记录一些关键的方法，在使用上有一定的理解成本。</p>
<h3 id="一、NSObject"><a href="#一、NSObject" class="headerlink" title="一、NSObject"></a>一、NSObject</h3><ul>
<li>判断两个NSObject是否相等</li>
</ul>
<p>必须覆盖实现NSObject的两个方法，其中isEqual的判断相等是基于对象自己的hash值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)isEqual:(id)object;</span><br><span class="line">@property (readonly) NSUInteger hash;</span><br></pre></td></tr></table></figure>
<ul>
<li>load方法与initialize方法</li>
</ul>
<p>load方法是在类被添加到runtime的时候就立即调用；initialize方法是对象收到第一个消息的时候，在这个消息之前被调用，并且是线程安全会阻塞其他线程，所以尽量避免耗时操作。基本可以认为执行顺序时间load在initialize之前，在init之前。</p>
<ul>
<li>alloc init 与new的区别</li>
</ul>
<p>基本可以认为是一致的，微小的区别在于alloc分配内存的时候使用了zone，而new不是，其内部默认调用了init方法，所以无法向alloc init那样做到initwithXX方法的扩展。</p>
<ul>
<li>一个对象消息转发过程</li>
</ul>
<p>当我们向目标对象发送的消息如[A B]向A对象发送B消息，而无法应答时，一般会报错“unrecognized selector sent to instance..”,而在报错前一般会经过如下几个方法,这样我们就有机会去预先处理一些可能会报错的方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+(BOOL)resolveInstanceMethod:(SEL)sel;</span><br><span class="line">-(id)forwardingTargetForSelector:(SEL)aSelector;</span><br><span class="line">-(NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector;</span><br><span class="line">-(void)forwardInvocation:(NSInvocation *)anInvocation;</span><br></pre></td></tr></table></figure>
<h3 id="二、UIView"><a href="#二、UIView" class="headerlink" title="二、UIView"></a>二、UIView</h3><ul>
<li>交互事件传递</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//判断交互事件发生所在的UIView</span><br><span class="line">- (nullable UIView *)hitTest:(CGPoint)point withEvent:(nullable UIEvent *)event;</span><br><span class="line"></span><br><span class="line">//判断交互事件发生的具体位置是否在当前UIView中</span><br><span class="line">- (BOOL)pointInside:(CGPoint)point withEvent:(nullable UIEvent *)event;</span><br></pre></td></tr></table></figure>
<ul>
<li>坐标映射和转换</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (CGPoint)convertPoint:(CGPoint)point toView:(nullable UIView *)view;</span><br><span class="line">- (CGPoint)convertPoint:(CGPoint)point fromView:(nullable UIView *)view;</span><br><span class="line">- (CGRect)convertRect:(CGRect)rect toView:(nullable UIView *)view;</span><br><span class="line">- (CGRect)convertRect:(CGRect)rect fromView:(nullable UIView *)view;</span><br></pre></td></tr></table></figure>
<ul>
<li>tintColor</li>
</ul>
<p>默认tintColor的值为nil，这表示它将会运用父视图层次的颜色来进行着色。如果父视图中没有设置tintColor，那么默认系统就会使用蓝色。因此，可以通过设置root view controller的tintColor来改变系统整体的颜色。</p>
<p>也可以给图像着色，调用imageWithRenderingMode:方法来改变图像渲染模式为UIImageRenderingModeAlwaysTemplate,其他两个选项是UIImageRenderingModeAlwaysOriginal和andUIImageRenderingModeAutomatic。默认是andUIImageRenderingModeAutomatic,在这个情况下，根据上下文来改变图像。</p>
<ul>
<li><p>布局与绘制</p>
<ul>
<li>layoutSubviews对subviews重新布局</li>
<li>layoutSubviews方法调用先于drawRect</li>
<li>setNeedsLayout在receiver标上一个需要被重新布局的标记，在系统runloop的下一个周期自动调用layoutSubviews</li>
<li>layoutIfNeeded方法如其名，UIKit会判断该receiver是否需要layout.根据Apple官方文档,layoutIfNeeded方法应该是这样的</li>
<li>layoutIfNeeded遍历的不是superview链，应该是subviews链</li>
<li>drawRect是对receiver的重绘，能获得contex</li>
<li>setNeedDisplay在receiver标上一个需要被重新绘图的标记，在下一个draw周期自动重绘，iphone device的刷新频率是60hz，也就是1/60秒后重绘</li>
</ul>
</li>
<li><p>其他<br>包括手势、自动布局、动画等等。</p>
</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[我的博客诞生]]></title>
      <url>/2014/11/07/%E6%88%91%E7%9A%84%E5%8D%9A%E5%AE%A2%E8%AF%9E%E7%94%9F/</url>
      <content type="html"><![CDATA[<p>早在之前就尝试过自己搭建的个人博客，想积累写写技术知识点和生活上的见闻，希望它作为自己个人的回忆。通常我们会在一些博客网站注册，比如博客园，但界面设计和交互已经跟不上时代。后来出了一些品质比较高的静态博客等，也尝试去使用过，最后还是选择了使用博客组件去搭建，因为总觉得独立的才是自己的，大概程序员的内心都流淌着这样的独白。</p>
<p>博客搭建框架组件很多，从WordPress到FarBox、Jekyll、Octopress等等，他们基本都配合github使用,在网上各路大神的推荐之下，试过几款框架,基本都是在读完安装说明并开始有点小激动的时候，痛苦的安装过程让我放弃了这一方式，一方面是，当时正值自己大学的时候使用的电脑很挫，一个奔腾处理器转圈都要转半天，另一方面就是翻墙网络也不稳定，安装搭建环境的过程总是各种安装失败，算了，然后就GG了。</p>
<p>万万没想到，我还是搭建了自己的博客。没有使用上述的哪种框架,前面的过程学习也大概知道了博客的搭建方式，索性自己就用FW设计了个人博客的UI界面，正好也会前端FE，就手写了博客页面Css和JS，这样博客的结界面就出来了，自己动手丰衣足食。当然写出来的是个静态页面，通过JS去读TXT的字符串来收到添加到页面结构，我自定好规则，写好CSS选择器，整体来说是可以用的，但是对于文章发布始终是不方便的。于是搜索查找了一个python脚本，动态读取文件，只需要专心的写文字就好，随后可上传到github通过域名映射直接展示。这样，我就搭建好了自己的博客1.0，因为界面等从头到尾都是我自己设计后用代码自己一行一行写的，非常符合我自己的审美设计要求，所以很满意，简直高端大气上档次！</p>
<p>上个截图,看一看画风：</p>
<p><img src="/assets/images/blog1.0.jpg" alt=""></p>
<p>到后来，接触到Hexo,发现功能、模板、发布，都有很好的扩展。Hexo的使用上手也很快，几乎是1小时就搭建完成了博客，这速度让我为之欢呼，所以决定转到Hexo来写作，那么，这里就写个文章来推荐一下吧。</p>
<h2 id="正文使用"><a href="#正文使用" class="headerlink" title="正文使用"></a>正文使用</h2><h3 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h3><ul>
<li><p>你得有自己的域名，买域名的地方比较多，有的坑有的好，我是在godaddy上买的。</p>
</li>
<li><p>买了之后到dnspod上建立自己的域名映射</p>
</li>
<li><p>注册github账号，你将会免费使用到它提供的各种便利而强大的功能，免费的存储空间，下载开源项目等等，重写CNAME，把你的域名映射到github默认的博客地址上</p>
</li>
<li><p>安装Node.js, npm</p>
</li>
<li><p>安装git,生成SSH-KEY管理权限，配置域名到github关联</p>
</li>
</ul>
<h3 id="二、安装Hexo"><a href="#二、安装Hexo" class="headerlink" title="二、安装Hexo"></a>二、安装Hexo</h3><p>1、hexo程序环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure>
<p>2、hexo工程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init 文件夹名称</span><br><span class="line">cd 文件夹名称</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
<p>3、会得到文件夹目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├ ── _config.yml</span><br><span class="line">├ ── package.json</span><br><span class="line">├ ── scaffolds</span><br><span class="line">├ ── source</span><br><span class="line">├ ── _drafts</span><br><span class="line">├ ── _posts</span><br><span class="line">└ ── themes</span><br></pre></td></tr></table></figure>
<ul>
<li>_config.yml 文件是网站的配置文件，可以在其中配置网站的大部分参数。</li>
<li>package.json 文件是应用程序的信息。</li>
<li>source 是资源文件夹，是用来存放用户资源的地方。</li>
<li>themes 是主题文件夹，Hexo会根据主题来生成不同的静态页面。</li>
<li>scaffolds是模板件夹，当新建文章的时候，Hexo会根据模板来建立文件。</li>
</ul>
<h5 id="三、生成第一篇文章"><a href="#三、生成第一篇文章" class="headerlink" title="三、生成第一篇文章"></a>三、生成第一篇文章</h5><p>1、创建文章</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new 你的文章名称</span><br></pre></td></tr></table></figure>
<p>2、编辑你的文章</p>
<p>上面一步在你对应的文件夹下新建了一个Markdown文件，此时需要你使用对应的语法去编写文档，不知道的可以去学习下，用语言命令号来写Word文档，该有的有，不该有的没有，简直就是最爱</p>
<p>3、编译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>
<p>此时打开你的浏览器，默认地址是（ <a href="http://0.0.0.0:4000/" target="_blank" rel="noopener">http://0.0.0.0:4000/</a> ），你就可以看到你的文章了，就是你刚才编写的文章。  </p>
<h5 id="四、发布到github"><a href="#四、发布到github" class="headerlink" title="四、发布到github"></a>四、发布到github</h5><p>由于前面你做好了准备工作里面包含了使用github当做静态博客地址，<br>你有一个repository事对应自己的name.github.io，前面已经完成了域名的映射，所以这里只需要提交，和你在（ <a href="http://0.0.0.0:4000" target="_blank" rel="noopener">http://0.0.0.0:4000</a> ）看到的一毛一样了。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git commit -a -m &quot;***文章&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>
<h5 id="五、关于主题"><a href="#五、关于主题" class="headerlink" title="五、关于主题"></a>五、关于主题</h5><p>已经用Hexo构建好了站点，但是使用的主题是hexo默认的landscape，这个风格确实不是我喜欢的，画风不是我的style。所以我们来看下如何变更主题。</p>
<p>1、查找喜欢的主题</p>
<ul>
<li>官网上 <a href="https://hexo.io/themes/" target="_blank" rel="noopener">查询</a> </li>
<li>github上 <a href="https://github.com/search?utf8=%E2%9C%93&amp;q=hexo&amp;type=" target="_blank" rel="noopener">搜索</a> </li>
</ul>
<p>2、下载主题包</p>
<ul>
<li>解压到前面theme文件夹下</li>
<li>在前面_config.yml文件里面，修改theme：your theme name</li>
</ul>
<p>3、安装依赖</p>
<p>默认主题已经包含了一些依赖包，但是hexo里每个不同的主题所依赖的包都不尽相同。比如有的主题示使用到Jade构建还需要执行下面的依赖安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-renderer-jade hexo-generator-feed hexo-generator-sitemap hexo-browsersync hexo-generator-archive</span><br><span class="line"></span><br><span class="line">npm install --save hexo-deployer-git hexo-generator-json-content hexo-generator-search</span><br></pre></td></tr></table></figure>
<p>安装完后，依旧走上面的两个编译命令即可。</p>
<p>4、前后主题对比</p>
<p><img src="/assets/images/blog2.0.jpg" alt=""></p>
<p><img src="/assets/images/blog3.0.jpg" alt=""></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>对于Hexo的使用，前后只介绍了关键的几个命令，可以快速搭建，都是基础入门很方便，麻烦的到是前面的准备工作，得一步步挨着来。Hexo的扩展功能强大且自由，直接浏览Hexo的官网可学习。</p>
<!--![](/assets/images/aoteman.png)-->
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MRC、ARC与属性修饰符]]></title>
      <url>/2014/11/02/MRC%E3%80%81ARC%E4%B8%8E%E5%B1%9E%E6%80%A7%E4%BF%AE%E9%A5%B0%E7%AC%A6/</url>
      <content type="html"><![CDATA[<h2 id="一、MRC"><a href="#一、MRC" class="headerlink" title="一、MRC"></a>一、MRC</h2><h3 id="1、内存管理问题"><a href="#1、内存管理问题" class="headerlink" title="1、内存管理问题"></a>1、内存管理问题</h3><p>传统的内存管理方式都需要业务代码自己处理，比如C和C++,程序员自己控制对象的使用周期，进行生成和释放。随着代码越来越复杂和人员的流动，就会出现无法确定的代码，如果内存对象一直留在那里，没人敢释放，整个程序占用的空间越来越大；胆大的人释放了可能导致crash。尽管遵循一些“谁创建谁释放”、“谁持有谁释放” 的原则，但依旧导致存储空间的浪费：为了保留仅仅一个内存对象，却要将与它关联的一大堆对象保留住，然而其中大部分已经不再使用了。</p>
<h3 id="2、解决方式"><a href="#2、解决方式" class="headerlink" title="2、解决方式"></a>2、解决方式</h3><p>就是引用计数。所有使用到同一内存对象的地方，使用者只要保证自己 retain 一次，release 一次，不用管别人是否使用。这样就实现了内存管理的分离，这就是MRC。当你使用new、alloc、copy方法创建一个对象时，该对象的保留计数器值为1.当不再使用该对象时，你要负责向该对象发送一条release或autorelease消息。当这个对象本身的引用计数为0时，就会被系统销毁。如果还有别处对它的引用，它就还在继续存在。<br>所有的内存管理是需要程序员手写代码控制的，一般就是持有操作和释放操作。<br>原则：谁持有，谁释放，不持有，不能释放，不再需要时，主动释放。</p>
<h2 id="二、-ARC"><a href="#二、-ARC" class="headerlink" title="二、 ARC"></a>二、 ARC</h2><h3 id="1、本质"><a href="#1、本质" class="headerlink" title="1、本质"></a>1、本质</h3><p>ARC只是相对于MRC的一次改进，但它和之前的技术本质上没有区别。它会默认在程序代码合适的位置呗对象增加计数和释放计数对象，其实就是MRC那些繁琐的操作给默认自动化了。当然ARC本身的特性是有区别的。</p>
<p>ARC是编译器时特性，而不是运行时特性。系统在运行时统一管理所有内存对象的释放，会导致增加额外的内存和 CPU 开销，程序员们依然在努力降低内存和CPU消耗。</p>
<h3 id="2、开关切换"><a href="#2、开关切换" class="headerlink" title="2、开关切换"></a>2、开关切换</h3><p>在target中找到对应的文件可以进行配置。</p>
<p>打开ARC：-fobjc-arc<br>关闭ARC：-fno-objc-arc</p>
<h2 id="三、修饰符"><a href="#三、修饰符" class="headerlink" title="三、修饰符"></a>三、修饰符</h2><h3 id="1、属性修饰符"><a href="#1、属性修饰符" class="headerlink" title="1、属性修饰符"></a>1、属性修饰符</h3><h4 id="1-1-存取类型"><a href="#1-1-存取类型" class="headerlink" title="1.1 存取类型"></a>1.1 存取类型</h4><p>任何属性都可以声明为readwrite或readonly，且默认设置为readwrite。</p>
<p>readwrite：程序自动创建setter/getter方法。<br>readonly：程序之创建getter方法。<br>此外，还可以自定义setter/getter方法。</p>
<h4 id="1-2-原子性"><a href="#1-2-原子性" class="headerlink" title="1.2 原子性"></a>1.2 原子性</h4><p>atomic是Objc使用的一种线程保护技术，基本上来讲，是防止在写未完成的时候被另外一个线程读取，造成数据错误。而这种机制是耗费系统资源的，所以在iPhone这种小型设备上，如果没有使用多线程间的通讯编程，那么nonatomic是一个非常好的选择。</p>
<h4 id="1-3-生命周期管理"><a href="#1-3-生命周期管理" class="headerlink" title="1.3 生命周期管理"></a>1.3 生命周期管理</h4><blockquote>
<h3 id="MRC"><a href="#MRC" class="headerlink" title="MRC"></a>MRC</h3></blockquote>
<ul>
<li>assign:</li>
</ul>
<p>默认类型。简单赋值，不更改引用计数。unsafe_unretained 修饰“基础数据类型”并不会报错，在实际使用时，与 assign 是完全等价的。</p>
<ul>
<li>copy:</li>
</ul>
<p>会拷贝传入的对象（即创建一个引用计数为1的新对象，但是内容与传入对象相同），并把新对象赋值给实例变量。常用与NSString,NSArray,NSDictionary,NSSet等。</p>
<ul>
<li>retain: </li>
</ul>
<p>释放旧对象，并使传入的新对象引用计数+1。此属性只能用于NSObject及其子类，而不能用于Core Foundation。</p>
<blockquote>
<h3 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h3></blockquote>
<ul>
<li>strong: </li>
</ul>
<p>默认类型，强引用，类似于retain。要求保留传入的对象，并放弃原有对象。</p>
<ul>
<li>weak: </li>
</ul>
<p>弱引用，不会使传入的对象引用计数+1。类似于assign，但与assign不同的是，当它们指向的对象被释放后，weak会被自动置为nil，而assign则不会，所以assign会导致“野指针”的出现，weak可以避免悬空指针。使用附有 weak 修饰符的变量会自动注册到 autoreleasepool。如果大量使用 weak 修饰的变量，则会消耗相应的 CPU 资源。良策是只在需要避免循环引用时使用 weak。</p>
<ul>
<li>unsafe_unretained: </li>
</ul>
<p>其实质等同于assign。与weak的区别就是指向的对象如果被释放，其不会被置为nil，而导致悬空指针的出现。它是ARC模式下非对象属性的默认值。</p>
<blockquote>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结:"></a>总结:</h3></blockquote>
<ul>
<li><p>strong/retain,两者等价。</p>
</li>
<li><p>assign/unsafe_unretained，两者修饰非对象属性等价。</p>
</li>
<li><p>默认属性：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MRC：(atomic, readwrite, assign)</span><br><span class="line">ARC下对象类型属性：(atomic, readwrite, strong)</span><br><span class="line">ARC下非对象类型：(atomic, readwrite, unsafe_unretained)</span><br></pre></td></tr></table></figure>
<h3 id="2、变量关键字修饰符"><a href="#2、变量关键字修饰符" class="headerlink" title="2、变量关键字修饰符"></a>2、变量关键字修饰符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_string: 是默认引用类型的关键字。</span><br><span class="line">__weak: 声明一个可以自动置nil的弱引用。</span><br><span class="line">__unsafe_unretained: 弱引用，但是当指向对象被释放时，不会被置nil。所以会导致野指针的出现。</span><br><span class="line">__autoreleasing:用来修饰一个函数的参数，这个参数会在函数返回的时候被自动释放。</span><br></pre></td></tr></table></figure>
<ul>
<li>对应关系：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">strong：__strong修饰符</span><br><span class="line">retain：__strong修饰符</span><br><span class="line">assign：__unsafe_unretained修饰符</span><br><span class="line">unsafe_unretained：__unsafe_unretained修饰符</span><br><span class="line">weak：__weak修饰符</span><br><span class="line">copy：__strong修饰符(但是赋值的是被复制的对象)</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[中秋节]]></title>
      <url>/2014/09/08/%E4%B8%AD%E7%A7%8B%E8%8A%82/</url>
      <content type="html"><![CDATA[<p>从7月到北京，忙忙碌碌的工作生活中已经度过两个月，在北京的生活轨迹也逐渐清晰起来，每天都那么的忙当然也很充实，我很喜欢这加互联网公司，也喜欢和一起入职的同事玩，大家都很奈斯。但有的时候，我会喜欢自己静静的呆着，即使什么也不做。昨天前天都出游了就没再打算出去，今天恰好是中秋节，安静的睡下，安静的醒来.</p>
<p>早晨收到了中秋的祝福短信，我都一一的回复了，祝他们也中秋快乐。随后平兄打来电话说下午约一波，说希望和我吃个中饭，我随后起来洗漱。平兄来了一起做了一顿饭，他和我讲起宽宽的故事，故事是这样的—-小红说：长得就像大盘鸡……..故事很短，我俩笑得不行。饭后，平兄在我这睡了一觉，就回学校去了。</p>
<p>看着窗外蓝色的天空，温暖的阳光里，我决定出去走走，拿起相机，穿上背心，带双拖鞋，出门去。北京一直让人笼罩在阴霾里，而夏日的晴天却格外的美丽。心情很好，我走在街上，拍着路过的车辆和行人，走上天桥，仰望着天空，这里开始令我心生喜欢。走在人大的校园里，依旧能感受到学生时代的美好，拍了学校里的一些风景，慢悠悠的又回到家里。我翻阅拍摄的照片，发现自己在处理光线阴暗的条件下存在不足，想当老湿还是得加油学习啊。</p>
<p>躺在沙发上，给爸妈打通电话，也问候正在拍婚纱照的姐姐，家人隔得很远，意识到这点的时候却又是今天的中秋节。翻阅通讯录，尝试去问候许久未见的朋友，却又觉得依旧不过是太阳升起溪水长流，可能这就是我的性格吧。</p>
<p>电话响起，室友说今晚中秋一起做晚饭吃，我说，好。初到北京就和现在的室友相识合租在一起，兴趣相投性格随性。</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[页面重构CSS与JS]]></title>
      <url>/2014/08/22/%E9%A1%B5%E9%9D%A2%E9%87%8D%E6%9E%84CSS%E5%92%8CJS/</url>
      <content type="html"><![CDATA[<p>今天给我们培训的是一位前端界自学成才的大牛，去哪儿的高级前端技术总监，杜瑶老师。这名字听起来像个大美女，但实际上是个美男子，哪种美男子呢，形象风格和郭敬明有点像吧，但是比小郭仔肯定是要高的，哈哈。听其他一起入职的同事讲起，杜老师对CSS的理解在web前端界都是排得上名的。他自己讲课的时候说道，不说排前3，排个第五吧。我擦勒，此话一出，房间里一篇哇哇之声，对大佬的膜拜有如涛涛江水连绵不绝。我呢，内心比较复杂，你说国内排第五吧确实很厉害，但就会个CSS排第五感觉不像我要走的路线，可以理解为术业专攻，你在某一方面，哪怕是很微小的某一方面有卓越的成绩，你依旧可以出人头地受人敬仰。</p>
<p>市场上存在各种浏览器拥有不同的内核渲染，导致对CSS的支持有差异，页面无法保证统一并且稳定的显示。杜老师给我们讲解了几个CSS的case，确实，我们在使用上还是浅薄的，CSS选择器说到底是结合起来使用的，各种属性怎么组合成相同的效果，却是最好的效果，杜老师有深刻的认识。后来我仔细翻阅了他的技术博客，出了一本在线的CSS手册，里面对每一种属性需要注意的常见case都有总结和认识，很多生僻的用法绝不是百度搜索出来那么简单，真不是一日之功，却造福了很多前端的学徒。</p>
<p>杜瑶老师还创造了很多有用的轮子，比如移动前端开发框架YO，专注为移动应用提供快速且专业的构建方式；她轻量，易用，可配置，并且具备超强的扩展能力。还有移动端经验速递trip等等。可见在前端的深度投入和有效产出。</p>
<p>此次培训，给我们布置的任务主要是页面重构方面，也就是对HTML\CSS的认识需要进一步实践。包括对机票页面和对酒店页面的重构。因为未来我们都有可能被分配到各个事业部去支持前端开发，事先熟悉下流程和页面是有好处的。</p>
<h3 id="特价机票页面"><a href="#特价机票页面" class="headerlink" title="特价机票页面"></a>特价机票页面</h3><p>页面所需要的图片都是充对应的线上页面直接下载下来的，构建机票页面有几个点是关键实现，我们可以挨个对着下药。效果如下：</p>
<p><a href="../../../../innerWeb/flightTicket/index.html">机票页面链接</a></p>
<ul>
<li>机票列表布局</li>
</ul>
<p>我使用的是无序列表，重点使用float方法，然后根据数据数组进行加载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#tj_list li &#123;</span><br><span class="line">    float: left;</span><br><span class="line">    display: block;</span><br><span class="line">    width: 218px;</span><br><span class="line">    height: 120px;</span><br><span class="line">    background: #fff;</span><br><span class="line">    border-radius: 2px;</span><br><span class="line">    margin: 0 15px 10px 0;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建数据请求URL</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">function url_chain(d_city,d_week,d_time,d_step,min_p,max_p,page_index,slide)&#123;</span><br><span class="line"></span><br><span class="line">    var address;</span><br><span class="line">    var url_day= new Date(),</span><br><span class="line">        tommorow=url_day.getFullYear() + &quot;-&quot; + (url_day.getMonth() + 1) + &quot;-&quot; + (url_day.getDate()+1);</span><br><span class="line"></span><br><span class="line">    var url=&quot;http://lp.flight.qunar.com/api/qdclowprice?&quot;,</span><br><span class="line">        filter= &#123;</span><br><span class="line">            dcity: d_city,</span><br><span class="line">            acity: &apos;&apos;,</span><br><span class="line">            ddate: tommorow,</span><br><span class="line">            drange: 7,</span><br><span class="line">            query: &apos;filter&apos;,</span><br><span class="line">            sort: &apos;S1&apos;,</span><br><span class="line">            asc: &apos;true&apos;,</span><br><span class="line">            page: &quot;&quot;,</span><br><span class="line">            from: &apos;tejia_d&apos;,</span><br><span class="line">            ex_track: &apos;&apos;,</span><br><span class="line">            searchType: &apos;domestic&apos;,</span><br><span class="line">            per: 40,</span><br><span class="line">            perScrollPage: 10,</span><br><span class="line">            dweek: d_week,</span><br><span class="line">            dtime: d_time,  </span><br><span class="line">            dstep: d_step,</span><br><span class="line">            minp: &quot;&quot;,</span><br><span class="line">            maxp: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        time_stamp=&quot;&amp;_=&quot;+parseInt(Math.random() * 100000000);</span><br><span class="line">        //address=url+&quot;dcity=&quot;+d_city+&quot;&amp;&quot;+$.param(filter) + time_stamp;</span><br><span class="line">        filter.page=page_index;</span><br><span class="line"></span><br><span class="line">        if(slide)&#123;</span><br><span class="line">            filter.maxp=max_p;</span><br><span class="line">            filter.minp=min_p;</span><br><span class="line">        &#125;</span><br><span class="line">        address=url+$.param(filter) + time_stamp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return address;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function create_url(page_arg,slide_arg)&#123;</span><br><span class="line"></span><br><span class="line">    var step_count=0,url;</span><br><span class="line">    var dcity,dweek,dtime,dstep,minp,maxp;</span><br><span class="line"></span><br><span class="line">     //获取出发城市</span><br><span class="line">        $(&quot;.leave_city .cdt_item li&quot;).each(function()&#123;</span><br><span class="line">            if($(this).hasClass(&quot;on&quot;))&#123;</span><br><span class="line">                //dcity=encodeURI($(this).html());</span><br><span class="line">                dcity=$(this).html();</span><br><span class="line">                if(dcity==&quot;不限&quot;)&#123;</span><br><span class="line">                    dcity=&quot;&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //获取是否工作日</span><br><span class="line">        $(&quot;.time_type .cdt_item li&quot;).each(function()&#123;</span><br><span class="line">            if($(this).hasClass(&quot;on&quot;))&#123;</span><br><span class="line">                var text=$(this).html();</span><br><span class="line">                if(text==&quot;周末&quot;)&#123;</span><br><span class="line">                    dweek=&quot;W1&quot;;</span><br><span class="line">                &#125;else if(text==&quot;工作日&quot;)&#123;</span><br><span class="line">                    dweek=&quot;W2&quot;;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    dweek=&quot;W0&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //获取起飞的月份</span><br><span class="line">        $(&quot;.time_mons .cdt_item li&quot;).each(function()&#123;</span><br><span class="line">            if($(this).hasClass(&quot;on&quot;))&#123;</span><br><span class="line">                var text=$(this).html();</span><br><span class="line">                if(text==&quot;八月&quot;)&#123;</span><br><span class="line">                    dtime=&quot;T8&quot;;</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    dtime=&quot;T0&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //获取早中晚起飞时间</span><br><span class="line">        $(&quot;.depart_time .cdt_item li input&quot;).each(function()&#123;</span><br><span class="line">            if($(this).attr(&quot;data-checked&quot;)==&quot;true&quot;)&#123;</span><br><span class="line">                step_count++;</span><br><span class="line">                if(step_count==1)&#123;</span><br><span class="line">                    dstep=$(this).attr(&quot;data-key&quot;);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    dstep=dstep+&quot;,&quot;+$(this).attr(&quot;data-key&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        //获取最大价格最小价格</span><br><span class="line">        minp=parseInt($(&quot;#js_min_price&quot;).html());</span><br><span class="line">        maxp=parseInt($(&quot;#js_max_price&quot;).html());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        url=url_chain(dcity,dweek,dtime,dstep,minp,maxp,page_arg,slide_arg);</span><br><span class="line">        console.log(url);</span><br><span class="line">        return url;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>搜索</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">function filter_it()&#123;</span><br><span class="line"></span><br><span class="line">    var url_address,weekday_str;</span><br><span class="line"></span><br><span class="line">    $(&quot;.time_type .cdt_item li,.time_mons .cdt_item li,.leave_city .cdt_item li,.depart_time .cdt_item li input&quot;).click(function()&#123;</span><br><span class="line">        $(&quot;a[data-pager-link=&apos;first&apos;]&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">        $(&quot;a[data-pager-link=&apos;prev&apos;]&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">        $(&quot;a[data-pager-link=&apos;next&apos;]&quot;).css(&quot;display&quot;,&quot;inline&quot;);</span><br><span class="line">        $(&quot;a[data-pager-link=&apos;last&apos;]&quot;).css(&quot;display&quot;,&quot;inline&quot;);</span><br><span class="line">        $(&quot;#no_data&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">        $(&quot;.tj_list_wrapper&quot;).css(&quot;display&quot;,&quot;block&quot;);</span><br><span class="line">        $(&quot;.pager&quot;).css(&quot;display&quot;,&quot;block&quot;);</span><br><span class="line"></span><br><span class="line">        pages_index=2;</span><br><span class="line">        ten_times=1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        url_address=create_url(1,false);</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url: url_address,</span><br><span class="line">            dataType : &quot;jsonp&quot;,</span><br><span class="line">            success:function(json)&#123;</span><br><span class="line"></span><br><span class="line">                $(&quot;#tj_list&quot;).html(&quot;&quot;);</span><br><span class="line">                $(&quot;#js_price_range em&quot;).css(&quot;left&quot;,&quot;100%&quot;);</span><br><span class="line">                </span><br><span class="line">                var info=json.data.info;</span><br><span class="line">                    $(&quot;#total_num&quot;).html(info.total);</span><br><span class="line">                    $(&quot;#js_min_price&quot;).html(info.minp);</span><br><span class="line">                    $(&quot;#js_max_price&quot;).html(info.maxp);</span><br><span class="line">                    $(&quot;#js_max_price&quot;).html(info.maxp);</span><br><span class="line">                    $(&quot;.pager .ps em&quot;).html(Math.ceil(info.total/400));</span><br><span class="line">                    max=info.maxp;</span><br><span class="line">                    min=info.minp;</span><br><span class="line">                var array=json.data.list;</span><br><span class="line">                    if(json.data.info.total!=0)&#123;</span><br><span class="line">                        $.each(array,function(i,value)&#123;</span><br><span class="line"></span><br><span class="line">                            var the_day=new Date(value.dd);</span><br><span class="line">                            if(the_day.getDay()==5)&#123;</span><br><span class="line">                                weekday_str=&quot;&lt;p class=&apos;ptop&apos;&gt;周五&lt;/p&gt;&quot;;</span><br><span class="line">                            &#125;else if(the_day.getDay()==6)&#123;</span><br><span class="line">                                weekday_str=&quot;&lt;p class=&apos;ptop&apos;&gt;周六&lt;/p&gt;&quot;;</span><br><span class="line">                            &#125;else if(the_day.getDay()==0)&#123;</span><br><span class="line">                                weekday_str=&quot;&lt;p class=&apos;ptop&apos;&gt;周七&lt;/p&gt;&quot;;</span><br><span class="line">                            &#125;else&#123;</span><br><span class="line">                                weekday_str=&quot;&quot;;</span><br><span class="line">                            &#125;</span><br><span class="line">                            var day=value.dd.charAt(8)+value.dd.charAt(9);</span><br><span class="line">                            var mon=value.dd.charAt(5)+value.dd.charAt(6);</span><br><span class="line"></span><br><span class="line">                            var item=&quot;&lt;li&gt;&lt;a href=&apos;#&apos; data-fromcity=&quot;+value.dc+ &quot;data-tocity=&quot;+value.ac+&quot;data-fromdate=&quot;+value.dd+&quot;&gt;&quot;+weekday_str+&quot;&lt;p class=&apos;p1&apos;&gt;&lt;span class=&apos;prc&apos;&gt;&lt;i class=&apos;rmb&apos;&gt;¥&lt;/i&gt;&quot;+value.pr+&quot;&lt;/span&gt;&amp;nbsp;&lt;span class=&apos;dsc&apos;&gt;&quot;+value.dis+&quot;折&lt;/span&gt;&lt;/p&gt;&lt;p class=&apos;p2&apos;&gt;&lt;span&gt;&quot;+value.dc+&quot;&lt;/span&gt;&amp;nbsp;-&amp;nbsp;&lt;span&gt;&quot;+value.ac+&quot;&lt;/span&gt;&lt;/p&gt;&lt;p class=&apos;p3&apos;&gt;&lt;span class=&apos;hl&apos;&gt;立即抢票&lt;/span&gt;&quot;+mon+&quot;月&quot;+day+&quot;日&amp;nbsp;&quot;+value.dt+&quot;&lt;/p&gt;&lt;/a&gt;&lt;/li&gt;&quot;</span><br><span class="line">                            $(item).appendTo($(&quot;#tj_list&quot;));</span><br><span class="line">                            inite_pager();</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        $(&quot;#no_data&quot;).css(&quot;display&quot;,&quot;block&quot;);</span><br><span class="line">                        $(&quot;.tj_list_wrapper&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">                        $(&quot;.pager&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            error:function(json)&#123;</span><br><span class="line">                alert(&quot;error&quot;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>翻页</li>
</ul>
<p>与搜索类似，修改page参数</p>
<ul>
<li>滚动加载</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$(document).scroll(</span><br><span class="line">    throttle(load_page, 500)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">function throttle(fn, delay) &#123;  </span><br><span class="line">    var timer = null;  </span><br><span class="line">    return function () &#123;  </span><br><span class="line">        var context = this, args = arguments;  </span><br><span class="line">        clearTimeout(timer);  </span><br><span class="line">        timer = setTimeout(function () &#123;  </span><br><span class="line">        fn.apply(context, args);  </span><br><span class="line">    &#125;, delay);  </span><br><span class="line">  &#125;;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="酒店touch页面"><a href="#酒店touch页面" class="headerlink" title="酒店touch页面"></a>酒店touch页面</h3><p>酒店页面的实现基本法和上述机票页面基本一致，区别在于是在移动端手机上显示的。主要实现了搜索列表、动画、酒店列表、筛选条件等大模块。效果如下：</p>
<p><a href="../../../../innerWeb/qunarHotel/index.html">机票页面链接</a></p>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[实现一个2048游戏]]></title>
      <url>/2014/08/03/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA2048%E6%B8%B8%E6%88%8F/</url>
      <content type="html"><![CDATA[<p>今日的任务是完成一个网页版的2048游戏，一脸懵逼的毫无心理准备，去哪儿对应届生的培训也是任性啊，几个老大这题目是不是出得太随意了点，还是你们最近迷上了这款游戏。好吧，还是要来弄一弄，可以先看下效果，点击链接跳转。</p>
<p><a href="../../../../innerWeb/2048/index.html">2048链接</a></p>
<h2 id="游戏设计"><a href="#游戏设计" class="headerlink" title="游戏设计"></a>游戏设计</h2><p>游戏的设计基本上遵从CSS定义transition动画，JS操作二位数组的数字和增删class实现属性变化。</p>
<h3 id="基础结构和动画"><a href="#基础结构和动画" class="headerlink" title="基础结构和动画"></a>基础结构和动画</h3><ul>
<li>HTML结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;div id=&quot;wrapper&quot;&gt;</span><br><span class="line">	&lt;div id=&quot;header&quot;&gt;</span><br><span class="line">		&lt;h1&gt;2048&lt;/h1&gt;</span><br><span class="line">		&lt;div id=&quot;base-func&quot;&gt;</span><br><span class="line">			&lt;a class=&quot;restart&quot;&gt;New Game&lt;/a&gt;</span><br><span class="line">			&lt;div class=&quot;now-score&quot;&gt;SCORE&lt;br&gt;&lt;span&gt;0&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">			&lt;div class=&quot;best-score&quot;&gt;BEST&lt;br&gt;&lt;span&gt;0&lt;/span&gt;&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">	&lt;div id=&quot;game-box&quot;&gt;</span><br><span class="line">		&lt;div id=&quot;game-message&quot;&gt;</span><br><span class="line">	        &lt;a class=&quot;retry&quot;&gt;Try again&lt;/a&gt;</span><br><span class="line">	        &lt;a class=&quot;you-win&quot;&gt;You win!&lt;/a&gt;</span><br><span class="line">	        &lt;a class=&quot;you-lose&quot;&gt;You lose!&lt;/a&gt;</span><br><span class="line">	    &lt;/div&gt;</span><br><span class="line">	    &lt;div id=&quot;block-box&quot;&gt;</span><br><span class="line">	    	</span><br><span class="line">	    &lt;/div&gt;</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>得分的提示的滑动显示</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@keyframes score-up&#123;</span><br><span class="line">	0%&#123;</span><br><span class="line">		opacity: 1;</span><br><span class="line">		top: 25px;</span><br><span class="line">	&#125;</span><br><span class="line">	100%&#123;</span><br><span class="line">		opacity: 0;</span><br><span class="line">		top: -50px;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>滑块滑动到位置的动画</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.tile.tile-position-1-1 &#123;</span><br><span class="line">  -webkit-transform: translate(0px, 0px);</span><br><span class="line">  -moz-transform: translate(0px, 0px);</span><br><span class="line">  transform: translate(0px, 0px); &#125;</span><br><span class="line">.tile.tile-position-1-2 &#123;</span><br><span class="line">  -webkit-transform: translate(0px, 121px);</span><br><span class="line">  -moz-transform: translate(0px, 121px);</span><br><span class="line">  transform: translate(0px, 121px); &#125;</span><br><span class="line">  </span><br><span class="line">//等等其他位置</span><br></pre></td></tr></table></figure>
<ul>
<li>合并两个单元的时候会出现的POP效果</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.tile-merged .tile-inner &#123;</span><br><span class="line">  z-index: 20;</span><br><span class="line">  -webkit-animation: pop 200ms ease 100ms;</span><br><span class="line">  -moz-animation: pop 200ms ease 100ms;</span><br><span class="line">  animation: pop 200ms ease 100ms;</span><br><span class="line">  -webkit-animation-fill-mode: backwards;</span><br><span class="line">  -moz-animation-fill-mode: backwards;</span><br><span class="line">  animation-fill-mode: backwards; </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="两个位子上出现2或者4的随机设定"><a href="#两个位子上出现2或者4的随机设定" class="headerlink" title="两个位子上出现2或者4的随机设定"></a>两个位子上出现2或者4的随机设定</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">var random_value = Math.random() &lt; 0.9 ? 2 : 4,</span><br><span class="line">value_class=&quot;tile-&quot;+random_value;</span><br><span class="line">var choosed_nmb=parseInt(Math.random()*blank_length-1),</span><br><span class="line">pos_x=blank_array2[choosed_nmb].charAt(0),</span><br><span class="line">pos_y=blank_array2[choosed_nmb].charAt(1),</span><br><span class="line">pos_str=pos_x+&quot;&quot;+pos_y;	</span><br><span class="line"></span><br><span class="line">var	pst_class=&quot;tile-position-&quot;+pos_x+&quot;-&quot;+pos_y;</span><br><span class="line">var block_box=$(&quot;#block-box&quot;);</span><br><span class="line">var wrapper=$(&quot;&lt;div&gt;&lt;/div&gt;&quot;);</span><br><span class="line">var inner=$(&quot;&lt;div&gt;&lt;/div&gt;&quot;);</span><br><span class="line">wrapper.addClass(&quot;tile tile-new&quot;);</span><br><span class="line">wrapper.addClass(value_class);</span><br><span class="line">wrapper.addClass(pst_class);</span><br><span class="line"></span><br><span class="line">inner.addClass(&quot;tile-inner&quot;);</span><br><span class="line">inner.html(random_value);</span><br><span class="line">inner.appendTo(wrapper);</span><br><span class="line">wrapper.appendTo(block_box);</span><br></pre></td></tr></table></figure>
<h3 id="滑动合并"><a href="#滑动合并" class="headerlink" title="滑动合并"></a>滑动合并</h3><ul>
<li>朝按键方向移动到最前,前面有相同的出现合并功能,以往右边滑动为例</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	for (var i = move_array2.length-1; i &gt;=1 ; i--) &#123;</span><br><span class="line">		for (var j = 0; j &lt; move_array2.length; j++) &#123;</span><br><span class="line"></span><br><span class="line">		//移动3格</span><br><span class="line">		if(i&lt;2&amp;&amp;move_array2[i-1][j]&gt;move_array2[i][j]&amp;&amp;move_array2[i-1][j]&gt;move_array2[i+1][j]&amp;&amp;move_array2[i-1][j]&gt;move_array2[i+2][j])&#123;</span><br><span class="line"></span><br><span class="line">		var pos_str=(move_array2[i-1][j]).toString();</span><br><span class="line"></span><br><span class="line">		//获得已存在方块坐标 </span><br><span class="line">		var pos_x=parseInt(pos_str.charAt(0));</span><br><span class="line">		var pos_y=parseInt(pos_str.charAt(1));</span><br><span class="line">		//var temp_class=pos_x+&quot;-&quot;+pos_y;</span><br><span class="line">		var now_class=&quot;tile-position-&quot;+pos_x+&quot;-&quot;+pos_y;</span><br><span class="line">		var	next_class=&quot;tile-position-&quot;+(pos_x+3)+&quot;-&quot;+pos_y;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		$(&quot;#block-box .tile&quot;).each(function()&#123;</span><br><span class="line">			</span><br><span class="line">			if($(this).hasClass(now_class))&#123;</span><br><span class="line">				$(this).removeClass(now_class);</span><br><span class="line">				$(this).addClass(next_class);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">			</span><br><span class="line">			//赋值保持后续连续</span><br><span class="line">			move_array2[i+2][j]=move_array2[i-1][j]+30;</span><br><span class="line">			move_array2[i-1][j]=0;</span><br><span class="line">			valid_step=true;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		//移动2格</span><br><span class="line">		if(i&lt;3&amp;&amp;move_array2[i-1][j]&gt;move_array2[i][j]&amp;&amp;move_array2[i-1][j]&gt;move_array2[i+1][j])&#123;</span><br><span class="line"></span><br><span class="line">			var pos_str=(move_array2[i-1][j]).toString();</span><br><span class="line"></span><br><span class="line">			//获得已存在方块坐标 </span><br><span class="line">			var pos_x=parseInt(pos_str.charAt(0));</span><br><span class="line">			var pos_y=parseInt(pos_str.charAt(1));</span><br><span class="line">			//var temp_class=pos_x+&quot;-&quot;+pos_y;</span><br><span class="line">			var now_class=&quot;tile-position-&quot;+pos_x+&quot;-&quot;+pos_y;</span><br><span class="line">			var	next_class=&quot;tile-position-&quot;+(pos_x+2)+&quot;-&quot;+pos_y;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			$(&quot;#block-box .tile&quot;).each(function()&#123;</span><br><span class="line">				</span><br><span class="line">				if($(this).hasClass(now_class))&#123;</span><br><span class="line">					$(this).removeClass(now_class);</span><br><span class="line">					$(this).addClass(next_class);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">				</span><br><span class="line">				//赋值保持后续连续</span><br><span class="line">				move_array2[i+1][j]=move_array2[i-1][j]+20;</span><br><span class="line">				move_array2[i-1][j]=0;</span><br><span class="line">				valid_step=true;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		//移动1格</span><br><span class="line">		if(move_array2[i-1][j]&gt;move_array2[i][j])&#123;</span><br><span class="line"></span><br><span class="line">			var pos_str=(move_array2[i-1][j]).toString();</span><br><span class="line"></span><br><span class="line">			$(&quot;#block-box .tile&quot;).each(function()&#123;</span><br><span class="line">				</span><br><span class="line">				if($(this).hasClass(now_class))&#123;</span><br><span class="line">					$(this).removeClass(now_class);</span><br><span class="line">					$(this).addClass(next_class);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">				</span><br><span class="line">				//赋值保持后续连续</span><br><span class="line">				move_array2[i][j]=move_array2[i-1][j]+10;</span><br><span class="line">				move_array2[i-1][j]=0;</span><br><span class="line">				valid_step=true;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="合并成功叠加分数"><a href="#合并成功叠加分数" class="headerlink" title="合并成功叠加分数"></a>合并成功叠加分数</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function add_score () &#123;</span><br><span class="line">	score_total=score_total+score_each;</span><br><span class="line">	$(&quot;.now-score span&quot;).text(score_total);</span><br><span class="line">	var now_score=$(&quot;.now-score&quot;);</span><br><span class="line">	var plus_scr=&quot;+&quot;+score_each;</span><br><span class="line">	var score_div=$(&quot;&lt;div&gt;&lt;/div&gt;&quot;);</span><br><span class="line">		score_div.addClass(&quot;score-block&quot;);</span><br><span class="line">		score_div.html(plus_scr);</span><br><span class="line">		score_div.appendTo(now_score);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="产生2048胜利或者失败"><a href="#产生2048胜利或者失败" class="headerlink" title="产生2048胜利或者失败"></a>产生2048胜利或者失败</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">function decide_win()&#123;</span><br><span class="line"></span><br><span class="line">	$(&quot;.useless&quot;).remove();  </span><br><span class="line"></span><br><span class="line">	var won=false;</span><br><span class="line">	//每次一来都看是否已经存在2048</span><br><span class="line">	for (var i=0;i&lt;merge_array2.length; i++) &#123;</span><br><span class="line">		for (var j = 0; j &lt; merge_array2.length; j++) &#123;</span><br><span class="line">			if(parseInt(merge_array2[i][j])==2048)&#123;</span><br><span class="line">				won=true;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if(won)&#123;</span><br><span class="line"></span><br><span class="line">		$(&quot;#game-message&quot;).css(&quot;display&quot;,&quot;block&quot;);</span><br><span class="line">		$(&quot;.you-win&quot;).css(&quot;display&quot;,&quot;inline-block&quot;);</span><br><span class="line">		$(&quot;.you-lose&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line"></span><br><span class="line">	&#125;else&#123;</span><br><span class="line"></span><br><span class="line">		//判定各个方向抖不存在相同相邻的数字则失败</span><br><span class="line"></span><br><span class="line">		var not_left=true,not_right=true,not_up=true,not_down=true;</span><br><span class="line">		tiles_count=$(&quot;#block-box .tile&quot;).size();</span><br><span class="line"></span><br><span class="line">		console.info(tiles_count);</span><br><span class="line">		</span><br><span class="line">		if(tiles_count==16)&#123;</span><br><span class="line">			for (var i=0;i&lt;merge_array2.length; i++) &#123;</span><br><span class="line">				for (var j = 0; j &lt; merge_array2.length; j++) &#123;</span><br><span class="line">					if(i&gt;0)&#123;</span><br><span class="line">						 if((merge_array2[i][j]==merge_array2[i-1][j])&amp;&amp;(merge_array2[i][j]&gt;0)&amp;&amp;(merge_array2[i-1][j]&gt;0))&#123;</span><br><span class="line">							not_left=false;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					if(i&lt;merge_array2.length-1)&#123;</span><br><span class="line">						 if((merge_array2[i][j]==merge_array2[i+1][j])&amp;&amp;(merge_array2[i][j]&gt;0)&amp;&amp;(merge_array2[i+1][j]&gt;0))&#123;</span><br><span class="line">							not_right=false;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					if(j&gt;0)&#123;</span><br><span class="line">						if((merge_array2[i][j]==merge_array2[i][j-1])&amp;&amp;(merge_array2[i][j]&gt;0)&amp;&amp;(merge_array2[i][j-1]&gt;0))&#123;</span><br><span class="line">							not_up=false;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					if(j&lt;merge_array2.length-1)&#123;</span><br><span class="line">						if((merge_array2[i][j]==merge_array2[i][j+1])&amp;&amp;(merge_array2[i][j]&gt;0)&amp;&amp;(merge_array2[i][j+1]&gt;0))&#123;</span><br><span class="line">							not_down=false;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			//console.info(not_left+&quot;---&quot;+not_up+&quot;---&quot;+not_right+&quot;---&quot;+not_down);</span><br><span class="line">			//显示失败的提示</span><br><span class="line">			if(not_left&amp;&amp;not_right&amp;&amp;not_up&amp;&amp;not_down)&#123;</span><br><span class="line">				$(&quot;#game-message&quot;).css(&quot;display&quot;,&quot;block&quot;);</span><br><span class="line">				$(&quot;.you-win&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">				$(&quot;.you-lose&quot;).css(&quot;display&quot;,&quot;inline-block&quot;);</span><br><span class="line">				if(typeof localStorage.best == &quot;undefined&quot;)&#123;</span><br><span class="line">					localStorage.best=0;</span><br><span class="line">				&#125;</span><br><span class="line">				var bst=parseInt(localStorage.best);</span><br><span class="line">				if(score_total&gt;bst)&#123;</span><br><span class="line">					localStorage.best=score_total;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				$(&quot;.best-score span&quot;).text(localStorage.best);</span><br><span class="line">				//alert(3);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[插入排序动画]]></title>
      <url>/2014/07/15/%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F%E5%8A%A8%E7%94%BB/</url>
      <content type="html"><![CDATA[<p>实现一个插入排序算法，要通过动画展示出来，显示排序数组交换的每一个步骤。常规的插入排序我们都学过，数字交换简单，这里其实就是将数字换成图形，数字交互改为图形的动画位置交换。我们看下效果：</p>
<p><iframe src="../../../../innerWeb/insertionSort/index.html" width="900" height="700"><iframe></iframe></iframe></p>
<h3 id="搭建结构动态创建"><a href="#搭建结构动态创建" class="headerlink" title="搭建结构动态创建"></a>搭建结构动态创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">	&lt;head&gt;</span><br><span class="line">		&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">		&lt;title&gt;hotel&lt;/title&gt;</span><br><span class="line">		&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/main.css&quot;&gt;</span><br><span class="line">		&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;&gt;</span><br><span class="line">	&lt;/head&gt;</span><br><span class="line">	&lt;body&gt;</span><br><span class="line">		&lt;div id=&quot;btns&quot;&gt;</span><br><span class="line">			&lt;a href=&quot;###&quot; class=&quot;inite&quot;&gt;生成随机数&lt;/a&gt;</span><br><span class="line">			&lt;a href=&quot;###&quot; class=&quot;start&quot;&gt;插入排序&lt;/a&gt;</span><br><span class="line">			&lt;a href=&quot;###&quot; class=&quot;fast&quot;&gt;快速插入排序&lt;/a&gt;</span><br><span class="line">			&lt;div id=&quot;mask&quot;&gt;&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;div id=&quot;ctt&quot;&gt;</span><br><span class="line">			&lt;div class=&quot;move_box&quot;&gt;</span><br><span class="line">				&lt;div class=&quot;pillar&quot;&gt;&lt;/div&gt;</span><br><span class="line">				&lt;div class=&quot;num&quot;&gt;0&lt;/div&gt;</span><br><span class="line">			&lt;/div&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">		&lt;script type=&quot;text/javascript&quot; src=&quot;js/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">	&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="动画使用CSS动画"><a href="#动画使用CSS动画" class="headerlink" title="动画使用CSS动画"></a>动画使用CSS动画</h3><ul>
<li>位置动画</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#btns&#123;</span><br><span class="line">	position: relative;</span><br><span class="line">	top: 300px;</span><br><span class="line">	margin: 20px auto;</span><br><span class="line">	width: 400px;</span><br><span class="line">	padding: 20px;</span><br><span class="line">	 -webkit-animation: btns-start 1s ease-in-out;</span><br><span class="line">    -moz-animation: btns-start 1s ease-in-out;</span><br><span class="line">    animation: btns-start 1s ease-in-out;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>长度动画</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@keyframes  btns-up&#123;</span><br><span class="line">	0%&#123;</span><br><span class="line">		top: 300px;</span><br><span class="line">	&#125;</span><br><span class="line">	100%&#123;</span><br><span class="line">		top:  60px;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="排序交换"><a href="#排序交换" class="headerlink" title="排序交换"></a>排序交换</h3><ul>
<li>生成随机数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">inite_btn.onclick = function() &#123;</span><br><span class="line">        btns_box.className=&quot;rise&quot;;</span><br><span class="line">        ctt_box.className=&quot;drop&quot;;</span><br><span class="line">        setTimeout(function()&#123;</span><br><span class="line">            not_fast=true;</span><br><span class="line">            start_btn.style.zIndex=100;</span><br><span class="line">            fast_btn.style.zIndex=100;</span><br><span class="line">            for (var i = 0; i &lt; boxs.length; i++) &#123;</span><br><span class="line">                var distance=i*40;</span><br><span class="line">                var rand=Math.floor(Math.random()*99+1);</span><br><span class="line">                boxs[i].style.left=distance+&quot;px&quot;;</span><br><span class="line">                ary[i]=rand;</span><br><span class="line">                box_ary[i]=boxs[i];</span><br><span class="line">                boxs[i].querySelector(&quot;.num&quot;).innerText=rand;</span><br><span class="line">            &#125;;</span><br><span class="line">            setTimeout(function()&#123;</span><br><span class="line">                for (var j = 0; j &lt; pillars.length; j++) &#123;</span><br><span class="line">                    pillars[j].style.height=ary[j]*4+&quot;px&quot;;</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;,500);</span><br><span class="line">        &#125;,500);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>插入排序动画</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">function outer_s() &#123;</span><br><span class="line">            </span><br><span class="line">            inite_btn.style.zIndex=10;</span><br><span class="line">            start_btn.style.zIndex=10;</span><br><span class="line">            fast_btn.style.zIndex=10;</span><br><span class="line">            var new_key,temp_num,temp_box;</span><br><span class="line">            if(j&lt;ary.length)&#123;</span><br><span class="line">                new_key=ary[j];</span><br><span class="line">                temp_num=j-1;</span><br><span class="line">                inner_s();</span><br><span class="line">                function inner_s()&#123;</span><br><span class="line">                    if(temp_num&gt;=0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        if(ary[temp_num]&gt;new_key)&#123;</span><br><span class="line">                            ary[temp_num+1]=ary[temp_num];</span><br><span class="line">                            ary[temp_num]=new_key;</span><br><span class="line">                            var temp_r_left=parseInt((box_ary[temp_num+1].style.left).replace(/px/,&quot;&quot;));</span><br><span class="line">                            var temp_l_left=parseInt((box_ary[temp_num].style.left).replace(/px/,&quot;&quot;));</span><br><span class="line">                            box_ary[temp_num+1].style.left=(temp_r_left-40)+&quot;px&quot;;</span><br><span class="line">                            box_ary[temp_num].style.left=(temp_l_left+40)+&quot;px&quot;;</span><br><span class="line">                            if(not_fast)&#123;</span><br><span class="line">                                box_ary[temp_num+1].querySelector(&quot;.pillar&quot;).style.background=&quot;#C8B29D&quot;;</span><br><span class="line">                                box_ary[temp_num+1].querySelector(&quot;.pillar&quot;).style.boxShadow=&quot;2px 1px 2px #A67664&quot;;</span><br><span class="line">                                box_ary[temp_num].querySelector(&quot;.pillar&quot;).style.background=&quot;#C8B29D&quot;;</span><br><span class="line">                                box_ary[temp_num].querySelector(&quot;.pillar&quot;).style.boxShadow=&quot;2px 1px 2px #A67664&quot;;</span><br><span class="line">                                setTimeout(function()&#123;</span><br><span class="line">                                    for (var i = 0; i &lt; box_ary.length; i++) &#123;</span><br><span class="line">                                        box_ary[i].querySelector(&quot;.pillar&quot;).style.background=&quot;#7EC9B2&quot;;</span><br><span class="line">                                        box_ary[i].querySelector(&quot;.pillar&quot;).style.boxShadow=&quot;2px 1px 2px #37866F&quot;;</span><br><span class="line"></span><br><span class="line">                                    &#125;;</span><br><span class="line">                                &#125;,1000);</span><br><span class="line">                            &#125;</span><br><span class="line">                            temp_box=box_ary[temp_num+1];</span><br><span class="line">                            box_ary[temp_num+1]=box_ary[temp_num];</span><br><span class="line">                            box_ary[temp_num]=temp_box;</span><br><span class="line">                            temp_num--;</span><br><span class="line">                            setTimeout(inner_s,1000);</span><br><span class="line">                        &#125;else&#123;</span><br><span class="line">                            j++;</span><br><span class="line">                            outer_s();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        j++;</span><br><span class="line">                        outer_s();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                j=1;</span><br><span class="line">                inite_btn.style.zIndex=100;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        
        <tags>
            
            <tag> 开发 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[毕业照]]></title>
      <url>/2014/06/26/%E6%AF%95%E4%B8%9A%E7%85%A7/</url>
      <content type="html"><![CDATA[<h2 id="冰岩作坊"><a href="#冰岩作坊" class="headerlink" title="冰岩作坊"></a>冰岩作坊</h2><p><img src="/assets/myPhoto/0.jpg" alt=""></p>
<h2 id="彩云之南"><a href="#彩云之南" class="headerlink" title="彩云之南"></a>彩云之南</h2><p><img src="/assets/myPhoto/2.jpg" alt=""></p>
<p><img src="/assets/myPhoto/3.jpg" alt=""></p>
<p><img src="/assets/myPhoto/4.jpg" alt=""></p>
<!--![](/assets/myPhoto/5.jpg)-->
<p><img src="/assets/myPhoto/6.jpg" alt=""></p>
<p><img src="/assets/myPhoto/7.jpg" alt=""></p>
<p><img src="/assets/myPhoto/8.jpg" alt=""></p>
<p><img src="/assets/myPhoto/9.jpg" alt=""></p>
<h2 id="校园毕业照"><a href="#校园毕业照" class="headerlink" title="校园毕业照"></a>校园毕业照</h2><p><img src="/assets/myPhoto/10.jpg" alt=""></p>
<p><img src="/assets/myPhoto/11.jpg" alt=""></p>
<p><img src="/assets/myPhoto/12.jpg" alt=""></p>
<p><img src="/assets/myPhoto/13.jpg" alt=""></p>
<p><img src="/assets/myPhoto/14.jpg" alt=""></p>
<p><img src="/assets/myPhoto/15.jpg" alt=""></p>
<p><img src="/assets/myPhoto/16.jpg" alt=""></p>
<p><img src="/assets/myPhoto/17.jpg" alt=""></p>
<p><img src="/assets/myPhoto/18.jpg" alt=""></p>
<p><img src="/assets/myPhoto/19.jpg" alt=""></p>
<p><img src="/assets/myPhoto/20.jpg" alt=""></p>
]]></content>
      
        
        <tags>
            
            <tag> 照片 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[我在武汉的四年]]></title>
      <url>/2014/06/22/%E6%88%91%E5%9C%A8%E6%AD%A6%E6%B1%89%E7%9A%84%E5%9B%9B%E5%B9%B4/</url>
      <content type="html"><![CDATA[<h3 id="四年"><a href="#四年" class="headerlink" title="四年"></a>四年</h3><p>过几天就走了，心里开始有些感慨，大家为了各自的梦想，要出发离开这里，四年的青春定格在了回忆。</p>
<p>想起当年入学的时候，既对新校园满怀期待和热情，也对自己高考不满意懊恼过，来到了一所自己从来没考虑过的学校，怀着复杂的心情开始了自己的大学生活。为人热情的我很快和班上的人打得一片火热，希望在大学里能做出的点事情，积极当了军训副排长，积极当了班级团支部书记，还组织了校园活动，取得了很好的校园成绩，获得了奖状奖章。不知不觉的就开心的度过了新生的一年，同时也结识了一群小伙伴，就是后来我们一起去的云南。必是玩的太嗨了，第一年个人专业课学习成绩中等。</p>
<p>大二的时候，我听学长的建议开始自主学习编程，并争取加入了学校的创新团队冰岩作坊，做web开发相关的。当时团队氛围比较和洽，一同进去的几位同学又都比较厌倦通信的课程，大家几个人一伙同啊，就放飞自己我了，在团队的工作玩和学习，做事情和效力，专业的上课就基本靠突击考试了。想想那时候意气风发，一方面web编程进步很大，可以算是同学里面比较突出的了，知道自己未来毕业完全有机会找一份很好的工作了，所以非常满意自己选择加入团队。但一方面专业学习大家都没在意，学得不扎实，专业课成绩惨淡。</p>
<p>这样的状态一直持续到大三下学期，在团队做了很多事情，把自己从一个软件编程小白变成了同学里面还算可以的小司机，为学校开发了多个网站，得到了老师的肯定，并有机会出去实习。到了这个时候，我开始想起了自己心中的遗憾，思考了很久，还是决定惜别团队，去完成了我从前的愿望，告别了指导老师。我加入了考研大军，设定了一个遥远的目标清华电子系，我相信自己努力就可以达到，考研不仅是一个艰苦的学习过程，更是一个对自己的认识和确认过程。从那之后，我开始坚持每日学习，并与一起准备考试的小伙伴奋战考试。考研复习期间，身边的同学找工作出国保研各自进行着，我不为所动，专心准备着。</p>
<p>3月份的时候出了成绩，考试数学的时候紧张了，想起了高考的时候，这半年压力也是确实大，选了一个最难考的学校，哈哈，还是没能如愿。不过我却不像之前高考那时候难过了，我认识到了自己的不足所在，坦然接受了这个结果，不是我不够聪明，是我内心不够平稳，心态不够自信。回想起来，高考的时候也是一样，虽然考的好的时候的确可以冲清北，但差的时候不就是华科水平吗，上课不专心听讲，天天打瞌睡，平常吊儿郎当嘻嘻哈哈，自然没能给我积攒足够的信心。类比这次考研也是一样，我前三年都没有太多用心在专业学习上，成绩普通，却定了一个一般人都不敢尝试的学校目标，虽然平常测验基本能够达到分数，但是校验会存在不准确，自己也还是那个问题，我内心的信心积累的不够，考试的时候容易紧张，就凉了。好吧，我表示并不难过，愉快的开始找起了工作。</p>
<p>错过了秋季招聘，各大互联网公司的校招都结束了，只有个别公司还有春季招聘的补招，哎呀到了关键时候了。当初选择来考研，大三的时候BAT实习一个都没去，冰岩的老大问我说要不要去微信实习，这个机会不错，我一点都没犹豫就说不去了，哈哈，还是年轻。一起和其他同学去面试了第一家公司，人生第一次参加校招面试，几轮面试下来，就我一个人过，这给了我不少信心，这样录取我的第一家公司叫做TPLink。回头一想，团队的同学都去的腾讯百度，你让我去这里，不太合适吧，于是拒绝了offer。然而啊春，招的机会实在是太少了，没啥大公司来了，根本没机会啊，天要亡我吗…等啊等，等来了一个搜狐，我跑去参加面试搜狐的研发职位，一看，产品岗位的面试官不就是我团队的学长吗，我擦嘞，好好表现，好好表现就问题不大了，哈哈，春季的补招相对会流程简化一些，经过两轮面试，看的出面试官对我比较满意，回头和学长聊了聊，咨询了面试情况和搜狐的工作待遇，比较放松的回去了。然后又是等啊等，等待到了最后一个上车机会，就是去哪儿网的春季补招。公司来面试的那一天是一个web前端开发的大佬面试我，我和盘托出大二大三写过的网站，回答了面试官的问题，一面都给我定了offer，很明显校招里面算可以的了，何况还是春季补招。哈哈，这样我就放了心，想起大二的时候曾经用过他们的手机端去哪儿旅行，体验很棒，买票很方便啊，改变了人们的旅行交通方式，当时想要是能去这家公司上班该多好啊，现在看来，一切有为法，都是缘分。所以我校招就拿了三个offer，一个TPLink在深圳，一个搜狐和一个去哪儿在北京。我欣然的选择了我喜欢的去哪儿，因为是个向往旅行的人。</p>
<p>到这里，我的四年就这样简略的写完了，当然还有那些的友情故事没写，谈妹子那段也跳过了，哈哈。我在大学里不断的尝试新东西，不停的突破自己，不断的寻求更好且更适合自己的道路，这就是我的大学经历。和同学说起我的心里想法，他们听到的都是，”我对大学的经历路程十分满意，不曾犹豫和后悔过一个选择”。</p>
<h3 id="致谢："><a href="#致谢：" class="headerlink" title="致谢："></a>致谢：</h3><p>感谢彩云之南多位同学一路陪伴成长</p>
<p>感谢冰岩作坊团队老师和同学给予我见识和机会</p>
<p>感谢我们巴蜀中学武汉联盟成员</p>
<p>感谢321寝室同学在生活中的包容</p>
<p>感谢通信1003班以及专业同学共同学习</p>
<p>感谢毕业设计的老师和同学照料</p>
<p>感谢我在学校认识的每一位有缘人</p>
]]></content>
      
        
        <tags>
            
            <tag> 总结 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
